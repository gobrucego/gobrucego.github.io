<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>7天：Wireshark抓包入门</title>
    <link href="/2025/11/10/7%E5%A4%A9%EF%BC%9AWireshark%E6%8A%93%E5%8C%85%E5%85%A5%E9%97%A8/"/>
    <url>/2025/11/10/7%E5%A4%A9%EF%BC%9AWireshark%E6%8A%93%E5%8C%85%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1>第7天：Wireshark抓包入门</h1><blockquote><p>“看见网络数据包的流动，就像看见了互联网的血液循环。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>学会安装和使用Wireshark</li><li>掌握基本的抓包和过滤技巧</li><li>能够分析HTTP请求过程</li><li>理解各层协议在实际数据包中的呈现</li></ul><h2 id="🎯-什么是Wireshark？">🎯 什么是Wireshark？</h2><p><strong>Wireshark</strong>是世界上最流行的网络协议分析工具（也叫抓包工具）。</p><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">Wireshark = 网络显微镜<br><br>就像医生用显微镜观察血液：<br><span class="hljs-bullet">- </span>看到红细胞、白细胞<br><span class="hljs-bullet">- </span>分析血液成分<br><span class="hljs-bullet">- </span>诊断健康问题<br><br>Wireshark让你看到网络数据包：<br><span class="hljs-bullet">- </span>看到TCP、HTTP、DNS包<br><span class="hljs-bullet">- </span>分析数据内容<br><span class="hljs-bullet">- </span>诊断网络问题<br></code></pre></td></tr></table></figure><h3 id="Wire">Wire</h3><p>shark的特点</p><ul><li>🔍 <strong>可视化</strong>：图形界面，易于使用</li><li>🎨 <strong>彩色显示</strong>：不同协议不同颜色</li><li>🔎 <strong>强大过滤</strong>：快速找到需要的包</li><li>📊 <strong>统计分析</strong>：流量统计、协议分布</li><li>💾 <strong>保存分析</strong>：可以保存抓包文件</li><li>🌐 <strong>跨平台</strong>：支持Windows、Mac、Linux</li></ul><h2 id="🔧-安装Wireshark">🔧 安装Wireshark</h2><h3 id="下载">下载</h3><p>访问官网：<a href="https://www.wireshark.org/">https://www.wireshark.org/</a></p><h3 id="各平台安装">各平台安装</h3><p><strong>Windows</strong>：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 下载.exe安装包<br><span class="hljs-bullet">2.</span> 双击安装<br><span class="hljs-bullet">3.</span> 安装过程中选择安装WinPcap或Npcap（必需）<br><span class="hljs-bullet">4.</span> 完成后重启计算机<br></code></pre></td></tr></table></figure><p><strong>Mac</strong>：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 下载.dmg文件<br><span class="hljs-bullet">2.</span> 拖动到Applications文件夹<br><span class="hljs-bullet">3.</span> 首次运行可能需要在系统偏好设置中允许<br></code></pre></td></tr></table></figure><p><strong>Linux（Ubuntu/Debian）</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt install wireshark<br><br><span class="hljs-comment"># 添加当前用户到wireshark组</span><br><span class="hljs-built_in">sudo</span> usermod -aG wireshark <span class="hljs-variable">$USER</span><br><br><span class="hljs-comment"># 重新登录生效</span><br></code></pre></td></tr></table></figure><h2 id="📖-Wireshark界面介绍">📖 Wireshark界面介绍</h2><h3 id="主界面布局">主界面布局</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs tap">┌─────────────────────────────────────────────────────────┐<br>│  菜单栏: 文件 编辑 查看 捕获 分析 统计 帮助         │<br>├─────────────────────────────────────────────────────────┤<br>│  工具栏: [开始] [停止] [重启] [保存] ...                │<br>├─────────────────────────────────────────────────────────┤<br>│  过滤器: [___________________________] [应用]           │<br>├─────────────────────────────────────────────────────────┤<br>│  ① 数据包列表区（Packet List）                          │<br>│  No.  Time     Source      Destination  Protocol Info   │<br>│ <span class="hljs-number"> 1 </span>   0.000    192.168.1.1 192.168.1.2  TCP      SYN    │<br>│ <span class="hljs-number"> 2 </span>   0.001    192.168.1.2 192.168.1.1  TCP      ACK    │<br>├─────────────────────────────────────────────────────────┤<br>│  ② 数据包详情区（Packet Details）                       │<br>│  ▶ Frame 1:<span class="hljs-number"> 74 </span>bytes on wire                            │<br>│  ▶ Ethernet II, Src: aa:bb:cc:dd:ee:ff                  │<br>│  ▶ Internet Protocol Version<span class="hljs-number"> 4 </span>                         │<br>│  ▶ Transmission Control Protocol                        │<br>├─────────────────────────────────────────────────────────┤<br>│  ③ 十六进制数据区（Packet Bytes）                       │<br>│ <span class="hljs-number"> 0000 </span><span class="hljs-number"> 00 </span>0c<span class="hljs-number"> 29 </span>6f 6c<span class="hljs-number"> 92 </span>00 0c<span class="hljs-number"> 29 </span>5b 3f e8<span class="hljs-number"> 08 </span>00<span class="hljs-number"> 45 </span>00 │<br>│ <span class="hljs-number"> 0010 </span><span class="hljs-number"> 00 </span>3c f9<span class="hljs-number"> 68 </span>40<span class="hljs-number"> 00 </span>40<span class="hljs-number"> 06 </span>38<span class="hljs-number"> 57 </span>c0 a8<span class="hljs-number"> 01 </span>64 c0 a8 │<br>└─────────────────────────────────────────────────────────┘<br></code></pre></td></tr></table></figure><h3 id="三大区域">三大区域</h3><ol><li><strong>数据包列表区</strong>：显示捕获的所有包</li><li><strong>数据包详情区</strong>：显示选中包的协议层次结构</li><li><strong>十六进制数据区</strong>：显示原始字节数据</li></ol><h2 id="🔍-开始第一次抓包">🔍 开始第一次抓包</h2><h3 id="步骤1：选择网络接口">步骤1：选择网络接口</h3><ol><li>启动Wireshark</li><li>在主界面看到网络接口列表</li><li>选择正在使用的接口（有流量波形的）<ul><li>WiFi：通常是 <code>en0</code>（Mac）或 <code>wlan0</code>（Linux）</li><li>有线：通常是 <code>eth0</code> 或 <code>en0</code></li></ul></li></ol><h3 id="步骤2：开始捕获">步骤2：开始捕获</h3><p>点击接口名称或点击工具栏的&quot;开始捕获&quot;按钮（鲨鱼鳍图标）</p><h3 id="步骤3：生成流量">步骤3：生成流量</h3><p>在浏览器中访问：<a href="http://www.example.com">http://www.example.com</a></p><h3 id="步骤4：停止捕获">步骤4：停止捕获</h3><p>点击工具栏的&quot;停止捕获&quot;按钮（红色方块）</p><h2 id="🎨-认识颜色代码">🎨 认识颜色代码</h2><p>Wireshark用颜色区分不同类型的包：</p><table><thead><tr><th>颜色</th><th>协议/类型</th><th>含义</th></tr></thead><tbody><tr><td>浅紫色</td><td>TCP</td><td>TCP协议</td></tr><tr><td>浅蓝色</td><td>UDP</td><td>UDP协议</td></tr><tr><td>黑色</td><td>有问题的包</td><td>校验和错误、重传等</td></tr><tr><td>浅绿色</td><td>HTTP</td><td>HTTP协议</td></tr><tr><td>浅黄色</td><td>Windows特定</td><td>NetBIOS、SMB等</td></tr><tr><td>深灰色</td><td>TCP重传</td><td>数据包重传</td></tr></tbody></table><h2 id="🔎-过滤器使用">🔎 过滤器使用</h2><h3 id="显示过滤器（Display-Filter）">显示过滤器（Display Filter）</h3><p><strong>在工具栏的过滤器框中输入</strong>，用于过滤已捕获的包。</p><h4 id="常用过滤器">常用过滤器</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># 只显示HTTP</span><br><span class="hljs-attribute">http</span><br><br><span class="hljs-comment"># 只显示TCP</span><br>tcp<br><br><span class="hljs-comment"># 只显示特定IP</span><br>ip.addr == <span class="hljs-number">192.168.1.100</span><br><br><span class="hljs-comment"># 只显示源IP</span><br>ip.src == <span class="hljs-number">192.168.1.100</span><br><br><span class="hljs-comment"># 只显示目标IP</span><br>ip.dst == <span class="hljs-number">8.8.8.8</span><br><br><span class="hljs-comment"># 只显示特定端口</span><br>tcp.port == <span class="hljs-number">80</span><br><br><span class="hljs-comment"># 组合条件（AND）</span><br>ip.addr == <span class="hljs-number">192.168.1.100</span> &amp;&amp; tcp.port == <span class="hljs-number">80</span><br><br><span class="hljs-comment"># 组合条件（OR）</span><br>http || dns<br><br><span class="hljs-comment"># 排除（NOT）</span><br>!arp<br><br><span class="hljs-comment"># HTTP GET请求</span><br>http.request.method == <span class="hljs-string">&quot;GET&quot;</span><br><br><span class="hljs-comment"># DNS查询</span><br>dns.flags.response == <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="捕获过滤器（Capture-Filter）">捕获过滤器（Capture Filter）</h3><p><strong>在开始捕获前设置</strong>，只捕获符合条件的包。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 只捕获80端口</span><br><span class="hljs-attribute">port</span> <span class="hljs-number">80</span><br><br><span class="hljs-comment"># 只捕获特定主机</span><br><span class="hljs-attribute">host</span> <span class="hljs-number">192.168.1.100</span><br><br><span class="hljs-comment"># 只捕获TCP</span><br><span class="hljs-attribute">tcp</span><br><br><span class="hljs-comment"># 组合条件</span><br><span class="hljs-attribute">host</span> <span class="hljs-number">192.168.1.100</span> and port <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><h2 id="🔬-实战：分析HTTP请求">🔬 实战：分析HTTP请求</h2><p>让我们实际抓取并分析一个HTTP请求！</p><h3 id="步骤1：设置过滤器">步骤1：设置过滤器</h3><p>在开始前，设置显示过滤器：<code>http</code></p><h3 id="步骤2：开始捕获-2">步骤2：开始捕获</h3><p>点击开始按钮</p><h3 id="步骤3：访问网站">步骤3：访问网站</h3><p>在浏览器访问：<a href="http://www.example.com">http://www.example.com</a><br>（注意：必须是http，不是https）</p><h3 id="步骤4：停止并分析">步骤4：停止并分析</h3><p>停止捕获，你会看到HTTP请求和响应。</p><h3 id="分析HTTP-GET请求">分析HTTP GET请求</h3><p>找到一个HTTP GET请求包，点击它：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">在数据包详情区，你会看到：</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">▶ Frame 123</span><span class="hljs-punctuation">:</span> <span class="hljs-string">502 bytes on wire</span><br>  <span class="hljs-attribute">├─ 物理层信息</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">▶ Ethernet II</span><br><span class="hljs-attribute">  ├─ Destination</span><span class="hljs-punctuation">:</span> <span class="hljs-string">xx:xx:xx:xx:xx:xx</span><br>  <span class="hljs-attribute">├─ Source</span><span class="hljs-punctuation">:</span> <span class="hljs-string">yy:yy:yy:yy:yy:yy</span><br>  <span class="hljs-attribute">└─ Type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">IPv4 (0x0800)</span><br>    <span class="hljs-comment"># 数据链路层：MAC地址</span><br><br><span class="hljs-attribute">▶ Internet Protocol Version 4</span><br><span class="hljs-attribute">  ├─ Source</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.1.100</span><br>  <span class="hljs-attribute">├─ Destination</span><span class="hljs-punctuation">:</span> <span class="hljs-string">93.184.216.34</span><br>  <span class="hljs-attribute">├─ Protocol</span><span class="hljs-punctuation">:</span> <span class="hljs-string">TCP (6)</span><br>  <span class="hljs-attribute">└─ TTL</span><span class="hljs-punctuation">:</span> <span class="hljs-string">64</span><br>    <span class="hljs-comment"># 网际层：IP地址</span><br><br><span class="hljs-attribute">▶ Transmission Control Protocol</span><br><span class="hljs-attribute">  ├─ Source Port</span><span class="hljs-punctuation">:</span> <span class="hljs-string">54321</span><br>  <span class="hljs-attribute">├─ Destination Port</span><span class="hljs-punctuation">:</span> <span class="hljs-string">80</span><br>  <span class="hljs-attribute">├─ Sequence number</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1</span><br>  <span class="hljs-attribute">└─ Flags</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0x018 (PSH, ACK)</span><br>    <span class="hljs-comment"># 传输层：端口号</span><br><br><span class="hljs-attribute">▶ Hypertext Transfer Protocol</span><br><span class="hljs-attribute">  ├─ GET / HTTP/1.1\r\n</span><br><span class="hljs-attribute">  ├─ Host</span><span class="hljs-punctuation">:</span> <span class="hljs-string">www.example.com\r\n</span><br>  <span class="hljs-attribute">├─ User-Agent</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Mozilla/5.0...\r\n</span><br>  <span class="hljs-attribute">├─ Accept</span><span class="hljs-punctuation">:</span> <span class="hljs-string">text/html...\r\n</span><br>  └─ \r\n<br>    <span class="hljs-comment"># 应用层：HTTP协议</span><br></code></pre></td></tr></table></figure><p><strong>看到了什么？</strong></p><ul><li>✅ 完整的TCP/IP四层结构！</li><li>✅ 每一层的头部信息</li><li>✅ HTTP请求的完整内容</li></ul><h3 id="分析HTTP响应">分析HTTP响应</h3><p>找到对应的HTTP响应包：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">▶ Hypertext Transfer Protocol<br>  ├─ HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK\<span class="hljs-attribute">r</span>\n<br>  ├─ Content-Type: text/html\<span class="hljs-attribute">r</span>\n<br>  ├─ Content-Length: <span class="hljs-number">1256</span>\<span class="hljs-attribute">r</span>\n<br>  ├─ Server: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">41</span>\<span class="hljs-attribute">r</span>\n<br>  └─ \<span class="hljs-attribute">r</span>\n<br>  └─ <span class="hljs-selector-attr">[HTML content]</span><br></code></pre></td></tr></table></figure><h2 id="💡-实用技巧">💡 实用技巧</h2><h3 id="1-跟踪TCP流">1. 跟踪TCP流</h3><p>右键点击一个TCP包 → Follow → TCP Stream</p><p><strong>作用</strong>：查看完整的TCP会话内容（所有来回的数据）</p><h3 id="2-统计信息">2. 统计信息</h3><p>菜单：Statistics → Protocol Hierarchy</p><p><strong>作用</strong>：查看各种协议的流量占比</p><h3 id="3-导出对象">3. 导出对象</h3><p>菜单：File → Export Objects → HTTP</p><p><strong>作用</strong>：提取HTTP传输的文件（图片、HTML等）</p><h3 id="4-时间列显示">4. 时间列显示</h3><p>右键点击Time列 → Display Format → 选择格式</p><p><strong>推荐</strong>：选择&quot;Seconds Since Previous Displayed Packet&quot;查看包间隔</p><h3 id="5-查找包">5. 查找包</h3><p>Ctrl+F（Windows/Linux）或 Cmd+F（Mac）</p><p>可以搜索：</p><ul><li>显示过滤器</li><li>十六进制值</li><li>字符串</li></ul><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ Wireshark是最强大的网络协议分析工具</li><li>✅ 可以看到每个数据包的完整结构</li><li>✅ 过滤器可以快速定位需要的包</li><li>✅ 可以分析HTTP、TCP、IP等各层协议</li><li>✅ 实际验证了前几天学习的协议知识</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>含义</th><th>用途</th></tr></thead><tbody><tr><td>抓包</td><td>捕获网络数据包</td><td>分析网络行为</td></tr><tr><td>显示过滤器</td><td>过滤已捕获的包</td><td>查看特定包</td></tr><tr><td>捕获过滤器</td><td>只捕获特定的包</td><td>减少文件大小</td></tr><tr><td>跟踪流</td><td>查看完整会话</td><td>理解通信过程</td></tr></tbody></table><h3 id="常用过滤器速查">常用过滤器速查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 协议过滤</span><br>http, tcp, udp, dns, icmp<br><br><span class="hljs-comment"># IP过滤</span><br>ip.addr == 192.168.1.1<br>ip.src == 192.168.1.1<br>ip.dst == 8.8.8.8<br><br><span class="hljs-comment"># 端口过滤</span><br>tcp.port == 80<br>tcp.srcport == 80<br>tcp.dstport == 443<br><br><span class="hljs-comment"># HTTP过滤</span><br>http.request<br>http.response<br>http.request.method == <span class="hljs-string">&quot;POST&quot;</span><br><br><span class="hljs-comment"># 逻辑运算</span><br>&amp;&amp; (AND)<br>|| (OR)<br>! (NOT)<br></code></pre></td></tr></table></figure><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：基础抓包">练习1：基础抓包</h3><ol><li>抓取访问baidu.com的数据包</li><li>找到DNS查询包</li><li>找到TCP三次握手的三个包</li><li>找到HTTP请求和响应</li></ol><h3 id="练习2：过滤器练习">练习2：过滤器练习</h3><p>使用过滤器完成以下任务：</p><ol><li>只显示你的电脑发送的包</li><li>只显示HTTP POST请求</li><li>显示所有到8.8.8.8的包</li><li>显示DNS查询但不显示响应</li></ol><h3 id="练习3：协议分析">练习3：协议分析</h3><p>抓取一个完整的HTTP请求，分析：</p><ol><li>TCP三次握手过程</li><li>HTTP请求头部内容</li><li>HTTP响应状态码</li><li>TCP四次挥手过程</li></ol><h3 id="练习4：进阶任务">练习4：进阶任务</h3><ol><li>导出一个网页传输的图片</li><li>统计5分钟内各协议的流量占比</li><li>找出延迟最大的数据包</li><li>分析一个TCP重传的包</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="为什么HTTPS不能抓包？">为什么HTTPS不能抓包？</h3><p>HTTPS是加密的：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">HTTP:  明文传输，Wireshark可以看到内容<br>HTTPS: 加密传输，Wireshark只能看到加密数据<br><br>要抓取HTTPS内容需要：<br><span class="hljs-bullet">1.</span> 安装证书<br><span class="hljs-bullet">2.</span> 配置浏览器导出密钥<br><span class="hljs-bullet">3.</span> 在Wireshark中配置SSL密钥日志<br></code></pre></td></tr></table></figure><h3 id="Wireshark的替代工具">Wireshark的替代工具</h3><ul><li><strong>tcpdump</strong>：命令行抓包工具</li><li><strong>Charles</strong>：专注HTTP/HTTPS的工具</li><li><strong>Fiddler</strong>：Windows上的HTTP调试工具</li><li><strong>mitmproxy</strong>：命令行的中间人代理</li></ul><h3 id="实际应用场景">实际应用场景</h3><ol><li><strong>Web开发调试</strong>：查看HTTP请求和响应</li><li><strong>网络故障排查</strong>：分析丢包、延迟</li><li><strong>安全分析</strong>：检测异常流量</li><li><strong>学习协议</strong>：深入理解网络协议</li><li><strong>性能优化</strong>：分析网络瓶颈</li></ol><h2 id="🎯-下一步：第一周总结">🎯 下一步：第一周总结</h2><p><strong>明天我们将总结第一周的所有内容！</strong></p><p>回顾：</p><ul><li>网络基础概念</li><li>OSI和TCP/IP模型</li><li>ping和traceroute命令</li><li>Wireshark抓包分析</li></ul><p>准备好进行第一周的综合测验了吗？</p><hr><p>💡 <strong>今日金句</strong>：Wireshark让不可见的网络数据包变得可见！</p><p>👉 <a href="day06.md">上一天：traceroute详解</a> | <a href="../../README.md">返回目录</a> | <a href="week_summary.md">下一天：第一周总结</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一周总结：网络基础入门</title>
    <link href="/2025/11/10/%E4%B8%80%E5%91%A8%E6%80%BB%E7%BB%93%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"/>
    <url>/2025/11/10/%E4%B8%80%E5%91%A8%E6%80%BB%E7%BB%93%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1>第一周总结：网络基础入门</h1><blockquote><p>“万丈高楼平地起，扎实基础是关键。”</p></blockquote><h2 id="🎯-本周回顾">🎯 本周回顾</h2><p>恭喜你完成了第一周的学习！让我们回顾一下这一周的精彩内容。</p><h3 id="📚-本周学习内容">📚 本周学习内容</h3><table><thead><tr><th>天数</th><th>主题</th><th>核心内容</th><th>实战项目</th></tr></thead><tbody><tr><td>第1天</td><td>认识计算机网络</td><td>网络基本概念、作用</td><td>网络连接检测工具</td></tr><tr><td>第2天</td><td>网络分类和拓扑</td><td>LAN/WAN/MAN、拓扑结构</td><td>局域网设备扫描器</td></tr><tr><td>第3天</td><td>OSI七层模型</td><td>七层结构、数据封装</td><td>协议分层演示</td></tr><tr><td>第4天</td><td>TCP/IP四层模型</td><td>实际应用模型、协议</td><td>数据包分析器</td></tr><tr><td>第5天</td><td>ping命令</td><td>ICMP协议、RTT</td><td>简易ping工具</td></tr><tr><td>第6天</td><td>traceroute命令</td><td>路由追踪、TTL</td><td>简易traceroute工具</td></tr><tr><td>第7天</td><td>Wireshark抓包</td><td>抓包分析、过滤器</td><td>实际抓包分析</td></tr></tbody></table><h2 id="📖-知识点总结">📖 知识点总结</h2><h3 id="1-网络基础概念">1. 网络基础概念</h3><p><strong>什么是计算机网络？</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">计算机网络 = 多台计算机通过通信线路连接<br><span class="hljs-bullet">             +</span> 共享资源<br><span class="hljs-bullet">             +</span> 交换信息<br></code></pre></td></tr></table></figure><p><strong>网络的分类</strong>：</p><ul><li>LAN（局域网）：家庭、办公室（几米到几公里）</li><li>MAN（城域网）：城市范围（几十公里）</li><li>WAN（广域网）：跨国、跨洲（几百到几万公里）</li></ul><p><strong>网络拓扑结构</strong>：</p><ul><li>总线型：所有设备连在一条线上</li><li>星型：所有设备连到中心节点（最常用）</li><li>环型：设备首尾相连成环</li><li>网状型：设备互相连接</li><li>树型：分层结构</li></ul><h3 id="2-OSI七层模型">2. OSI七层模型</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino">第<span class="hljs-number">7</span>层 - 应用层（Application）      → HTTP, FTP, DNS<br>第<span class="hljs-number">6</span>层 - 表示层（Presentation）     → 加密, 压缩<br>第<span class="hljs-number">5</span>层 - 会话层（Session）          → 会话管理<br>第<span class="hljs-number">4</span>层 - 传输层（Transport）        → TCP, UDP<br>第<span class="hljs-number">3</span>层 - 网络层（Network）          → IP, ICMP<br>第<span class="hljs-number">2</span>层 - 数据链路层（Data Link）    → <span class="hljs-built_in">Ethernet</span>, <span class="hljs-built_in">WiFi</span><br>第<span class="hljs-number">1</span>层 - 物理层（Physical）         → 网线, 光纤<br></code></pre></td></tr></table></figure><p><strong>记忆口诀</strong>：应表会传网数物</p><p><strong>数据封装过程</strong>：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">应用数据 → [传输层头|<span class="hljs-string">数据] → [网络层头</span>|<span class="hljs-string">传输层头</span>|<span class="hljs-string">数据]</span><br><span class="hljs-string">→ [链路层头</span>|<span class="hljs-string">网络层头</span>|<span class="hljs-string">传输层头</span>|<span class="hljs-string">数据</span>|<span class="hljs-string">链路层尾]</span><br></code></pre></td></tr></table></figure><h3 id="3-TCP-IP四层模型">3. TCP/IP四层模型</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs arduino">┌────────────────┐<br>│  应用层        │  HTTP, DNS, FTP, SSH<br>├────────────────┤<br>│  传输层        │  TCP, UDP<br>├────────────────┤<br>│  网际层        │  IP, ICMP, ARP<br>├────────────────┤<br>│  网络接口层    │  <span class="hljs-built_in">Ethernet</span>, <span class="hljs-built_in">WiFi</span><br>└────────────────┘<br></code></pre></td></tr></table></figure><p><strong>TCP/IP vs OSI</strong>：</p><ul><li>OSI：理论模型（7层）</li><li>TCP/IP：实际使用（4层）</li></ul><h3 id="4-关键协议">4. 关键协议</h3><h4 id="IP协议（Internet-Protocol）">IP协议（Internet Protocol）</h4><ul><li>作用：寻址和路由</li><li>IP地址：192.168.1.100</li><li>版本：IPv4（32位）、IPv6（128位）</li></ul><h4 id="TCP协议（Transmission-Control-Protocol）">TCP协议（Transmission Control Protocol）</h4><ul><li>作用：可靠传输</li><li>特点：面向连接、可靠、有序</li><li>端口：标识应用程序</li></ul><h4 id="UDP协议（User-Datagram-Protocol）">UDP协议（User Datagram Protocol）</h4><ul><li>作用：快速传输</li><li>特点：无连接、不可靠、简单快速</li></ul><h4 id="ICMP协议（Internet-Control-Message-Protocol）">ICMP协议（Internet Control Message Protocol）</h4><ul><li>作用：错误报告、网络诊断</li><li>应用：ping、traceroute</li></ul><h4 id="HTTP协议（Hypertext-Transfer-Protocol）">HTTP协议（Hypertext Transfer Protocol）</h4><ul><li>作用：网页传输</li><li>端口：80（HTTP）、443（HTTPS）</li><li>方法：GET、POST、PUT、DELETE等</li></ul><h3 id="5-重要概念">5. 重要概念</h3><p><strong>MAC地址</strong>：</p><ul><li>网卡的物理地址</li><li>格式：AA:BB:CC:DD:EE:FF</li><li>作用：局域网内通信</li></ul><p><strong>IP地址</strong>：</p><ul><li>网络中设备的逻辑地址</li><li>格式：192.168.1.1</li><li>作用：跨网络通信</li></ul><p><strong>端口号</strong>：</p><ul><li>标识主机上的应用程序</li><li>范围：0-65535</li><li>常用：80(HTTP)、443(HTTPS)、22(SSH)</li></ul><p><strong>TTL（Time To Live）</strong>：</p><ul><li>数据包的生存时间</li><li>每经过一个路由器减1</li><li>为0时被丢弃</li></ul><p><strong>RTT（Round-Trip Time）</strong>：</p><ul><li>往返时间</li><li>从发送到收到回复的时间</li><li>单位：毫秒(ms)</li></ul><h3 id="6-网络工具">6. 网络工具</h3><p><strong>ping</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 测试连通性</span><br>ping baidu.com<br><br><span class="hljs-comment"># 发送4个包</span><br>ping -c 4 baidu.com  <span class="hljs-comment"># Linux/Mac</span><br>ping -n 4 baidu.com  <span class="hljs-comment"># Windows</span><br></code></pre></td></tr></table></figure><p><strong>traceroute</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 追踪路由路径</span><br>traceroute baidu.com  <span class="hljs-comment"># Linux/Mac</span><br>tracert baidu.com     <span class="hljs-comment"># Windows</span><br></code></pre></td></tr></table></figure><p><strong>Wireshark</strong>：</p><ul><li>图形化抓包工具</li><li>支持多种协议分析</li><li>强大的过滤功能</li></ul><h2 id="🧪-综合练习题">🧪 综合练习题</h2><h3 id="一、选择题">一、选择题</h3><ol><li><p>以下哪个不是网络拓扑结构？<br>A. 星型  B. 环型  C. 圆型  D. 总线型</p></li><li><p>TCP/IP模型有几层？<br>A. 4层  B. 5层  C. 7层  D. 9层</p></li><li><p>ping命令使用的是哪个协议？<br>A. TCP  B. UDP  C. ICMP  D. HTTP</p></li><li><p>以下哪个IP地址是私网地址？<br>A. 8.8.8.8  B. 192.168.1.1  C. 114.114.114.114  D. 220.181.38.148</p></li><li><p>HTTP协议默认使用哪个端口？<br>A. 22  B. 80  C. 443  D. 3306</p></li></ol><h3 id="二、简答题">二、简答题</h3><ol><li><p>解释OSI模型中每一层的主要作用。</p></li><li><p>TCP和UDP有什么区别？各自适用于什么场景？</p></li><li><p>说明ping命令的工作原理。</p></li><li><p>什么是子网掩码？192.168.1.0/24是什么意思？</p></li><li><p>数据包从应用层到物理层的封装过程是怎样的？</p></li></ol><h3 id="三、实践题">三、实践题</h3><ol><li><p><strong>网络诊断</strong></p><ul><li>使用ping测试到baidu.com的连通性</li><li>记录RTT和TTL值</li><li>分析结果说明什么</li></ul></li><li><p><strong>路径追踪</strong></p><ul><li>使用traceroute追踪到google.com的路径</li><li>记录经过的跳数</li><li>哪一跳延迟最大？为什么？</li></ul></li><li><p><strong>抓包分析</strong></p><ul><li>使用Wireshark抓取访问<a href="http://www.example.xn--com-n82e636edycn86b">http://www.example.com的数据包</a></li><li>找出DNS查询包</li><li>找出TCP三次握手的包</li><li>找出HTTP GET请求包</li><li>分析每个包的各层结构</li></ul></li><li><p><strong>局域网扫描</strong></p><ul><li>扫描你所在的局域网</li><li>列出所有在线设备的IP和MAC地址</li><li>绘制简单的网络拓扑图</li></ul></li></ol><h2 id="🚀-综合实战项目">🚀 综合实战项目</h2><h3 id="项目：网络诊断工具箱">项目：网络诊断工具箱</h3><p><strong>需求</strong>：<br>开发一个综合的网络诊断工具，整合本周学到的所有知识。</p><p><strong>功能</strong>：</p><ol><li><strong>连通性测试</strong>：ping功能</li><li><strong>路由追踪</strong>：traceroute功能</li><li><strong>端口扫描</strong>：扫描指定主机的开放端口</li><li><strong>局域网扫描</strong>：发现局域网内的所有设备</li><li><strong>DNS查询</strong>：查询域名的IP地址</li><li><strong>网络信息</strong>：显示本机网络配置</li></ol><p><strong>实现提示</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day08_network_toolbox.py</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkToolbox</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">self, host</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;测试连通性&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">traceroute</span>(<span class="hljs-params">self, host</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;追踪路由&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_ports</span>(<span class="hljs-params">self, host, ports</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;扫描端口&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_lan</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;扫描局域网&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dns_lookup</span>(<span class="hljs-params">self, domain</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;DNS查询&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_network_info</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;获取本机网络信息&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    toolbox = NetworkToolbox()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== 网络诊断工具箱 ===&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. Ping测试&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. 路由追踪&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 端口扫描&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4. 局域网扫描&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;5. DNS查询&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;6. 网络信息&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;0. 退出&quot;</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请选择功能: &quot;</span>)<br>        <span class="hljs-comment"># 根据choice调用相应功能</span><br>        ...<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p><strong>评分标准</strong>：</p><ul><li>功能完整性：40分</li><li>代码质量：30分</li><li>用户体验：20分</li><li>创新性：10分</li></ul><h2 id="📊-自我评估">📊 自我评估</h2><h3 id="检查清单">检查清单</h3><p>完成本周学习后，你应该能够：</p><ul><li>[ ] 解释什么是计算机网络</li><li>[ ] 说出网络的三种分类</li><li>[ ] 画出五种网络拓扑结构</li><li>[ ] 列出OSI七层模型的每一层</li><li>[ ] 说明TCP/IP四层模型</li><li>[ ] 理解数据包的封装过程</li><li>[ ] 使用ping命令测试网络</li><li>[ ] 使用traceroute追踪路由</li><li>[ ] 使用Wireshark抓包</li><li>[ ] 编写简单的网络诊断程序</li></ul><h3 id="掌握程度评估">掌握程度评估</h3><p>为每个知识点打分（1-5分）：</p><table><thead><tr><th>知识点</th><th>掌握程度</th></tr></thead><tbody><tr><td>网络基础概念</td><td>□□□□□</td></tr><tr><td>网络分类和拓扑</td><td>□□□□□</td></tr><tr><td>OSI七层模型</td><td>□□□□□</td></tr><tr><td>TCP/IP四层模型</td><td>□□□□□</td></tr><tr><td>常用协议理解</td><td>□□□□□</td></tr><tr><td>ping命令使用</td><td>□□□□□</td></tr><tr><td>traceroute使用</td><td>□□□□□</td></tr><tr><td>Wireshark使用</td><td>□□□□□</td></tr><tr><td>网络编程基础</td><td>□□□□□</td></tr></tbody></table><p>如果某项低于3分，建议复习对应章节。</p><h2 id="💡-学习心得">💡 学习心得</h2><p><strong>思考题</strong>：</p><ol><li>本周学习中，哪个知识点你觉得最难理解？</li><li>哪个实战项目你觉得最有趣？</li><li>你遇到了什么困难？如何解决的？</li><li>对下周的学习有什么期待？</li></ol><p><strong>建议</strong>：</p><ul><li>写下你的学习心得</li><li>记录遇到的问题和解决方法</li><li>整理笔记，建立知识体系</li><li>多动手实践，光看不练假把式</li></ul><h2 id="🎯-下周预告">🎯 下周预告</h2><p><strong>第二周：深入理解网络模型</strong></p><p>我们将学习：</p><ul><li>第8天：IP地址详解</li><li>第9天：子网划分实战</li><li>第10天：MAC地址和ARP协议</li><li>第11天：端口和Socket深入</li><li>第12天：DNS协议详解</li><li>第13天：DHCP协议</li><li>第14天：第二周总结和项目</li></ul><p><strong>预习建议</strong>：</p><ul><li>复习本周的IP地址概念</li><li>了解二进制和十进制转换</li><li>思考：为什么需要子网划分？</li></ul><h2 id="🏆-成就解锁">🏆 成就解锁</h2><p>恭喜你完成第一周的学习！你已经解锁：</p><p>✅ <strong>网络入门者</strong>：完成第一周所有内容<br>✅ <strong>抓包新手</strong>：学会使用Wireshark<br>✅ <strong>诊断助手</strong>：会使用ping和traceroute<br>✅ <strong>代码实践者</strong>：编写了5个网络工具</p><p><strong>继续加油，向着网络大师的目标前进！</strong> 💪</p><hr><h2 id="📚-参考资料">📚 参考资料</h2><h3 id="推荐书籍">推荐书籍</h3><ul><li>《计算机网络：自顶向下方法》</li><li>《图解TCP/IP》</li><li>《网络是怎样连接的》</li></ul><h3 id="在线资源">在线资源</h3><ul><li>Wireshark官方文档：<a href="https://www.wireshark.org/docs/">https://www.wireshark.org/docs/</a></li><li>RFC文档库：<a href="https://www.rfc-editor.org/">https://www.rfc-editor.org/</a></li><li>TCP/IP指南：各大技术博客</li></ul><h3 id="练习网站">练习网站</h3><ul><li>HackerRank网络题目</li><li>LeetCode网络相关题</li><li>实验楼网络课程</li></ul><hr><p>💡 <strong>本周金句</strong>：千里之行始于足下，网络学习贵在坚持！</p><p>👉 <a href="day01.md">返回第1天</a> | <a href="../../README.md">返回目录</a> | <a href="../week02/day08.md">进入第2周</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>6天：网络命令进阶 - traceroute</title>
    <link href="/2025/11/10/6%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%BF%9B%E9%98%B6%20-%20traceroute/"/>
    <url>/2025/11/10/6%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%BF%9B%E9%98%B6%20-%20traceroute/</url>
    
    <content type="html"><![CDATA[<h1>第6天：网络命令进阶 - traceroute</h1><blockquote><p>“看看数据包是怎样环游世界的。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解traceroute的工作原理</li><li>掌握如何追踪网络路径</li><li>深入理解TTL的作用机制</li><li>编写自己的traceroute工具</li></ul><h2 id="🎯-什么是traceroute？">🎯 什么是traceroute？</h2><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">traceroute</span> <span class="hljs-operator">=</span> 追踪快递路线<br><br>你的包裹从北京到上海：<br>北京 → 石家庄中转站 → 济南中转站 → 南京中转站 → 上海<br><br>traceroute就是显示数据包经过的所有<span class="hljs-string">&quot;中转站&quot;</span>（路由器）<br></code></pre></td></tr></table></figure><p><strong>traceroute</strong>（Windows上叫tracert）是用来显示数据包从源到目的地所经过的路由路径的工具。</p><h3 id="traceroute的作用">traceroute的作用</h3><ol><li><strong>诊断网络故障</strong>：找出哪个路由器出问题了</li><li><strong>分析网络路径</strong>：了解数据包的传输路线</li><li><strong>测量延迟</strong>：看每一跳的延迟</li><li><strong>发现网络瓶颈</strong>：找出哪里最慢</li></ol><h2 id="🔍-traceroute的工作原理">🔍 traceroute的工作原理</h2><h3 id="核心思想：利用TTL">核心思想：利用TTL</h3><p>还记得昨天学的TTL吗？</p><ul><li>每个数据包都有TTL（Time To Live）</li><li>每经过一个路由器，TTL减1</li><li>当TTL=0时，路由器丢弃数据包，并返回&quot;超时&quot;错误（ICMP Time Exceeded）</li></ul><p><strong>traceroute的巧妙之处</strong>：故意设置小的TTL值！</p><h3 id="完整流程">完整流程</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs routeros">第1步：发送<span class="hljs-attribute">TTL</span>=1的包<br>┌──────┐  <span class="hljs-attribute">TTL</span>=1   ┌────────┐<br>│ 你的 │ ───────&gt; │ 路由器1 │<br>│ 电脑 │          └────────┘<br>└──────┘          TTL变成0！<br>                  返回<span class="hljs-string">&quot;超时&quot;</span>消息<br>                  (ICMP Time Exceeded)<br><br>→ 得知第1跳是路由器1<br><br>第2步：发送<span class="hljs-attribute">TTL</span>=2的包<br>┌──────┐  <span class="hljs-attribute">TTL</span>=2   ┌────────┐  <span class="hljs-attribute">TTL</span>=1   ┌────────┐<br>│ 你的 │ ───────&gt; │ 路由器1 │ ───────&gt; │ 路由器2 │<br>│ 电脑 │          └────────┘          └────────┘<br>└──────┘                              TTL变成0！<br>                                      返回<span class="hljs-string">&quot;超时&quot;</span>消息<br><br>→ 得知第2跳是路由器2<br><br>第3步：发送<span class="hljs-attribute">TTL</span>=3的包<br>（依此类推，直到到达目的地）<br></code></pre></td></tr></table></figure><h3 id="图解示意">图解示意</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs 1c">你的电脑 <span class="hljs-punctuation">(</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span><span class="hljs-punctuation">)</span><br>    <span class="hljs-string">|</span><br>    <span class="hljs-string">| TTL=1</span><br>    v<br>路由器<span class="hljs-number">1</span> <span class="hljs-punctuation">(</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span><span class="hljs-punctuation">)</span>     → 返回<span class="hljs-punctuation">:</span> Time Exceeded<br>    <span class="hljs-string">|</span><br>    <span class="hljs-string">| TTL=2</span><br>    v<br>路由器<span class="hljs-number">2</span> <span class="hljs-punctuation">(</span><span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span>        → 返回<span class="hljs-punctuation">:</span> Time Exceeded<br>    <span class="hljs-string">|</span><br>    <span class="hljs-string">| TTL=3</span><br>    v<br>路由器<span class="hljs-number">3</span> <span class="hljs-punctuation">(</span><span class="hljs-number">61.135</span>.<span class="hljs-number">169.1</span><span class="hljs-punctuation">)</span>    → 返回<span class="hljs-punctuation">:</span> Time Exceeded<br>    <span class="hljs-string">|</span><br>    <span class="hljs-string">| TTL=4</span><br>    v<br>目标服务器 <span class="hljs-punctuation">(</span><span class="hljs-number">220.181</span>.<span class="hljs-number">38.148</span><span class="hljs-punctuation">)</span> → 返回<span class="hljs-punctuation">:</span> Echo Reply<br></code></pre></td></tr></table></figure><h2 id="🔧-使用traceroute命令">🔧 使用traceroute命令</h2><h3 id="基本用法">基本用法</h3><p><strong>Linux/Mac</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本traceroute</span><br>traceroute baidu.com<br><br><span class="hljs-comment"># 限制最大跳数</span><br>traceroute -m 20 baidu.com<br><br><span class="hljs-comment"># 不解析域名（更快）</span><br>traceroute -n baidu.com<br><br><span class="hljs-comment"># 使用ICMP而不是UDP</span><br>traceroute -I baidu.com<br></code></pre></td></tr></table></figure><p><strong>Windows</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本tracert</span><br>tracert baidu.com<br><br><span class="hljs-comment"># 限制最大跳数</span><br>tracert -h 20 baidu.com<br><br><span class="hljs-comment"># 不解析域名</span><br>tracert -d baidu.com<br></code></pre></td></tr></table></figure><h3 id="输出解析">输出解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ traceroute baidu.com<br><br>traceroute to baidu.com (220.181.38.148), 30 hops max, 60 byte packets<br> 1  192.168.1.1 (192.168.1.1)          1.234 ms  1.123 ms  1.089 ms<br> 2  10.0.0.1 (10.0.0.1)                5.678 ms  5.432 ms  5.345 ms<br> 3  61.135.169.1 (61.135.169.1)        12.345 ms 12.234 ms 12.123 ms<br> 4  61.135.169.125 (61.135.169.125)    15.678 ms 15.567 ms 15.456 ms<br> 5  * * *<br> 6  220.181.38.148 (220.181.38.148)    28.901 ms 28.789 ms 28.678 ms<br></code></pre></td></tr></table></figure><p><strong>字段含义</strong>：</p><ul><li>第1列：跳数（hop number）</li><li>第2列：路由器的IP地址和主机名</li><li>后3列：三次测试的RTT（往返时间）</li><li><code>* * *</code>：该路由器没有回应（可能禁用了ICMP）</li></ul><h2 id="🔧-实战项目：实现简易traceroute工具">🔧 实战项目：实现简易traceroute工具</h2><p>让我们用Python实现traceroute！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day06_simple_traceroute.py</span><br><span class="hljs-comment"># 功能：实现简单的traceroute工具</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_checksum</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    计算ICMP校验和（与ping工具中的相同）</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>:<br>        data += <span class="hljs-string">b&#x27;\x00&#x27;</span><br><br>    checksum = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">2</span>):<br>        word = (data[i] &lt;&lt; <span class="hljs-number">8</span>) + data[i + <span class="hljs-number">1</span>]<br>        checksum += word<br><br>    <span class="hljs-keyword">while</span> checksum &gt;&gt; <span class="hljs-number">16</span>:<br>        checksum = (checksum &amp; <span class="hljs-number">0xFFFF</span>) + (checksum &gt;&gt; <span class="hljs-number">16</span>)<br><br>    checksum = ~checksum &amp; <span class="hljs-number">0xFFFF</span><br>    <span class="hljs-keyword">return</span> checksum<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_icmp_packet</span>(<span class="hljs-params">packet_id, sequence</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    创建ICMP Echo Request数据包</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    icmp_type = <span class="hljs-number">8</span>  <span class="hljs-comment"># Echo Request</span><br>    icmp_code = <span class="hljs-number">0</span><br>    icmp_checksum = <span class="hljs-number">0</span><br><br>    header = struct.pack(<span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_type, icmp_code, icmp_checksum,<br>                         packet_id, sequence)<br>    data = struct.pack(<span class="hljs-string">&#x27;!d&#x27;</span>, time.time())<br><br>    icmp_checksum = calculate_checksum(header + data)<br>    header = struct.pack(<span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_type, icmp_code, icmp_checksum,<br>                         packet_id, sequence)<br><br>    <span class="hljs-keyword">return</span> header + data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_icmp_reply</span>(<span class="hljs-params">packet</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析ICMP回复</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        (icmp_type, source_ip)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 解析IP头部，获取源IP</span><br>    ip_header = packet[:<span class="hljs-number">20</span>]<br>    iph = struct.unpack(<span class="hljs-string">&#x27;!BBHHHBBH4s4s&#x27;</span>, ip_header)<br>    source_ip = socket.inet_ntoa(iph[<span class="hljs-number">8</span>])<br><br>    <span class="hljs-comment"># 解析ICMP头部</span><br>    icmp_header = packet[<span class="hljs-number">20</span>:<span class="hljs-number">28</span>]<br>    icmp_type, icmp_code = struct.unpack(<span class="hljs-string">&#x27;!BB&#x27;</span>, icmp_header[:<span class="hljs-number">2</span>])<br><br>    <span class="hljs-keyword">return</span> icmp_type, source_ip<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">traceroute</span>(<span class="hljs-params">host, max_hops=<span class="hljs-number">30</span>, timeout=<span class="hljs-number">2</span>, tries=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    追踪到目标主机的路由路径</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        host: 目标主机名或IP</span><br><span class="hljs-string">        max_hops: 最大跳数</span><br><span class="hljs-string">        timeout: 超时时间（秒）</span><br><span class="hljs-string">        tries: 每一跳尝试次数</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        1. 从TTL=1开始，逐步增加TTL</span><br><span class="hljs-string">        2. 发送ICMP Echo Request</span><br><span class="hljs-string">        3. 收到Time Exceeded回复时，记录该路由器</span><br><span class="hljs-string">        4. 收到Echo Reply时，说明到达目的地</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;traceroute to <span class="hljs-subst">&#123;host&#125;</span>, <span class="hljs-subst">&#123;max_hops&#125;</span> hops max&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 解析目标主机</span><br>    <span class="hljs-keyword">try</span>:<br>        dest_ip = socket.gethostbyname(host)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;目标IP: <span class="hljs-subst">&#123;dest_ip&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-keyword">except</span> socket.gaierror:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 无法解析主机名: <span class="hljs-subst">&#123;host&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 创建原始socket（需要root权限）</span><br>    <span class="hljs-keyword">try</span>:<br>        send_sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)<br>        recv_sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)<br>        recv_sock.settimeout(timeout)<br>    <span class="hljs-keyword">except</span> PermissionError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 需要管理员权限运行此程序&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Linux/Mac: sudo python day06_simple_traceroute.py&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Windows: 以管理员身份运行&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    packet_id = <span class="hljs-number">12345</span><br>    reached = <span class="hljs-literal">False</span><br><br>    <span class="hljs-comment"># 从TTL=1开始，逐步增加</span><br>    <span class="hljs-keyword">for</span> ttl <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, max_hops + <span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 设置TTL</span><br>        send_sock.setsockopt(socket.IPPROTO_IP, socket.IP_TTL, ttl)<br><br>        <span class="hljs-comment"># 尝试3次</span><br>        hop_info = &#123;<br>            <span class="hljs-string">&#x27;ttl&#x27;</span>: ttl,<br>            <span class="hljs-string">&#x27;ip&#x27;</span>: <span class="hljs-literal">None</span>,<br>            <span class="hljs-string">&#x27;hostname&#x27;</span>: <span class="hljs-literal">None</span>,<br>            <span class="hljs-string">&#x27;rtts&#x27;</span>: []<br>        &#125;<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot; <span class="hljs-subst">&#123;ttl:2d&#125;</span>  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>, flush=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(tries):<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-comment"># 创建并发送ICMP包</span><br>                packet = create_icmp_packet(packet_id, ttl)<br>                send_time = time.time()<br>                send_sock.sendto(packet, (dest_ip, <span class="hljs-number">0</span>))<br><br>                <span class="hljs-comment"># 接收回复</span><br>                <span class="hljs-keyword">try</span>:<br>                    reply_packet, addr = recv_sock.recvfrom(<span class="hljs-number">1024</span>)<br>                    recv_time = time.time()<br>                    rtt = (recv_time - send_time) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># 转换为毫秒</span><br><br>                    <span class="hljs-comment"># 解析回复</span><br>                    icmp_type, source_ip = parse_icmp_reply(reply_packet)<br><br>                    <span class="hljs-comment"># 记录信息</span><br>                    <span class="hljs-keyword">if</span> hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                        hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>] = source_ip<br><br>                        <span class="hljs-comment"># 尝试获取主机名</span><br>                        <span class="hljs-keyword">try</span>:<br>                            hostname = socket.gethostbyaddr(source_ip)[<span class="hljs-number">0</span>]<br>                            hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>] = hostname<br>                        <span class="hljs-keyword">except</span>:<br>                            hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>] = source_ip<br><br>                    hop_info[<span class="hljs-string">&#x27;rtts&#x27;</span>].append(rtt)<br><br>                    <span class="hljs-comment"># ICMP类型11 = Time Exceeded（中间路由器）</span><br>                    <span class="hljs-comment"># ICMP类型0 = Echo Reply（到达目的地）</span><br>                    <span class="hljs-keyword">if</span> icmp_type == <span class="hljs-number">0</span>:<br>                        reached = <span class="hljs-literal">True</span><br><br>                <span class="hljs-keyword">except</span> socket.timeout:<br>                    hop_info[<span class="hljs-string">&#x27;rtts&#x27;</span>].append(<span class="hljs-literal">None</span>)<br><br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                hop_info[<span class="hljs-string">&#x27;rtts&#x27;</span>].append(<span class="hljs-literal">None</span>)<br><br>        <span class="hljs-comment"># 打印这一跳的信息</span><br>        <span class="hljs-keyword">if</span> hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>]:<br>            <span class="hljs-keyword">if</span> hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>] <span class="hljs-keyword">and</span> hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>] != hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>]:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>]&#125;</span> (<span class="hljs-subst">&#123;hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>]&#125;</span>)  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>]&#125;</span>  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br><br>            <span class="hljs-comment"># 打印RTT</span><br>            <span class="hljs-keyword">for</span> rtt <span class="hljs-keyword">in</span> hop_info[<span class="hljs-string">&#x27;rtts&#x27;</span>]:<br>                <span class="hljs-keyword">if</span> rtt <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;rtt:<span class="hljs-number">.2</span>f&#125;</span> ms  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;*  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;* * *&quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>()  <span class="hljs-comment"># 换行</span><br><br>        <span class="hljs-comment"># 如果到达目的地，停止</span><br>        <span class="hljs-keyword">if</span> reached:<br>            <span class="hljs-built_in">print</span>()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 已到达目的地 <span class="hljs-subst">&#123;dest_ip&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> reached:<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⚠️  未能在<span class="hljs-subst">&#123;max_hops&#125;</span>跳内到达目的地&quot;</span>)<br><br>    send_sock.close()<br>    recv_sock.close()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;简易Traceroute工具&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取目标主机</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span>:<br>        host = sys.argv[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        host = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入要追踪的主机名或IP: &quot;</span>).strip()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> host:<br>            host = <span class="hljs-string">&quot;baidu.com&quot;</span>  <span class="hljs-comment"># 默认</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🔍 开始追踪路由路径...\n&quot;</span>)<br><br>    <span class="hljs-comment"># 执行traceroute</span><br>    traceroute(host, max_hops=<span class="hljs-number">30</span>, timeout=<span class="hljs-number">2</span>, tries=<span class="hljs-number">3</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n💡 说明:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 每一行代表一跳（一个路由器）&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 显示3次测试的RTT时间&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - * 表示该路由器没有响应&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 某些路由器可能禁用了ICMP响应&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Linux/Mac（需要root权限）</span><br><span class="hljs-built_in">sudo</span> python code/day06/day06_simple_traceroute.py baidu.com<br><br><span class="hljs-comment"># Windows（以管理员身份运行）</span><br>python code\day06\day06_simple_traceroute.py baidu.com<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">======================================================================<br>                      简易Traceroute工具<br>======================================================================<br><br>🔍 开始追踪路由路径...<br><br>traceroute to baidu.com, <span class="hljs-number">30</span> hops max<br><br>目标IP: <span class="hljs-number">220.181</span>.<span class="hljs-number">38.148</span><br>----------------------------------------------------------------------<br>  <span class="hljs-number">1</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>  <span class="hljs-number">1.23</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">1</span>.<span class="hljs-number">12</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">1</span>.<span class="hljs-number">09</span> <span class="hljs-keyword">ms</span><br>  <span class="hljs-title">2</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span>  <span class="hljs-number">5.67</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">5</span>.<span class="hljs-number">43</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">5</span>.<span class="hljs-number">34</span> <span class="hljs-keyword">ms</span><br>  <span class="hljs-title">3</span>  <span class="hljs-number">61.135</span>.<span class="hljs-number">169.1</span>  <span class="hljs-number">12.34</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">12</span>.<span class="hljs-number">23</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">12</span>.<span class="hljs-number">12</span> <span class="hljs-keyword">ms</span><br>  <span class="hljs-title">4</span>  <span class="hljs-number">61.135</span>.<span class="hljs-number">169.125</span>  <span class="hljs-number">15.67</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">15</span>.<span class="hljs-number">56</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">15</span>.<span class="hljs-number">45</span> <span class="hljs-keyword">ms</span><br>  <span class="hljs-title">5</span>  * * *<br>  <span class="hljs-number">6</span>  <span class="hljs-number">220.181</span>.<span class="hljs-number">38.148</span>  <span class="hljs-number">28.90</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">28</span>.<span class="hljs-number">78</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">28</span>.<span class="hljs-number">67</span> <span class="hljs-keyword">ms</span><br><br><span class="hljs-title">✅ 已到达目的地 220</span>.<span class="hljs-number">181.38</span>.<span class="hljs-number">148</span><br><br>======================================================================<br><br>💡 说明:<br>   - 每一行代表一跳（一个路由器）<br>   - 显示<span class="hljs-number">3</span>次测试的RTT时间<br>   - * 表示该路由器没有响应<br>   - 某些路由器可能禁用了ICMP响应<br>======================================================================<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="1-设置TTL">1. 设置TTL</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">send_sock.setsockopt(socket.IPPROTO_IP, socket.IP_TTL, ttl)<br></code></pre></td></tr></table></figure><p>这是关键！通过设置socket的TTL选项，我们可以控制数据包能经过多少个路由器。</p><h3 id="2-ICMP消息类型">2. ICMP消息类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 收到的ICMP类型：</span><br>- 类型<span class="hljs-number">11</span>（Time Exceeded）：中间路由器返回，说明TTL耗尽<br>- 类型<span class="hljs-number">0</span>（Echo Reply）：目标主机返回，说明到达目的地<br></code></pre></td></tr></table></figure><h3 id="3-为什么要尝试3次？">3. 为什么要尝试3次？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(tries):  <span class="hljs-comment"># 尝试3次</span><br></code></pre></td></tr></table></figure><p><strong>原因</strong>：</p><ol><li>网络可能不稳定，单次测试不准确</li><li>可以计算平均延迟</li><li>可以检测丢包情况</li><li>与标准traceroute行为一致</li></ol><h3 id="4-为什么有些路由器显示-？">4. 为什么有些路由器显示 * * * ？</h3><p>可能的原因：</p><ol><li><strong>防火墙阻止</strong>：该路由器配置了防火墙，不响应ICMP</li><li><strong>安全策略</strong>：运营商出于安全考虑，禁用了ICMP响应</li><li><strong>负载均衡</strong>：每次请求可能走不同路径</li><li><strong>超时</strong>：路由器太忙，来不及响应</li></ol><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ traceroute通过逐步增加TTL来追踪路径</li><li>✅ TTL=0时路由器返回&quot;Time Exceeded&quot;消息</li><li>✅ 每一跳通常测试3次以获得稳定数据</li><li>✅ 某些路由器可能不响应ICMP</li></ol><h3 id="traceroute-vs-ping">traceroute vs ping</h3><table><thead><tr><th>特性</th><th>ping</th><th>traceroute</th></tr></thead><tbody><tr><td>目的</td><td>测试连通性</td><td>追踪路径</td></tr><tr><td>显示内容</td><td>目标主机信息</td><td>所有中间路由器</td></tr><tr><td>TTL设置</td><td>固定（通常64）</td><td>递增（1, 2, 3…）</td></tr><tr><td>数据包数量</td><td>少</td><td>多</td></tr><tr><td>执行速度</td><td>快</td><td>慢</td></tr></tbody></table><h3 id="Windows-vs-Linux-Mac">Windows vs Linux/Mac</h3><table><thead><tr><th>特性</th><th>Windows (tracert)</th><th>Linux/Mac (traceroute)</th></tr></thead><tbody><tr><td>协议</td><td>ICMP</td><td>UDP（默认）或ICMP</td></tr><tr><td>命令</td><td>tracert</td><td>traceroute</td></tr><tr><td>ICMP选项</td><td>默认</td><td>-I 参数</td></tr></tbody></table><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：实际操作">练习1：实际操作</h3><p>使用traceroute追踪以下网站，记录经过的跳数：</p><ol><li><a href="http://baidu.com">baidu.com</a></li><li><a href="http://google.com">google.com</a>（如果能访问）</li><li>你的学校或公司网站</li><li>国外的网站（观察延迟变化）</li></ol><h3 id="练习2：路径分析">练习2：路径分析</h3><p>观察traceroute的输出，回答：</p><ol><li>第一跳通常是什么设备？</li><li>为什么有些跳的延迟突然增大？</li><li>国内访问国外网站，通常在第几跳出国？</li></ol><h3 id="练习3：故障诊断">练习3：故障诊断</h3><p>如果traceroute显示以下情况，说明什么问题？</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-number">1</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>  <span class="hljs-number">1</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">2</span>  * * *<br><span class="hljs-number">3</span>  * * *<br><span class="hljs-number">4</span>  * * *<br>...<br></code></pre></td></tr></table></figure><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>扩展traceroute工具：</p><ol><li>添加路径可视化（绘制路由图）</li><li>支持同时追踪多个目标</li><li>记录历史路径，对比路径变化</li><li>添加AS号查询（自治系统号）</li></ol><h3 id="练习5：思考题">练习5：思考题</h3><ol><li>为什么去程和回程路径可能不同？</li><li>traceroute能用来攻击吗？</li><li>如何阻止别人traceroute你的服务器？</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="traceroute的不同实现方式">traceroute的不同实现方式</h3><h4 id="1-UDP方式（Linux默认）">1. UDP方式（Linux默认）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用UDP包，目标端口从33434开始递增</span><br>traceroute baidu.com<br><br>工作原理：<br>- 发送UDP包到不常用的端口<br>- 中间路由器：返回ICMP Time Exceeded<br>- 目标主机：返回ICMP Port Unreachable<br></code></pre></td></tr></table></figure><h4 id="2-ICMP方式（Windows默认）">2. ICMP方式（Windows默认）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用ICMP Echo Request</span><br>traceroute -I baidu.com  <span class="hljs-comment"># Linux</span><br>tracert baidu.com        <span class="hljs-comment"># Windows</span><br><br>工作原理：<br>- 发送ICMP Echo Request<br>- 中间路由器：返回ICMP Time Exceeded<br>- 目标主机：返回ICMP Echo Reply<br></code></pre></td></tr></table></figure><h4 id="3-TCP方式">3. TCP方式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用TCP SYN包（需要指定端口）</span><br>traceroute -T -p 80 baidu.com<br><br>工作原理：<br>- 发送TCP SYN包到指定端口<br>- 中间路由器：返回ICMP Time Exceeded<br>- 目标主机：返回TCP SYN+ACK<br></code></pre></td></tr></table></figure><h3 id="MTR：增强版traceroute">MTR：增强版traceroute</h3><p>MTR（My Traceroute）结合了ping和traceroute的功能：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装</span><br><span class="hljs-built_in">sudo</span> apt install mtr      <span class="hljs-comment"># Ubuntu/Debian</span><br>brew install mtr          <span class="hljs-comment"># Mac</span><br><br><span class="hljs-comment"># 使用</span><br><span class="hljs-built_in">sudo</span> mtr baidu.com<br></code></pre></td></tr></table></figure><p><strong>MTR的优势</strong>：</p><ul><li>实时更新</li><li>显示丢包率</li><li>显示每一跳的统计信息</li><li>更直观的界面</li></ul><h3 id="路由的变化">路由的变化</h3><p>互联网的路由不是固定的，会因为以下原因变化：</p><ol><li><strong>负载均衡</strong>：分散流量到不同路径</li><li><strong>路由策略</strong>：运营商动态调整路由</li><li><strong>故障切换</strong>：某条线路故障时自动切换</li><li><strong>时间因素</strong>：不同时段可能走不同路由</li></ol><h3 id="实际应用场景">实际应用场景</h3><ol><li><p><strong>网络故障诊断</strong>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">情况：网站访问很慢<br>步骤：traceroute 查看哪一跳延迟高<br>结果：定位瓶颈所在<br></code></pre></td></tr></table></figure></li><li><p><strong>CDN检测</strong>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">情况：想知道访问的是哪个CDN节点<br>步骤：traceroute 查看最后几跳<br>结果：发现CDN在本地，延迟低<br></code></pre></td></tr></table></figure></li><li><p><strong>网络拓扑发现</strong>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">情况：想了解公司网络结构<br>步骤：traceroute 到不同内网地址<br>结果：绘制网络拓扑图<br></code></pre></td></tr></table></figure></li></ol><h3 id="有趣的发现">有趣的发现</h3><p><strong>地理位置与延迟</strong>：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">本地路由器：    <span class="hljs-number">1</span>-<span class="hljs-number">2</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">同城服务器：    10-30</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">相邻省份：      30-60</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">跨国连接：      100-300</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">全球另一端：    300-500</span> ms<br></code></pre></td></tr></table></figure><p><strong>光速的限制</strong>：</p><ul><li>光在光纤中的速度约为 200,000 km/s</li><li>地球周长约 40,000 km</li><li>理论上环绕地球一圈至少需要 200ms</li><li>实际延迟会更高（路由器处理时间）</li></ul><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第7天：Wireshark抓包入门</strong></p><p>我们将学习：</p><ul><li>Wireshark的基本使用</li><li>如何捕获和分析数据包</li><li>过滤器的使用技巧</li><li>实战：分析HTTP请求过程</li></ul><hr><p>💡 <strong>今日金句</strong>：追踪路由，就像在互联网上寻找宝藏的地图！</p><p>👉 <a href="day05.md">上一天：ping命令详解</a> | <a href="../../README.md">返回目录</a> | <a href="day07.md">下一天：Wireshark抓包入门</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>5天：网络命令入门 - ping</title>
    <link href="/2025/11/10/5%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E5%85%A5%E9%97%A8%20-%20ping/"/>
    <url>/2025/11/10/5%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E5%85%A5%E9%97%A8%20-%20ping/</url>
    
    <content type="html"><![CDATA[<h1>第5天：网络命令入门 - ping</h1><blockquote><p>“ping一下，网络通不通立刻知道。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解ping命令的工作原理</li><li>掌握ICMP协议基础知识</li><li>学会使用ping命令进行网络诊断</li><li>编写自己的ping工具</li></ul><h2 id="🎯-什么是ping？">🎯 什么是ping？</h2><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">ping</span> <span class="hljs-operator">=</span> 喊话游戏<br><br>你：喂！能听到吗？ （发送）<br>朋友：能听到！         （回应）<br>你：太好了，通信正常！ （确认）<br></code></pre></td></tr></table></figure><p><strong>ping命令</strong>就是用来测试网络连通性的工具，它会发送一个数据包到目标主机，然后等待回应。</p><h3 id="ping的作用">ping的作用</h3><ol><li><strong>测试连通性</strong>：目标主机是否可达</li><li><strong>测量延迟</strong>：数据往返需要多少时间</li><li><strong>检测丢包</strong>：有多少数据包丢失了</li><li><strong>诊断网络问题</strong>：定位网络故障</li></ol><h2 id="📡-ICMP协议">📡 ICMP协议</h2><h3 id="什么是ICMP？">什么是ICMP？</h3><p><strong>ICMP</strong>（Internet Control Message Protocol，互联网控制消息协议）是TCP/IP协议族的一部分，工作在网际层（IP层）。</p><h3 id="ICMP的作用">ICMP的作用</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">ICMP</span> <span class="hljs-operator">=</span> 网络的<span class="hljs-string">&quot;通讯员&quot;</span><br><br>主要任务：<br><span class="hljs-number">1</span>. 报告错误（<span class="hljs-string">&quot;对方不在家&quot;</span>）<br><span class="hljs-number">2</span>. 诊断问题（<span class="hljs-string">&quot;ping测试&quot;</span>）<br><span class="hljs-number">3</span>. 提供反馈（<span class="hljs-string">&quot;超时了&quot;</span>）<br></code></pre></td></tr></table></figure><h3 id="常见的ICMP消息类型">常见的ICMP消息类型</h3><table><thead><tr><th>类型</th><th>名称</th><th>用途</th></tr></thead><tbody><tr><td>0</td><td>Echo Reply</td><td>ping的回应</td></tr><tr><td>3</td><td>Destination Unreachable</td><td>目标不可达</td></tr><tr><td>5</td><td>Redirect</td><td>重定向</td></tr><tr><td>8</td><td>Echo Request</td><td>ping的请求</td></tr><tr><td>11</td><td>Time Exceeded</td><td>超时（TTL=0）</td></tr></tbody></table><h2 id="🔍-ping的工作原理">🔍 ping的工作原理</h2><h3 id="完整流程">完整流程</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">1</span>. 发送 ICMP Echo Request（类型<span class="hljs-number">8</span>）<br>   你的电脑 → 目标主机<br>   &quot;你好，我是<span class="hljs-number">192.168.1.100</span>，请回应！&quot;<br><br><span class="hljs-number">2</span>. 接收 ICMP Echo Reply（类型<span class="hljs-number">0</span>）<br>   目标主机 → 你的电脑<br>   &quot;收到！我是<span class="hljs-number">8.8.8.8</span>，一切正常！&quot;<br><br><span class="hljs-number">3</span>. 计算RTT（往返时间）<br>   发送时间：<span class="hljs-number">10</span>:<span class="hljs-number">00:00.000</span><br>   接收时间：<span class="hljs-number">10</span>:<span class="hljs-number">00:00.050</span><br>   RTT = <span class="hljs-number">50</span>毫秒<br></code></pre></td></tr></table></figure><h3 id="RTT（Round-Trip-Time）">RTT（Round-Trip Time）</h3><p><strong>RTT</strong>：数据包从发送到收到回复的总时间</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">RTT = 去程时间 + 回程时间<br><br>影响RTT的因素：<br><span class="hljs-bullet">- </span>物理距离（光速是有限的）<br><span class="hljs-bullet">- </span>网络拥塞<br><span class="hljs-bullet">- </span>路由器处理时间<br><span class="hljs-bullet">- </span>对方服务器处理时间<br></code></pre></td></tr></table></figure><h3 id="ICMP报文结构">ICMP报文结构</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">ICMP Echo Request/Reply 格式：<br><br><span class="hljs-section">0               8              16              24              31</span><br><span class="hljs-section">+---------------+---------------+---------------+---------------+</span><br>|     类型      |     代码      |           校验和              |<br><span class="hljs-section">|   (Type)      |   (Code)      |         (Checksum)            |</span><br><span class="hljs-section">+---------------+---------------+---------------+---------------+</span><br><span class="hljs-section">|          标识符 (Identifier)   |      序列号 (Sequence)        |</span><br><span class="hljs-section">+---------------+---------------+---------------+---------------+</span><br>|                         数据 (Data)                            |<br><span class="hljs-section">|                         可选，用于填充                         |</span><br><span class="hljs-section">+---------------+---------------+---------------+---------------+</span><br><br>字段说明：<br><span class="hljs-bullet">- </span>类型：8=请求，0=回应<br><span class="hljs-bullet">- </span>代码：通常为0<br><span class="hljs-bullet">- </span>校验和：用于检测数据完整性<br><span class="hljs-bullet">- </span>标识符：标识这个ping进程<br><span class="hljs-bullet">- </span>序列号：标识这是第几个包<br><span class="hljs-bullet">- </span>数据：可选的负载数据<br></code></pre></td></tr></table></figure><h2 id="🔧-使用ping命令">🔧 使用ping命令</h2><h3 id="基本用法">基本用法</h3><p><strong>Windows</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本ping</span><br>ping baidu.com<br><br><span class="hljs-comment"># ping 4次后停止</span><br>ping -n 4 baidu.com<br><br><span class="hljs-comment"># 指定包大小（字节）</span><br>ping -l 1000 baidu.com<br><br><span class="hljs-comment"># 持续ping</span><br>ping -t baidu.com<br></code></pre></td></tr></table></figure><p><strong>Linux/Mac</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本ping</span><br>ping baidu.com<br><br><span class="hljs-comment"># ping 4次后停止</span><br>ping -c 4 baidu.com<br><br><span class="hljs-comment"># 指定包大小（字节）</span><br>ping -s 1000 baidu.com<br><br><span class="hljs-comment"># 快速ping（间隔0.2秒）</span><br>ping -i 0.2 baidu.com<br></code></pre></td></tr></table></figure><h3 id="输出解析">输出解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ping baidu.com<br><br>PING baidu.com (220.181.38.148): 56 data bytes<br>64 bytes from 220.181.38.148: icmp_seq=0 ttl=52 <span class="hljs-keyword">time</span>=28.5 ms<br>64 bytes from 220.181.38.148: icmp_seq=1 ttl=52 <span class="hljs-keyword">time</span>=27.8 ms<br>64 bytes from 220.181.38.148: icmp_seq=2 ttl=52 <span class="hljs-keyword">time</span>=28.1 ms<br>64 bytes from 220.181.38.148: icmp_seq=3 ttl=52 <span class="hljs-keyword">time</span>=29.2 ms<br><br>--- baidu.com ping statistics ---<br>4 packets transmitted, 4 packets received, 0.0% packet loss<br>round-trip min/avg/max/stddev = 27.8/28.4/29.2/0.5 ms<br></code></pre></td></tr></table></figure><p><strong>字段含义</strong>：</p><ul><li><code>64 bytes</code>：数据包大小</li><li><code>icmp_seq</code>：序列号（第几个包）</li><li><code>ttl=52</code>：生存时间（经过了64-52=12个路由器）</li><li><code>time=28.5 ms</code>：RTT往返时间</li><li><code>0.0% packet loss</code>：丢包率</li><li><code>min/avg/max</code>：最小/平均/最大RTT</li></ul><h2 id="🔧-实战项目：实现简易ping工具">🔧 实战项目：实现简易ping工具</h2><p>让我们用Python实现一个简单的ping工具！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day05_simple_ping.py</span><br><span class="hljs-comment"># 功能：实现简单的ping工具</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_checksum</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    计算ICMP校验和</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        data: 要计算校验和的数据（bytes）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        校验和（int）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        1. 将数据按16位分组求和</span><br><span class="hljs-string">        2. 如果有进位，将进位加到结果上</span><br><span class="hljs-string">        3. 取反码得到校验和</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 如果数据长度是奇数，补一个字节0</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>:<br>        data += <span class="hljs-string">b&#x27;\x00&#x27;</span><br><br>    <span class="hljs-comment"># 按16位（2字节）分组求和</span><br>    checksum = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">2</span>):<br>        <span class="hljs-comment"># 将两个字节组合成一个16位整数</span><br>        word = (data[i] &lt;&lt; <span class="hljs-number">8</span>) + data[i + <span class="hljs-number">1</span>]<br>        checksum += word<br><br>    <span class="hljs-comment"># 处理进位：将高16位加到低16位</span><br>    <span class="hljs-keyword">while</span> checksum &gt;&gt; <span class="hljs-number">16</span>:<br>        checksum = (checksum &amp; <span class="hljs-number">0xFFFF</span>) + (checksum &gt;&gt; <span class="hljs-number">16</span>)<br><br>    <span class="hljs-comment"># 取反码</span><br>    checksum = ~checksum &amp; <span class="hljs-number">0xFFFF</span><br><br>    <span class="hljs-keyword">return</span> checksum<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_icmp_packet</span>(<span class="hljs-params">packet_id, sequence</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    创建ICMP Echo Request数据包</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        packet_id: 标识符（用于区分不同的ping进程）</span><br><span class="hljs-string">        sequence: 序列号（标识第几个包）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        完整的ICMP数据包（bytes）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    ICMP包结构：</span><br><span class="hljs-string">        [类型(1字节) | 代码(1字节) | 校验和(2字节) |</span><br><span class="hljs-string">         标识符(2字节) | 序列号(2字节) | 数据]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># ICMP类型：8=Echo Request</span><br>    icmp_type = <span class="hljs-number">8</span><br>    <span class="hljs-comment"># ICMP代码：0</span><br>    icmp_code = <span class="hljs-number">0</span><br>    <span class="hljs-comment"># 校验和：先设为0，稍后计算</span><br>    icmp_checksum = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># 打包ICMP头部（不包括校验和）</span><br>    <span class="hljs-comment"># ! = 网络字节序（大端）</span><br>    <span class="hljs-comment"># B = unsigned char (1字节)</span><br>    <span class="hljs-comment"># H = unsigned short (2字节)</span><br>    header = struct.pack(<span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_type, icmp_code, icmp_checksum,<br>                         packet_id, sequence)<br><br>    <span class="hljs-comment"># 数据部分：发送时间戳（用于计算RTT）</span><br>    data = struct.pack(<span class="hljs-string">&#x27;!d&#x27;</span>, time.time())<br><br>    <span class="hljs-comment"># 计算校验和</span><br>    icmp_checksum = calculate_checksum(header + data)<br><br>    <span class="hljs-comment"># 重新打包，加入正确的校验和</span><br>    header = struct.pack(<span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_type, icmp_code, icmp_checksum,<br>                         packet_id, sequence)<br><br>    <span class="hljs-keyword">return</span> header + data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_icmp_reply</span>(<span class="hljs-params">packet</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析ICMP Echo Reply数据包</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        packet: 接收到的数据包</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        (icmp_type, icmp_code, icmp_id, icmp_seq, send_time)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># IP头部通常是20字节，ICMP从第21字节开始</span><br>    icmp_header = packet[<span class="hljs-number">20</span>:<span class="hljs-number">28</span>]<br><br>    <span class="hljs-comment"># 解析ICMP头部</span><br>    icmp_type, icmp_code, checksum, packet_id, sequence = struct.unpack(<br>        <span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_header<br>    )<br><br>    <span class="hljs-comment"># 解析数据部分的时间戳</span><br>    send_time = struct.unpack(<span class="hljs-string">&#x27;!d&#x27;</span>, packet[<span class="hljs-number">28</span>:<span class="hljs-number">36</span>])[<span class="hljs-number">0</span>]<br><br>    <span class="hljs-keyword">return</span> icmp_type, icmp_code, packet_id, sequence, send_time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">host, count=<span class="hljs-number">4</span>, timeout=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ping指定主机</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        host: 目标主机名或IP地址</span><br><span class="hljs-string">        count: ping的次数</span><br><span class="hljs-string">        timeout: 超时时间（秒）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        统计信息字典</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PING <span class="hljs-subst">&#123;host&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 解析主机名为IP地址</span><br>    <span class="hljs-keyword">try</span>:<br>        dest_ip = socket.gethostbyname(host)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;目标IP: <span class="hljs-subst">&#123;dest_ip&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-keyword">except</span> socket.gaierror:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 无法解析主机名: <span class="hljs-subst">&#123;host&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># 创建原始socket（需要root权限）</span><br>    <span class="hljs-keyword">try</span>:<br>        sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)<br>        sock.settimeout(timeout)<br>    <span class="hljs-keyword">except</span> PermissionError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 需要管理员权限运行此程序&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Linux/Mac: sudo python day05_simple_ping.py&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Windows: 以管理员身份运行&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># 统计信息</span><br>    packet_id = <span class="hljs-number">12345</span>  <span class="hljs-comment"># 可以用进程ID</span><br>    sent = <span class="hljs-number">0</span><br>    received = <span class="hljs-number">0</span><br>    rtt_list = []<br><br>    <span class="hljs-comment"># 发送ping包</span><br>    <span class="hljs-keyword">for</span> seq <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(count):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 创建ICMP包</span><br>            packet = create_icmp_packet(packet_id, seq)<br><br>            <span class="hljs-comment"># 发送</span><br>            send_time = time.time()<br>            sock.sendto(packet, (dest_ip, <span class="hljs-number">0</span>))<br>            sent += <span class="hljs-number">1</span><br><br>            <span class="hljs-comment"># 接收回复</span><br>            <span class="hljs-keyword">try</span>:<br>                reply_packet, addr = sock.recvfrom(<span class="hljs-number">1024</span>)<br>                recv_time = time.time()<br><br>                <span class="hljs-comment"># 解析回复</span><br>                icmp_type, icmp_code, reply_id, reply_seq, packet_send_time = \<br>                    parse_icmp_reply(reply_packet)<br><br>                <span class="hljs-comment"># 检查是否是我们的包的回复</span><br>                <span class="hljs-keyword">if</span> icmp_type == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> reply_id == packet_id <span class="hljs-keyword">and</span> reply_seq == seq:<br>                    <span class="hljs-comment"># 计算RTT</span><br>                    rtt = (recv_time - packet_send_time) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># 转换为毫秒</span><br>                    rtt_list.append(rtt)<br>                    received += <span class="hljs-number">1</span><br><br>                    <span class="hljs-comment"># 获取TTL</span><br>                    ttl = struct.unpack(<span class="hljs-string">&#x27;!B&#x27;</span>, reply_packet[<span class="hljs-number">8</span>:<span class="hljs-number">9</span>])[<span class="hljs-number">0</span>]<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 来自 <span class="hljs-subst">&#123;dest_ip&#125;</span>: icmp_seq=<span class="hljs-subst">&#123;seq&#125;</span> ttl=<span class="hljs-subst">&#123;ttl&#125;</span> &quot;</span><br>                          <span class="hljs-string">f&quot;time=<span class="hljs-subst">&#123;rtt:<span class="hljs-number">.2</span>f&#125;</span> ms&quot;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⚠️  收到意外的ICMP包 type=<span class="hljs-subst">&#123;icmp_type&#125;</span>&quot;</span>)<br><br>            <span class="hljs-keyword">except</span> socket.timeout:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⏱️  icmp_seq=<span class="hljs-subst">&#123;seq&#125;</span> 请求超时&quot;</span>)<br><br>            <span class="hljs-comment"># 等待1秒再发送下一个包</span><br>            <span class="hljs-keyword">if</span> seq &lt; count - <span class="hljs-number">1</span>:<br>                time.sleep(<span class="hljs-number">1</span>)<br><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 发送失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    sock.close()<br><br>    <span class="hljs-comment"># 打印统计信息</span><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📊 <span class="hljs-subst">&#123;host&#125;</span> ping统计信息:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   发送: <span class="hljs-subst">&#123;sent&#125;</span> 个包&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   接收: <span class="hljs-subst">&#123;received&#125;</span> 个包&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   丢失: <span class="hljs-subst">&#123;sent - received&#125;</span> 个包 (<span class="hljs-subst">&#123;((sent-received)/sent*<span class="hljs-number">100</span>):<span class="hljs-number">.1</span>f&#125;</span>% loss)&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> rtt_list:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   RTT: 最小=<span class="hljs-subst">&#123;<span class="hljs-built_in">min</span>(rtt_list):<span class="hljs-number">.2</span>f&#125;</span>ms, &quot;</span><br>              <span class="hljs-string">f&quot;平均=<span class="hljs-subst">&#123;<span class="hljs-built_in">sum</span>(rtt_list)/<span class="hljs-built_in">len</span>(rtt_list):<span class="hljs-number">.2</span>f&#125;</span>ms, &quot;</span><br>              <span class="hljs-string">f&quot;最大=<span class="hljs-subst">&#123;<span class="hljs-built_in">max</span>(rtt_list):<span class="hljs-number">.2</span>f&#125;</span>ms&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">60</span>)<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&#x27;sent&#x27;</span>: sent,<br>        <span class="hljs-string">&#x27;received&#x27;</span>: received,<br>        <span class="hljs-string">&#x27;rtt_list&#x27;</span>: rtt_list<br>    &#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;简易Ping工具&quot;</span>.center(<span class="hljs-number">60</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取目标主机</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span>:<br>        host = sys.argv[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        host = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入要ping的主机名或IP: &quot;</span>).strip()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> host:<br>            host = <span class="hljs-string">&quot;baidu.com&quot;</span>  <span class="hljs-comment"># 默认</span><br><br>    <span class="hljs-comment"># 执行ping</span><br>    result = ping(host, count=<span class="hljs-number">4</span>, timeout=<span class="hljs-number">3</span>)<br><br>    <span class="hljs-keyword">if</span> result <span class="hljs-keyword">and</span> result[<span class="hljs-string">&#x27;received&#x27;</span>] &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;🎉 Ping完成！&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ Ping失败或网络不可达&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Linux/Mac（需要root权限）</span><br><span class="hljs-built_in">sudo</span> python code/day05/day05_simple_ping.py baidu.com<br><br><span class="hljs-comment"># Windows（以管理员身份运行）</span><br>python code\day05\day05_simple_ping.py baidu.com<br><br><span class="hljs-comment"># 不带参数运行，会提示输入主机名</span><br><span class="hljs-built_in">sudo</span> python code/day05/day05_simple_ping.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">============================================================<br>                       简易Ping工具<br>============================================================<br><br>PING baidu.com<br><br><span class="hljs-section">目标IP: 220.181.38.148</span><br><span class="hljs-section">------------------------------------------------------------</span><br>✅ 来自 220.181.38.148: icmp<span class="hljs-emphasis">_seq=0 ttl=52 time=28.50 ms</span><br><span class="hljs-emphasis">✅ 来自 220.181.38.148: icmp_seq=1 ttl=52 time=27.82 ms</span><br><span class="hljs-emphasis">✅ 来自 220.181.38.148: icmp_seq=2 ttl=52 time=28.15 ms</span><br><span class="hljs-emphasis">✅ 来自 220.181.38.148: icmp_</span>seq=3 ttl=52 time=29.20 ms<br><br><span class="hljs-code">------------------------------------------------------------</span><br><span class="hljs-code">📊 baidu.com ping统计信息:</span><br><span class="hljs-code">   发送: 4 个包</span><br><span class="hljs-code">   接收: 4 个包</span><br><span class="hljs-code">   丢失: 0 个包 (0.0% loss)</span><br><span class="hljs-code">   RTT: 最小=27.82ms, 平均=28.42ms, 最大=29.20ms</span><br><span class="hljs-code">------------------------------------------------------------</span><br><br>🎉 Ping完成！<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="1-为什么需要root权限？">1. 为什么需要root权限？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)<br></code></pre></td></tr></table></figure><p><strong>原始套接字</strong>（SOCK_RAW）可以构造任意的IP包，这是一个强大的功能，所以操作系统要求必须有管理员权限才能使用。</p><h3 id="2-校验和的计算">2. 校验和的计算</h3><p>校验和用于检测数据在传输过程中是否损坏：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 原理：</span><br><span class="hljs-number">1.</span> 将数据按<span class="hljs-number">16</span>位分组<br><span class="hljs-number">2.</span> 所有分组相加<br><span class="hljs-number">3.</span> 如果有进位，加到低<span class="hljs-number">16</span>位<br><span class="hljs-number">4.</span> 对结果取反码<br><br><span class="hljs-comment"># 接收方验证：</span><br><span class="hljs-number">1.</span> 对收到的数据（包括校验和）做同样的计算<br><span class="hljs-number">2.</span> 如果结果是<span class="hljs-number">0xFFFF</span>，说明数据完整<br><span class="hljs-number">3.</span> 否则说明数据损坏<br></code></pre></td></tr></table></figure><h3 id="3-TTL的含义">3. TTL的含义</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">TTL (Time To Live) <span class="hljs-operator">=</span> 生存时间<br><br>初始值：通常是<span class="hljs-number">64</span>或<span class="hljs-number">128</span><br>每经过一个路由器：TTL -<span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>当TTL <span class="hljs-operator">=</span> <span class="hljs-number">0</span>：路由器丢弃该包，返回超时错误<br><br>作用：防止数据包在网络中无限循环<br></code></pre></td></tr></table></figure><h3 id="4-时间戳的作用">4. 时间戳的作用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 发送时在数据部分嵌入时间戳</span><br>data = struct.pack(<span class="hljs-string">&#x27;!d&#x27;</span>, time.time())<br><br><span class="hljs-comment"># 收到回复时，解析时间戳</span><br>send_time = struct.unpack(<span class="hljs-string">&#x27;!d&#x27;</span>, packet[<span class="hljs-number">28</span>:<span class="hljs-number">36</span>])[<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># 计算RTT</span><br>rtt = (recv_time - send_time) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># 毫秒</span><br></code></pre></td></tr></table></figure><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ ping用于测试网络连通性和延迟</li><li>✅ ping基于ICMP协议（类型8请求，类型0回复）</li><li>✅ RTT是数据包往返的总时间</li><li>✅ TTL表示数据包还能经过多少个路由器</li><li>✅ 实现ping需要使用原始套接字</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>含义</th><th>单位</th></tr></thead><tbody><tr><td>RTT</td><td>往返时间</td><td>毫秒(ms)</td></tr><tr><td>TTL</td><td>生存时间</td><td>跳数(hops)</td></tr><tr><td>丢包率</td><td>丢失的包占总数的比例</td><td>百分比(%)</td></tr><tr><td>ICMP</td><td>网络控制消息协议</td><td>-</td></tr></tbody></table><h3 id="ping命令速查">ping命令速查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本用法</span><br>ping 目标主机<br><br><span class="hljs-comment"># 常用选项</span><br>-c 次数      <span class="hljs-comment"># Linux/Mac: 指定ping次数</span><br>-n 次数      <span class="hljs-comment"># Windows: 指定ping次数</span><br>-i 间隔      <span class="hljs-comment"># 指定发送间隔（秒）</span><br>-s 大小      <span class="hljs-comment"># 指定数据包大小</span><br>-t           <span class="hljs-comment"># Windows: 持续ping</span><br></code></pre></td></tr></table></figure><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：实际操作">练习1：实际操作</h3><p>使用ping命令测试以下主机，记录RTT和TTL：</p><ol><li><a href="http://baidu.com">baidu.com</a></li><li><a href="http://google.com">google.com</a></li><li>你的路由器（通常是192.168.1.1）</li><li>本机（127.0.0.1）</li></ol><h3 id="练习2：理解TTL">练习2：理解TTL</h3><p>如果ping baidu.com的TTL是52，初始TTL是64，问：</p><ol><li>数据包经过了多少个路由器？</li><li>为什么不同的主机TTL不一样？</li></ol><h3 id="练习3：分析丢包">练习3：分析丢包</h3><p>如果ping一个网站，出现以下情况，可能的原因是什么？</p><ol><li>100%丢包</li><li>偶尔丢包（10-20%）</li><li>RTT很高（&gt;500ms）</li></ol><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>扩展ping工具：</p><ol><li>添加图形化的RTT变化显示</li><li>支持ping多个主机</li><li>将结果保存到文件</li><li>添加声音提示（连通时播放提示音）</li></ol><h3 id="练习5：思考题">练习5：思考题</h3><ol><li>为什么ping使用ICMP而不是TCP或UDP？</li><li>能否通过ping判断对方的操作系统？（提示：看TTL初始值）</li><li>防火墙可以阻止ping吗？</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="ping的高级用法">ping的高级用法</h3><p><strong>测试MTU（最大传输单元）</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Linux/Mac</span><br>ping -M <span class="hljs-keyword">do</span> -s 1472 baidu.com<br><br><span class="hljs-comment"># Windows</span><br>ping -f -l 1472 baidu.com<br><br><span class="hljs-comment"># 如果成功，说明MTU &gt;= 1500</span><br><span class="hljs-comment"># 如果失败，逐渐减小数值直到成功</span><br></code></pre></td></tr></table></figure><p><strong>洪水ping（压力测试）</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Linux（需要root权限）</span><br><span class="hljs-built_in">sudo</span> ping -f baidu.com<br><br><span class="hljs-comment"># 说明：尽可能快地发送包，用于压力测试</span><br><span class="hljs-comment"># ⚠️ 注意：不要对公共服务器使用，可能被视为攻击</span><br></code></pre></td></tr></table></figure><h3 id="不同操作系统的TTL初始值">不同操作系统的TTL初始值</h3><table><thead><tr><th>操作系统</th><th>TTL初始值</th></tr></thead><tbody><tr><td>Linux</td><td>64</td></tr><tr><td>Windows</td><td>128</td></tr><tr><td>Cisco路由器</td><td>255</td></tr><tr><td>Unix/BSD</td><td>255</td></tr></tbody></table><p>通过ping返回的TTL，可以大致判断对方的操作系统类型！</p><h3 id="ICMP的其他用途">ICMP的其他用途</h3><ol><li><strong>Traceroute</strong>：通过逐步增加TTL来追踪路由</li><li><strong>MTU发现</strong>：确定最佳数据包大小</li><li><strong>网络诊断</strong>：检测网络配置问题</li><li><strong>错误报告</strong>：通知源主机网络错误</li></ol><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第6天：网络命令进阶 - traceroute</strong></p><p>我们将学习：</p><ul><li>traceroute的工作原理</li><li>如何追踪数据包的完整路径</li><li>理解TTL在路由追踪中的作用</li><li>编写自己的traceroute工具</li></ul><hr><p>💡 <strong>今日金句</strong>：ping通网络，就像听到远方朋友的回音！</p><p>👉 <a href="day04.md">上一天：TCP/IP四层模型</a> | <a href="../../README.md">返回目录</a> | <a href="day06.md">下一天：traceroute详解</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>4天：TCP/IP四层模型</title>
    <link href="/2025/11/10/4%E5%A4%A9%EF%BC%9ATCP_IP%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B/"/>
    <url>/2025/11/10/4%E5%A4%A9%EF%BC%9ATCP_IP%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1>第4天：TCP/IP四层模型</h1><blockquote><p>“理论是OSI，实战是TCP/IP。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解TCP/IP四层模型</li><li>掌握TCP/IP与OSI的区别和联系</li><li>学会分析真实的网络数据包</li><li>编写程序捕获和解析数据包</li></ul><h2 id="🎯-为什么需要TCP-IP模型？">🎯 为什么需要TCP/IP模型？</h2><h3 id="OSI-vs-TCP-IP">OSI vs TCP/IP</h3><p><strong>OSI七层模型</strong>：</p><ul><li>📖 理论模型，由ISO制定</li><li>🎓 教学用途，帮助理解网络概念</li><li>📚 过于复杂，实际应用较少</li></ul><p><strong>TCP/IP四层模型</strong>：</p><ul><li>💻 实际使用的模型</li><li>🌐 互联网的基础</li><li>🚀 简单实用，广泛应用</li></ul><h3 id="类比理解">类比理解</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">OSI模型 <span class="hljs-operator">=</span> 理想的建筑设计图纸（<span class="hljs-number">7</span>层楼）<br>TCP/IP模型 <span class="hljs-operator">=</span> 实际建造的房子（<span class="hljs-number">4</span>层楼，但功能齐全）<br></code></pre></td></tr></table></figure><h2 id="📊-TCP-IP四层模型">📊 TCP/IP四层模型</h2><h3 id="层次对应关系">层次对应关系</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs livescript">┌──────────────────┐<br>│   OSI七层模型    │            TCP/IP四层模型<br>├──────────────────┤<br>│  <span class="hljs-number">7.</span> 应用层       │ <span class="hljs-string">\</span><br>│  <span class="hljs-number">6.</span> 表示层       │  <span class="hljs-string">\</span>       ┌──────────────────┐<br>│  <span class="hljs-number">5.</span> 会话层       │   &#125; ───&gt; │  <span class="hljs-number">4.</span> 应用层       │<br>└──────────────────┘  /       │  (Application)   │<br>┌──────────────────┐ /        └──────────────────┘<br>│  <span class="hljs-number">4.</span> 传输层       │ ───────&gt; ┌──────────────────┐<br>└──────────────────┘          │  <span class="hljs-number">3.</span> 传输层       │<br>┌──────────────────┐          │  (Transport)     │<br>│  <span class="hljs-number">3.</span> 网络层       │ ───────&gt; └──────────────────┘<br>└──────────────────┘          ┌──────────────────┐<br>┌──────────────────┐          │  <span class="hljs-number">2.</span> 网际层       │<br>│  <span class="hljs-number">2.</span> 数据链路层   │ <span class="hljs-string">\</span>        │  (Internet)      │<br>│  <span class="hljs-number">1.</span> 物理层       │  &#125; ───&gt;  └──────────────────┘<br>└──────────────────┘ /        ┌──────────────────┐<br>                               │  <span class="hljs-number">1.</span> 网络接口层   │<br>                               │  (Network Access)│<br>                               └──────────────────┘<br></code></pre></td></tr></table></figure><h3 id="TCP-IP各层详解">TCP/IP各层详解</h3><h4 id="第4层：应用层（Application-Layer）">第4层：应用层（Application Layer）</h4><p><strong>对应OSI</strong>：应用层 + 表示层 + 会话层</p><p><strong>主要协议</strong>：</p><ul><li>🌐 HTTP/HTTPS：网页浏览</li><li>📧 SMTP/POP3/IMAP：邮件</li><li>📁 FTP：文件传输</li><li>🔍 DNS：域名解析</li><li>🔐 SSH：远程登录</li><li>💬 MQTT：物联网通信</li></ul><p><strong>作用</strong>：为用户提供各种网络服务</p><p><strong>例子</strong>：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nix">浏览器访问 www.baidu.com<br>↓<br>应用层：生成HTTP请求<br>GET <span class="hljs-symbol">/</span> HTTP<span class="hljs-symbol">/1.1</span><br><span class="hljs-params">Host:</span> www.baidu.com<br></code></pre></td></tr></table></figure><hr><h4 id="第3层：传输层（Transport-Layer）">第3层：传输层（Transport Layer）</h4><p><strong>对应OSI</strong>：传输层</p><p><strong>主要协议</strong>：</p><ul><li>🚚 TCP：可靠传输，面向连接</li><li>📦 UDP：快速传输，无连接</li></ul><p><strong>作用</strong>：提供端到端的数据传输</p><p><strong>关键概念</strong>：</p><ul><li><strong>端口号</strong>：标识应用程序<ul><li>HTTP: 80</li><li>HTTPS: 443</li><li>SSH: 22</li><li>MySQL: 3306</li></ul></li></ul><p><strong>TCP vs UDP</strong>：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">TCP</span> <span class="hljs-operator">=</span> 打电话（需要接通，可靠）<br><span class="hljs-attribute">UDP</span> <span class="hljs-operator">=</span> 发短信（直接发，不保证送达）<br></code></pre></td></tr></table></figure><hr><h4 id="第2层：网际层（Internet-Layer）">第2层：网际层（Internet Layer）</h4><p><strong>对应OSI</strong>：网络层</p><p><strong>主要协议</strong>：</p><ul><li>🌐 IP：网际协议（IPv4/IPv6）</li><li>📡 ICMP：控制消息协议</li><li>🗺️ ARP：地址解析协议</li><li>🔀 IGMP：组管理协议</li></ul><p><strong>作用</strong>：路由和寻址，在网络间传输数据</p><p><strong>关键概念</strong>：</p><ul><li><strong>IP地址</strong>：设备的网络地址<ul><li>192.168.1.100（私网）</li><li>8.8.8.8（公网）</li></ul></li></ul><p><strong>例子</strong>：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">从北京的电脑访问上海的服务器<br>↓<br>网际层：选择最佳路径<br>北京 → 路由器1 → 路由器2 → <span class="hljs-string">...</span> → 上海<br></code></pre></td></tr></table></figure><hr><h4 id="第1层：网络接口层（Network-Access-Layer）">第1层：网络接口层（Network Access Layer）</h4><p><strong>对应OSI</strong>：数据链路层 + 物理层</p><p><strong>主要协议</strong>：</p><ul><li>🔗 Ethernet：以太网</li><li>📶 WiFi：无线局域网</li><li>🔌 PPP：点对点协议</li></ul><p><strong>作用</strong>：在物理网络上传输数据帧</p><p><strong>关键概念</strong>：</p><ul><li><strong>MAC地址</strong>：网卡的物理地址<ul><li>AA:BB:CC:DD:EE:FF</li></ul></li></ul><p><strong>例子</strong>：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">同一个局域网内的两台电脑通信<br>↓<br>网络接口层：通过MAC地址直接传输<br>电脑<span class="hljs-selector-tag">A</span>的网卡 → 交换机 → 电脑<span class="hljs-selector-tag">B</span>的网卡<br></code></pre></td></tr></table></figure><h2 id="📦-TCP-IP数据封装">📦 TCP/IP数据封装</h2><h3 id="发送数据的封装过程">发送数据的封装过程</h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs coq">应用层：<br>[HTTP请求数据]<br>    ↓<br>传输层：<br>[TCP头部 | <span class="hljs-type">HTTP</span>请求数据]  ← Segment（段）<br>    ↓<br>网际层：<br>[IP头部 | <span class="hljs-type">TCP</span>头部 | <span class="hljs-type">HTTP</span>请求数据]  ← Packet（包）<br>    ↓<br>网络接口层：<br>[以太网帧头 | <span class="hljs-type">IP</span>头部 | <span class="hljs-type">TCP</span>头部 | <span class="hljs-type">HTTP</span>请求数据 | <span class="hljs-type">帧尾]  ← Frame</span>（帧）<br>    ↓<br>物理层：<br><span class="hljs-number">01010101.</span>..  ← Bits（比特流）<br></code></pre></td></tr></table></figure><h3 id="各层添加的信息">各层添加的信息</h3><table><thead><tr><th>层次</th><th>添加的信息</th><th>目的</th></tr></thead><tbody><tr><td>应用层</td><td>应用数据</td><td>用户数据</td></tr><tr><td>传输层</td><td>源端口、目标端口</td><td>标识应用程序</td></tr><tr><td>网际层</td><td>源IP、目标IP</td><td>标识主机位置</td></tr><tr><td>网络接口层</td><td>源MAC、目标MAC</td><td>标识网卡</td></tr></tbody></table><h2 id="🔧-实战项目：数据包分析器">🔧 实战项目：数据包分析器</h2><p>让我们编写一个程序，捕获和分析真实的网络数据包！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day04_packet_analyzer.py</span><br><span class="hljs-comment"># 功能：捕获并分析网络数据包（TCP/IP各层信息）</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> textwrap<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ethernet_frame</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析以太网帧（网络接口层）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    以太网帧格式：</span><br><span class="hljs-string">    [目标MAC(6字节) | 源MAC(6字节) | 类型(2字节) | 数据 | CRC(4字节)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 提取MAC地址和类型</span><br>    dest_mac, src_mac, eth_type = struct.unpack(<span class="hljs-string">&#x27;! 6s 6s H&#x27;</span>, data[:<span class="hljs-number">14</span>])<br><br>    <span class="hljs-comment"># 格式化MAC地址</span><br>    dest_mac = <span class="hljs-string">&#x27;:&#x27;</span>.join(<span class="hljs-string">&#x27;&#123;:02x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> dest_mac)<br>    src_mac = <span class="hljs-string">&#x27;:&#x27;</span>.join(<span class="hljs-string">&#x27;&#123;:02x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> src_mac)<br><br>    <span class="hljs-comment"># 以太网类型</span><br>    <span class="hljs-comment"># 0x0800 = IPv4, 0x86DD = IPv6, 0x0806 = ARP</span><br>    eth_type = socket.htons(eth_type)<br><br>    <span class="hljs-comment"># 返回MAC地址、类型和剩余数据</span><br>    <span class="hljs-keyword">return</span> dest_mac, src_mac, eth_type, data[<span class="hljs-number">14</span>:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ipv4_packet</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析IPv4数据包（网际层）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    IPv4头部格式（20字节）：</span><br><span class="hljs-string">    [版本+头长(1) | 服务类型(1) | 总长度(2) | 标识(2) | 标志+偏移(2) |</span><br><span class="hljs-string">     TTL(1) | 协议(1) | 校验和(2) | 源IP(4) | 目标IP(4)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 解析IPv4头部的前20字节</span><br>    version_header_length = data[<span class="hljs-number">0</span>]<br>    version = version_header_length &gt;&gt; <span class="hljs-number">4</span>  <span class="hljs-comment"># 高4位是版本</span><br>    header_length = (version_header_length &amp; <span class="hljs-number">15</span>) * <span class="hljs-number">4</span>  <span class="hljs-comment"># 低4位是头长（单位：4字节）</span><br><br>    <span class="hljs-comment"># 提取TTL、协议、源IP、目标IP</span><br>    ttl, proto, src, target = struct.unpack(<span class="hljs-string">&#x27;! 8x B B 2x 4s 4s&#x27;</span>, data[:<span class="hljs-number">20</span>])<br><br>    <span class="hljs-comment"># 格式化IP地址</span><br>    src_ip = <span class="hljs-string">&#x27;.&#x27;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, src))<br>    target_ip = <span class="hljs-string">&#x27;.&#x27;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, target))<br><br>    <span class="hljs-comment"># 协议号对应的协议名</span><br>    protocols = &#123;<span class="hljs-number">1</span>: <span class="hljs-string">&#x27;ICMP&#x27;</span>, <span class="hljs-number">6</span>: <span class="hljs-string">&#x27;TCP&#x27;</span>, <span class="hljs-number">17</span>: <span class="hljs-string">&#x27;UDP&#x27;</span>&#125;<br>    proto_name = protocols.get(proto, <span class="hljs-string">f&#x27;Other(<span class="hljs-subst">&#123;proto&#125;</span>)&#x27;</span>)<br><br>    <span class="hljs-keyword">return</span> version, header_length, ttl, proto_name, src_ip, target_ip, data[header_length:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tcp_segment</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析TCP段（传输层）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    TCP头部格式（至少20字节）：</span><br><span class="hljs-string">    [源端口(2) | 目标端口(2) | 序号(4) | 确认号(4) |</span><br><span class="hljs-string">     头长+标志(2) | 窗口(2) | 校验和(2) | 紧急指针(2)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    src_port, dest_port, sequence, acknowledgment, offset_reserved_flags = struct.unpack(<br>        <span class="hljs-string">&#x27;! H H L L H&#x27;</span>, data[:<span class="hljs-number">14</span>]<br>    )<br><br>    <span class="hljs-comment"># 提取头部长度（高4位）</span><br>    offset = (offset_reserved_flags &gt;&gt; <span class="hljs-number">12</span>) * <span class="hljs-number">4</span><br><br>    <span class="hljs-comment"># 提取TCP标志位</span><br>    flag_urg = (offset_reserved_flags &amp; <span class="hljs-number">32</span>) &gt;&gt; <span class="hljs-number">5</span><br>    flag_ack = (offset_reserved_flags &amp; <span class="hljs-number">16</span>) &gt;&gt; <span class="hljs-number">4</span><br>    flag_psh = (offset_reserved_flags &amp; <span class="hljs-number">8</span>) &gt;&gt; <span class="hljs-number">3</span><br>    flag_rst = (offset_reserved_flags &amp; <span class="hljs-number">4</span>) &gt;&gt; <span class="hljs-number">2</span><br>    flag_syn = (offset_reserved_flags &amp; <span class="hljs-number">2</span>) &gt;&gt; <span class="hljs-number">1</span><br>    flag_fin = offset_reserved_flags &amp; <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> src_port, dest_port, sequence, acknowledgment, flag_urg, flag_ack, \<br>           flag_psh, flag_rst, flag_syn, flag_fin, data[offset:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">udp_segment</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析UDP段（传输层）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    UDP头部格式（8字节）：</span><br><span class="hljs-string">    [源端口(2) | 目标端口(2) | 长度(2) | 校验和(2)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    src_port, dest_port, length = struct.unpack(<span class="hljs-string">&#x27;! H H 2x H&#x27;</span>, data[:<span class="hljs-number">8</span>])<br>    <span class="hljs-keyword">return</span> src_port, dest_port, length, data[<span class="hljs-number">8</span>:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">format_multi_line</span>(<span class="hljs-params">prefix, string, size=<span class="hljs-number">80</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;格式化多行输出&quot;&quot;&quot;</span><br>    size -= <span class="hljs-built_in">len</span>(prefix)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(string, <span class="hljs-built_in">bytes</span>):<br>        string = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-string">r&#x27;\x&#123;:02x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(byte) <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> string)<br>        <span class="hljs-keyword">if</span> size % <span class="hljs-number">2</span>:<br>            size -= <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;\n&#x27;</span>.join([prefix + line <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> textwrap.wrap(string, size)])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数：捕获并分析数据包</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;TCP/IP数据包分析器&quot;</span>.center(<span class="hljs-number">80</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n📡 正在监听网络接口...&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 提示：访问一个网站或ping一个地址来生成流量&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚠️  按Ctrl+C停止捕获\n&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><br>    <span class="hljs-comment"># 创建原始套接字</span><br>    <span class="hljs-comment"># 注意：在某些系统上可能需要root权限</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># Windows</span><br>        conn = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_IP)<br>        conn.bind((<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-number">0</span>))<br>        conn.setsockopt(socket.IPPROTO_IP, socket.IP_HDRINCL, <span class="hljs-number">1</span>)<br>        conn.ioctl(socket.SIO_RCVALL, socket.RCVALL_ON)<br>    <span class="hljs-keyword">except</span> AttributeError:<br>        <span class="hljs-comment"># Linux/Mac</span><br>        conn = socket.socket(socket.AF_PACKET, socket.SOCK_RAW, socket.ntohs(<span class="hljs-number">3</span>))<br><br>    packet_count = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-comment"># 接收数据</span><br>            raw_data, addr = conn.recvfrom(<span class="hljs-number">65535</span>)<br>            packet_count += <span class="hljs-number">1</span><br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;▼&#x27;</span> * <span class="hljs-number">40</span>&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📦 数据包 #<span class="hljs-subst">&#123;packet_count&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;▼&#x27;</span> * <span class="hljs-number">40</span>&#125;</span>\n&quot;</span>)<br><br>            <span class="hljs-comment"># 1. 解析以太网帧（网络接口层）</span><br>            <span class="hljs-keyword">try</span>:<br>                dest_mac, src_mac, eth_type, data = ethernet_frame(raw_data)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔗 网络接口层（以太网帧）&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源MAC地址: <span class="hljs-subst">&#123;src_mac&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标MAC地址: <span class="hljs-subst">&#123;dest_mac&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   协议类型: 0x<span class="hljs-subst">&#123;eth_type:04x&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-comment"># 某些系统可能不包含以太网头</span><br>                eth_type = <span class="hljs-number">0x0800</span><br>                data = raw_data<br><br>            <span class="hljs-comment"># 2. 解析IP数据包（网际层）</span><br>            <span class="hljs-keyword">if</span> eth_type == <span class="hljs-number">0x0800</span>:  <span class="hljs-comment"># IPv4</span><br>                version, header_length, ttl, proto, src_ip, target_ip, data = ipv4_packet(data)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🌐 网际层（IP数据包）&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   IP版本: IPv<span class="hljs-subst">&#123;version&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   头部长度: <span class="hljs-subst">&#123;header_length&#125;</span>字节&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   TTL: <span class="hljs-subst">&#123;ttl&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   协议: <span class="hljs-subst">&#123;proto&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源IP地址: <span class="hljs-subst">&#123;src_ip&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标IP地址: <span class="hljs-subst">&#123;target_ip&#125;</span>&quot;</span>)<br><br>                <span class="hljs-comment"># 3. 解析传输层</span><br>                <span class="hljs-keyword">if</span> proto == <span class="hljs-string">&#x27;TCP&#x27;</span>:<br>                    src_port, dest_port, sequence, acknowledgment, flag_urg, flag_ack, \<br>                    flag_psh, flag_rst, flag_syn, flag_fin, data = tcp_segment(data)<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🚚 传输层（TCP段）&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源端口: <span class="hljs-subst">&#123;src_port&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标端口: <span class="hljs-subst">&#123;dest_port&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   序列号: <span class="hljs-subst">&#123;sequence&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   确认号: <span class="hljs-subst">&#123;acknowledgment&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   标志位: &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br><br>                    flags = []<br>                    <span class="hljs-keyword">if</span> flag_syn: flags.append(<span class="hljs-string">&quot;SYN&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_ack: flags.append(<span class="hljs-string">&quot;ACK&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_fin: flags.append(<span class="hljs-string">&quot;FIN&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_rst: flags.append(<span class="hljs-string">&quot;RST&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_psh: flags.append(<span class="hljs-string">&quot;PSH&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_urg: flags.append(<span class="hljs-string">&quot;URG&quot;</span>)<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;, &quot;</span>.join(flags) <span class="hljs-keyword">if</span> flags <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;无&quot;</span>)<br><br>                    <span class="hljs-comment"># 4. 应用层数据</span><br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &gt; <span class="hljs-number">0</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📱 应用层数据&quot;</span>)<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   数据长度: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(data)&#125;</span>字节&quot;</span>)<br><br>                        <span class="hljs-comment"># 尝试解析HTTP</span><br>                        <span class="hljs-keyword">try</span>:<br>                            data_str = data.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>                            <span class="hljs-keyword">if</span> data_str.startswith(<span class="hljs-string">&#x27;HTTP&#x27;</span>) <span class="hljs-keyword">or</span> data_str.startswith(<span class="hljs-string">&#x27;GET&#x27;</span>) <span class="hljs-keyword">or</span> \<br>                               data_str.startswith(<span class="hljs-string">&#x27;POST&#x27;</span>):<br>                                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   协议: HTTP&quot;</span>)<br>                                lines = data_str.split(<span class="hljs-string">&#x27;\\r\\n&#x27;</span>)[:<span class="hljs-number">5</span>]  <span class="hljs-comment"># 只显示前5行</span><br>                                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>                                    <span class="hljs-keyword">if</span> line:<br>                                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   <span class="hljs-subst">&#123;line&#125;</span>&quot;</span>)<br>                        <span class="hljs-keyword">except</span>:<br>                            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   数据预览: <span class="hljs-subst">&#123;data[:<span class="hljs-number">50</span>]&#125;</span>&quot;</span>)<br><br>                <span class="hljs-keyword">elif</span> proto == <span class="hljs-string">&#x27;UDP&#x27;</span>:<br>                    src_port, dest_port, length, data = udp_segment(data)<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📦 传输层（UDP段）&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源端口: <span class="hljs-subst">&#123;src_port&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标端口: <span class="hljs-subst">&#123;dest_port&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   长度: <span class="hljs-subst">&#123;length&#125;</span>字节&quot;</span>)<br><br>                    <span class="hljs-comment"># DNS查询/响应</span><br>                    <span class="hljs-keyword">if</span> src_port == <span class="hljs-number">53</span> <span class="hljs-keyword">or</span> dest_port == <span class="hljs-number">53</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   应用协议: DNS&quot;</span>)<br><br>                <span class="hljs-keyword">elif</span> proto == <span class="hljs-string">&#x27;ICMP&#x27;</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📡 传输层（ICMP）&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   这是一个ping或traceroute数据包&quot;</span>)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><br>            <span class="hljs-comment"># 只捕获前10个包作为演示</span><br>            <span class="hljs-keyword">if</span> packet_count &gt;= <span class="hljs-number">10</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n✅ 已捕获<span class="hljs-subst">&#123;packet_count&#125;</span>个数据包，停止监听&quot;</span>)<br>                <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n\n✋ 用户停止捕获&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📊 总共捕获了 <span class="hljs-subst">&#123;packet_count&#125;</span> 个数据包&quot;</span>)<br><br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-comment"># Windows需要关闭混杂模式</span><br>        <span class="hljs-keyword">try</span>:<br>            conn.ioctl(socket.SIO_RCVALL, socket.RCVALL_OFF)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>        conn.close()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">import</span> sys<br>    <span class="hljs-keyword">if</span> sys.platform == <span class="hljs-string">&#x27;win32&#x27;</span> <span class="hljs-keyword">or</span> sys.platform == <span class="hljs-string">&#x27;linux&#x27;</span> <span class="hljs-keyword">or</span> sys.platform == <span class="hljs-string">&#x27;darwin&#x27;</span>:<br>        main()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚠️  此程序可能需要管理员/root权限&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Linux/Mac: sudo python day04_packet_analyzer.py&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Windows: 以管理员身份运行&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="运行说明">运行说明</h3><p><strong>Linux/Mac</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> python code/day04/day04_packet_analyzer.py<br></code></pre></td></tr></table></figure><p><strong>Windows</strong>：<br>以管理员身份运行命令提示符，然后：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python code\day04\day04_packet_analyzer.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><p>程序会实时显示捕获到的数据包的各层信息。</p><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ TCP/IP四层模型是实际使用的网络模型</li><li>✅ TCP/IP比OSI更简洁实用</li><li>✅ 每一层都有特定的协议和作用</li><li>✅ 数据包包含多层的头部信息</li></ol><h3 id="TCP-IP四层对应表">TCP/IP四层对应表</h3><table><thead><tr><th>TCP/IP层</th><th>主要协议</th><th>关键信息</th><th>设备</th></tr></thead><tbody><tr><td>应用层</td><td>HTTP、DNS、FTP</td><td>应用数据</td><td>-</td></tr><tr><td>传输层</td><td>TCP、UDP</td><td>端口号</td><td>-</td></tr><tr><td>网际层</td><td>IP、ICMP</td><td>IP地址</td><td>路由器</td></tr><tr><td>网络接口层</td><td>Ethernet、WiFi</td><td>MAC地址</td><td>交换机、网卡</td></tr></tbody></table><h3 id="重要协议">重要协议</h3><p><strong>应用层</strong>：</p><ul><li>HTTP（80）：网页</li><li>HTTPS（443）：加密网页</li><li>DNS（53）：域名解析</li><li>FTP（21）：文件传输</li><li>SSH（22）：远程登录</li><li>SMTP（25）：发送邮件</li></ul><p><strong>传输层</strong>：</p><ul><li>TCP：可靠传输</li><li>UDP：快速传输</li></ul><p><strong>网际层</strong>：</p><ul><li>IP：寻址和路由</li><li>ICMP：错误报告和诊断</li></ul><p><strong>网络接口层</strong>：</p><ul><li>Ethernet：有线网络</li><li>WiFi：无线网络</li></ul><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：协议识别">练习1：协议识别</h3><p>以下端口号对应什么协议？</p><ol><li>80</li><li>443</li><li>22</li><li>3306</li><li>27017</li></ol><h3 id="练习2：层次判断">练习2：层次判断</h3><p>以下信息分别属于哪一层？</p><ol><li>192.168.1.1</li><li>AA:BB:CC:DD:EE:FF</li><li>端口8080</li><li>HTTP/1.1</li><li>TCP序列号12345</li></ol><h3 id="练习3：绘制数据包结构">练习3：绘制数据包结构</h3><p>画出一个完整的HTTP请求数据包的结构，标注每一层的头部。</p><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>扩展数据包分析器：</p><ol><li>添加数据包过滤功能（只显示特定协议）</li><li>统计各协议的数据包数量</li><li>将捕获的数据包保存到文件</li></ol><h3 id="练习5：思考题">练习5：思考题</h3><ol><li>为什么TCP/IP模型只有4层而OSI有7层？</li><li>路由器工作在哪一层？交换机呢？</li><li>防火墙可能工作在哪几层？</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="TCP-IP协议族">TCP/IP协议族</h3><p>TCP/IP不仅仅是TCP和IP两个协议，而是一整个协议族：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs routeros">应用层：<br>┌────────────────────────────────────┐<br>│ HTTP  FTP  <span class="hljs-built_in"> DNS </span>  SMTP  SSH  等<span class="hljs-built_in">..</span>. │<br>└────────────────────────────────────┘<br><br>传输层：<br>┌──────────┬──────────┐<br>│   TCP    │   UDP    │<br>└──────────┴──────────┘<br><br>网际层：<br>┌────────────────────────────┐<br>│  <span class="hljs-built_in"> IP </span>  ICMP   ARP   IGMP   │<br>└────────────────────────────┘<br><br>网络接口层：<br>┌────────────────────────────┐<br>│ <span class="hljs-built_in"> Ethernet </span> WiFi <span class="hljs-built_in"> PPP </span> 等<span class="hljs-built_in">..</span>. │<br>└────────────────────────────┘<br></code></pre></td></tr></table></figure><h3 id="常见端口号记忆">常见端口号记忆</h3><p><strong>HTTP家族</strong>：</p><ul><li>80：HTTP</li><li>443：HTTPS</li><li>8080：HTTP代理</li></ul><p><strong>文件传输</strong>：</p><ul><li>20/21：FTP</li><li>22：SFTP（SSH）</li><li>69：TFTP</li></ul><p><strong>邮件</strong>：</p><ul><li>25：SMTP（发送）</li><li>110：POP3（接收）</li><li>143：IMAP（接收）</li></ul><p><strong>数据库</strong>：</p><ul><li>3306：MySQL</li><li>5432：PostgreSQL</li><li>27017：MongoDB</li><li>6379：Redis</li></ul><p><strong>远程</strong>：</p><ul><li>22：SSH</li><li>23：Telnet</li><li>3389：RDP（Windows远程桌面）</li></ul><h3 id="实际应用场景">实际应用场景</h3><ol><li><p><strong>浏览网页</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">应用层：HTTP请求 www<span class="hljs-selector-class">.baidu</span><span class="hljs-selector-class">.com</span><br>传输层：TCP 端口<span class="hljs-number">80</span><br>网际层：IP地址 <span class="hljs-number">220.181</span>.<span class="hljs-number">38.148</span><br>网络接口层：通过以太网发送<br></code></pre></td></tr></table></figure></li><li><p><strong>发送邮件</strong>：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino">应用层：SMTP协议<br>传输层：TCP 端口<span class="hljs-number">25</span><br>网际层：IP地址（邮件服务器）<br>网络接口层：<span class="hljs-built_in">WiFi</span><br></code></pre></td></tr></table></figure></li><li><p><strong>ping命令</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">应用层：无（ICMP是网际层协议）<br>传输层：无<br>网际层：ICMP <span class="hljs-built_in">echo</span> request<br>网络接口层：以太网<br></code></pre></td></tr></table></figure></li></ol><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第5天：网络命令入门 - ping</strong></p><p>我们将学习：</p><ul><li>ping命令的工作原理</li><li>ICMP协议详解</li><li>RTT（往返时间）的计算</li><li>编写自己的ping工具</li></ul><hr><p>💡 <strong>今日金句</strong>：掌握TCP/IP，就掌握了互联网的语言！</p><p>👉 <a href="day03.md">上一天：OSI七层模型</a> | <a href="../../README.md">返回目录</a> | <a href="day05.md">下一天：ping命令详解</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>3天：OSI七层模型</title>
    <link href="/2025/11/10/3%E5%A4%A9%EF%BC%9AOSI%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/"/>
    <url>/2025/11/10/3%E5%A4%A9%EF%BC%9AOSI%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1>第3天：OSI七层模型</h1><blockquote><p>“网络协议就像流水线，每一层都有自己的分工。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解什么是OSI七层模型</li><li>掌握每一层的作用</li><li>理解数据封装和解封装过程</li><li>编写程序演示协议分层</li></ul><h2 id="🎯-为什么要分层？">🎯 为什么要分层？</h2><h3 id="生活中的例子：快递系统">生活中的例子：快递系统</h3><p>想象你要给上海的朋友寄一本书：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs">你写信 ────────────────────────────&gt; 朋友读信<br>  ↓                                      ↑<br>包装快递 ──────────────────────────&gt; 拆开快递<br>  ↓                                      ↑<br>分拣中心 ──────────────────────────&gt; 分拣中心<br>  ↓                                      ↑<br>运输车辆 ──────────────────────────&gt; 运输车辆<br></code></pre></td></tr></table></figure><p><strong>每一层只关心自己的工作</strong>：</p><ul><li>你只需要写信，不管怎么运输</li><li>快递员只负责包装，不管写的什么</li><li>司机只负责开车，不管包裹里是什么</li></ul><p>这就是<strong>分层的思想</strong>！</p><h3 id="分层的好处">分层的好处</h3><ol><li><strong>降低复杂度</strong>：每层只处理自己的任务</li><li><strong>标准化接口</strong>：层与层之间有明确的接口</li><li><strong>易于维护</strong>：修改某一层不影响其他层</li><li><strong>可替换</strong>：可以更换某一层的实现</li></ol><h2 id="📊-OSI七层模型">📊 OSI七层模型</h2><p><strong>OSI</strong>（Open Systems Interconnection）是国际标准化组织（ISO）制定的网络模型。</p><h3 id="七层概览">七层概览</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs arduino">┌─────────────┬────────────┬──────────────┬──────────────┐<br>│  层次       │  名称      │  作用        │  例子        │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">7</span>层      │  应用层    │  为用户提供  │  HTTP、FTP   │<br>│             │Application │  网络服务    │  SMTP、DNS   │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">6</span>层      │  表示层    │  数据格式转换│  加密、压缩  │<br>│             │Presentation│  编码、加密  │  JPEG、MPEG  │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">5</span>层      │  会话层    │  建立、管理  │  RPC、SQL    │<br>│             │Session     │  会话        │              │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">4</span>层      │  传输层    │  端到端通信  │  TCP、UDP    │<br>│             │Transport   │  可靠传输    │              │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">3</span>层      │  网络层    │  路由选择    │  IP、ICMP    │<br>│             │Network     │  寻址        │              │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">2</span>层      │  数据链路层│  帧传输      │  <span class="hljs-built_in">Ethernet</span>    │<br>│             │Data Link   │  错误检测    │  <span class="hljs-built_in">WiFi</span>、PPP   │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">1</span>层      │  物理层    │  比特传输    │  网线、光纤  │<br>│             │Physical    │  电信号      │  无线电波    │<br>└─────────────┴────────────┴──────────────┴──────────────┘<br></code></pre></td></tr></table></figure><h3 id="记忆口诀">记忆口诀</h3><p><strong>从上到下</strong>：</p><ul><li>应（应用层）</li><li>表（表示层）</li><li>会（会话层）</li><li>传（传输层）</li><li>网（网络层）</li><li>数（数据链路层）</li><li>物（物理层）</li></ul><p><strong>英文口诀</strong>：All People Seem To Need Data Processing</p><h2 id="🔍-各层详解">🔍 各层详解</h2><h3 id="第7层：应用层（Application-Layer）">第7层：应用层（Application Layer）</h3><p><strong>作用</strong>：为应用程序提供网络服务</p><p><strong>通俗理解</strong>：你直接使用的软件层面</p><p><strong>例子</strong>：</p><ul><li>浏览器打开网页（HTTP/HTTPS）</li><li>收发邮件（SMTP/POP3）</li><li>下载文件（FTP）</li><li>域名解析（DNS）</li></ul><p><strong>类比</strong>：快递公司的客服窗口</p><hr><h3 id="第6层：表示层（Presentation-Layer）">第6层：表示层（Presentation Layer）</h3><p><strong>作用</strong>：数据格式转换、加密、压缩</p><p><strong>通俗理解</strong>：翻译官</p><p><strong>例子</strong>：</p><ul><li>JPEG图片格式</li><li>MP3音频格式</li><li>加密算法（SSL/TLS）</li><li>字符编码（UTF-8）</li></ul><p><strong>类比</strong>：快递包装、封装</p><hr><h3 id="第5层：会话层（Session-Layer）">第5层：会话层（Session Layer）</h3><p><strong>作用</strong>：建立、管理、终止会话</p><p><strong>通俗理解</strong>：负责通话的接线员</p><p><strong>例子</strong>：</p><ul><li>登录会话</li><li>数据库连接</li><li>RPC远程调用</li></ul><p><strong>类比</strong>：快递单号管理系统</p><hr><h3 id="第4层：传输层（Transport-Layer）">第4层：传输层（Transport Layer）</h3><p><strong>作用</strong>：端到端的可靠传输</p><p><strong>通俗理解</strong>：确保包裹完整送达</p><p><strong>例子</strong>：</p><ul><li>TCP：可靠传输，确保数据不丢失</li><li>UDP：快速传输，不保证可靠</li></ul><p><strong>关键概念</strong>：端口号（区分不同的应用）</p><p><strong>类比</strong>：快递公司的分发系统</p><hr><h3 id="第3层：网络层（Network-Layer）">第3层：网络层（Network Layer）</h3><p><strong>作用</strong>：路由选择和寻址</p><p><strong>通俗理解</strong>：找到最佳路径</p><p><strong>例子</strong>：</p><ul><li>IP协议（IP地址）</li><li>路由器工作在这一层</li></ul><p><strong>关键概念</strong>：IP地址（定位设备位置）</p><p><strong>类比</strong>：快递运输路线规划</p><hr><h3 id="第2层：数据链路层（Data-Link-Layer）">第2层：数据链路层（Data Link Layer）</h3><p><strong>作用</strong>：帧传输，相邻节点之间的数据传输</p><p><strong>通俗理解</strong>：同一条街道内的传送</p><p><strong>例子</strong>：</p><ul><li>以太网（Ethernet）</li><li>WiFi</li><li>MAC地址</li></ul><p><strong>关键概念</strong>：MAC地址（网卡的物理地址）</p><p><strong>类比</strong>：同城快递站点之间的传递</p><hr><h3 id="第1层：物理层（Physical-Layer）">第1层：物理层（Physical Layer）</h3><p><strong>作用</strong>：在物理媒介上传输比特流</p><p><strong>通俗理解</strong>：实际的传输介质</p><p><strong>例子</strong>：</p><ul><li>网线（双绞线）</li><li>光纤</li><li>无线电波</li></ul><p><strong>关键概念</strong>：电信号、光信号、无线信号</p><p><strong>类比</strong>：快递车、飞机、轮船</p><h2 id="📦-数据封装过程">📦 数据封装过程</h2><p>当你发送数据时，数据会经过<strong>封装</strong>过程：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">应用层：    [用户数据]<br>              ↓ 添加应用层头部<br>表示层：    [表示层头部|<span class="hljs-string">用户数据]</span><br><span class="hljs-string">              ↓ 添加会话层头部</span><br><span class="hljs-string">会话层：    [会话层头部</span>|<span class="hljs-string">表示层头部</span>|<span class="hljs-string">用户数据]</span><br><span class="hljs-string">              ↓ 添加传输层头部</span><br><span class="hljs-string">传输层：    [TCP头部</span>|<span class="hljs-string">数据] ← 称为&quot;段&quot;（Segment）</span><br><span class="hljs-string">              ↓ 添加网络层头部</span><br><span class="hljs-string">网络层：    [IP头部</span>|<span class="hljs-string">TCP头部</span>|<span class="hljs-string">数据] ← 称为&quot;包&quot;（Packet）</span><br><span class="hljs-string">              ↓ 添加数据链路层头部和尾部</span><br><span class="hljs-string">数据链路层：[帧头</span>|<span class="hljs-string">IP头部</span>|<span class="hljs-string">TCP头部</span>|<span class="hljs-string">数据</span>|<span class="hljs-string">帧尾] ← 称为&quot;帧&quot;（Frame）</span><br><span class="hljs-string">              ↓ 转换为比特流</span><br><span class="hljs-string">物理层：    01010101010101... ← 比特流（Bits）</span><br></code></pre></td></tr></table></figure><h3 id="类比理解">类比理解</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs armasm">你写的信     →  应用层数据<br>装进信封     →  传输层添加端口信息<br>写上地址     →  网络层添加<span class="hljs-built_in">IP</span>地址<br>放入包裹箱   →  数据链路层添加MAC地址<br>快递车运输   →  物理层传输<br></code></pre></td></tr></table></figure><h2 id="🔧-实战项目：协议分层演示">🔧 实战项目：协议分层演示</h2><p>让我们编写一个程序，模拟OSI七层模型的数据封装过程！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day03_osi_demo.py</span><br><span class="hljs-comment"># 功能：演示OSI七层模型的数据封装和解封装过程</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OSILayer</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;OSI模型的基础层类&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, layer_num</span>):<br>        <span class="hljs-variable language_">self</span>.name = name<br>        <span class="hljs-variable language_">self</span>.layer_num = layer_num<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;封装数据：添加本层头部&quot;&quot;&quot;</span><br>        header = <span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;self.name&#125;</span>头部]&quot;</span><br>        <span class="hljs-keyword">return</span> header + data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;解封装数据：移除本层头部&quot;&quot;&quot;</span><br>        header = <span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;self.name&#125;</span>头部]&quot;</span><br>        <span class="hljs-keyword">if</span> data.startswith(header):<br>            <span class="hljs-keyword">return</span> data[<span class="hljs-built_in">len</span>(header):]<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PhysicalLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;物理层：第1层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;物理层&quot;</span>, <span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;将数据转换为比特流&quot;&quot;&quot;</span><br>        bits = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">format</span>(<span class="hljs-built_in">ord</span>(c), <span class="hljs-string">&#x27;08b&#x27;</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📡 <span class="hljs-subst">&#123;self.name&#125;</span>: 将数据转换为比特流&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   比特流(前64位): <span class="hljs-subst">&#123;bits[:<span class="hljs-number">64</span>]&#125;</span>...&quot;</span>)<br>        <span class="hljs-keyword">return</span> bits<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, bits</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;将比特流转换为数据&quot;&quot;&quot;</span><br>        chars = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(bits), <span class="hljs-number">8</span>):<br>            byte = bits[i:i+<span class="hljs-number">8</span>]<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(byte) == <span class="hljs-number">8</span>:<br>                chars.append(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(byte, <span class="hljs-number">2</span>)))<br>        data = <span class="hljs-string">&#x27;&#x27;</span>.join(chars)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📡 <span class="hljs-subst">&#123;self.name&#125;</span>: 将比特流转换为数据&quot;</span>)<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLinkLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;数据链路层：第2层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;数据链路层&quot;</span>, <span class="hljs-number">2</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;添加MAC地址（帧头和帧尾）&quot;&quot;&quot;</span><br>        mac_src = <span class="hljs-string">&quot;AA:BB:CC:DD:EE:FF&quot;</span>  <span class="hljs-comment"># 源MAC地址</span><br>        mac_dst = <span class="hljs-string">&quot;11:22:33:44:55:66&quot;</span>  <span class="hljs-comment"># 目标MAC地址</span><br>        frame = <span class="hljs-string">f&quot;[帧头|源MAC:<span class="hljs-subst">&#123;mac_src&#125;</span>|目标MAC:<span class="hljs-subst">&#123;mac_dst&#125;</span>]<span class="hljs-subst">&#123;data&#125;</span>[帧尾|CRC校验]&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔗 <span class="hljs-subst">&#123;self.name&#125;</span>: 添加MAC地址&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源MAC: <span class="hljs-subst">&#123;mac_src&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标MAC: <span class="hljs-subst">&#123;mac_dst&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> frame<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, frame</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;移除MAC地址&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 简化处理：移除帧头和帧尾</span><br>        start = frame.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        end = frame.rfind(<span class="hljs-string">&quot;[&quot;</span>)<br>        data = frame[start:end]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔗 <span class="hljs-subst">&#123;self.name&#125;</span>: 移除MAC地址&quot;</span>)<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;网络层：第3层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;网络层&quot;</span>, <span class="hljs-number">3</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;添加IP地址&quot;&quot;&quot;</span><br>        ip_src = <span class="hljs-string">&quot;192.168.1.100&quot;</span>  <span class="hljs-comment"># 源IP地址</span><br>        ip_dst = <span class="hljs-string">&quot;93.184.216.34&quot;</span>  <span class="hljs-comment"># 目标IP地址（example.com）</span><br>        packet = <span class="hljs-string">f&quot;[IP头|源IP:<span class="hljs-subst">&#123;ip_src&#125;</span>|目标IP:<span class="hljs-subst">&#123;ip_dst&#125;</span>|TTL:64]<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🌐 <span class="hljs-subst">&#123;self.name&#125;</span>: 添加IP地址&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源IP: <span class="hljs-subst">&#123;ip_src&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标IP: <span class="hljs-subst">&#123;ip_dst&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> packet<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, packet</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;移除IP头部&quot;&quot;&quot;</span><br>        start = packet.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🌐 <span class="hljs-subst">&#123;self.name&#125;</span>: 移除IP头部&quot;</span>)<br>        <span class="hljs-keyword">return</span> start <span class="hljs-keyword">and</span> packet[start:] <span class="hljs-keyword">or</span> packet<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TransportLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;传输层：第4层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;传输层&quot;</span>, <span class="hljs-number">4</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;添加端口号（TCP头部）&quot;&quot;&quot;</span><br>        port_src = <span class="hljs-number">54321</span>  <span class="hljs-comment"># 源端口</span><br>        port_dst = <span class="hljs-number">80</span>     <span class="hljs-comment"># 目标端口（HTTP）</span><br>        segment = <span class="hljs-string">f&quot;[TCP头|源端口:<span class="hljs-subst">&#123;port_src&#125;</span>|目标端口:<span class="hljs-subst">&#123;port_dst&#125;</span>|序号:12345]<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🚚 <span class="hljs-subst">&#123;self.name&#125;</span>: 添加端口号（TCP协议）&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源端口: <span class="hljs-subst">&#123;port_src&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标端口: <span class="hljs-subst">&#123;port_dst&#125;</span> (HTTP)&quot;</span>)<br>        <span class="hljs-keyword">return</span> segment<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, segment</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;移除TCP头部&quot;&quot;&quot;</span><br>        start = segment.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🚚 <span class="hljs-subst">&#123;self.name&#125;</span>: 移除TCP头部&quot;</span>)<br>        <span class="hljs-keyword">return</span> segment[start:]<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SessionLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;会话层：第5层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;会话层&quot;</span>, <span class="hljs-number">5</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;建立会话&quot;&quot;&quot;</span><br>        session_id = <span class="hljs-string">&quot;SESSION-20250105-12345&quot;</span><br>        session_data = <span class="hljs-string">f&quot;[会话头|会话ID:<span class="hljs-subst">&#123;session_id&#125;</span>]<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;💬 <span class="hljs-subst">&#123;self.name&#125;</span>: 建立会话&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   会话ID: <span class="hljs-subst">&#123;session_id&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> session_data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;终止会话&quot;&quot;&quot;</span><br>        start = data.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;💬 <span class="hljs-subst">&#123;self.name&#125;</span>: 解析会话信息&quot;</span>)<br>        <span class="hljs-keyword">return</span> data[start:]<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PresentationLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;表示层：第6层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;表示层&quot;</span>, <span class="hljs-number">6</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;数据格式转换&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 这里简化为添加编码信息</span><br>        formatted_data = <span class="hljs-string">f&quot;[格式|编码:UTF-8|压缩:无|加密:无]<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🎨 <span class="hljs-subst">&#123;self.name&#125;</span>: 数据格式处理&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   编码: UTF-8&quot;</span>)<br>        <span class="hljs-keyword">return</span> formatted_data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;数据格式还原&quot;&quot;&quot;</span><br>        start = data.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🎨 <span class="hljs-subst">&#123;self.name&#125;</span>: 数据格式还原&quot;</span>)<br>        <span class="hljs-keyword">return</span> data[start:]<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;应用层：第7层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;应用层&quot;</span>, <span class="hljs-number">7</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;生成HTTP请求&quot;&quot;&quot;</span><br>        http_request = <span class="hljs-string">f&quot;GET / HTTP/1.1\\nHost: example.com\\n\\n<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📱 <span class="hljs-subst">&#123;self.name&#125;</span>: 生成HTTP请求&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   请求: GET / HTTP/1.1&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   主机: example.com&quot;</span>)<br>        <span class="hljs-keyword">return</span> http_request<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;解析HTTP响应&quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📱 <span class="hljs-subst">&#123;self.name&#125;</span>: 解析HTTP响应&quot;</span>)<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OSIModel</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;OSI七层模型&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 创建各层对象</span><br>        <span class="hljs-variable language_">self</span>.layers = [<br>            ApplicationLayer(),    <span class="hljs-comment"># 第7层</span><br>            PresentationLayer(),   <span class="hljs-comment"># 第6层</span><br>            SessionLayer(),        <span class="hljs-comment"># 第5层</span><br>            TransportLayer(),      <span class="hljs-comment"># 第4层</span><br>            NetworkLayer(),        <span class="hljs-comment"># 第3层</span><br>            DataLinkLayer(),       <span class="hljs-comment"># 第2层</span><br>            PhysicalLayer(),       <span class="hljs-comment"># 第1层</span><br>        ]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_data</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;发送数据：从应用层到物理层&quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;📤 数据发送过程（封装）&quot;</span>.center(<span class="hljs-number">70</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n原始数据: <span class="hljs-subst">&#123;data&#125;</span>\n&quot;</span>)<br><br>        current_data = data<br><br>        <span class="hljs-comment"># 从应用层到物理层，逐层封装</span><br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.layers:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;▼&#x27;</span> * <span class="hljs-number">35</span>&#125;</span>&quot;</span>)<br>            current_data = layer.encapsulate(current_data)<br>            <span class="hljs-keyword">if</span> layer.layer_num &gt; <span class="hljs-number">1</span>:  <span class="hljs-comment"># 物理层的输出太长，不显示完整数据</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   数据长度: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(current_data)&#125;</span> 字符&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-keyword">return</span> current_data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">receive_data</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;接收数据：从物理层到应用层&quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;📥 数据接收过程（解封装）&quot;</span>.center(<span class="hljs-number">70</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>        current_data = data<br><br>        <span class="hljs-comment"># 从物理层到应用层，逐层解封装</span><br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(<span class="hljs-variable language_">self</span>.layers):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;▲&#x27;</span> * <span class="hljs-number">35</span>&#125;</span>&quot;</span>)<br>            current_data = layer.decapsulate(current_data)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n最终数据: <span class="hljs-subst">&#123;current_data&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>        <span class="hljs-keyword">return</span> current_data<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;OSI七层模型数据封装演示&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n📚 本程序演示OSI七层模型的数据封装和解封装过程&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 创建OSI模型</span><br>    osi = OSIModel()<br><br>    <span class="hljs-comment"># 要发送的数据</span><br>    original_data = <span class="hljs-string">&quot;Hello, Network World!&quot;</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🎯 准备发送数据: \&quot;<span class="hljs-subst">&#123;original_data&#125;</span>\&quot;&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 发送数据（封装过程）</span><br>    transmitted_data = osi.send_data(original_data)<br><br>    <span class="hljs-comment"># 模拟数据传输</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;⚡&quot;</span> * <span class="hljs-number">35</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   数据通过网络传输中...&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚡&quot;</span> * <span class="hljs-number">35</span>)<br><br>    <span class="hljs-comment"># 接收数据（解封装过程）</span><br>    received_data = osi.receive_data(transmitted_data)<br><br>    <span class="hljs-comment"># 验证</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;✅ 传输完成！&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n发送的数据: <span class="hljs-subst">&#123;original_data&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;接收的数据: <span class="hljs-subst">&#123;received_data&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello, Network World!&quot;</span> <span class="hljs-keyword">in</span> received_data:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n🎉 数据传输成功！&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n❌ 数据传输失败！&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> code/day03<br>python day03_osi_demo.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><p>程序会详细展示数据在OSI七层模型中的封装和解封装过程，帮助你直观理解每一层的作用。</p><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ OSI七层模型是网络通信的标准模型</li><li>✅ 每一层都有明确的职责</li><li>✅ 数据发送时逐层封装，接收时逐层解封装</li><li>✅ 分层的优点是降低复杂度、便于维护</li></ol><h3 id="OSI七层速记">OSI七层速记</h3><table><thead><tr><th>层次</th><th>名称</th><th>关键词</th><th>协议示例</th></tr></thead><tbody><tr><td>7</td><td>应用层</td><td>用户接口</td><td>HTTP、FTP、DNS</td></tr><tr><td>6</td><td>表示层</td><td>格式转换</td><td>SSL、JPEG</td></tr><tr><td>5</td><td>会话层</td><td>会话管理</td><td>RPC、SQL</td></tr><tr><td>4</td><td>传输层</td><td>端到端</td><td>TCP、UDP</td></tr><tr><td>3</td><td>网络层</td><td>路由寻址</td><td>IP、ICMP</td></tr><tr><td>2</td><td>数据链路层</td><td>帧传输</td><td>Ethernet、WiFi</td></tr><tr><td>1</td><td>物理层</td><td>比特流</td><td>网线、光纤</td></tr></tbody></table><h3 id="重要概念">重要概念</h3><ul><li><strong>封装</strong>（Encapsulation）：发送数据时，逐层添加头部信息</li><li><strong>解封装</strong>（Decapsulation）：接收数据时，逐层移除头部信息</li><li><strong>PDU</strong>（Protocol Data Unit）：协议数据单元<ul><li>应用层：消息（Message）</li><li>传输层：段（Segment）</li><li>网络层：包（Packet）</li><li>数据链路层：帧（Frame）</li><li>物理层：比特（Bit）</li></ul></li></ul><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：层次识别">练习1：层次识别</h3><p>以下操作分别在哪一层完成？</p><ol><li>输入网址 <a href="http://www.baidu.com">www.baidu.com</a></li><li>将域名解析为IP地址</li><li>添加源端口和目标端口</li><li>选择路由路径</li><li>将数据转换为电信号</li></ol><h3 id="练习2：绘制封装过程">练习2：绘制封装过程</h3><p>画出&quot;发送一封邮件&quot;的完整封装过程，标注每一层添加的信息。</p><h3 id="练习3：思考题">练习3：思考题</h3><ol><li>为什么要分成7层？能不能只分3层或分10层？</li><li>如果没有分层，会有什么问题？</li><li>哪些层是软件实现的？哪些是硬件实现的？</li></ol><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>修改演示程序，添加以下功能：</p><ol><li>显示每层数据的大小变化</li><li>模拟数据在传输过程中丢失的情况</li><li>添加错误检测和重传机制</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="OSI-vs-TCP-IP模型">OSI vs TCP/IP模型</h3><p>OSI是理论模型，TCP/IP是实际使用的模型：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs livescript">OSI七层模型              TCP/IP四层模型<br>┌─────────────┐<br>│  应用层     │ <span class="hljs-string">\</span>        ┌─────────────┐<br>├─────────────┤  <span class="hljs-string">\</span>       │  应用层     │<br>│  表示层     │   &#125; ───&gt; │             │<br>├─────────────┤  /       │             │<br>│  会话层     │ /        └─────────────┘<br>├─────────────┤          ┌─────────────┐<br>│  传输层     │  ─────&gt;  │  传输层     │<br>├─────────────┤          └─────────────┘<br>│  网络层     │  ─────&gt;  ┌─────────────┐<br>├─────────────┤          │  网络层     │<br>│ 数据链路层  │ <span class="hljs-string">\</span>        └─────────────┘<br>├─────────────┤  &#125; ───&gt;  ┌─────────────┐<br>│  物理层     │ /        │ 网络接口层  │<br>└─────────────┘          └─────────────┘<br></code></pre></td></tr></table></figure><p><strong>明天我们将详细学习TCP/IP模型！</strong></p><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第4天：TCP/IP四层模型</strong></p><p>我们将学习：</p><ul><li>TCP/IP模型和OSI模型的区别</li><li>TCP/IP各层的详细功能</li><li>实际网络中如何使用TCP/IP</li><li>编写程序分析真实的网络数据包</li></ul><hr><p>💡 <strong>今日金句</strong>：分层不是为了复杂化，而是为了简单化！</p><p>👉 <a href="day02.md">上一天：网络的分类和拓扑结构</a> | <a href="../../README.md">返回目录</a> | <a href="day04.md">下一天：TCP/IP四层模型</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2天：网络的分类和拓扑结构</title>
    <link href="/2025/11/10/2%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E5%88%86%E7%B1%BB%E5%92%8C%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/"/>
    <url>/2025/11/10/2%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E5%88%86%E7%B1%BB%E5%92%8C%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h1>第2天：网络的分类和拓扑结构</h1><blockquote><p>“网络就像城市的交通系统，有不同的规模和不同的连接方式。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解网络的分类（LAN、WAN、MAN）</li><li>掌握网络拓扑结构的类型</li><li>编写程序：扫描局域网设备</li></ul><h2 id="🌐-网络的分类">🌐 网络的分类</h2><h3 id="按地理范围分类">按地理范围分类</h3><h4 id="1-局域网（LAN-Local-Area-Network）">1. 局域网（LAN - Local Area Network）</h4><p><strong>定义</strong>：覆盖范围较小的网络，通常在一个建筑物或校园内。</p><p><strong>生活中的例子</strong>：</p><ul><li>你家里的WiFi网络</li><li>公司办公室的网络</li><li>网吧的网络</li><li>学校机房的网络</li></ul><p><strong>特点</strong>：</p><ul><li>📏 范围：几米到几公里</li><li>🚀 速度：很快（100Mbps - 10Gbps）</li><li>💰 成本：低</li><li>👥 归属：个人或单位所有</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">类比理解：<br>局域网 <span class="hljs-operator">=</span> 你家的内部电话系统<br>只能在家里几个房间之间通话<br></code></pre></td></tr></table></figure><h4 id="2-城域网（MAN-Metropolitan-Area-Network）">2. 城域网（MAN - Metropolitan Area Network）</h4><p><strong>定义</strong>：覆盖一个城市范围的网络。</p><p><strong>生活中的例子</strong>：</p><ul><li>城市的有线电视网络</li><li>城市公共WiFi网络</li><li>城市监控网络</li></ul><p><strong>特点</strong>：</p><ul><li>📏 范围：几十公里</li><li>🚀 速度：较快</li><li>💰 成本：中等</li><li>👥 归属：通常是运营商或政府</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">类比理解：<br>城域网 <span class="hljs-operator">=</span> 城市的公交系统<br>连接城市内的不同区域<br></code></pre></td></tr></table></figure><h4 id="3-广域网（WAN-Wide-Area-Network）">3. 广域网（WAN - Wide Area Network）</h4><p><strong>定义</strong>：覆盖很大地理范围的网络，可以跨越国家和大洲。</p><p><strong>生活中的例子</strong>：</p><ul><li>互联网（Internet）</li><li>跨国公司的专用网络</li><li>电信运营商的骨干网</li></ul><p><strong>特点</strong>：</p><ul><li>📏 范围：几百到几万公里</li><li>🚀 速度：相对较慢</li><li>💰 成本：高</li><li>👥 归属：运营商或大型组织</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">类比理解：<br>广域网 <span class="hljs-operator">=</span> 国际航空网络<br>连接世界各地的城市<br></code></pre></td></tr></table></figure><h3 id="对比总结">对比总结</h3><table><thead><tr><th>类型</th><th>覆盖范围</th><th>传输速度</th><th>延迟</th><th>例子</th></tr></thead><tbody><tr><td>LAN</td><td>10m - 1km</td><td>最快</td><td>最低</td><td>家庭WiFi</td></tr><tr><td>MAN</td><td>10km - 100km</td><td>较快</td><td>较低</td><td>城市网络</td></tr><tr><td>WAN</td><td>100km+</td><td>较慢</td><td>较高</td><td>互联网</td></tr></tbody></table><h2 id="🔷-网络拓扑结构">🔷 网络拓扑结构</h2><p><strong>拓扑结构</strong>就是网络中各个设备的连接方式和布局形状。</p><h3 id="1-总线型拓扑（Bus-Topology）">1. 总线型拓扑（Bus Topology）</h3><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">设备A</span> <span class="hljs-literal">---</span> <span class="hljs-comment">设备B</span> <span class="hljs-literal">---</span> <span class="hljs-comment">设备C</span> <span class="hljs-literal">---</span> <span class="hljs-comment">设备D</span><br>         <span class="hljs-comment">|                      |</span><br>       <span class="hljs-comment">(总线)                (总线)</span><br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：布线简单，成本低</li><li>❌ 缺点：总线断了，整个网络瘫痪</li><li>📝 应用：早期以太网</li></ul><p><strong>类比</strong>：公交线路，所有站点都在一条线上</p><h3 id="2-星型拓扑（Star-Topology）">2. 星型拓扑（Star Topology）</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c">        设备B<br>          <span class="hljs-string">|</span><br>设备A <span class="hljs-punctuation">-</span><span class="hljs-punctuation">-</span> 交换机 <span class="hljs-punctuation">-</span><span class="hljs-punctuation">-</span> 设备C<br>          <span class="hljs-string">|</span><br>        设备D<br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：一个设备故障不影响其他设备</li><li>✅ 管理方便，易于排错</li><li>❌ 缺点：中心设备（交换机）故障，整个网络瘫痪</li><li>📝 应用：<strong>现代最常用的拓扑结构</strong></li></ul><p><strong>类比</strong>：太阳系，所有行星围绕太阳转</p><h3 id="3-环型拓扑（Ring-Topology）">3. 环型拓扑（Ring Topology）</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">设备A <span class="hljs-comment">--- 设备B</span><br>  |          |<br>设备D <span class="hljs-comment">--- 设备C</span><br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：数据传输路径确定</li><li>❌ 缺点：一个设备故障影响整个网络</li><li>📝 应用：令牌环网络（已较少使用）</li></ul><p><strong>类比</strong>：接力赛跑，每个人传递给下一个人</p><h3 id="4-网状型拓扑（Mesh-Topology）">4. 网状型拓扑（Mesh Topology）</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">设备A --- 设备B<br> |<span class="hljs-string"> \    / </span>|<br> |<span class="hljs-string">  \ /   </span>|<br> |<span class="hljs-string">  / \   </span>|<br> |<span class="hljs-string"> /    \ </span>|<br>设备D --- 设备C<br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：可靠性极高，有多条路径</li><li>❌ 缺点：布线复杂，成本高</li><li>📝 应用：军事网络、互联网骨干</li></ul><p><strong>类比</strong>：地铁网络，有多条线路可选</p><h3 id="5-树型拓扑（Tree-Topology）">5. 树型拓扑（Tree Topology）</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript">     根交换机<br>     /      <span class="hljs-string">\</span><br>  交换机A   交换机B<br>  /   <span class="hljs-string">\</span>      /   <span class="hljs-string">\</span><br>设备<span class="hljs-number">1</span> 设备<span class="hljs-number">2</span> 设备<span class="hljs-number">3</span> 设备<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：易于扩展，层次清晰</li><li>❌ 缺点：根节点故障影响所有下级</li><li>📝 应用：企业网络、校园网</li></ul><p><strong>类比</strong>：公司组织架构</p><h2 id="🔧-实战项目：局域网设备扫描器">🔧 实战项目：局域网设备扫描器</h2><p>让我们编写一个程序，扫描你所在局域网内的所有设备！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day02_lan_scanner.py</span><br><span class="hljs-comment"># 功能：扫描局域网内的活跃设备</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> ipaddress<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor, as_completed<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ip_and_subnet</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    获取本机IP地址和所在的子网</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        local_ip: 本机IP地址字符串</span><br><span class="hljs-string">        subnet: 子网字符串（如 &quot;192.168.1.0/24&quot;）</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 创建socket连接到外部地址，获取本机IP</span><br>        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)<br>        sock.connect((<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-number">80</span>))<br>        local_ip = sock.getsockname()[<span class="hljs-number">0</span>]<br>        sock.close()<br><br>        <span class="hljs-comment"># 从IP地址推断子网（假设是/24子网）</span><br>        <span class="hljs-comment"># 例如：192.168.1.100 -&gt; 192.168.1.0/24</span><br>        ip_parts = local_ip.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br>        subnet = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">0</span>]&#125;</span>.<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">1</span>]&#125;</span>.<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">2</span>]&#125;</span>.0/24&quot;</span><br><br>        <span class="hljs-keyword">return</span> local_ip, subnet<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;获取本机IP失败：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_host</span>(<span class="hljs-params">ip, timeout=<span class="hljs-number">0.5</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    检查指定IP的主机是否在线</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        ip: 要检查的IP地址</span><br><span class="hljs-string">        timeout: 超时时间（秒）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        如果主机在线，返回(ip, hostname)</span><br><span class="hljs-string">        如果主机不在线，返回None</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        尝试连接到目标IP的常用端口（80端口）</span><br><span class="hljs-string">        如果能连接，说明主机在线</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 尝试连接到80端口（HTTP端口）</span><br>        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>        sock.settimeout(timeout)<br><br>        <span class="hljs-comment"># 尝试连接</span><br>        result = sock.connect_ex((<span class="hljs-built_in">str</span>(ip), <span class="hljs-number">80</span>))<br><br>        <span class="hljs-keyword">if</span> result == <span class="hljs-number">0</span>:<br>            <span class="hljs-comment"># 连接成功，尝试获取主机名</span><br>            <span class="hljs-keyword">try</span>:<br>                hostname = socket.gethostbyaddr(<span class="hljs-built_in">str</span>(ip))[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">except</span>:<br>                hostname = <span class="hljs-string">&quot;未知主机名&quot;</span><br><br>            sock.close()<br>            <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(ip), hostname)<br>        <span class="hljs-keyword">else</span>:<br>            sock.close()<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ping_check</span>(<span class="hljs-params">ip, timeout=<span class="hljs-number">0.5</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    使用更简单的方法检测主机是否在线</span><br><span class="hljs-string">    尝试多个常用端口</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    common_ports = [<span class="hljs-number">80</span>, <span class="hljs-number">443</span>, <span class="hljs-number">22</span>, <span class="hljs-number">445</span>, <span class="hljs-number">139</span>]  <span class="hljs-comment"># HTTP, HTTPS, SSH, SMB</span><br><br>    <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> common_ports:<br>        <span class="hljs-keyword">try</span>:<br>            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>            sock.settimeout(timeout)<br>            result = sock.connect_ex((<span class="hljs-built_in">str</span>(ip), port))<br>            sock.close()<br><br>            <span class="hljs-keyword">if</span> result == <span class="hljs-number">0</span>:<br>                <span class="hljs-comment"># 尝试获取主机名</span><br>                <span class="hljs-keyword">try</span>:<br>                    hostname = socket.gethostbyaddr(<span class="hljs-built_in">str</span>(ip))[<span class="hljs-number">0</span>]<br>                <span class="hljs-keyword">except</span>:<br>                    hostname = <span class="hljs-string">&quot;未知主机名&quot;</span><br><br>                <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(ip), hostname, port)<br><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_network</span>(<span class="hljs-params">subnet, max_workers=<span class="hljs-number">50</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    扫描整个子网</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        subnet: 子网地址（如 &quot;192.168.1.0/24&quot;）</span><br><span class="hljs-string">        max_workers: 最大线程数</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        活跃主机列表</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 解析子网，获取所有IP地址</span><br>    network = ipaddress.ip_network(subnet, strict=<span class="hljs-literal">False</span>)<br>    total_hosts = network.num_addresses - <span class="hljs-number">2</span>  <span class="hljs-comment"># 减去网络地址和广播地址</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔍 开始扫描子网: <span class="hljs-subst">&#123;subnet&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📊 总共需要扫描 <span class="hljs-subst">&#123;total_hosts&#125;</span> 个IP地址&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⏳ 请稍候...\n&quot;</span>)<br><br>    active_hosts = []<br>    scanned = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># 使用线程池并发扫描</span><br>    <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=max_workers) <span class="hljs-keyword">as</span> executor:<br>        <span class="hljs-comment"># 提交所有扫描任务</span><br>        future_to_ip = &#123;<br>            executor.submit(ping_check, ip): ip<br>            <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> network.hosts()  <span class="hljs-comment"># 排除网络地址和广播地址</span><br>        &#125;<br><br>        <span class="hljs-comment"># 处理完成的任务</span><br>        <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(future_to_ip):<br>            scanned += <span class="hljs-number">1</span><br>            result = future.result()<br><br>            <span class="hljs-keyword">if</span> result:<br>                ip, hostname, port = result<br>                active_hosts.append((ip, hostname, port))<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 发现设备: <span class="hljs-subst">&#123;ip:<span class="hljs-number">15</span>&#125;</span> | <span class="hljs-subst">&#123;hostname:<span class="hljs-number">30</span>&#125;</span> | 端口: <span class="hljs-subst">&#123;port&#125;</span>&quot;</span>)<br><br>            <span class="hljs-comment"># 显示进度</span><br>            <span class="hljs-keyword">if</span> scanned % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:<br>                progress = (scanned / total_hosts) * <span class="hljs-number">100</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   进度: <span class="hljs-subst">&#123;progress:<span class="hljs-number">.1</span>f&#125;</span>% (<span class="hljs-subst">&#123;scanned&#125;</span>/<span class="hljs-subst">&#123;total_hosts&#125;</span>)&quot;</span>, end=<span class="hljs-string">&#x27;\r&#x27;</span>)<br><br>    <span class="hljs-keyword">return</span> active_hosts<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">display_topology</span>(<span class="hljs-params">active_hosts, local_ip</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    显示网络拓扑结构（简化版）</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;网络拓扑结构（星型拓扑）&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;                      [路由器/交换机]&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;                             |&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;          &quot;</span> + <span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">40</span>)<br><br>    <span class="hljs-keyword">for</span> ip, hostname, port <span class="hljs-keyword">in</span> active_hosts:<br>        marker = <span class="hljs-string">&quot; (本机)&quot;</span> <span class="hljs-keyword">if</span> ip == local_ip <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;          |-- [<span class="hljs-subst">&#123;ip&#125;</span>] <span class="hljs-subst">&#123;hostname&#125;</span><span class="hljs-subst">&#123;marker&#125;</span>&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;局域网设备扫描器&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取本机IP和子网</span><br>    local_ip, subnet = get_local_ip_and_subnet()<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> local_ip:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 无法获取本机IP地址，请检查网络连接！&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📍 本机IP: <span class="hljs-subst">&#123;local_ip&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🌐 所在子网: <span class="hljs-subst">&#123;subnet&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 扫描网络</span><br>    active_hosts = scan_network(subnet)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✨ 扫描完成！共发现 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(active_hosts)&#125;</span> 台活跃设备&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>    <span class="hljs-comment"># 显示详细信息</span><br>    <span class="hljs-keyword">if</span> active_hosts:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n📋 活跃设备列表：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;IP地址&#x27;</span>:&lt;<span class="hljs-number">15</span>&#125;</span> | <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;主机名&#x27;</span>:&lt;<span class="hljs-number">30</span>&#125;</span> | <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;开放端口&#x27;</span>&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">70</span>)<br><br>        <span class="hljs-keyword">for</span> ip, hostname, port <span class="hljs-keyword">in</span> active_hosts:<br>            marker = <span class="hljs-string">&quot; ⭐&quot;</span> <span class="hljs-keyword">if</span> ip == local_ip <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ip:&lt;<span class="hljs-number">15</span>&#125;</span> | <span class="hljs-subst">&#123;hostname:&lt;<span class="hljs-number">30</span>&#125;</span> | <span class="hljs-subst">&#123;port&#125;</span><span class="hljs-subst">&#123;marker&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># 显示拓扑结构</span><br>        display_topology(active_hosts, local_ip)<br><br>        <span class="hljs-comment"># 分析网络类型</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n💡 网络分析：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - 这是一个局域网（LAN）&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - 使用星型拓扑结构&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - 共有 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(active_hosts)&#125;</span> 台设备连接到同一个交换机/路由器&quot;</span>)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n⚠️  未发现其他活跃设备&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> code/day02<br>python day02_lan_scanner.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">======================================================================<br>                         局域网设备扫描器<br>======================================================================<br><br>📍 本机IP: 192.168.1.100<br>🌐 所在子网: 192.168.1.0/24<br><br>🔍 开始扫描子网: 192.168.1.0/24<br>📊 总共需要扫描 254 个IP地址<br>⏳ 请稍候...<br><br>✅ 发现设备: 192.168.1.1     | router.home                     | 端口: 80<br>✅ 发现设备: 192.168.1.100   | linzhibin-MacBook              | 端口: 80<br>✅ 发现设备: 192.168.1.105   | xiaomi-phone                   | 端口: 443<br><br>======================================================================<br>✨ 扫描完成！共发现 3 台活跃设备<br>======================================================================<br><br>📋 活跃设备列表：<br><span class="hljs-section">IP地址           | 主机名                          | 开放端口</span><br><span class="hljs-section">----------------------------------------------------------------------</span><br>192.168.1.1     | router.home                    | 80<br>192.168.1.100   | linzhibin-MacBook              | 80 ⭐<br>192.168.1.105   | xiaomi-phone                   | 443<br><br>======================================================================<br>                    网络拓扑结构（星型拓扑）<br>======================================================================<br><br><span class="hljs-code">                      [路由器/交换机]</span><br><span class="hljs-code">                             |</span><br><span class="hljs-code">          ----------------------------------------</span><br><span class="hljs-code">          |-- [192.168.1.1] router.home</span><br><span class="hljs-code">          |-- [192.168.1.100] linzhibin-MacBook (本机)</span><br><span class="hljs-code">          |-- [192.168.1.105] xiaomi-phone</span><br><br>======================================================================<br><br>💡 网络分析：<br>   - 这是一个局域网（LAN）<br>   - 使用星型拓扑结构<br>   - 共有 3 台设备连接到同一个交换机/路由器<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="1-ipaddress模块">1. ipaddress模块</h3><p>Python的<code>ipaddress</code>模块用于处理IP地址和网络：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> ipaddress<br><br><span class="hljs-comment"># 创建网络对象</span><br>network = ipaddress.ip_network(<span class="hljs-string">&quot;192.168.1.0/24&quot;</span>)<br><br><span class="hljs-comment"># 获取网络中的所有主机IP</span><br><span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> network.hosts():<br>    <span class="hljs-built_in">print</span>(ip)  <span class="hljs-comment"># 192.168.1.1, 192.168.1.2, ..., 192.168.1.254</span><br></code></pre></td></tr></table></figure><h3 id="2-子网掩码-24-是什么意思？">2. 子网掩码 /24 是什么意思？</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span> 的含义：<br><br>/<span class="hljs-number">24</span> 表示子网掩码有<span class="hljs-number">24</span>个<span class="hljs-number">1</span>：<br><span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">00000000</span><br>即：<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">0</span><br><br>可用IP范围：<br><span class="hljs-number">192.168.1.1</span> 到 <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">254</span>（共<span class="hljs-number">254</span>个）<br><span class="hljs-number">192.168.1.0</span> 是网络地址<br><span class="hljs-number">192.168.1.255</span> 是广播地址<br></code></pre></td></tr></table></figure><h3 id="3-ThreadPoolExecutor-并发扫描">3. ThreadPoolExecutor 并发扫描</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><br><span class="hljs-comment"># 创建线程池，最多50个线程同时工作</span><br><span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">50</span>) <span class="hljs-keyword">as</span> executor:<br>    <span class="hljs-comment"># 提交任务</span><br>    futures = [executor.submit(scan_ip, ip) <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> ip_list]<br><br>    <span class="hljs-comment"># 等待完成</span><br>    <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(futures):<br>        result = future.result()<br></code></pre></td></tr></table></figure><p><strong>为什么要用多线程？</strong></p><ul><li>单线程扫描254个IP需要很长时间</li><li>多线程可以同时扫描多个IP，大大提高效率</li><li>50个线程可以让扫描速度提升几十倍</li></ul><h3 id="4-connect-ex方法">4. connect_ex方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">result = sock.connect_ex((ip, port))<br><br><span class="hljs-comment"># 返回值：</span><br><span class="hljs-comment"># 0 = 连接成功</span><br><span class="hljs-comment"># 其他 = 连接失败（错误码）</span><br></code></pre></td></tr></table></figure><p>这比普通的<code>connect()</code>方法更好，因为失败时不会抛出异常。</p><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ 网络按范围分为LAN、MAN、WAN</li><li>✅ 家庭和办公室网络是局域网（LAN）</li><li>✅ 网络拓扑结构有5种：总线、星型、环型、网状、树型</li><li>✅ 现代网络最常用星型拓扑结构</li><li>✅ 子网的概念和表示方法</li><li>✅ 如何扫描局域网内的设备</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>解释</th><th>例子</th></tr></thead><tbody><tr><td>局域网</td><td>小范围的网络</td><td>家庭WiFi</td></tr><tr><td>星型拓扑</td><td>所有设备连接到中心节点</td><td>所有电脑连接到路由器</td></tr><tr><td>子网</td><td>一个网络的子集</td><td>192.168.1.0/24</td></tr><tr><td>主机</td><td>网络中的设备</td><td>你的电脑、手机</td></tr></tbody></table><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：识别拓扑类型">练习1：识别拓扑类型</h3><p>说出以下场景使用的是什么拓扑结构：</p><ol><li>所有教室的电脑都连接到机房的交换机</li><li>地铁13号线各个站点的连接</li><li>互联网骨干网的连接方式</li></ol><h3 id="练习2：修改扫描器">练习2：修改扫描器</h3><p>修改程序，让它可以：</p><ol><li>扫描自定义的子网（不是默认的/24）</li><li>显示每个设备的响应时间</li><li>保存扫描结果到文件</li></ol><h3 id="练习3：计算题">练习3：计算题</h3><p>一个192.168.1.0/24的网络：</p><ol><li>子网掩码是多少？</li><li>第一个可用IP是多少？</li><li>最后一个可用IP是多少？</li><li>总共有多少个可用IP？</li></ol><h3 id="练习4：绘制拓扑图">练习4：绘制拓扑图</h3><p>绘制你家里或公司的网络拓扑结构图，标注：</p><ul><li>所有设备（电脑、手机、打印机等）</li><li>路由器/交换机</li><li>连接方式（有线/无线）</li></ul><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="为什么星型拓扑最流行？">为什么星型拓扑最流行？</h3><p><strong>历史原因</strong>：</p><ul><li>早期使用总线型拓扑（10BASE-2同轴电缆）</li><li>问题：一根线断了，所有设备都不能用</li><li>星型拓扑解决了这个问题</li></ul><p><strong>现代优势</strong>：</p><ul><li>便于管理：可以在交换机上管理每个端口</li><li>易于排错：某个设备故障不影响其他设备</li><li>易于扩展：只需在交换机上增加端口</li><li>性能好：交换机可以智能转发数据</li></ul><h3 id="家庭网络的实际拓扑">家庭网络的实际拓扑</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs 1c">互联网<br>  <span class="hljs-string">|</span><br>光猫<br>  <span class="hljs-string">|</span><br>路由器（WiFi）<br>  <span class="hljs-string">|</span><br>  <span class="hljs-string">|---- 电脑（有线）</span><br>  <span class="hljs-string">|---- 手机（无线）</span><br>  <span class="hljs-string">|---- 平板（无线）</span><br>  <span class="hljs-string">|---- 智能电视（有线）</span><br>  <span class="hljs-string">|---- 智能音箱（无线）</span><br></code></pre></td></tr></table></figure><p>这是一个典型的<strong>星型拓扑</strong>！</p><h3 id="企业网络的拓扑">企业网络的拓扑</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript">     核心交换机（根）<br>       /      <span class="hljs-string">\</span><br>  交换机A    交换机B<br>  /   <span class="hljs-string">\</span>       /   <span class="hljs-string">\</span><br>电脑<span class="hljs-number">1</span> 电脑<span class="hljs-number">2</span> 电脑<span class="hljs-number">3</span> 电脑<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>这是一个<strong>树型拓扑</strong>（也叫分层星型拓扑）！</p><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第3天：OSI七层模型</strong></p><p>我们将学习：</p><ul><li>什么是OSI七层模型？</li><li>每一层做什么？</li><li>为什么要分层？</li><li>编写程序分析各层的作用</li></ul><hr><p>💡 <strong>今日金句</strong>：网络拓扑就像城市规划，不同的结构有不同的优缺点！</p><p>👉 <a href="day01.md">上一天：认识计算机网络</a> | <a href="../../README.md">返回目录</a> | <a href="day03.md">下一天：OSI七层模型</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>1天：认识计算机网络</title>
    <link href="/2025/11/10/1%E5%A4%A9%EF%BC%9A%E8%AE%A4%E8%AF%86%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    <url>/2025/11/10/1%E5%A4%A9%EF%BC%9A%E8%AE%A4%E8%AF%86%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
    
    <content type="html"><![CDATA[<h1>第1天：认识计算机网络</h1><blockquote><p>“互联网就像一张巨大的蜘蛛网，连接着全世界的计算机。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解什么是计算机网络</li><li>了解网络的作用和重要性</li><li>编写第一个网络程序：检测网络连接</li></ul><h2 id="🎯-什么是计算机网络？">🎯 什么是计算机网络？</h2><h3 id="生活化理解">生活化理解</h3><p>想象一下你在用微信聊天：</p><ol><li>你在北京发了一条消息</li><li>你的朋友在上海收到了这条消息</li><li>中间发生了什么？</li></ol><p>这就是计算机网络在工作！</p><p><strong>计算机网络</strong>就是把分散在不同地点的计算机通过通信线路连接起来，实现资源共享和信息传递的系统。</p><h3 id="网络的三个关键要素">网络的三个关键要素</h3><ol><li><strong>计算机</strong>（节点）：发送和接收信息的设备</li><li><strong>通信线路</strong>（链路）：传输信息的介质（网线、WiFi、光纤等）</li><li><strong>协议</strong>（规则）：计算机之间交流的&quot;语言&quot;</li></ol><h3 id="类比理解">类比理解</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">计算机网络 <span class="hljs-operator">=</span> 快递系统<br><br>你的电脑  →  寄件人<br>网络线路  →  快递车、飞机<br>路由器    →  中转站<br>协议      →  包裹规格、运输规则<br>目标电脑  →  收件人<br></code></pre></td></tr></table></figure><h2 id="💡-网络能做什么？">💡 网络能做什么？</h2><h3 id="1-资源共享">1. 资源共享</h3><ul><li>共享打印机</li><li>共享文件</li><li>共享数据库</li></ul><h3 id="2-信息传递">2. 信息传递</h3><ul><li>发送邮件</li><li>网页浏览</li><li>视频通话</li><li>在线游戏</li></ul><h3 id="3-分布式计算">3. 分布式计算</h3><ul><li>云计算</li><li>区块链</li><li>大数据处理</li></ul><h2 id="🔧-实战项目：检测网络连接">🔧 实战项目：检测网络连接</h2><p>让我们编写第一个网络程序！这个程序会检测你的电脑是否连接到互联网。</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day01_network_checker.py</span><br><span class="hljs-comment"># 功能：检测网络连接状态</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_internet_connection</span>(<span class="hljs-params">host=<span class="hljs-string">&quot;8.8.8.8&quot;</span>, port=<span class="hljs-number">53</span>, timeout=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    检测是否能连接到互联网</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数说明：</span><br><span class="hljs-string">        host: 目标主机IP地址（默认使用Google的DNS服务器 8.8.8.8）</span><br><span class="hljs-string">        port: 目标端口（53是DNS服务的标准端口）</span><br><span class="hljs-string">        timeout: 超时时间（秒）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回值：</span><br><span class="hljs-string">        True: 网络连接正常</span><br><span class="hljs-string">        False: 网络连接失败</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        尝试创建一个socket连接到指定的服务器</span><br><span class="hljs-string">        如果能连接成功，说明网络是通的</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 创建一个socket对象</span><br>        <span class="hljs-comment"># AF_INET表示IPv4地址</span><br>        <span class="hljs-comment"># SOCK_STREAM表示TCP协议</span><br>        socket.setdefaulttimeout(timeout)<br>        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br><br>        <span class="hljs-comment"># 尝试连接到目标主机的指定端口</span><br>        sock.connect((host, port))<br><br>        <span class="hljs-comment"># 连接成功，关闭socket</span><br>        sock.close()<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># 连接失败，说明网络不通</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;连接失败：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ip</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    获取本机的IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        创建一个UDP socket，连接到外部地址（不会真正发送数据）</span><br><span class="hljs-string">        通过这个socket获取本机的IP地址</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 创建UDP socket</span><br>        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)<br><br>        <span class="hljs-comment"># 连接到一个外部地址（这里不会真正发送数据）</span><br>        <span class="hljs-comment"># 使用Google的DNS服务器地址</span><br>        sock.connect((<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-number">80</span>))<br><br>        <span class="hljs-comment"># 获取本机的IP地址</span><br>        local_ip = sock.getsockname()[<span class="hljs-number">0</span>]<br><br>        sock.close()<br>        <span class="hljs-keyword">return</span> local_ip<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;无法获取IP地址&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_hostname</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    获取计算机的主机名</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> socket.gethostname()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;未知主机名&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数：执行网络检测并显示结果</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;网络连接检测工具&quot;</span>.center(<span class="hljs-number">50</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取主机名</span><br>    hostname = get_hostname()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📌 主机名: <span class="hljs-subst">&#123;hostname&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># 获取本机IP地址</span><br>    local_ip = get_local_ip()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📍 本机IP地址: <span class="hljs-subst">&#123;local_ip&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 检测网络连接</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;🔍 正在检测网络连接...&quot;</span>)<br><br>    <span class="hljs-comment"># 测试多个服务器</span><br>    test_servers = [<br>        (<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-string">&quot;Google DNS&quot;</span>),<br>        (<span class="hljs-string">&quot;114.114.114.114&quot;</span>, <span class="hljs-string">&quot;国内DNS&quot;</span>),<br>        (<span class="hljs-string">&quot;1.1.1.1&quot;</span>, <span class="hljs-string">&quot;Cloudflare DNS&quot;</span>)<br>    ]<br><br>    connected = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> ip, name <span class="hljs-keyword">in</span> test_servers:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   测试连接到 <span class="hljs-subst">&#123;name&#125;</span> (<span class="hljs-subst">&#123;ip&#125;</span>)...&quot;</span>, end=<span class="hljs-string">&quot; &quot;</span>)<br>        <span class="hljs-keyword">if</span> check_internet_connection(ip):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;✅ 成功&quot;</span>)<br>            connected = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 失败&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-keyword">if</span> connected:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;🎉 网络连接正常！&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 这意味着你的电脑可以访问互联网上的其他计算机。&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚠️  网络连接异常！&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 请检查：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   1. 网线是否插好？&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   2. WiFi是否连接？&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   3. 路由器是否正常工作？&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">50</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> code/day01<br>python day01_network_checker.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">==================================================<br>                网络连接检测工具<br>==================================================<br><br>📌 主机名: linzhibin-MacBook<br>📍 本机IP地址: 192.168.1.100<br><br>🔍 正在检测网络连接...<br><span class="hljs-code">   测试连接到 Google DNS (8.8.8.8)... ✅ 成功</span><br><span class="hljs-code">   测试连接到 国内DNS (114.114.114.114)... ✅ 成功</span><br><span class="hljs-code">   测试连接到 Cloudflare DNS (1.1.1.1)... ✅ 成功</span><br><br>🎉 网络连接正常！<br>💡 这意味着你的电脑可以访问互联网上的其他计算机。<br><br>==================================================<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="Socket是什么？">Socket是什么？</h3><p><strong>Socket</strong>（套接字）是网络编程的基础，可以理解为：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">Socket</span> <span class="hljs-operator">=</span> 电话机<br><br>建立连接   →  拨号<br>发送数据   →  说话<br>接收数据   →  听对方说话<br>关闭连接   →  挂断电话<br></code></pre></td></tr></table></figure><h3 id="为什么用8-8-8-8？">为什么用8.8.8.8？</h3><ul><li><code>8.8.8.8</code> 是Google提供的公共DNS服务器</li><li>它几乎24小时在线，非常稳定</li><li>如果能连接到它，说明网络是通的</li></ul><h3 id="AF-INET-和-SOCK-STREAM-是什么？">AF_INET 和 SOCK_STREAM 是什么？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">socket.AF_INET       <span class="hljs-comment"># 使用IPv4地址</span><br>socket.AF_INET6      <span class="hljs-comment"># 使用IPv6地址</span><br><br>socket.SOCK_STREAM   <span class="hljs-comment"># TCP协议（可靠传输）</span><br>socket.SOCK_DGRAM    <span class="hljs-comment"># UDP协议（快速传输）</span><br></code></pre></td></tr></table></figure><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ 计算机网络是连接多台计算机的系统</li><li>✅ 网络由计算机、通信线路和协议组成</li><li>✅ Socket是网络编程的基础工具</li><li>✅ 可以通过连接DNS服务器来检测网络状态</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>解释</th><th>比喻</th></tr></thead><tbody><tr><td>计算机网络</td><td>多台计算机互联的系统</td><td>快递网络</td></tr><tr><td>Socket</td><td>网络编程接口</td><td>电话机</td></tr><tr><td>IP地址</td><td>计算机在网络中的地址</td><td>家庭住址</td></tr><tr><td>端口</td><td>应用程序的标识号</td><td>门牌号</td></tr></tbody></table><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：修改代码">练习1：修改代码</h3><p>修改程序，让它可以检测连接到百度服务器（220.181.38.148）</p><h3 id="练习2：思考题">练习2：思考题</h3><ol><li>为什么我们使用DNS服务器（端口53）而不是HTTP服务器（端口80）来测试？</li><li>本机IP地址和互联网IP地址有什么区别？</li></ol><h3 id="练习3：扩展功能">练习3：扩展功能</h3><p>尝试添加功能：显示连接到目标服务器所需的时间（提示：使用time模块）</p><h2 id="📚-扩展阅读">📚 扩展阅读</h2><ul><li>IP地址是什么？（明天会详细讲解）</li><li>DNS是什么？（第15天会详细讲解）</li><li>TCP和UDP有什么区别？（第36天会详细讲解）</li></ul><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第2天：网络的分类和拓扑结构</strong></p><p>我们将学习：</p><ul><li>LAN、WAN、MAN是什么？</li><li>网络拓扑结构有哪些？</li><li>如何绘制网络拓扑图？</li></ul><hr><p>💡 <strong>今日金句</strong>：万丈高楼平地起，网络学习第一步！</p><p>👉 <a href="../../README.md">返回目录</a> | <a href="day02.md">下一天：网络的分类和拓扑结构</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>about</title>
    <link href="/2025/10/29/about/"/>
    <url>/2025/10/29/about/</url>
    
    <content type="html"><![CDATA[<p>第一阶段（快速提升趣味性）：</p><ol><li>机缘系统 - 增加随机惊喜</li><li>连招系统 - 让战斗更有策略</li><li>灵兽系统 - 增加收集要素</li></ol><p>第二阶段（增加深度）：<br>4. 悟道系统 - 策略性成长<br>5. 道侣系统 - 情感投入<br>6. 秘境探索 - 内容扩充</p><p>第三阶段（长期目标）：<br>7. 成就系统 - 增加重玩价值<br>8. 轮回强化 - New Game+<br>9. 动态剧情 - 提升叙事品质</p><p>小应用思路：</p><p>聚焦“每日情绪打卡＋简易建议”应用</p><p>或“短时放松 + 呼吸／冥想”模块：适合美国用户快节奏生活</p><p>强化 iOS 本地处理＋隐私保障，会是加分项</p><p>本地化社群+手帐/规划应用</p><p>为什么有机会：欧洲多个国家语言多样、用户偏好本地化服务；且“轻量规划工具”在小应用里好切入。<br>小应用思路：</p><p>针对某国（如德国、法国、西班牙）市场的“月度预算规划＋支出可视化”工具</p><p>或“学习某语言／文化习惯”辅助工具：结合当地节日、任务打卡</p><p>强调“数据留设备端”“隐私保护”作为卖点</p>]]></content>
    
    
    
    <tags>
      
      <tag>“info&quot;,&quot;zen&quot;</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>myruls</title>
    <link href="/2025/10/29/myruls/"/>
    <url>/2025/10/29/myruls/</url>
    
    <content type="html"><![CDATA[<p>日常收集到的一些当时可能觉得有趣的东西</p><h1>AI</h1><p><a href="https://github.com/B3o/GPTS-Prompt-Collection">提示词搜集</a></p><h1>素材</h1><p><a href="https://github.com/renpy/renpy">回合制游戏引擎</a></p><p><a href="https://github.com/CorentinTh/it-tools">IT工具</a></p><p><a href="https://github.com/qdhenry/Claude-Command-Suite">Skills</a></p><p><a href="https://github.com/collections/game-engines">游戏引擎集合</a></p><h1>VPS</h1><p><a href="https://cloud.zheanyun.com">浙安云</a></p><p><a href="https://app.cloudcone.com">cloudcone</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>“url”,&quot;project&quot;</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
