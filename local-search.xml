<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>二周总结：网络层深入理解</title>
    <link href="/2025/11/10/%E4%BA%8C%E5%91%A8%E6%80%BB%E7%BB%93%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/"/>
    <url>/2025/11/10/%E4%BA%8C%E5%91%A8%E6%80%BB%E7%BB%93%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1>第二周总结：网络层深入理解</h1><h2 id="本周学习回顾">本周学习回顾</h2><p>恭喜你完成了第二周的学习！本周我们深入学习了网络层的核心概念和协议。让我们一起回顾这一周的精彩内容。</p><hr><h2 id="📚-本周知识地图">📚 本周知识地图</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs armasm">第二周：网络层深入<br>├── Day <span class="hljs-number">8</span>: <span class="hljs-built_in">IP</span>地址详解<br>│   ├── IPv4地址结构<br>│   ├── <span class="hljs-built_in">IP</span>地址分类（A/B/C/D/E）<br>│   ├── 公有<span class="hljs-built_in">IP</span> vs 私有<span class="hljs-built_in">IP</span><br>│   ├── 特殊<span class="hljs-built_in">IP</span>地址<br>│   └── <span class="hljs-built_in">IP</span>地址分析工具<br>│<br>├── Day <span class="hljs-number">9</span>: 子网划分与CIDR<br>│   ├── 子网掩码原理<br>│   ├── CIDR表示法<br>│   ├── 子网计算方法<br>│   ├── VLSM可变长子网<br>│   └── 子网计算器<br>│<br>├── Day <span class="hljs-number">10</span>: MAC地址与ARP<br>│   ├── MAC地址结构<br>│   ├── OUI厂商标识<br>│   ├── ARP工作原理<br>│   ├── ARP缓存机制<br>│   └── ARP扫描工具<br>│<br>├── Day <span class="hljs-number">11</span>: 端口和Socket深入<br>│   ├── 端口概念（<span class="hljs-number">0</span>-<span class="hljs-number">65535</span>）<br>│   ├── 常用端口号<br>│   ├── Socket编程基础<br>│   ├── TCP vs UDP<br>│   └── 端口扫描器<br>│<br>├── Day <span class="hljs-number">12</span>: DNS协议详解<br>│   ├── DNS层级架构<br>│   ├── DNS查询流程（递归/迭代）<br>│   ├── DNS记录类型<br>│   ├── DNS缓存机制<br>│   └── DNS查询工具<br>│<br>└── Day <span class="hljs-number">13</span>: DHCP协议详解<br>    ├── DHCP工作原理<br>    ├── DORA四次握手<br>    ├── <span class="hljs-built_in">IP</span>地址租约管理<br>    ├── DHCP报文格式<br>    └── DHCP分析工具<br></code></pre></td></tr></table></figure><hr><h2 id="🎯-核心知识点回顾">🎯 核心知识点回顾</h2><h3 id="1-IP地址体系">1. IP地址体系</h3><p><strong>IPv4地址结构</strong>：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">192.168.1.100<br> |<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string"> </span>|<br> |<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string"> +-- 主机号</span><br><span class="hljs-string"> </span>|<span class="hljs-string">   </span>|<span class="hljs-string">   +---- 子网号</span><br><span class="hljs-string"> </span>|<span class="hljs-string">   +-------- 网络号</span><br><span class="hljs-string"> +------------ 网络类别</span><br></code></pre></td></tr></table></figure><p><strong>IP地址分类</strong>：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-keyword">A</span>类：<span class="hljs-number">1.0.0.0</span> - <span class="hljs-number">126.255.255.255</span><br>     <span class="hljs-number">0</span>xxxxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx<br>     用途：大型网络<br><br>B类：<span class="hljs-number">128.0.0.0</span> - <span class="hljs-number">191.255.255.255</span><br>     <span class="hljs-number">10</span>xxxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx<br>     用途：中型网络<br><br>C类：<span class="hljs-number">192.0.0.0</span> - <span class="hljs-number">223.255.255.255</span><br>     <span class="hljs-number">110</span>xxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx<br>     用途：小型网络<br><br>D类：<span class="hljs-number">224.0.0.0</span> - <span class="hljs-number">239.255.255.255</span><br>     用途：组播<br><br>E类：<span class="hljs-number">240.0.0.0</span> - <span class="hljs-number">255.255.255.255</span><br>     用途：保留/实验<br></code></pre></td></tr></table></figure><p><strong>私有IP地址</strong>：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">10.0.0.0</span>/<span class="hljs-number">8</span>        → A类私有<br><span class="hljs-number">172.16.0.0</span>/<span class="hljs-number">12</span>     → B类私有<br><span class="hljs-number">192.168.0.0</span>/<span class="hljs-number">16</span>    → C类私有<br></code></pre></td></tr></table></figure><h3 id="2-子网划分">2. 子网划分</h3><p><strong>子网掩码作用</strong>：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">IP地址：    <span class="hljs-number">192.168.1.100</span>   <span class="hljs-number">11000000</span>.<span class="hljs-number">10101000</span>.<span class="hljs-number">00000001</span>.<span class="hljs-number">01100100</span><br>子网掩码：  <span class="hljs-number">255.255.255.0</span>   <span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">00000000</span><br>─────────────────────────────────────────────────────────────<br>网络地址：  <span class="hljs-number">192.168.1.0</span>     <span class="hljs-number">11000000</span>.<span class="hljs-number">10101000</span>.<span class="hljs-number">00000001</span>.<span class="hljs-number">00000000</span> (AND运算)<br></code></pre></td></tr></table></figure><p><strong>CIDR计算</strong>：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns">CIDR    子网掩码           可用主机数    用途<br>/<span class="hljs-number">8</span>      <span class="hljs-number">255.0.0.0</span>         <span class="hljs-number">16,777,214</span>    大型网络<br>/<span class="hljs-number">16</span>     <span class="hljs-number">255.255.0.0</span>       <span class="hljs-number">65</span>,<span class="hljs-number">534</span>        中型网络<br>/<span class="hljs-number">24</span>     <span class="hljs-number">255.255.255.0</span>     <span class="hljs-number">254</span>           小型网络<br>/<span class="hljs-number">25</span>     <span class="hljs-number">255.255.255.128</span>   <span class="hljs-number">126</span>           小型子网<br>/<span class="hljs-number">26</span>     <span class="hljs-number">255.255.255.192</span>   <span class="hljs-number">62</span>            更小子网<br>/<span class="hljs-number">30</span>     <span class="hljs-number">255.255.255.252</span>   <span class="hljs-number">2</span>             点对点链路<br></code></pre></td></tr></table></figure><p><strong>子网划分示例</strong>：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns">原网络：<span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><br><br>划分为<span class="hljs-number">4</span>个子网（/<span class="hljs-number">26</span>）：<br>├── <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">26</span>    (<span class="hljs-number">192.168.1.1</span> - <span class="hljs-number">192.168.1.62</span>)<br>├── <span class="hljs-number">192.168.1.64</span>/<span class="hljs-number">26</span>   (<span class="hljs-number">192.168.1.65</span> - <span class="hljs-number">192.168.1.126</span>)<br>├── <span class="hljs-number">192.168.1.128</span>/<span class="hljs-number">26</span>  (<span class="hljs-number">192.168.1.129</span> - <span class="hljs-number">192.168.1.190</span>)<br>└── <span class="hljs-number">192.168.1.192</span>/<span class="hljs-number">26</span>  (<span class="hljs-number">192.168.1.193</span> - <span class="hljs-number">192.168.1.254</span>)<br></code></pre></td></tr></table></figure><h3 id="3-MAC地址与ARP">3. MAC地址与ARP</h3><p><strong>MAC地址结构</strong>：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable constant_">AA</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:CC</span><span class="hljs-symbol">:DD</span><span class="hljs-symbol">:EE</span><span class="hljs-symbol">:FF</span><br>│     │  │     │<br>│     │  │     └─ 设备号（厂商分配）<br>│     │  └─────── 设备号<br>│     └────────── 设备号<br>└──────────────── <span class="hljs-variable constant_">OUI</span>（厂商标识）<br><br>示例：<br><span class="hljs-number">00</span><span class="hljs-symbol">:</span><span class="hljs-number">50</span><span class="hljs-symbol">:</span><span class="hljs-number">56</span><span class="hljs-symbol">:XX</span><span class="hljs-symbol">:XX</span><span class="hljs-symbol">:XX</span> → <span class="hljs-title class_">VMware</span><br>08<span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:XX</span><span class="hljs-symbol">:XX</span><span class="hljs-symbol">:XX</span> → <span class="hljs-title class_">VirtualBox</span><br><span class="hljs-variable constant_">AC</span><span class="hljs-symbol">:DE</span><span class="hljs-symbol">:</span><span class="hljs-number">48</span><span class="hljs-symbol">:XX</span><span class="hljs-symbol">:XX</span><span class="hljs-symbol">:XX</span> → <span class="hljs-title class_">Apple</span><br></code></pre></td></tr></table></figure><p><strong>ARP工作流程</strong>：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dns">场景：主机<span class="hljs-keyword">A</span> (<span class="hljs-number">192.168.1.10</span>) 要发送数据给主机B (<span class="hljs-number">192.168.1.20</span>)<br><br><span class="hljs-number">1</span>. 主机<span class="hljs-keyword">A</span>检查ARP缓存<br>   └─ 没有<span class="hljs-number">192.168.1.20</span>的MAC地址<br><br><span class="hljs-number">2</span>. 主机<span class="hljs-keyword">A</span>广播ARP请求<br>   源MAC: aa:bb:cc:dd:ee:ff<br>   源IP:  <span class="hljs-number">192.168.1.10</span><br>   目标MAC: ff:ff:ff:ff:ff:ff (广播)<br>   目标IP: <span class="hljs-number">192.168.1.20</span><br>   问题: &quot;<span class="hljs-number">192.168.1.20</span>的MAC地址是什么？&quot;<br><br><span class="hljs-number">3</span>. 主机B收到请求，单播ARP响应<br>   源MAC: <span class="hljs-number">11:22:33:44</span>:<span class="hljs-number">55</span>:<span class="hljs-number">66</span><br>   源IP:  <span class="hljs-number">192.168.1.20</span><br>   目标MAC: aa:bb:cc:dd:ee:ff<br>   目标IP: <span class="hljs-number">192.168.1.10</span><br>   回答: &quot;我是<span class="hljs-number">192.168.1.20</span>，MAC是<span class="hljs-number">11:22:33:44</span>:<span class="hljs-number">55</span>:<span class="hljs-number">66</span>&quot;<br><br><span class="hljs-number">4</span>. 主机<span class="hljs-keyword">A</span>更新ARP缓存<br>   <span class="hljs-number">192.168.1.20</span> → <span class="hljs-number">11:22:33:44</span>:<span class="hljs-number">55</span>:<span class="hljs-number">66</span><br><br><span class="hljs-number">5</span>. 主机<span class="hljs-keyword">A</span>封装数据帧发送<br>   目标MAC: <span class="hljs-number">11:22:33:44</span>:<span class="hljs-number">55</span>:<span class="hljs-number">66</span> ✅<br></code></pre></td></tr></table></figure><h3 id="4-端口与Socket">4. 端口与Socket</h3><p><strong>端口分类</strong>：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">0</span>-<span class="hljs-number">1023</span>      系统端口（Well-Known Ports）<br>            需要管理员权限<br>            示例：<span class="hljs-built_in">HTTP</span>(<span class="hljs-number">80</span>)、<span class="hljs-built_in">HTTPS</span>(<span class="hljs-number">443</span>)、<span class="hljs-built_in">SSH</span>(<span class="hljs-number">22</span>)<br><br><span class="hljs-number">1024</span>-<span class="hljs-number">49151</span>  注册端口（Registered Ports）<br>            由IANA分配<br>            示例：<span class="hljs-built_in">MySQL</span>(<span class="hljs-number">3306</span>)、<span class="hljs-built_in">Redis</span>(<span class="hljs-number">6379</span>)<br><br><span class="hljs-number">49152</span>-<span class="hljs-number">65535</span> 动态端口（Dynamic Ports）<br>            临时端口、客户端端口<br></code></pre></td></tr></table></figure><p><strong>常用端口速查</strong>：</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tap">协议/服务    端口    说明<br>HTTP       <span class="hljs-number"> 80 </span>     网页浏览<br>HTTPS      <span class="hljs-number"> 443 </span>    加密网页<br>SSH        <span class="hljs-number"> 22 </span>     远程登录<br>FTP        <span class="hljs-number"> 21 </span>     文件传输<br>Telnet     <span class="hljs-number"> 23 </span>     远程终端<br>SMTP       <span class="hljs-number"> 25 </span>     邮件发送<br>POP3       <span class="hljs-number"> 110 </span>    邮件接收<br>IMAP       <span class="hljs-number"> 143 </span>    邮件接收<br>DNS        <span class="hljs-number"> 53 </span>     域名解析<br>DHCP        67/68   IP地址分配<br>MySQL      <span class="hljs-number"> 3306 </span>   数据库<br>PostgreSQL <span class="hljs-number"> 5432 </span>   数据库<br>Redis      <span class="hljs-number"> 6379 </span>   缓存数据库<br>MongoDB    <span class="hljs-number"> 27017 </span>  文档数据库<br></code></pre></td></tr></table></figure><p><strong>TCP Socket流程</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs stylus">服务器端：                     客户端：<br><span class="hljs-function"><span class="hljs-title">socket</span><span class="hljs-params">()</span></span>                      <span class="hljs-built_in">socket</span>()<br>   ↓                             ↓<br><span class="hljs-function"><span class="hljs-title">bind</span><span class="hljs-params">()</span></span>                         ---<br>   ↓                             ↓<br><span class="hljs-function"><span class="hljs-title">listen</span><span class="hljs-params">()</span></span>                       <span class="hljs-built_in">connect</span>() ────→ 三次握手<br>   ↓                             ↓<br><span class="hljs-function"><span class="hljs-title">accept</span><span class="hljs-params">()</span></span> ←───────────────────────┘<br>   ↓                             ↓<br><span class="hljs-function"><span class="hljs-title">recv</span><span class="hljs-params">()</span></span> ←─────────────────────── <span class="hljs-built_in">send</span>()<br>   ↓                             ↓<br><span class="hljs-function"><span class="hljs-title">send</span><span class="hljs-params">()</span></span> ─────────────────────→ <span class="hljs-built_in">recv</span>()<br>   ↓                             ↓<br><span class="hljs-function"><span class="hljs-title">close</span><span class="hljs-params">()</span></span>                        <span class="hljs-built_in">close</span>()<br></code></pre></td></tr></table></figure><h3 id="5-DNS协议">5. DNS协议</h3><p><strong>DNS层级结构</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">完整域名：www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.<br>           │   │       │   │<br>           │   │       │   └─ 根域<br>           │   │       └───── 顶级域(TLD)<br>           │   └─────────────二级域(SLD)<br>           └─────────────────子域/主机名<br></code></pre></td></tr></table></figure><p><strong>DNS查询流程（递归+迭代）</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span>. 客户端 → 本地DNS服务器<br>   <span class="hljs-string">&quot;www.example.com的IP是什么？&quot;</span><br><br><span class="hljs-number">2</span>. 本地DNS → 根DNS服务器<br>   根DNS → <span class="hljs-string">&quot;去问.com服务器，地址是X.X.X.X&quot;</span><br><br><span class="hljs-number">3</span>. 本地DNS → <span class="hljs-selector-class">.com</span> DNS服务器<br>   <span class="hljs-selector-class">.com</span> DNS → <span class="hljs-string">&quot;去问example.com的权威DNS，地址是Y.Y.Y.Y&quot;</span><br><br><span class="hljs-number">4</span>. 本地DNS → example<span class="hljs-selector-class">.com</span> 权威DNS<br>   权威DNS → <span class="hljs-string">&quot;www.example.com的IP是93.184.216.34&quot;</span><br><br><span class="hljs-number">5</span>. 本地DNS → 客户端<br>   <span class="hljs-string">&quot;答案是93.184.216.34&quot;</span><br><br>总耗时：通常<span class="hljs-number">50</span>-<span class="hljs-number">200ms</span><br></code></pre></td></tr></table></figure><p><strong>DNS记录类型</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">A记录     → IPv4地址        www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> → <span class="hljs-number">93.184</span>.<span class="hljs-number">216.34</span><br>AAAA记录  → IPv6地址        www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> → <span class="hljs-number">2606</span>:<span class="hljs-number">2800</span>:<span class="hljs-number">220</span>:<span class="hljs-number">1</span>:...<br>CNAME记录 → 别名           blog<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> → www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span><br>MX记录    → 邮件服务器      example<span class="hljs-selector-class">.com</span> → mail<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> (优先级<span class="hljs-number">10</span>)<br>NS记录    → 域名服务器      example<span class="hljs-selector-class">.com</span> → ns1<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span><br>TXT记录   → 文本信息        用于SPF、DKIM验证<br>PTR记录   → 反向解析        IP → 域名<br></code></pre></td></tr></table></figure><p><strong>DNS缓存层级</strong>：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">浏览器缓存 (几分钟)<br>    ↓<br>操作系统缓存 (根据TTL)<br>    ↓<br>路由器缓存 (根据TTL)<br>    ↓<br>本地DNS服务器缓存 (根据TTL)<br>    ↓<br>权威DNS服务器 (真实数据源)<br></code></pre></td></tr></table></figure><h3 id="6-DHCP协议">6. DHCP协议</h3><p><strong>DORA四次握手</strong>：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs abnf">D - Discover   客户端广播：<span class="hljs-string">&quot;有DHCP服务器吗？&quot;</span><br>O - Offer      服务器响应：<span class="hljs-string">&quot;这里有个IP：192.168.1.100&quot;</span><br>R - Request    客户端广播：<span class="hljs-string">&quot;我要192.168.1.100&quot;</span><br>A - Ack        服务器确认：<span class="hljs-string">&quot;好的，分配给你了！&quot;</span><br><br>时间线：<br><span class="hljs-attribute">t</span><span class="hljs-operator">=</span><span class="hljs-number">0</span>ms    客户端发送Discover<br><span class="hljs-attribute">t</span><span class="hljs-operator">=</span><span class="hljs-number">10</span>ms   服务器响应Offer<br><span class="hljs-attribute">t</span><span class="hljs-operator">=</span><span class="hljs-number">15</span>ms   客户端发送Request<br><span class="hljs-attribute">t</span><span class="hljs-operator">=</span><span class="hljs-number">20</span>ms   服务器发送Ack<br>         ✅ 客户端配置完成，可以上网<br></code></pre></td></tr></table></figure><p><strong>DHCP配置内容</strong>：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dns">必需配置：<br>├── IP地址          <span class="hljs-number">192.168.1.100</span><br>├── 子网掩码        <span class="hljs-number">255.255.255.0</span><br>└── 租约时间        <span class="hljs-number">86400</span>秒 (<span class="hljs-number">24</span>小时)<br><br>可选配置：<br>├── 默认网关        <span class="hljs-number">192.168.1.1</span><br>├── DNS服务器       <span class="hljs-number">8.8.8.8</span>, <span class="hljs-number">8.8.4.4</span><br>├── 域名            example.com<br>└── 其他参数        NTP服务器、WINS服务器等<br></code></pre></td></tr></table></figure><p><strong>租约时间管理</strong>：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs subunit">租约周期：24小时 (86400秒)<br><br>时间点：<br>0%        开始时间：2024<span class="hljs-string">-01</span><span class="hljs-string">-15</span> 10:00:00<br>          ↓<br>50%       T1续约：  2024<span class="hljs-string">-01</span><span class="hljs-string">-15</span> 22:00:00<br>          (直接联系原DHCP服务器)<br>          ↓<br>87.5%     T2重绑：  2024<span class="hljs-string">-01</span><span class="hljs-string">-16</span> 04:30:00<br>          (广播寻找任何DHCP服务器)<br>          ↓<br>100%      到期时间：2024<span class="hljs-string">-01</span><span class="hljs-string">-16</span> 10:00:00<br>          (释放IP，重新DORA)<br></code></pre></td></tr></table></figure><hr><h2 id="🔗-知识串联">🔗 知识串联</h2><p>让我们把这一周的知识串联起来，看看它们如何协同工作：</p><h3 id="场景：你的电脑如何访问-www-baidu-com">场景：你的电脑如何访问 <a href="http://www.baidu.com">www.baidu.com</a></h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs dns">步骤<span class="hljs-number">1</span>：获取网络配置 (DHCP)<br>─────────────────────────────────<br>开机 → DHCP DORA过程<br>     ↓<br>获得配置：<br>- IP地址：<span class="hljs-number">192.168.1.100</span><br>- 子网掩码：<span class="hljs-number">255.255.255.0</span><br>- 网关：<span class="hljs-number">192.168.1.1</span><br>- DNS：<span class="hljs-number">8.8.8.8</span><br><br>步骤<span class="hljs-number">2</span>：DNS域名解析<br>─────────────────────────────────<br>浏览器输入：www.baidu.com<br>     ↓<br>查询本地DNS缓存<br>     ↓ (未命中)<br>本地DNS → 递归查询<br>     ↓<br>得到IP：<span class="hljs-number">110.242.68.66</span><br><br>步骤<span class="hljs-number">3</span>：判断是否同一子网<br>─────────────────────────────────<br>目标IP：<span class="hljs-number">110.242.68.66</span><br>本机IP：<span class="hljs-number">192.168.1.100</span>/<span class="hljs-number">24</span><br>本机网络：<span class="hljs-number">192.168.1.0</span><br><br><span class="hljs-number">110.242.68.66</span> ∉ <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><br>     ↓<br>需要通过网关转发<br><br>步骤<span class="hljs-number">4</span>：ARP获取网关MAC地址<br>─────────────────────────────────<br>需要发送给：<span class="hljs-number">192.168.1.1</span>（网关）<br>     ↓<br>查询ARP缓存<br>     ↓ (未命中)<br>广播ARP请求：&quot;<span class="hljs-number">192.168.1.1</span>的MAC是什么？&quot;<br>     ↓<br>收到ARP响应：&quot;MAC是aa:bb:cc:dd:ee:ff&quot;<br>     ↓<br>更新ARP缓存<br><br>步骤<span class="hljs-number">5</span>：封装数据包并发送<br>─────────────────────────────────<br>应用层：HTTP请求 GET / HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br>     ↓<br>传输层：TCP段 (源端口:<span class="hljs-number">54321</span> → 目标端口:<span class="hljs-number">80</span>)<br>     ↓<br>网络层：IP包<br>        源IP: <span class="hljs-number">192.168.1.100</span><br>        目标IP: <span class="hljs-number">110.242.68.66</span><br>     ↓<br>链路层：以太网帧<br>        源MAC: 你的电脑MAC<br>        目标MAC: aa:bb:cc:dd:ee:ff (网关MAC)<br>     ↓<br>发送到网关<br><br>步骤<span class="hljs-number">6</span>：网关转发<br>─────────────────────────────────<br>网关收到数据包<br>     ↓<br>查看目标IP：<span class="hljs-number">110.242.68.66</span><br>     ↓<br>查询路由表，找到下一跳<br>     ↓<br>转发给运营商路由器<br>     ↓<br>... 经过多个路由器 ...<br>     ↓<br>到达百度服务器<br><br>步骤<span class="hljs-number">7</span>：接收响应<br>─────────────────────────────────<br>百度服务器处理请求<br>     ↓<br>返回HTTP响应<br>     ↓<br>... 原路返回 ...<br>     ↓<br>到达你的电脑<br>     ↓<br>浏览器显示网页 ✅<br></code></pre></td></tr></table></figure><h3 id="完整的网络层协议栈">完整的网络层协议栈</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs scss">┌────────────────────────────────────────┐<br>│         应用层                          │<br>│    HTTP、FTP、SMTP、DNS                │<br>├────────────────────────────────────────┤<br>│         传输层                          │<br>│    TCP (端口)、UDP (端口)              │<br>├────────────────────────────────────────┤<br>│         网络层                          │<br>│    IP (地址)、ICMP、ARP                │<br>├────────────────────────────────────────┤<br>│         链路层                          │<br>│    以太网 (MAC地址)、WiFi              │<br>├────────────────────────────────────────┤<br>│         物理层                          │<br>│    电信号、光信号、无线电波            │<br>└────────────────────────────────────────┘<br></code></pre></td></tr></table></figure><hr><h2 id="💻-综合实战项目">💻 综合实战项目</h2><h3 id="项目：网络配置诊断工具">项目：网络配置诊断工具</h3><p>创建一个综合工具，整合本周所学知识：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 综合诊断</span><br>python week02_network_diagnostic.py --full<br><br><span class="hljs-comment"># 单项检查</span><br>python week02_network_diagnostic.py --check-ip<br>python week02_network_diagnostic.py --check-dns<br>python week02_network_diagnostic.py --check-gateway<br></code></pre></td></tr></table></figure><p><strong>项目代码</strong>：见 <code>code/week02/week02_network_diagnostic.py</code></p><p><strong>功能清单</strong>：</p><ol><li>✅ 显示本机IP配置（IP、掩码、网关、DNS）</li><li>✅ 分析IP地址类型（公有/私有、类别）</li><li>✅ 计算子网信息（网络地址、广播地址、可用主机）</li><li>✅ 查看ARP缓存</li><li>✅ 扫描网关可达性</li><li>✅ 测试DNS解析</li><li>✅ 显示DHCP租约信息</li><li>✅ 检查常用端口</li><li>✅ 网络连通性测试</li><li>✅ 生成诊断报告</li></ol><hr><h2 id="📝-知识测验">📝 知识测验</h2><h3 id="基础题（每题10分）">基础题（每题10分）</h3><p><strong>1. IP地址 172.16.50.100 属于哪一类？是公有IP还是私有IP？</strong></p><details><summary>点击查看答案</summary><ul><li>类别：B类（第一个字节172，10xxxxxx开头）</li><li>类型：私有IP（172.16.0.0/12 是B类私有地址范围）</li></ul></details><p><strong>2. 子网掩码 255.255.255.192 对应的CIDR是多少？有多少个可用主机？</strong></p><details><summary>点击查看答案</summary><ul><li>CIDR：/26</li><li>计算：255.255.255.192 = 11111111.11111111.11111111.11000000<br>共有26个1，所以是/26</li><li>可用主机数：2^(32-26) - 2 = 2^6 - 2 = 64 - 2 = 62个</li></ul></details><p><strong>3. MAC地址 00:50:56:12:34:56 是哪个厂商的设备？</strong></p><details><summary>点击查看答案</summary><ul><li>厂商：VMware</li><li>判断：OUI前缀 00:50:56 属于VMware</li></ul></details><p><strong>4. 端口号 3306 通常用于什么服务？</strong></p><details><summary>点击查看答案</summary><ul><li>服务：MySQL数据库</li><li>默认端口：3306/tcp</li></ul></details><p><strong>5. DNS的A记录和CNAME记录有什么区别？</strong></p><details><summary>点击查看答案</summary><ul><li><p>A记录：直接指向IPv4地址<br>示例：<a href="http://www.example.com">www.example.com</a> → 93.184.216.34</p></li><li><p>CNAME记录：指向另一个域名（别名）<br>示例：<a href="http://blog.example.com">blog.example.com</a> → <a href="http://www.example.com">www.example.com</a></p></li><li><p>区别：</p><ol><li>A记录直接解析，CNAME需要再次查询</li><li>根域名只能用A记录</li><li>CNAME不能与其他记录共存</li></ol></li></ul></details><p><strong>6. DHCP的T1和T2分别是租约时长的多少？</strong></p><details><summary>点击查看答案</summary><ul><li>T1（续约时间）：租约时长的 50%</li><li>T2（重绑时间）：租约时长的 87.5%</li></ul><p>示例：租期24小时</p><ul><li>T1 = 12小时（直接联系原服务器）</li><li>T2 = 21小时（广播寻找任何服务器）</li><li>到期 = 24小时（释放IP）</li></ul></details><h3 id="进阶题（每题15分）">进阶题（每题15分）</h3><p><strong>7. 请计算网络 192.168.10.0/24 划分为8个等大小子网的结果。</strong></p><details><summary>点击查看答案</summary><p>划分为8个子网，需要3位（2^3=8）<br>新的子网掩码：/24 + 3 = /27<br>子网掩码：255.255.255.224</p><p>8个子网：</p><ol><li>192.168.10.0/27   (192.168.10.1 - 192.168.10.30)</li><li>192.168.10.32/27  (192.168.10.33 - 192.168.10.62)</li><li>192.168.10.64/27  (192.168.10.65 - 192.168.10.94)</li><li>192.168.10.96/27  (192.168.10.97 - 192.168.10.126)</li><li>192.168.10.128/27 (192.168.10.129 - 192.168.10.158)</li><li>192.168.10.160/27 (192.168.10.161 - 192.168.10.190)</li><li>192.168.10.192/27 (192.168.10.193 - 192.168.10.222)</li><li>192.168.10.224/27 (192.168.10.225 - 192.168.10.254)</li></ol><p>每个子网：30个可用主机</p></details><p><strong>8. 描述完整的ARP请求和响应过程（包括MAC地址和IP地址）。</strong></p><details><summary>点击查看答案</summary><p>场景：主机A要与主机B通信</p><p>已知信息：</p><ul><li>主机A：IP=192.168.1.10, MAC=aa:bb:cc:dd:ee:ff</li><li>主机B：IP=192.168.1.20, MAC=11:22:33:44:55:66</li></ul><p>步骤：</p><ol><li><p>ARP请求（广播）：</p><ul><li>源MAC：aa:bb:cc:dd:ee:ff</li><li>目标MAC：ff:ff:ff:ff:ff:ff（广播）</li><li>源IP：192.168.1.10</li><li>目标IP：192.168.1.20</li><li>询问：“谁是192.168.1.20？请告诉192.168.1.10”</li></ul></li><li><p>ARP响应（单播）：</p><ul><li>源MAC：11:22:33:44:55:66</li><li>目标MAC：aa:bb:cc:dd:ee:ff</li><li>源IP：192.168.1.20</li><li>目标IP：192.168.1.10</li><li>回答：“我是192.168.1.20，我的MAC是11:22:33:44:55:66”</li></ul></li><li><p>主机A更新ARP缓存表：<br>192.168.1.20 → 11:22:33:44:55:66</p></li><li><p>后续通信直接使用缓存的MAC地址</p></li></ol></details><p><strong>9. 解释DNS递归查询和迭代查询的区别，并说明哪里用递归哪里用迭代。</strong></p><details><summary>点击查看答案</summary><p>递归查询（Recursive Query）：</p><ul><li>定义：查询者发出请求后，DNS服务器负责完成整个查询</li><li>特点：“帮我查到结果再告诉我”</li><li>返回：最终答案或错误</li></ul><p>迭代查询（Iterative Query）：</p><ul><li>定义：DNS服务器只返回下一步应该查询的服务器地址</li><li>特点：“我不知道，但你可以去问XX服务器”</li><li>返回：推荐查询的服务器地址</li></ul><p>实际应用：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">客户端 → 本地DNS   【递归查询】<br>         ↓<br>本地DNS → 根DNS     【迭代查询】<br>         ↓<br>本地DNS → TLD<span class="hljs-built_in"> DNS </span>  【迭代查询】<br>         ↓<br>本地DNS → 权威DNS   【迭代查询】<br>         ↓<br>本地DNS → 客户端    【递归查询】<br></code></pre></td></tr></table></figure><p>为什么这样设计？</p><ul><li>客户端用递归：简单，不需要多次查询</li><li>服务器间用迭代：减轻单个服务器负担，避免递归导致的深度过深</li></ul></details><p><strong>10. 如果DHCP服务器在另一个子网，如何实现DHCP服务？</strong></p><details><summary>点击查看答案</summary><p>问题：DHCP使用广播，广播无法跨越路由器</p><p>解决方案：<strong>DHCP Relay（中继代理）</strong></p><p>工作原理：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[子网1: 192.168.1.0/24]</span><br>    ↓ 客户端广播Discover<br><span class="hljs-string">[路由器 - DHCP Relay]</span><br>    ↓ 单播转发到DHCP服务器<br><span class="hljs-string">[子网2: 192.168.2.0/24 - DHCP服务器]</span><br></code></pre></td></tr></table></figure><p>详细流程：</p><ol><li>客户端在子网1广播DHCP Discover</li><li>路由器（配置为DHCP Relay）收到</li><li>路由器修改报文：<ul><li>源IP改为路由器接口IP (192.168.1.1)</li><li>目标IP改为DHCP服务器IP (192.168.2.100)，单播</li><li>Gateway IP字段填入192.168.1.1</li><li>Hops字段加1</li></ul></li><li>DHCP服务器看到Gateway IP，知道客户端在子网1</li><li>从子网1的地址池分配IP</li><li>服务器单播响应给路由器</li><li>路由器转发响应给客户端</li></ol><p>配置示例（Cisco）：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">interface</span> GigabitEthernet0/<span class="hljs-number">0</span><br> <span class="hljs-attribute">ip</span> address <span class="hljs-number">192.168.1.1</span> <span class="hljs-number">255.255.255.0</span><br> <span class="hljs-attribute">ip</span> helper-address <span class="hljs-number">192.168.2.100</span><br></code></pre></td></tr></table></figure></details><h3 id="计分标准">计分标准</h3><ul><li>90-100分：优秀，完全掌握本周内容</li><li>75-89分：良好，大部分知识点已掌握</li><li>60-74分：及格，基础知识掌握，需加强练习</li><li>60分以下：需要重新学习本周内容</li></ul><hr><h2 id="🎓-实践建议">🎓 实践建议</h2><h3 id="1-动手实验">1. 动手实验</h3><p><strong>必做实验</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">□ 使用ipconfig/ifconfig查看本机网络配置<br>□ 计算自己所在网络的子网信息<br>□ 查看并分析ARP缓存表<br>□ 使用nslookup/dig查询DNS<br>□ 释放并重新获取DHCP地址<br>□ 扫描局域网内的活跃主机<br></code></pre></td></tr></table></figure><p><strong>选做实验</strong>：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">□ 搭建简单的DHCP服务器（虚拟机）<br>□ 配置DNS服务器（<span class="hljs-keyword">bind9）</span><br><span class="hljs-keyword"></span>□ 使用Wireshark抓包分析DHCP过程<br>□ 编写子网划分计算器<br>□ 实现简单的ARP欺骗检测<br></code></pre></td></tr></table></figure><h3 id="2-工具使用">2. 工具使用</h3><p><strong>命令行工具</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Windows</span><br>ipconfig /all          <span class="hljs-comment"># 查看详细网络配置</span><br>ipconfig /displaydns   <span class="hljs-comment"># 查看DNS缓存</span><br>arp -a                 <span class="hljs-comment"># 查看ARP缓存</span><br>nslookup www.baidu.com <span class="hljs-comment"># DNS查询</span><br>netstat -an            <span class="hljs-comment"># 查看端口状态</span><br><br><span class="hljs-comment"># Linux/Mac</span><br>ifconfig / ip addr     <span class="hljs-comment"># 查看网络配置</span><br>arp -n                 <span class="hljs-comment"># 查看ARP缓存</span><br>dig www.baidu.com      <span class="hljs-comment"># DNS查询</span><br>netstat -tuln          <span class="hljs-comment"># 查看监听端口</span><br>ss -tuln               <span class="hljs-comment"># 更快的端口查看</span><br></code></pre></td></tr></table></figure><p><strong>图形化工具</strong>：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>Wireshark：抓包分析<br><span class="hljs-bullet">- </span>Advanced IP Scanner：网络扫描<br><span class="hljs-bullet">- </span>Angry IP Scanner：跨平台IP扫描<br><span class="hljs-bullet">- </span>Fiddler：HTTP抓包<br></code></pre></td></tr></table></figure><h3 id="3-延伸学习">3. 延伸学习</h3><p><strong>推荐阅读</strong>：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>. RFC <span class="hljs-number">791</span>  - IP协议规范<br><span class="hljs-attribute">2</span>. RFC <span class="hljs-number">826</span>  - ARP协议规范<br><span class="hljs-attribute">3</span>. RFC <span class="hljs-number">1918</span> - 私有IP地址分配<br><span class="hljs-attribute">4</span>. RFC <span class="hljs-number">1035</span> - DNS协议规范<br><span class="hljs-attribute">5</span>. RFC <span class="hljs-number">2131</span> - DHCP协议规范<br><span class="hljs-attribute">6</span>. RFC <span class="hljs-number">4632</span> - CIDR地址分配<br></code></pre></td></tr></table></figure><p><strong>推荐视频/课程</strong>：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>Wireshark网络分析教程<br><span class="hljs-bullet">- </span>子网划分实战演练<br><span class="hljs-bullet">- </span>DNS深入解析<br><span class="hljs-bullet">- </span>DHCP服务器搭建<br></code></pre></td></tr></table></figure><hr><h2 id="🚀-下周预告">🚀 下周预告</h2><p><strong>第三周：传输层协议详解</strong></p><p>我们将学习：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">Day 15</span><span class="hljs-punctuation">:</span> <span class="hljs-string">TCP协议基础</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">TCP报文格式</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">TCP三次握手</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">TCP四次挥手</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">TCP状态机</span><br><br><span class="hljs-attribute">Day 16</span><span class="hljs-punctuation">:</span> <span class="hljs-string">TCP可靠传输</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">序列号和确认号</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">滑动窗口机制</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">流量控制</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">拥塞控制</span><br><br><span class="hljs-attribute">Day 17</span><span class="hljs-punctuation">:</span> <span class="hljs-string">UDP协议详解</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">UDP报文格式</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">UDP vs TCP对比</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">UDP应用场景</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">UDP编程实战</span><br><br><span class="hljs-attribute">Day 18</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Socket编程进阶</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">非阻塞Socket</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">Socket选项设置</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">多路复用（select/poll/epoll）</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">实战：聊天室服务器</span><br><br><span class="hljs-attribute">Day 19</span><span class="hljs-punctuation">:</span> <span class="hljs-string">HTTP协议基础</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">HTTP请求和响应</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">HTTP方法（GET/POST等）</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">HTTP状态码</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">Cookie和Session</span><br><br><span class="hljs-attribute">Day 20</span><span class="hljs-punctuation">:</span> <span class="hljs-string">HTTPS与安全</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">HTTPS工作原理</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">SSL/TLS握手</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">证书验证</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">中间人攻击防护</span><br><br><span class="hljs-attribute">Day 21</span><span class="hljs-punctuation">:</span> <span class="hljs-string">第三周总结</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">传输层协议综合复习</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">TCP/UDP深入对比</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">综合实战项目</span><br></code></pre></td></tr></table></figure><hr><h2 id="📊-学习进度追踪">📊 学习进度追踪</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs arcade">第一周 ✅ 网络基础入门<br>├─ <span class="hljs-built_in">Day</span> <span class="hljs-number">1</span><span class="hljs-number">-7</span> 完成 ✅<br>└─ 周总结完成 ✅<br><br>第二周 ✅ 网络层深入<br>├─ <span class="hljs-built_in">Day</span> <span class="hljs-number">8</span>:  IP地址详解 ✅<br>├─ <span class="hljs-built_in">Day</span> <span class="hljs-number">9</span>:  子网划分 ✅<br>├─ <span class="hljs-built_in">Day</span> <span class="hljs-number">10</span>: MAC与ARP ✅<br>├─ <span class="hljs-built_in">Day</span> <span class="hljs-number">11</span>: 端口与Socket ✅<br>├─ <span class="hljs-built_in">Day</span> <span class="hljs-number">12</span>: DNS协议 ✅<br>├─ <span class="hljs-built_in">Day</span> <span class="hljs-number">13</span>: DHCP协议 ✅<br>└─ <span class="hljs-built_in">Day</span> <span class="hljs-number">14</span>: 周总结 ✅<br><br>第三周 ⏳ 传输层协议<br>└─ <span class="hljs-built_in">Day</span> <span class="hljs-number">15</span><span class="hljs-number">-21</span> 待学习<br><br>总进度：<span class="hljs-number">14</span>/<span class="hljs-number">180</span> 天 (<span class="hljs-number">7.8</span>%)<br></code></pre></td></tr></table></figure><hr><h2 id="✅-本周检查清单">✅ 本周检查清单</h2><p>在进入下一周之前，请确保：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs armasm">□ 理解<span class="hljs-built_in">IP</span>地址分类和私有<span class="hljs-built_in">IP</span>范围<br>□ 能够计算子网掩码和CIDR<br>□ 掌握子网划分的方法<br>□ 理解MAC地址结构和OUI<br>□ 掌握ARP工作原理<br>□ 熟悉常用端口号<br>□ 理解Socket编程基础<br>□ 掌握DNS查询流程<br>□ 理解DNS记录类型<br>□ 掌握DHCP DORA过程<br>□ 理解租约管理机制<br>□ 完成本周所有代码练习<br>□ 能够使用基本的网络诊断命令<br></code></pre></td></tr></table></figure><hr><h2 id="💬-学习心得">💬 学习心得</h2><p>在这里记录你的学习收获和疑问：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs markdown">本周最大收获：<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><br>还不太理解的地方：<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><br>下周学习计划：<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_<br><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-emphasis">_</span><br></code></pre></td></tr></table></figure><hr><h2 id="🎉-总结">🎉 总结</h2><p>恭喜你完成第二周的学习！这一周我们深入学习了网络层的核心概念：</p><ul><li>✅ 掌握了IP地址体系和子网划分</li><li>✅ 理解了MAC地址和ARP协议</li><li>✅ 学会了端口和Socket编程</li><li>✅ 深入了解DNS和DHCP协议</li><li>✅ 编写了多个实用的网络工具</li></ul><p>这些知识是网络工程师的必备基础。在实际工作中，你会频繁地使用这些概念来：</p><ul><li>规划和分配IP地址</li><li>排查网络连通性问题</li><li>配置网络服务</li><li>开发网络应用</li></ul><p><strong>继续保持学习的热情，我们下周见！</strong> 🚀</p><hr><p><strong>记住</strong>：网络知识需要大量实践才能真正掌握。多动手、多实验、多思考！</p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>14天：第一阶段总结与综合实战</title>
    <link href="/2025/11/10/14%E5%A4%A9%EF%BC%9A%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E4%B8%8E%E7%BB%BC%E5%90%88%E5%AE%9E%E6%88%98/"/>
    <url>/2025/11/10/14%E5%A4%A9%EF%BC%9A%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E4%B8%8E%E7%BB%BC%E5%90%88%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h1>第14天：第一阶段总结与综合实战</h1><blockquote><p>“前两周的学习为你打开了网络世界的大门，现在是时候检验学习成果了！”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>回顾第一阶段核心知识点</li><li>完成综合实战项目</li><li>掌握网络问题排查方法</li><li>为下一阶段做好准备</li></ul><hr><h2 id="1-第一阶段学习回顾（Day-1-13）">1. 第一阶段学习回顾（Day 1-13）</h2><h3 id="1-1-知识地图">1.1 知识地图</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">第一阶段：网络基础入门</span><br><span class="hljs-attribute">│</span><br><span class="hljs-attribute">├── 第1周：网络基础概念</span><br><span class="hljs-attribute">│   ├── Day 1</span><span class="hljs-punctuation">:</span> <span class="hljs-string">计算机网络概述</span><br><span class="hljs-attribute">│   │   ├── 什么是计算机网络</span><br><span class="hljs-attribute">│   │   ├── 网络的作用</span><br><span class="hljs-attribute">│   │   └── 网络连接检测工具</span><br><span class="hljs-attribute">│   │</span><br><span class="hljs-attribute">│   ├── Day 2</span><span class="hljs-punctuation">:</span> <span class="hljs-string">网络分类和拓扑</span><br><span class="hljs-attribute">│   │   ├── LAN/WAN/MAN</span><br><span class="hljs-attribute">│   │   ├── 五种拓扑结构</span><br><span class="hljs-attribute">│   │   └── 局域网扫描器</span><br><span class="hljs-attribute">│   │</span><br><span class="hljs-attribute">│   ├── Day 3</span><span class="hljs-punctuation">:</span> <span class="hljs-string">OSI七层模型</span><br><span class="hljs-attribute">│   │   ├── 七层模型详解</span><br><span class="hljs-attribute">│   │   ├── 数据封装过程</span><br><span class="hljs-attribute">│   │   └── 协议分层演示</span><br><span class="hljs-attribute">│   │</span><br><span class="hljs-attribute">│   ├── Day 4</span><span class="hljs-punctuation">:</span> <span class="hljs-string">TCP/IP四层模型</span><br><span class="hljs-attribute">│   │   ├── TCP/IP vs OSI</span><br><span class="hljs-attribute">│   │   ├── 四层模型详解</span><br><span class="hljs-attribute">│   │   └── 数据包分析</span><br><span class="hljs-attribute">│   │</span><br><span class="hljs-attribute">│   ├── Day 5</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ping命令</span><br><span class="hljs-attribute">│   │   ├── ping原理</span><br><span class="hljs-attribute">│   │   ├── ICMP协议</span><br><span class="hljs-attribute">│   │   └── 简易ping工具</span><br><span class="hljs-attribute">│   │</span><br><span class="hljs-attribute">│   ├── Day 6</span><span class="hljs-punctuation">:</span> <span class="hljs-string">traceroute命令</span><br><span class="hljs-attribute">│   │   ├── traceroute原理</span><br><span class="hljs-attribute">│   │   ├── TTL字段</span><br><span class="hljs-attribute">│   │   └── traceroute工具</span><br><span class="hljs-attribute">│   │</span><br><span class="hljs-attribute">│   └── Day 7</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Wireshark抓包</span><br><span class="hljs-attribute">│       ├── Wireshark基础</span><br><span class="hljs-attribute">│       ├── 过滤器语法</span><br><span class="hljs-attribute">│       └── HTTP请求分析</span><br><span class="hljs-attribute">│</span><br><span class="hljs-attribute">└── 第2周：网络层深入理解</span><br><span class="hljs-attribute">    ├── Day 8</span><span class="hljs-punctuation">:</span> <span class="hljs-string">IP地址基础</span><br>    <span class="hljs-attribute">│   ├── IPv4地址结构</span><br><span class="hljs-attribute">    │   ├── IP地址分类</span><br><span class="hljs-attribute">    │   └── IP地址分析工具</span><br><span class="hljs-attribute">    │</span><br><span class="hljs-attribute">    ├── Day 9</span><span class="hljs-punctuation">:</span> <span class="hljs-string">子网划分</span><br>    <span class="hljs-attribute">│   ├── 子网掩码</span><br><span class="hljs-attribute">    │   ├── CIDR表示法</span><br><span class="hljs-attribute">    │   └── 子网计算器</span><br><span class="hljs-attribute">    │</span><br><span class="hljs-attribute">    ├── Day 10</span><span class="hljs-punctuation">:</span> <span class="hljs-string">MAC地址和ARP</span><br>    <span class="hljs-attribute">│   ├── MAC地址结构</span><br><span class="hljs-attribute">    │   ├── ARP协议</span><br><span class="hljs-attribute">    │   └── ARP扫描工具</span><br><span class="hljs-attribute">    │</span><br><span class="hljs-attribute">    ├── Day 11</span><span class="hljs-punctuation">:</span> <span class="hljs-string">端口和Socket</span><br>    <span class="hljs-attribute">│   ├── 端口概念</span><br><span class="hljs-attribute">    │   ├── Socket基础</span><br><span class="hljs-attribute">    │   └── 端口扫描器</span><br><span class="hljs-attribute">    │</span><br><span class="hljs-attribute">    ├── Day 12</span><span class="hljs-punctuation">:</span> <span class="hljs-string">DNS协议</span><br>    <span class="hljs-attribute">│   ├── DNS工作原理</span><br><span class="hljs-attribute">    │   ├── DNS查询流程</span><br><span class="hljs-attribute">    │   └── DNS查询工具</span><br><span class="hljs-attribute">    │</span><br><span class="hljs-attribute">    └── Day 13</span><span class="hljs-punctuation">:</span> <span class="hljs-string">DHCP协议</span><br>        ├── DHCP原理<br>        ├── DORA四次握手<br>        └── DHCP分析工具<br></code></pre></td></tr></table></figure><hr><h2 id="2-核心知识点总结">2. 核心知识点总结</h2><h3 id="2-1-OSI七层模型-vs-TCP-IP四层模型">2.1 OSI七层模型 vs TCP/IP四层模型</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">OSI</span>七层模型              TCP/<span class="hljs-built_in">IP</span>四层模型        协议示例<br>┌────────────────┐<br>│  <span class="hljs-number">7</span>. 应用层      │      ┌──────────┐         HTTP, FTP, DNS<br>│  <span class="hljs-number">6</span>. 表示层      │──────│ 应用层    │         SMTP, SSH, Telnet<br>│  <span class="hljs-number">5</span>. 会话层      │      └──────────┘<br>├────────────────┤      ┌──────────┐<br>│  <span class="hljs-number">4</span>. 传输层      │──────│ 传输层    │         TCP, UDP<br>├────────────────┤      └──────────┘<br>│  <span class="hljs-number">3</span>. 网络层      │      ┌──────────┐<br>├────────────────┤──────│ 网络层    │         <span class="hljs-built_in">IP</span>, ICMP, ARP<br>│  <span class="hljs-number">2</span>. 数据链路层   │      └──────────┘<br>├────────────────┤      ┌──────────┐<br>│  <span class="hljs-number">1</span>. 物理层      │──────│ 链路层    │         Ethernet, WiFi<br>└────────────────┘      └──────────┘<br><br>数据封装过程：<br>应用数据<br>  → 添加TCP/UDP头（传输层）<br>    → 添加<span class="hljs-built_in">IP</span>头（网络层）<br>      → 添加以太网帧头/尾（链路层）<br>        → 转换为比特流（物理层）<br></code></pre></td></tr></table></figure><h3 id="2-2-IP地址和子网划分">2.2 IP地址和子网划分</h3><p><strong>IP地址分类</strong>：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">类别    范围                    默认掩码          用途<br>A    <span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> - <span class="hljs-number">126</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>    /<span class="hljs-number">8</span> (<span class="hljs-number">255</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>)        大型网络<br>B    <span class="hljs-number">128</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> - <span class="hljs-number">191</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>  /<span class="hljs-number">16</span> (<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>)     中型网络<br>C    <span class="hljs-number">192</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> - <span class="hljs-number">223</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>  /<span class="hljs-number">24</span> (<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">0</span>)   小型网络<br><br>私有IP：<br><span class="hljs-number">10.0.0.0</span>/<span class="hljs-number">8</span>         (<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> - <span class="hljs-number">10</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>)<br><span class="hljs-number">172.16.0.0</span>/<span class="hljs-number">12</span>      (<span class="hljs-number">172</span>.<span class="hljs-number">16</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> - <span class="hljs-number">172</span>.<span class="hljs-number">31</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>)<br><span class="hljs-number">192.168.0.0</span>/<span class="hljs-number">16</span>     (<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> - <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>)<br><br>特殊IP：<br><span class="hljs-number">127.0.0.1</span>          环回地址（本机）<br><span class="hljs-number">0.0.0.0</span>            所有地址/未知地址<br><span class="hljs-number">255.255.255.255</span>    广播地址<br></code></pre></td></tr></table></figure><p><strong>子网划分快速计算</strong>：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">CIDR    掩码              主机数    子网数（从<span class="hljs-string">/24</span>划分）<br><span class="hljs-string">/24</span>     255.255.255.0     254       1<br><span class="hljs-string">/25</span>     255.255.255.128   126       2<br><span class="hljs-string">/26</span>     255.255.255.192   62        4<br><span class="hljs-string">/27</span>     255.255.255.224   30        8<br><span class="hljs-string">/28</span>     255.255.255.240   14        16<br><span class="hljs-string">/29</span>     255.255.255.248   6         32<br><span class="hljs-string">/30</span>     255.255.255.252   2         64（用于点对点）<br><br>主机数计算：2^<span class="hljs-params">(32-CIDR)</span> - 2<br></code></pre></td></tr></table></figure><h3 id="2-3-ARP协议">2.3 ARP协议</h3><p><strong>ARP工作流程</strong>：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs ruby">场景：主机A (<span class="hljs-number">192.168</span>.<span class="hljs-number">1.10</span>) 想发送数据给主机B (<span class="hljs-number">192.168</span>.<span class="hljs-number">1.20</span>)<br><br>步骤<span class="hljs-number">1</span>：检查<span class="hljs-variable constant_">ARP</span>缓存<br>    arp -a<br>    → 如果有B的<span class="hljs-variable constant_">MAC</span>地址，直接使用<br>    → 如果没有，进行<span class="hljs-variable constant_">ARP</span>请求<br><br>步骤<span class="hljs-number">2</span>：广播<span class="hljs-variable constant_">ARP</span>请求<br>    源<span class="hljs-variable constant_">MAC</span>: <span class="hljs-variable constant_">AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span> (主机A)<br>    目标<span class="hljs-variable constant_">MAC</span>: <span class="hljs-variable constant_">FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span> (广播)<br>    内容: <span class="hljs-string">&quot;谁是192.168.1.20？请告诉192.168.1.10&quot;</span><br><br>步骤<span class="hljs-number">3</span>：目标主机回应<br>    源<span class="hljs-variable constant_">MAC</span>: <span class="hljs-variable constant_">BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span> (主机B)<br>    目标<span class="hljs-variable constant_">MAC</span>: <span class="hljs-variable constant_">AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span> (主机A)<br>    内容: <span class="hljs-string">&quot;192.168.1.20是我，我的MAC是BB:BB:BB:BB:BB:BB&quot;</span><br><br>步骤<span class="hljs-number">4</span>：更新<span class="hljs-variable constant_">ARP</span>缓存<br>    <span class="hljs-number">192.168</span>.<span class="hljs-number">1.20</span> → <span class="hljs-variable constant_">BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span> (保存在缓存中)<br><br>步骤<span class="hljs-number">5</span>：发送数据<br>    现在可以直接发送数据了<br></code></pre></td></tr></table></figure><h3 id="2-4-DNS工作原理">2.4 DNS工作原理</h3><p><strong>DNS查询流程</strong>：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs armasm">用户访问 www.example.com<br><br><span class="hljs-number">1</span>. 浏览器检查缓存<br>   浏览器缓存 → 操作系统缓存 → hosts文件<br><br><span class="hljs-number">2</span>. 如果缓存未命中，向本地DNS服务器查询<br>   客户端 → 本地DNS (<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>)<br><br><span class="hljs-number">3</span>. 本地DNS递归查询<br>   ┌──────────────────────────────────────┐<br>   │ 本地DNS → 根DNS服务器 (.)            │<br>   │     <span class="hljs-string">&quot;example.com在哪？&quot;</span>              │<br>   │     ← <span class="hljs-string">&quot;去问.com的DNS服务器&quot;</span>          │<br>   │                                      │<br>   │ 本地DNS → .com顶级DNS                │<br>   │     <span class="hljs-string">&quot;example.com在哪？&quot;</span>              │<br>   │     ← <span class="hljs-string">&quot;去问example.com的权威DNS&quot;</span>     │<br>   │                                      │<br>   │ 本地DNS → example.com权威DNS         │<br>   │     <span class="hljs-string">&quot;www.example.com的IP是？&quot;</span>        │<br>   │     ← <span class="hljs-string">&quot;IP是93.184.216.34&quot;</span>            │<br>   └──────────────────────────────────────┘<br><br><span class="hljs-number">4</span>. 本地DNS返回结果给客户端<br><span class="hljs-symbol">   IP:</span> <span class="hljs-number">93</span>.<span class="hljs-number">184</span>.<span class="hljs-number">216</span>.<span class="hljs-number">34</span><br><br><span class="hljs-number">5</span>. 浏览器使用该<span class="hljs-built_in">IP</span>建立连接<br>   HTTP <span class="hljs-meta">GET</span> http:<span class="hljs-comment">//93.184.216.34/</span><br></code></pre></td></tr></table></figure><h3 id="2-5-DHCP工作原理">2.5 DHCP工作原理</h3><p><strong>DHCP四次握手（DORA）</strong>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">D</span> - Discover  发现<br>O - Offer     提供<br>R - Request   请求<br>A - Ack       确认<br><br>场景：新电脑接入网络<br><br><span class="hljs-number">1</span>. DHCP Discover (广播)<br>   客户端: <span class="hljs-string">&quot;有DHCP服务器吗？我需要IP地址！&quot;</span><br>   源IP: <span class="hljs-number">0.0.0.0</span><br>   目标IP: <span class="hljs-number">255.255.255.255</span><br>   目标MAC: FF:FF:FF:FF:FF:FF<br><br><span class="hljs-number">2</span>. DHCP Offer (单播)<br>   服务器: <span class="hljs-string">&quot;我是DHCP服务器，可以给你192.168.1.100&quot;</span><br>   提供: IP=<span class="hljs-number">192.168.1.100</span>, 掩码=<span class="hljs-number">255.255.255.0</span>, 网关=<span class="hljs-number">192.168.1.1</span><br><br><span class="hljs-number">3</span>. DHCP Request (广播)<br>   客户端: <span class="hljs-string">&quot;我接受192.168.1.100这个地址&quot;</span><br>   （广播是为了告诉其他DHCP服务器这个IP被占用了）<br><br><span class="hljs-number">4</span>. DHCP Ack (单播)<br>   服务器: <span class="hljs-string">&quot;确认分配给你192.168.1.100，租期24小时&quot;</span><br>   包含: IP、掩码、网关、DNS、租期<br><br>配置完成！客户端现在可以上网了。<br></code></pre></td></tr></table></figure><hr><h2 id="3-综合实战项目：网络配置检测工具">3. 综合实战项目：网络配置检测工具</h2><h3 id="3-1-项目需求">3.1 项目需求</h3><p>创建一个命令行工具，能够：</p><ol><li>检测本机网络配置</li><li>测试网络连通性</li><li>DNS查询测试</li><li>生成诊断报告</li></ol><h3 id="3-2-代码实现">3.2 代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day14_network_inspector.py</span><br><span class="hljs-comment"># 功能：综合网络配置检测工具</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> platform<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkInspector</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    网络配置检测工具</span><br><span class="hljs-string"></span><br><span class="hljs-string">    功能：</span><br><span class="hljs-string">        1. 获取本机网络配置</span><br><span class="hljs-string">        2. 测试网络连通性</span><br><span class="hljs-string">        3. DNS解析测试</span><br><span class="hljs-string">        4. 生成诊断报告</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.system = platform.system()<br>        <span class="hljs-variable language_">self</span>.report = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_to_report</span>(<span class="hljs-params">self, section: <span class="hljs-built_in">str</span>, content: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;添加内容到报告&quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.report.append(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">60</span>&#125;</span>&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.report.append(<span class="hljs-string">f&quot; <span class="hljs-subst">&#123;section&#125;</span>&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.report.append(<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">60</span>)<br>        <span class="hljs-variable language_">self</span>.report.append(content)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ip</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        获取本机IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回值：</span><br><span class="hljs-string">            本机IP地址字符串</span><br><span class="hljs-string"></span><br><span class="hljs-string">        工作原理：</span><br><span class="hljs-string">            创建UDP socket连接到外部地址（不实际发送数据）</span><br><span class="hljs-string">            从socket获取本机使用的IP地址</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 创建UDP socket</span><br>            s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)<br>            <span class="hljs-comment"># 连接到外部地址（Google DNS）</span><br>            s.connect((<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-number">80</span>))<br>            <span class="hljs-comment"># 获取socket使用的本地IP</span><br>            local_ip = s.getsockname()[<span class="hljs-number">0</span>]<br>            s.close()<br>            <span class="hljs-keyword">return</span> local_ip<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;获取失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_hostname</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;获取主机名&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> socket.gethostname()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_network_interfaces</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        获取网络接口信息</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回值：</span><br><span class="hljs-string">            包含接口信息的字典</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        interfaces = &#123;&#125;<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 获取主机名对应的所有IP地址</span><br>            hostname = socket.gethostname()<br>            local_ips = socket.gethostbyname_ex(hostname)[<span class="hljs-number">2</span>]<br><br>            interfaces[<span class="hljs-string">&#x27;主机名&#x27;</span>] = hostname<br>            interfaces[<span class="hljs-string">&#x27;本机IP&#x27;</span>] = <span class="hljs-variable language_">self</span>.get_local_ip()<br>            interfaces[<span class="hljs-string">&#x27;所有IP&#x27;</span>] = <span class="hljs-string">&#x27;, &#x27;</span>.join(local_ips)<br><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            interfaces[<span class="hljs-string">&#x27;错误&#x27;</span>] = <span class="hljs-built_in">str</span>(e)<br><br>        <span class="hljs-keyword">return</span> interfaces<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_connectivity</span>(<span class="hljs-params">self, host: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;8.8.8.8&quot;</span>, port: <span class="hljs-built_in">int</span> = <span class="hljs-number">53</span></span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">str</span>]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        测试网络连通性</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            host: 目标主机</span><br><span class="hljs-string">            port: 目标端口</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回值：</span><br><span class="hljs-string">            (是否连通, 详细信息)</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 尝试建立TCP连接</span><br>            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>            sock.settimeout(<span class="hljs-number">3</span>)<br>            start_time = socket.time.time()<br>            result = sock.connect_ex((host, port))<br>            end_time = socket.time.time()<br>            sock.close()<br><br>            <span class="hljs-keyword">if</span> result == <span class="hljs-number">0</span>:<br>                latency = (end_time - start_time) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># 转换为毫秒</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">f&quot;✅ 连接成功 (<span class="hljs-subst">&#123;host&#125;</span>:<span class="hljs-subst">&#123;port&#125;</span>) - 延迟: <span class="hljs-subst">&#123;latency:<span class="hljs-number">.2</span>f&#125;</span>ms&quot;</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">f&quot;❌ 连接失败 (<span class="hljs-subst">&#123;host&#125;</span>:<span class="hljs-subst">&#123;port&#125;</span>)&quot;</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">f&quot;❌ 连接异常: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_dns</span>(<span class="hljs-params">self, domain: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;www.baidu.com&quot;</span></span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">str</span>]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        测试DNS解析</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            domain: 要解析的域名</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回值：</span><br><span class="hljs-string">            (是否成功, 详细信息)</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            start_time = socket.time.time()<br>            ip = socket.gethostbyname(domain)<br>            end_time = socket.time.time()<br><br>            query_time = (end_time - start_time) * <span class="hljs-number">1000</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">f&quot;✅ DNS解析成功\n   <span class="hljs-subst">&#123;domain&#125;</span> → <span class="hljs-subst">&#123;ip&#125;</span>\n   查询时间: <span class="hljs-subst">&#123;query_time:<span class="hljs-number">.2</span>f&#125;</span>ms&quot;</span><br>        <span class="hljs-keyword">except</span> socket.gaierror <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">f&quot;❌ DNS解析失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">f&quot;❌ DNS查询异常: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_default_gateway</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        获取默认网关</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回值：</span><br><span class="hljs-string">            默认网关IP地址</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.system == <span class="hljs-string">&quot;Windows&quot;</span>:<br>                result = subprocess.run(<br>                    [<span class="hljs-string">&#x27;ipconfig&#x27;</span>],<br>                    capture_output=<span class="hljs-literal">True</span>,<br>                    text=<span class="hljs-literal">True</span><br>                )<br>                output = result.stdout<br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> output.split(<span class="hljs-string">&#x27;\n&#x27;</span>):<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;默认网关&#x27;</span> <span class="hljs-keyword">in</span> line <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;Default Gateway&#x27;</span> <span class="hljs-keyword">in</span> line:<br>                        parts = line.split(<span class="hljs-string">&#x27;:&#x27;</span>)<br>                        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt; <span class="hljs-number">1</span>:<br>                            gateway = parts[<span class="hljs-number">1</span>].strip()<br>                            <span class="hljs-keyword">if</span> gateway <span class="hljs-keyword">and</span> gateway != <span class="hljs-string">&#x27;&#x27;</span>:<br>                                <span class="hljs-keyword">return</span> gateway<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># Linux/Mac</span><br>                result = subprocess.run(<br>                    [<span class="hljs-string">&#x27;ip&#x27;</span>, <span class="hljs-string">&#x27;route&#x27;</span>],<br>                    capture_output=<span class="hljs-literal">True</span>,<br>                    text=<span class="hljs-literal">True</span><br>                )<br>                output = result.stdout<br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> output.split(<span class="hljs-string">&#x27;\n&#x27;</span>):<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;default&#x27;</span> <span class="hljs-keyword">in</span> line:<br>                        parts = line.split()<br>                        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt; <span class="hljs-number">2</span>:<br>                            <span class="hljs-keyword">return</span> parts[<span class="hljs-number">2</span>]<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;未找到&quot;</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;获取失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_full_inspection</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        运行完整的网络检测</span><br><span class="hljs-string"></span><br><span class="hljs-string">        工作流程：</span><br><span class="hljs-string">            1. 获取本机网络配置</span><br><span class="hljs-string">            2. 测试本地连通性</span><br><span class="hljs-string">            3. 测试外网连通性</span><br><span class="hljs-string">            4. 测试DNS解析</span><br><span class="hljs-string">            5. 生成诊断报告</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; 网络配置检测工具 - Network Inspector&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span>)<br><br>        <span class="hljs-comment"># 1. 本机配置</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[1/5] 正在获取本机网络配置...&quot;</span>)<br>        interfaces = <span class="hljs-variable language_">self</span>.get_network_interfaces()<br>        gateway = <span class="hljs-variable language_">self</span>.get_default_gateway()<br><br>        config_info = []<br>        config_info.append(<span class="hljs-string">f&quot;主机名:    <span class="hljs-subst">&#123;interfaces.get(<span class="hljs-string">&#x27;主机名&#x27;</span>, <span class="hljs-string">&#x27;未知&#x27;</span>)&#125;</span>&quot;</span>)<br>        config_info.append(<span class="hljs-string">f&quot;本机IP:    <span class="hljs-subst">&#123;interfaces.get(<span class="hljs-string">&#x27;本机IP&#x27;</span>, <span class="hljs-string">&#x27;未知&#x27;</span>)&#125;</span>&quot;</span>)<br>        config_info.append(<span class="hljs-string">f&quot;默认网关:  <span class="hljs-subst">&#123;gateway&#125;</span>&quot;</span>)<br>        config_info.append(<span class="hljs-string">f&quot;操作系统:  <span class="hljs-subst">&#123;self.system&#125;</span>&quot;</span>)<br><br>        <span class="hljs-variable language_">self</span>.add_to_report(<span class="hljs-string">&quot;本机网络配置&quot;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>.join(config_info))<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> config_info:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;line&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># 2. 测试网关连通性</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[2/5] 正在测试网关连通性...&quot;</span>)<br>        <span class="hljs-keyword">if</span> gateway != <span class="hljs-string">&quot;未找到&quot;</span> <span class="hljs-keyword">and</span> gateway != <span class="hljs-string">&quot;获取失败&quot;</span>:<br>            success, msg = <span class="hljs-variable language_">self</span>.test_connectivity(gateway, <span class="hljs-number">80</span>)<br>            <span class="hljs-variable language_">self</span>.add_to_report(<span class="hljs-string">&quot;网关连通性测试&quot;</span>, msg)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;msg&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            msg = <span class="hljs-string">&quot;❌ 无法获取网关，跳过测试&quot;</span><br>            <span class="hljs-variable language_">self</span>.add_to_report(<span class="hljs-string">&quot;网关连通性测试&quot;</span>, msg)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;msg&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># 3. 测试外网连通性</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[3/5] 正在测试外网连通性...&quot;</span>)<br>        test_hosts = [<br>            (<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-number">53</span>, <span class="hljs-string">&quot;Google DNS&quot;</span>),<br>            (<span class="hljs-string">&quot;114.114.114.114&quot;</span>, <span class="hljs-number">53</span>, <span class="hljs-string">&quot;114 DNS&quot;</span>),<br>            (<span class="hljs-string">&quot;1.1.1.1&quot;</span>, <span class="hljs-number">53</span>, <span class="hljs-string">&quot;Cloudflare DNS&quot;</span>)<br>        ]<br><br>        connectivity_results = []<br>        <span class="hljs-keyword">for</span> host, port, name <span class="hljs-keyword">in</span> test_hosts:<br>            success, msg = <span class="hljs-variable language_">self</span>.test_connectivity(host, port)<br>            connectivity_results.append(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;name&#125;</span>: <span class="hljs-subst">&#123;msg&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;msg&#125;</span>&quot;</span>)<br><br>        <span class="hljs-variable language_">self</span>.add_to_report(<span class="hljs-string">&quot;外网连通性测试&quot;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>.join(connectivity_results))<br><br>        <span class="hljs-comment"># 4. 测试DNS</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[4/5] 正在测试DNS解析...&quot;</span>)<br>        test_domains = [<br>            <span class="hljs-string">&quot;www.baidu.com&quot;</span>,<br>            <span class="hljs-string">&quot;www.google.com&quot;</span>,<br>            <span class="hljs-string">&quot;www.github.com&quot;</span><br>        ]<br><br>        dns_results = []<br>        <span class="hljs-keyword">for</span> domain <span class="hljs-keyword">in</span> test_domains:<br>            success, msg = <span class="hljs-variable language_">self</span>.test_dns(domain)<br>            dns_results.append(msg)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;msg&#125;</span>&quot;</span>)<br><br>        <span class="hljs-variable language_">self</span>.add_to_report(<span class="hljs-string">&quot;DNS解析测试&quot;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>.join(dns_results))<br><br>        <span class="hljs-comment"># 5. 生成诊断建议</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[5/5] 正在生成诊断报告...&quot;</span>)<br>        diagnosis = <span class="hljs-variable language_">self</span>.generate_diagnosis()<br>        <span class="hljs-variable language_">self</span>.add_to_report(<span class="hljs-string">&quot;诊断建议&quot;</span>, diagnosis)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_diagnosis</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        生成诊断建议</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回值：</span><br><span class="hljs-string">            诊断建议字符串</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        suggestions = []<br><br>        <span class="hljs-comment"># 检查报告中的问题</span><br>        report_text = <span class="hljs-string">&#x27;\n&#x27;</span>.join(<span class="hljs-variable language_">self</span>.report)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;连接失败&#x27;</span> <span class="hljs-keyword">in</span> report_text <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;连接异常&#x27;</span> <span class="hljs-keyword">in</span> report_text:<br>            suggestions.append(<span class="hljs-string">&quot;⚠️  检测到网络连接问题：&quot;</span>)<br>            suggestions.append(<span class="hljs-string">&quot;   1. 检查网线或WiFi连接&quot;</span>)<br>            suggestions.append(<span class="hljs-string">&quot;   2. 检查防火墙设置&quot;</span>)<br>            suggestions.append(<span class="hljs-string">&quot;   3. 尝试重启路由器&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;DNS解析失败&#x27;</span> <span class="hljs-keyword">in</span> report_text:<br>            suggestions.append(<span class="hljs-string">&quot;\n⚠️  检测到DNS解析问题：&quot;</span>)<br>            suggestions.append(<span class="hljs-string">&quot;   1. 检查DNS服务器配置&quot;</span>)<br>            suggestions.append(<span class="hljs-string">&quot;   2. 尝试使用公共DNS (8.8.8.8)&quot;</span>)<br>            suggestions.append(<span class="hljs-string">&quot;   3. 清除DNS缓存&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> suggestions:<br>            suggestions.append(<span class="hljs-string">&quot;✅ 网络状态良好，未发现明显问题&quot;</span>)<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;\n&#x27;</span>.join(suggestions)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">print_report</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;打印完整报告&quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; 完整诊断报告&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span>)<br><br>        <span class="hljs-keyword">for</span> section <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.report:<br>            <span class="hljs-built_in">print</span>(section)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; 报告结束&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span> + <span class="hljs-string">&quot;\n&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_report</span>(<span class="hljs-params">self, filename: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;network_report.txt&quot;</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        保存报告到文件</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            filename: 保存的文件名</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.write(<span class="hljs-string">&quot;网络配置检测报告\n&quot;</span>)<br>                f.write(<span class="hljs-string">f&quot;生成时间: <span class="hljs-subst">&#123;socket.time.ctime()&#125;</span>\n&quot;</span>)<br>                f.write(<span class="hljs-string">&#x27;\n&#x27;</span>.join(<span class="hljs-variable language_">self</span>.report))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n✅ 报告已保存到: <span class="hljs-subst">&#123;filename&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n❌ 保存报告失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;主程序&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ╔══════════════════════════════════════════════════════════╗</span><br><span class="hljs-string">    ║       网络配置检测工具 v1.0                               ║</span><br><span class="hljs-string">    ║       Network Configuration Inspector                    ║</span><br><span class="hljs-string">    ╚══════════════════════════════════════════════════════════╝</span><br><span class="hljs-string">    &quot;&quot;&quot;</span>)<br><br>    inspector = NetworkInspector()<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 运行完整检测</span><br>        inspector.run_full_inspection()<br><br>        <span class="hljs-comment"># 打印报告</span><br>        inspector.print_report()<br><br>        <span class="hljs-comment"># 保存报告</span><br>        save_option = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n是否保存报告到文件？(y/n): &quot;</span>).strip().lower()<br>        <span class="hljs-keyword">if</span> save_option == <span class="hljs-string">&#x27;y&#x27;</span>:<br>            filename = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入文件名 (默认: network_report.txt): &quot;</span>).strip()<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> filename:<br>                filename = <span class="hljs-string">&quot;network_report.txt&quot;</span><br>            inspector.save_report(filename)<br><br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n\n用户中断程序&quot;</span>)<br>        sys.exit(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n❌ 程序异常: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="3-3-运行示例">3.3 运行示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 运行程序</span><br>python code/day14/day14_network_inspector.py<br><br>输出示例：<br>╔══════════════════════════════════════════════════════════╗<br>║       网络配置检测工具 v1.0                               ║<br>║       Network Configuration Inspector                    ║<br>╚══════════════════════════════════════════════════════════╝<br><br>============================================================<br> 网络配置检测工具 - Network Inspector<br>============================================================<br><br>[1/5] 正在获取本机网络配置...<br>  主机名:    DESKTOP-ABC123<br>  本机IP:    192.168.1.100<br>  默认网关:  192.168.1.1<br>  操作系统:  Windows<br><br>[2/5] 正在测试网关连通性...<br>  ✅ 连接成功 (192.168.1.1:80) - 延迟: 1.23ms<br><br>[3/5] 正在测试外网连通性...<br>  ✅ 连接成功 (8.8.8.8:53) - 延迟: 15.67ms<br>  ✅ 连接成功 (114.114.114.114:53) - 延迟: 12.34ms<br>  ✅ 连接成功 (1.1.1.1:53) - 延迟: 18.90ms<br><br>[4/5] 正在测试DNS解析...<br>  ✅ DNS解析成功<br>     www.baidu.com → 39.156.66.10<br>     查询时间: 45.67ms<br>  ✅ DNS解析成功<br>     www.google.com → 172.217.160.68<br>     查询时间: 23.45ms<br>  ✅ DNS解析成功<br>     www.github.com → 20.205.243.166<br>     查询时间: 34.56ms<br><br>[5/5] 正在生成诊断报告...<br></code></pre></td></tr></table></figure><hr><h2 id="4-常见网络问题诊断">4. 常见网络问题诊断</h2><h3 id="4-1-问题诊断流程图">4.1 问题诊断流程图</h3><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dos">网络无法访问？<br>│<br>├─ 步骤<span class="hljs-number">1</span>: 检查物理连接<br>│   ├─ 网线是否插好？<br>│   ├─ WiFi是否连接？<br>│   └─ 网卡指示灯是否亮？<br>│<br>├─ 步骤<span class="hljs-number">2</span>: 检查IP配置<br>│   ├─ IP地址: <span class="hljs-built_in">ipconfig</span> / ip addr<br>│   ├─ 子网掩码正确？<br>│   ├─ 网关配置正确？<br>│   └─ DNS服务器配置正确？<br>│<br>├─ 步骤<span class="hljs-number">3</span>: <span class="hljs-built_in">Ping</span>测试<br>│   ├─ <span class="hljs-built_in">ping</span> <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> (本机)<br>│   ├─ <span class="hljs-built_in">ping</span> 网关<br>│   ├─ <span class="hljs-built_in">ping</span> DNS服务器<br>│   └─ <span class="hljs-built_in">ping</span> 外网IP (<span class="hljs-number">8</span>.<span class="hljs-number">8</span>.<span class="hljs-number">8</span>.<span class="hljs-number">8</span>)<br>│<br>├─ 步骤<span class="hljs-number">4</span>: DNS测试<br>│   ├─ nslookup www.baidu.com<br>│   └─ 检查DNS解析是否正常<br>│<br>└─ 步骤<span class="hljs-number">5</span>: 路由测试<br>    └─ traceroute/tracert 检查路径<br></code></pre></td></tr></table></figure><h3 id="4-2-常见问题和解决方案">4.2 常见问题和解决方案</h3><p><strong>问题1：获取不到IP地址（169.254.x.x）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">原因：<br>- DHCP服务器故障<br>- 网络线路问题<br>- DHCP服务未启动<br><br>解决方法：<br>1. 重启网卡<br>   <span class="hljs-comment"># Windows</span><br>   ipconfig /release<br>   ipconfig /renew<br><br>   <span class="hljs-comment"># Linux</span><br>   <span class="hljs-built_in">sudo</span> dhclient -r<br>   <span class="hljs-built_in">sudo</span> dhclient<br><br>2. 检查DHCP服务器<br>3. 手动配置静态IP<br></code></pre></td></tr></table></figure><p><strong>问题2：能Ping通IP但无法访问网站</strong></p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">原因：</span><br><span class="hljs-attribute">- DNS服务器故障</span><br><span class="hljs-attribute">- DNS配置错误</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">解决方法：</span><br><span class="hljs-attribute">1. 更换DNS服务器</span><br><span class="hljs-attribute">   Windows</span><span class="hljs-punctuation">:</span> <span class="hljs-string">网络适配器设置</span><br>   <span class="hljs-attribute">Linux</span><span class="hljs-punctuation">:</span> <span class="hljs-string">/etc/resolv.conf</span><br><br>   <span class="hljs-attribute">推荐DNS</span><span class="hljs-punctuation">:</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">8.8.8.8 (Google)</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">114.114.114.114 (114DNS)</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">1.1.1.1 (Cloudflare)</span><br><br>2. 清除DNS缓存<br>   <span class="hljs-comment"># Windows</span><br>   ipconfig /flushdns<br><br>   <span class="hljs-comment"># Linux</span><br>   sudo systemd-resolve --flush-caches<br></code></pre></td></tr></table></figure><p><strong>问题3：网速很慢</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs markdown">原因：<br><span class="hljs-bullet">-</span> 网络拥堵<br><span class="hljs-bullet">-</span> 带宽限制<br><span class="hljs-bullet">-</span> DNS解析慢<br><span class="hljs-bullet">-</span> 路由问题<br><br>诊断方法：<br><span class="hljs-bullet">1.</span> 测试带宽<br>   使用speedtest等工具<br><br><span class="hljs-bullet">2.</span> 检查延迟<br>   ping -n 100 网关<br>   检查平均延迟和抖动<br><br><span class="hljs-bullet">3.</span> 追踪路由<br>   tracert www.baidu.com<br>   查看哪一跳延迟高<br><br><span class="hljs-bullet">4.</span> 优化DNS<br>   更换更快的DNS服务器<br></code></pre></td></tr></table></figure><hr><h2 id="5-第一阶段技能清单">5. 第一阶段技能清单</h2><p>完成第一阶段后，你应该掌握：</p><h3 id="5-1-理论知识">5.1 理论知识</h3><ul><li>✅ 理解OSI七层模型和TCP/IP四层模型</li><li>✅ 掌握IP地址分类和子网划分</li><li>✅ 理解MAC地址和ARP协议</li><li>✅ 掌握DNS和DHCP工作原理</li><li>✅ 理解端口和Socket概念</li></ul><h3 id="5-2-工具使用">5.2 工具使用</h3><ul><li>✅ ping - 测试连通性</li><li>✅ traceroute/tracert - 追踪路由</li><li>✅ ipconfig/ifconfig - 查看网络配置</li><li>✅ nslookup/dig - DNS查询</li><li>✅ arp - 查看ARP缓存</li><li>✅ Wireshark - 抓包分析</li></ul><h3 id="5-3-编程能力">5.3 编程能力</h3><ul><li>✅ 使用Python socket库</li><li>✅ 实现网络连接检测</li><li>✅ 实现局域网扫描</li><li>✅ 实现简单的ping和traceroute</li><li>✅ 实现DNS查询工具</li></ul><h3 id="5-4-问题排查">5.4 问题排查</h3><ul><li>✅ 系统化的网络问题诊断流程</li><li>✅ 使用命令行工具排查问题</li><li>✅ 分析网络配置错误</li><li>✅ 解决常见网络问题</li></ul><hr><h2 id="6-今日练习">6. 今日练习</h2><h3 id="练习1：综合诊断">练习1：综合诊断</h3><p>运行day14的网络检测工具，分析输出结果，回答：</p><ol><li>你的本机IP地址是什么？属于哪一类？</li><li>默认网关是什么？</li><li>DNS解析速度如何？</li><li>是否存在网络问题？</li></ol><h3 id="练习2：子网划分">练习2：子网划分</h3><p>给定网络 192.168.10.0/24，划分为：</p><ol><li>4个相等的子网</li><li>计算每个子网的网络地址、广播地址、可用IP范围</li><li>选择CIDR表示法</li></ol><h3 id="练习3：故障排查">练习3：故障排查</h3><p>假设场景：</p><ul><li>能ping通192.168.1.1（网关）</li><li>能ping通8.8.8.8</li><li><a href="http://xn--www-7z8f502aym2co5o.baidu.com">无法访问www.baidu.com</a></li></ul><p>请使用所学的诊断方法，找出问题原因并给出解决方案。</p><h3 id="练习4：抓包分析">练习4：抓包分析</h3><p>使用Wireshark：</p><ol><li>抓取一次完整的DHCP四次握手</li><li>分析每个数据包的内容</li><li>识别DORA四个阶段</li><li>截图标注关键信息</li></ol><hr><h2 id="7-扩展学习">7. 扩展学习</h2><h3 id="7-1-推荐阅读">7.1 推荐阅读</h3><ul><li>RFC 791: Internet Protocol (IP)</li><li>RFC 826: Address Resolution Protocol (ARP)</li><li>RFC 792: Internet Control Message Protocol (ICMP)</li><li>RFC 2131: Dynamic Host Configuration Protocol (DHCP)</li><li>RFC 1035: Domain Names - Implementation and Specification (DNS)</li></ul><h3 id="7-2-在线资源">7.2 在线资源</h3><ul><li>Wireshark官方教程</li><li>子网划分在线计算器</li><li>网络协议分析案例</li></ul><h3 id="7-3-实践建议">7.3 实践建议</h3><ol><li>搭建虚拟实验环境（VirtualBox + 多台虚拟机）</li><li>配置不同的网络拓扑</li><li>模拟各种网络故障</li><li>练习问题诊断和解决</li></ol><hr><h2 id="8-下一阶段预告">8. 下一阶段预告</h2><h3 id="第二阶段：应用层协议深入（Day-15-27）">第二阶段：应用层协议深入（Day 15-27）</h3><p><strong>第3周：传输层协议基础</strong></p><ul><li>TCP协议详解</li><li>TCP可靠传输机制</li><li>UDP协议</li><li>Socket编程</li></ul><p><strong>第4周：网络层协议深入</strong></p><ul><li>IP协议深入</li><li>IPv6</li><li>ICMP详解</li><li>路由协议基础</li></ul><p>学习重点：</p><ul><li>深入理解TCP/IP核心协议</li><li>掌握Socket网络编程</li><li>学习网络层路由机制</li><li>完成更复杂的实战项目</li></ul><hr><h2 id="9-总结">9. 总结</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs armasm">第一阶段学习路径：<br><br>网络基础概念 → 协议分层模型 → 诊断工具<br>       ↓              ↓            ↓<br>   网络拓扑        OSI/TCP-<span class="hljs-built_in">IP</span>     ping/traceroute<br>                      ↓<br>              <span class="hljs-built_in">IP</span>地址和子网划分<br>                      ↓<br>              MAC地址和ARP<br>                      ↓<br>              DNS和DHCP<br>                      ↓<br>           综合实战：网络诊断工具<br><br>核心能力：<br>✅ 网络基础理论<br>✅ 协议工作原理<br>✅ 工具使用<br>✅ 编程实现<br>✅ 问题诊断<br><br>学习心得：<br>网络基础是所有网络技术的根基。<br>理解了<span class="hljs-built_in">IP</span>地址、子网划分、ARP、DNS这些基础概念，<br>就像掌握了网络世界的<span class="hljs-string">&quot;字母表&quot;</span>。<br><br>接下来我们将深入传输层和网络层，<br>学习TCP/<span class="hljs-built_in">IP</span>协议栈的核心机制。<br><br>继续加油！💪<br></code></pre></td></tr></table></figure><hr><p><strong>进度：14/120天（11.7%）</strong></p><p>恭喜完成第一阶段学习！你已经建立了扎实的网络基础知识。接下来的学习将更加深入和精彩，让我们继续前进！</p><hr><h2 id="附录：常用命令速查表">附录：常用命令速查表</h2><h3 id="Windows命令">Windows命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">ipconfig /all              <span class="hljs-comment"># 查看详细网络配置</span><br>ipconfig /release          <span class="hljs-comment"># 释放DHCP分配的IP</span><br>ipconfig /renew            <span class="hljs-comment"># 重新获取IP</span><br>ipconfig /flushdns         <span class="hljs-comment"># 清除DNS缓存</span><br>ipconfig /displaydns       <span class="hljs-comment"># 显示DNS缓存</span><br><br>ping &lt;IP&gt;                  <span class="hljs-comment"># 测试连通性</span><br>ping -t &lt;IP&gt;              <span class="hljs-comment"># 持续ping</span><br>tracert &lt;域名&gt;             <span class="hljs-comment"># 追踪路由</span><br>nslookup &lt;域名&gt;            <span class="hljs-comment"># DNS查询</span><br>arp -a                     <span class="hljs-comment"># 查看ARP缓存</span><br>netstat -an               <span class="hljs-comment"># 查看网络连接</span><br>route <span class="hljs-built_in">print</span>               <span class="hljs-comment"># 查看路由表</span><br></code></pre></td></tr></table></figure><h3 id="Linux-Mac命令">Linux/Mac命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip addr show              <span class="hljs-comment"># 查看网络配置</span><br>ip route show             <span class="hljs-comment"># 查看路由表</span><br>ifconfig                  <span class="hljs-comment"># 查看网络接口（旧）</span><br><br>ping &lt;IP&gt;                 <span class="hljs-comment"># 测试连通性</span><br>ping -c 4 &lt;IP&gt;           <span class="hljs-comment"># ping 4次</span><br>traceroute &lt;域名&gt;         <span class="hljs-comment"># 追踪路由</span><br>dig &lt;域名&gt;                <span class="hljs-comment"># DNS查询（详细）</span><br>nslookup &lt;域名&gt;           <span class="hljs-comment"># DNS查询（简单）</span><br><br>arp -a                    <span class="hljs-comment"># 查看ARP缓存</span><br>netstat -an              <span class="hljs-comment"># 查看网络连接</span><br>ss -tulpn                <span class="hljs-comment"># 查看监听端口</span><br><br><span class="hljs-built_in">sudo</span> dhclient -r         <span class="hljs-comment"># 释放IP</span><br><span class="hljs-built_in">sudo</span> dhclient            <span class="hljs-comment"># 获取IP</span><br><span class="hljs-built_in">sudo</span> systemd-resolve --flush-caches  <span class="hljs-comment"># 清除DNS缓存</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>13天：DHCP协议详解</title>
    <link href="/2025/11/10/13%E5%A4%A9%EF%BC%9ADHCP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/"/>
    <url>/2025/11/10/13%E5%A4%A9%EF%BC%9ADHCP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1>第13天：DHCP协议详解</h1><h2 id="今日目标">今日目标</h2><ul><li>理解DHCP的工作原理和作用</li><li>掌握DHCP四次握手过程</li><li>了解IP地址租约管理机制</li><li>学会分析DHCP数据包</li><li>实现DHCP服务器模拟器</li></ul><hr><h2 id="1-什么是DHCP？">1. 什么是DHCP？</h2><h3 id="1-1-DHCP的定义">1.1 DHCP的定义</h3><p><strong>DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）</strong> 是一种网络管理协议，用于自动分配IP地址和网络配置。</p><p><strong>生活类比</strong>：</p><ul><li>你去酒店入住，不需要自己决定住哪个房间</li><li>前台会自动分配一个空房间给你</li><li>退房后，房间可以分配给其他客人</li><li>DHCP就是网络中的&quot;前台&quot;，自动分配IP地址</li></ul><h3 id="1-2-为什么需要DHCP？">1.2 为什么需要DHCP？</h3><p><strong>没有DHCP的痛苦</strong>：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs armasm">场景<span class="hljs-number">1</span>：公司有<span class="hljs-number">100</span>台电脑<br>❌ 手动配置每台电脑的<span class="hljs-built_in">IP</span>地址<br>❌ 记录哪些<span class="hljs-built_in">IP</span>已被使用<br>❌ 避免<span class="hljs-built_in">IP</span>地址冲突<br>❌ 新员工入职需要IT手动配置<br>❌ 员工离职需要手动回收<span class="hljs-built_in">IP</span><br><br>时间成本：每台约<span class="hljs-number">10</span>分钟 × <span class="hljs-number">100</span>台 = <span class="hljs-number">1000</span>分钟<br></code></pre></td></tr></table></figure><p><strong>使用DHCP的好处</strong>：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs armasm">场景<span class="hljs-number">2</span>：配置DHCP服务器<br>✅ 电脑开机自动获取<span class="hljs-built_in">IP</span><br>✅ 无需人工干预<br>✅ 自动避免<span class="hljs-built_in">IP</span>冲突<br>✅ 新设备即插即用<br>✅ 离线设备自动回收<span class="hljs-built_in">IP</span><br><br>时间成本：配置一次DHCP服务器 ≈ <span class="hljs-number">30</span>分钟<br></code></pre></td></tr></table></figure><h3 id="1-3-DHCP能配置什么？">1.3 DHCP能配置什么？</h3><p>DHCP不仅分配IP地址，还会配置：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> IP地址           192.168.1.100<br><span class="hljs-bullet">2.</span> 子网掩码         255.255.255.0<br><span class="hljs-bullet">3.</span> 默认网关         192.168.1.1<br><span class="hljs-bullet">4.</span> DNS服务器        8.8.8.8, 114.114.114.114<br><span class="hljs-bullet">5.</span> 租约时间         24小时<br><span class="hljs-bullet">6.</span> WINS服务器       （可选）<br><span class="hljs-bullet">7.</span> 域名             example.com<br><span class="hljs-bullet">8.</span> NTP时间服务器    （可选）<br></code></pre></td></tr></table></figure><hr><h2 id="2-DHCP工作原理">2. DHCP工作原理</h2><h3 id="2-1-DHCP四次握手（DORA过程）">2.1 DHCP四次握手（DORA过程）</h3><p>DHCP获取IP地址需要四个步骤，称为<strong>DORA过程</strong>：</p><ol><li><strong>D</strong>iscover - 发现服务器</li><li><strong>O</strong>ffer - 提供地址</li><li><strong>R</strong>equest - 请求地址</li><li><strong>A</strong>ck - 确认分配</li></ol><p><strong>完整流程图</strong>：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">客户端                                    DHCP服务器<br>  |<span class="hljs-string">                                           </span>|<br>  |<span class="hljs-string">  1. DHCP Discover (广播)                 </span>|<br>  |<span class="hljs-string">  &quot;有DHCP服务器吗？我需要IP地址&quot;           </span>|<br>  |<span class="hljs-string">------------------------------------------&gt;</span>|<br>  |<span class="hljs-string">     源IP: 0.0.0.0                         </span>|<br>  |<span class="hljs-string">     目标IP: 255.255.255.255               </span>|<br>  |<span class="hljs-string">                                           </span>|<br>  |<span class="hljs-string">                                           </span>|<span class="hljs-string"> 检查可用IP</span><br><span class="hljs-string">  </span>|<span class="hljs-string">                                           </span>|<span class="hljs-string"> 找到: 192.168.1.100</span><br><span class="hljs-string">  </span>|<span class="hljs-string">                                           </span>|<br>  |<span class="hljs-string">  2. DHCP Offer (单播/广播)                </span>|<br>  |<span class="hljs-string">  &quot;我这里有个IP：192.168.1.100&quot;            </span>|<br>  |<span class="hljs-string">&lt;------------------------------------------</span>|<br>  |<span class="hljs-string">     源IP: 192.168.1.1                     </span>|<br>  |<span class="hljs-string">     提供IP: 192.168.1.100                 </span>|<br>  |<span class="hljs-string">                                           </span>|<br>  |<span class="hljs-string"> 决定接受这个IP                             </span>|<br>  |<span class="hljs-string">                                           </span>|<br>  |<span class="hljs-string">  3. DHCP Request (广播)                   </span>|<br>  |<span class="hljs-string">  &quot;我要192.168.1.100这个IP&quot;                </span>|<br>  |<span class="hljs-string">------------------------------------------&gt;</span>|<br>  |<span class="hljs-string">     请求IP: 192.168.1.100                 </span>|<br>  |<span class="hljs-string">                                           </span>|<br>  |<span class="hljs-string">                                           </span>|<span class="hljs-string"> 确认IP可用</span><br><span class="hljs-string">  </span>|<span class="hljs-string">                                           </span>|<span class="hljs-string"> 标记为已分配</span><br><span class="hljs-string">  </span>|<span class="hljs-string">                                           </span>|<br>  |<span class="hljs-string">  4. DHCP Ack (单播)                       </span>|<br>  |<span class="hljs-string">  &quot;好的，192.168.1.100归你了，租期24小时&quot;   </span>|<br>  |<span class="hljs-string">&lt;------------------------------------------</span>|<br>  |<span class="hljs-string">     确认IP: 192.168.1.100                 </span>|<br>  |<span class="hljs-string">     租期: 86400秒                          </span>|<br>  |<span class="hljs-string">                                           </span>|<br>  |<span class="hljs-string"> ✅ 配置IP地址                              </span>|<br>  |<span class="hljs-string"> ✅ 可以上网了                              </span>|<br>  |<span class="hljs-string">                                           </span>|<br></code></pre></td></tr></table></figure><h3 id="2-2-详细步骤解析">2.2 详细步骤解析</h3><p><strong>步骤1：DHCP Discover（发现）</strong></p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">客户端刚开机，还没有<span class="hljs-built_in">IP</span>地址<br><br>广播消息：<br>┌────────────────────────────────┐<br>│ 源MAC：  aa:bb:cc:<span class="hljs-built_in">dd</span>:ee:ff    │<br>│ 目标MAC：ff:ff:ff:ff:ff:ff    │ (广播)<br>│ 源<span class="hljs-built_in">IP</span>：   <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>               │ (还没有<span class="hljs-built_in">IP</span>)<br>│ 目标<span class="hljs-built_in">IP</span>： <span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.255</span>       │ (广播)<br>│ 消息：   我需要<span class="hljs-built_in">IP</span>地址！         │<br>│ 事务ID： <span class="hljs-number">0x12345678</span>            │ (用于匹配响应)<br>└────────────────────────────────┘<br><br>特点：<br>- 使用广播，因为不知道DHCP服务器在哪<br>- 源<span class="hljs-built_in">IP</span>是<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>，因为还没有<span class="hljs-built_in">IP</span>地址<br>- 包含客户端的MAC地址（用于识别）<br></code></pre></td></tr></table></figure><p><strong>步骤2：DHCP Offer（提供）</strong></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dns">服务器收到Discover后，从地址池中选择一个可用IP<br><br>单播/广播响应：<br>┌────────────────────────────────┐<br>│ 源IP：   <span class="hljs-number">192.168.1.1</span> (DHCP服务器) │<br>│ 目标IP： <span class="hljs-number">192.168.1.100</span> 或 广播   │<br>│ 提供IP： <span class="hljs-number">192.168.1.100</span>          │<br>│ 子网掩码：<span class="hljs-number">255.255.255.0</span>         │<br>│ 默认网关：<span class="hljs-number">192.168.1.1</span>           │<br>│ DNS：    <span class="hljs-number">8.8.8.8</span>                │<br>│ 租期：   <span class="hljs-number">86400</span>秒 (<span class="hljs-number">24</span>小时)       │<br>│ 事务ID： <span class="hljs-number">0x12345678</span> (匹配请求)  │<br>└────────────────────────────────┘<br><br>特点：<br>- 可能有多个DHCP服务器响应<br>- 提供IP但还没有分配<br>- 客户端可以选择接受哪个offer<br></code></pre></td></tr></table></figure><p><strong>步骤3：DHCP Request（请求）</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs armasm">客户端选择一个offer，正式请求该<span class="hljs-built_in">IP</span><br><br>广播消息：<br>┌────────────────────────────────┐<br>│ 源<span class="hljs-built_in">IP</span>：   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>               │ (仍然没有<span class="hljs-built_in">IP</span>)<br>│ 目标<span class="hljs-built_in">IP</span>： <span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>       │ (广播)<br>│ 请求<span class="hljs-built_in">IP</span>： <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">100</span>         │<br>│ 服务器： <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>           │<br>│ 消息：   我要这个<span class="hljs-built_in">IP</span>！           │<br>│ 事务ID： <span class="hljs-number">0x12345678</span>            │<br>└────────────────────────────────┘<br><br>为什么广播？<br>- 告诉所有DHCP服务器：<span class="hljs-string">&quot;我选择了192.168.1.1的offer&quot;</span><br>- 其他服务器可以回收它们提供的<span class="hljs-built_in">IP</span><br></code></pre></td></tr></table></figure><p><strong>步骤4：DHCP Ack（确认）</strong></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dns">服务器确认分配，客户端可以使用IP了<br><br>单播响应：<br>┌────────────────────────────────┐<br>│ 源IP：   <span class="hljs-number">192.168.1.1</span>           │<br>│ 目标IP： <span class="hljs-number">192.168.1.100</span>         │<br>│ 确认IP： <span class="hljs-number">192.168.1.100</span>         │<br>│ 租期：   <span class="hljs-number">86400</span>秒               │<br>│ 开始时间：<span class="hljs-number">2024-01-15</span> <span class="hljs-number">10</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>  │<br>│ 更新时间：<span class="hljs-number">2024-01-15</span> <span class="hljs-number">22</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>  │ (<span class="hljs-number">50</span>%租期)<br>│ 重绑时间：<span class="hljs-number">2024-01-16</span> <span class="hljs-number">04</span>:<span class="hljs-number">30</span>:<span class="hljs-number">00</span>  │ (<span class="hljs-number">87</span>.<span class="hljs-number">5</span>%租期)<br>│ 消息：   分配成功！             │<br>└────────────────────────────────┘<br><br>客户端收到Ack后：<br>✅ 配置IP地址：<span class="hljs-number">192.168.1.100</span><br>✅ 配置子网掩码：<span class="hljs-number">255.255.255.0</span><br>✅ 配置默认网关：<span class="hljs-number">192.168.1.1</span><br>✅ 配置DNS服务器：<span class="hljs-number">8.8.8.8</span><br>✅ 启动租约计时器<br></code></pre></td></tr></table></figure><h3 id="2-3-特殊情况">2.3 特殊情况</h3><p><strong>情况1：服务器拒绝（DHCP Nak）</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs armasm">原因：<br>- 请求的<span class="hljs-built_in">IP</span>已被其他设备占用<br>- <span class="hljs-built_in">IP</span>地址不在分配范围内<br>- 租约已过期且<span class="hljs-built_in">IP</span>被重新分配<br><br>流程：<br>客户端 → DHCP Request<br>服务器 → DHCP Nak (拒绝)<br>客户端 → 重新开始，发送 DHCP Discover<br></code></pre></td></tr></table></figure><p><strong>情况2：租约续期</strong></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs abnf">时间线（假设租期<span class="hljs-number">24</span>小时）：<br><br><span class="hljs-attribute">t</span><span class="hljs-operator">=</span><span class="hljs-number">0</span>h        获得IP地址<br><span class="hljs-attribute">t</span><span class="hljs-operator">=</span><span class="hljs-number">12</span>h (<span class="hljs-number">50</span>%) 尝试续期（直接向原服务器请求）<br><span class="hljs-attribute">t</span><span class="hljs-operator">=</span><span class="hljs-number">21</span>h (<span class="hljs-number">87.5</span>%) 如果续期失败，广播续期请求<br><span class="hljs-attribute">t</span><span class="hljs-operator">=</span><span class="hljs-number">24</span>h       租约到期，释放IP，重新DORA<br><br>续期过程（简化的DORA）：<br>客户端 → DHCP Request (续期请求)<br>服务器 → DHCP Ack (同意续期) 或 Nak (拒绝，重新DORA)<br></code></pre></td></tr></table></figure><p><strong>情况3：客户端重启</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs armasm">场景：客户端记得上次使用的<span class="hljs-built_in">IP</span><br><br>快速重连：<br>客户端 → DHCP Request (直接请求上次的<span class="hljs-built_in">IP</span>)<br>        源<span class="hljs-built_in">IP</span>: <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br>        请求<span class="hljs-built_in">IP</span>: <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">100</span> (上次的)<br><br>服务器 → DHCP Ack (如果<span class="hljs-built_in">IP</span>仍然可用)<br>     或 DHCP Nak (<span class="hljs-built_in">IP</span>已被占用，重新DORA)<br><br>优点：<br>- 跳过Discover和Offer<br>- 更快获得网络连接<br>- 减少网络流量<br></code></pre></td></tr></table></figure><hr><h2 id="3-DHCP报文格式">3. DHCP报文格式</h2><h3 id="3-1-DHCP报文结构">3.1 DHCP报文结构</h3><p>DHCP基于<strong>BOOTP协议</strong>，使用UDP传输：</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs erlang">UDP端口：<br>- 客户端端口：68<br>- 服务器端口：67<br><br>报文格式（最小236字节）：<br>┌─────────────────────────────────────┐<br>│ Op <span class="hljs-params">(<span class="hljs-number">1</span>字节)</span>         操作码            │ 1=请求, 2=响应<br>│ HType <span class="hljs-params">(<span class="hljs-number">1</span>字节)</span>      硬件类型          │ 1=以太网<br>│ HLen <span class="hljs-params">(<span class="hljs-number">1</span>字节)</span>       硬件地址长度      │ 6=MAC地址<br>│ Hops <span class="hljs-params">(<span class="hljs-number">1</span>字节)</span>       跳数              │ 中继计数<br>├─────────────────────────────────────┤<br>│ Transaction ID <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span> 事务ID        │ 随机数，匹配请求和响应<br>├─────────────────────────────────────┤<br>│ Seconds <span class="hljs-params">(<span class="hljs-number">2</span>字节)</span>    开机秒数          │ 客户端开机后的秒数<br>│ Flags <span class="hljs-params">(<span class="hljs-number">2</span>字节)</span>      标志位            │ 广播标志等<br>├─────────────────────────────────────┤<br>│ Client IP <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span>  客户端IP          │ 续期时使用<br>│ Your IP <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span>    你的IP            │ 服务器分配的IP<br>│ Server IP <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span>  服务器IP          │ DHCP服务器地址<br>│ Gateway IP <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span> 网关IP            │ 中继代理地址<br>├─────────────────────────────────────┤<br>│ Client MAC <span class="hljs-params">(<span class="hljs-number">16</span>字节)</span> 客户端硬件地址   │ 前6字节是MAC<br>├─────────────────────────────────────┤<br>│ Server Name <span class="hljs-params">(<span class="hljs-number">64</span>字节)</span> 服务器名称      │ 可选<br>│ Boot File <span class="hljs-params">(<span class="hljs-number">128</span>字节)</span>  启动文件名      │ 可选<br>├─────────────────────────────────────┤<br>│ Magic Cookie <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span> 魔术字          │ 0x63825363<br>├─────────────────────────────────────┤<br>│ Options <span class="hljs-params">(可变)</span>     选项字段          │ DHCP消息类型、参数等<br>└─────────────────────────────────────┘<br></code></pre></td></tr></table></figure><h3 id="3-2-重要选项（Options）">3.2 重要选项（Options）</h3><p>DHCP的核心功能在Options字段：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs less">格式：<span class="hljs-selector-attr">[选项代码]</span><span class="hljs-selector-attr">[长度]</span><span class="hljs-selector-attr">[数据]</span><br><br>常用选项：<br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">53</span> (DHCP消息类型) <span class="hljs-selector-tag">-</span> <span class="hljs-number">1</span>字节<br>├── <span class="hljs-number">1</span>: <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Discover</span><br>├── <span class="hljs-number">2</span>: <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Offer</span><br>├── <span class="hljs-number">3</span>: <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Request</span><br>├── <span class="hljs-number">4</span>: <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Decline</span> (拒绝)<br>├── <span class="hljs-number">5</span>: <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Ack</span><br>├── <span class="hljs-number">6</span>: <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Nak</span> (否认)<br>├── <span class="hljs-number">7</span>: <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Release</span> (释放)<br>└── <span class="hljs-number">8</span>: <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Inform</span> (通知)<br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">1</span> (子网掩码) <span class="hljs-selector-tag">-</span> <span class="hljs-number">4</span>字节<br>└── <span class="hljs-number">255.255</span><span class="hljs-selector-class">.255</span><span class="hljs-selector-class">.0</span><br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">3</span> (默认网关) <span class="hljs-selector-tag">-</span> <span class="hljs-number">4</span>字节×<span class="hljs-selector-tag">n</span><br>└── <span class="hljs-number">192.168</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.1</span><br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">6</span> (DNS服务器) <span class="hljs-selector-tag">-</span> <span class="hljs-number">4</span>字节×<span class="hljs-selector-tag">n</span><br>├── <span class="hljs-number">8.8</span><span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.8</span><br>└── <span class="hljs-number">8.8</span><span class="hljs-selector-class">.4</span><span class="hljs-selector-class">.4</span><br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">51</span> (租约时间) <span class="hljs-selector-tag">-</span> <span class="hljs-number">4</span>字节<br>└── <span class="hljs-number">86400</span> (秒)<br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">54</span> (DHCP服务器标识) <span class="hljs-selector-tag">-</span> <span class="hljs-number">4</span>字节<br>└── <span class="hljs-number">192.168</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.1</span><br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">58</span> (T1续约时间) <span class="hljs-selector-tag">-</span> <span class="hljs-number">4</span>字节<br>└── <span class="hljs-number">43200</span> (<span class="hljs-number">50%</span>租期)<br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">59</span> (T2重绑时间) <span class="hljs-selector-tag">-</span> <span class="hljs-number">4</span>字节<br>└── <span class="hljs-number">75600</span> (<span class="hljs-number">87.5%</span>租期)<br><br><span class="hljs-selector-tag">Option</span> <span class="hljs-number">255</span> (结束标记)<br>└── 选项结束<br></code></pre></td></tr></table></figure><h3 id="3-3-报文示例">3.3 报文示例</h3><p><strong>DHCP Discover报文</strong>：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">┌─────────────────────────────────────┐</span><br><span class="hljs-attribute">│ Op</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1 (请求)                         │</span><br><span class="hljs-attribute">│ HType</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1 (以太网)                    │</span><br><span class="hljs-attribute">│ HLen</span><span class="hljs-punctuation">:</span> <span class="hljs-string">6                              │</span><br><span class="hljs-attribute">│ Hops</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0                              │</span><br><span class="hljs-attribute">│ Transaction ID</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0x3d1d6b                │</span><br><span class="hljs-attribute">│ Seconds</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0                           │</span><br><span class="hljs-attribute">│ Flags</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0x0000                        │</span><br><span class="hljs-attribute">│ Client IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.0.0.0                   │</span><br><span class="hljs-attribute">│ Your IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.0.0.0                     │</span><br><span class="hljs-attribute">│ Server IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.0.0.0                   │</span><br><span class="hljs-attribute">│ Gateway IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.0.0.0                  │</span><br><span class="hljs-attribute">│ Client MAC</span><span class="hljs-punctuation">:</span> <span class="hljs-string">aa:bb:cc:dd:ee:ff        │</span><br><span class="hljs-attribute">│ Magic Cookie</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0x63825363             │</span><br><span class="hljs-attribute">│ Options</span><span class="hljs-punctuation">:</span> <span class="hljs-string">                            │</span><br><span class="hljs-attribute">│   - Option 53</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1 (Discover)          │</span><br><span class="hljs-attribute">│   - Option 55</span><span class="hljs-punctuation">:</span> <span class="hljs-string">请求参数列表           │</span><br><span class="hljs-attribute">│     (1,3,6,15,51,54,58,59)          │</span><br><span class="hljs-attribute">│   - Option 255</span><span class="hljs-punctuation">:</span> <span class="hljs-string">End                  │</span><br>└─────────────────────────────────────┘<br></code></pre></td></tr></table></figure><hr><h2 id="4-IP地址租约管理">4. IP地址租约管理</h2><h3 id="4-1-租约生命周期">4.1 租约生命周期</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs scss">租约状态机：<br><br>    <span class="hljs-selector-attr">[无IP]</span><br>      ↓<br>   DHCP DORA<br>      ↓<br>   <span class="hljs-selector-attr">[已绑定]</span> ←──────┐<br>      ↓ (<span class="hljs-number">50%</span>租期)  │<br>   <span class="hljs-selector-attr">[续约中]</span> ────────┘ (续约成功)<br>      ↓ (失败)<br>   <span class="hljs-selector-attr">[重绑中]</span> ←──────┐<br>      ↓ (<span class="hljs-number">87.5%</span>租期)│<br>   <span class="hljs-selector-attr">[广播续约]</span> ──────┘ (续约成功)<br>      ↓ (失败)<br>   <span class="hljs-selector-attr">[租约过期]</span><br>      ↓<br>    释放IP<br>      ↓<br>   重新DORA<br></code></pre></td></tr></table></figure><h3 id="4-2-租约时间计算">4.2 租约时间计算</h3><p><strong>示例：租期24小时</strong></p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs excel">时间点计算：<br><br>租约开始：<span class="hljs-number">2024</span>-<span class="hljs-number">01</span>-<span class="hljs-number">15</span> <span class="hljs-symbol">10:00</span><span class="hljs-symbol">:00</span><br>租约时长：<span class="hljs-number">86400</span>秒 (<span class="hljs-number">24</span>小时)<br><br>┌──────────────────────────────────────────┐<br>│ <span class="hljs-number">0%</span>        <span class="hljs-number">50%</span>       <span class="hljs-number">87.5%</span>       <span class="hljs-number">100%</span>      │<br>│ │          │          │           │       │<br>│ ├──────────┼──────────┼───────────┤       │<br>│ │          │          │           │       │<br>│ <span class="hljs-symbol">10:00</span>    <span class="hljs-symbol">22:00</span>    <span class="hljs-symbol">04:30</span>       <span class="hljs-symbol">10:00</span>      │<br>│ 开始      <span class="hljs-symbol">T1</span>续约    <span class="hljs-symbol">T2</span>重绑      过期      │<br>└──────────────────────────────────────────┘<br><br><span class="hljs-symbol">T1</span> (Renewing <span class="hljs-built_in">Time</span>)<span class="hljs-symbol">:</span><br>= 开始时间 + 租期 × <span class="hljs-number">50%</span><br>= <span class="hljs-symbol">10:00</span> + <span class="hljs-number">12</span>小时<br>= <span class="hljs-symbol">22:00</span><br><br><span class="hljs-symbol">T2</span> (Rebinding <span class="hljs-built_in">Time</span>)<span class="hljs-symbol">:</span><br>= 开始时间 + 租期 × <span class="hljs-number">87.5%</span><br>= <span class="hljs-symbol">10:00</span> + <span class="hljs-number">21</span>小时<br>= <span class="hljs-symbol">04:30</span> (次日)<br><br>到期时间<span class="hljs-symbol">:</span><br>= 开始时间 + 租期<br>= <span class="hljs-symbol">10:00</span> + <span class="hljs-number">24</span>小时<br>= <span class="hljs-symbol">10:00</span> (次日)<br></code></pre></td></tr></table></figure><h3 id="4-3-租约管理策略">4.3 租约管理策略</h3><p><strong>服务器端地址池管理</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">地址池配置：<br>├── 网络：<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><br>├── 可用范围：<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span> - <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.200</span><br>├── 保留地址：<br>│   ├── <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span> (网关)<br>│   ├── <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.2</span> (DNS)<br>│   └── <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.10</span>-<span class="hljs-number">50</span> (静态IP)<br>└── DHCP池：<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>-<span class="hljs-number">200</span> (<span class="hljs-number">101</span>个地址)<br><br>分配策略：<br><span class="hljs-number">1.</span> 优先分配客户端上次使用的IP<br><span class="hljs-number">2.</span> 选择租约最早到期的IP<br><span class="hljs-number">3.</span> 避免刚释放的IP（等待<span class="hljs-number">2</span>分钟）<br><span class="hljs-number">4.</span> 记录每个IP的租约信息<br></code></pre></td></tr></table></figure><p><strong>客户端租约状态</strong>：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs subunit">租约数据库（示例）：<br><br>MAC地址            IP地址         租约开始            租约结束            状态<br>aa:bb:cc:dd:ee:ff  192.168.1.100  2024<span class="hljs-string">-01</span><span class="hljs-string">-15</span> 10:00   2024<span class="hljs-string">-01</span><span class="hljs-string">-16</span> 10:00   已分配<br>11:22:33:44:55:66  192.168.1.101  2024<span class="hljs-string">-01</span><span class="hljs-string">-15</span> 08:30   2024<span class="hljs-string">-01</span><span class="hljs-string">-16</span> 08:30   已分配<br>aa:aa:aa:aa:aa:aa  192.168.1.102  2024<span class="hljs-string">-01</span><span class="hljs-string">-14</span> 20:00   2024<span class="hljs-string">-01</span><span class="hljs-string">-15</span> 20:00   已过期<br></code></pre></td></tr></table></figure><hr><h2 id="5-DHCP中继代理">5. DHCP中继代理</h2><h3 id="5-1-为什么需要中继？">5.1 为什么需要中继？</h3><p><strong>问题</strong>：DHCP使用广播，但广播不能跨越路由器</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">场景：公司有多个子网</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">[子网1</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.1.0/24]</span><br>     <span class="hljs-attribute">↓</span><br><span class="hljs-attribute">  [路由器] ← 广播在这里被阻挡</span><br><span class="hljs-attribute">     ↓</span><br><span class="hljs-attribute">[子网2</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.2.0/24]  ← DHCP服务器在这里</span><br>     <span class="hljs-attribute">↓</span><br><span class="hljs-attribute">[子网3</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.3.0/24]</span><br><br>问题：<br><span class="hljs-bullet">-</span> <span class="hljs-string">子网1和子网3的客户端无法联系到子网2的DHCP服务器</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">需要每个子网都部署DHCP服务器？❌ 太麻烦</span><br></code></pre></td></tr></table></figure><p><strong>解决方案：DHCP Relay（中继代理）</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[子网1客户端]</span><br>     ↓ 广播 DHCP Discover<br><span class="hljs-string">[路由器/中继代理]</span><br>     ↓ 单播转发到DHCP服务器<br><span class="hljs-string">[子网2 DHCP服务器]</span><br>     ↓ 单播响应到中继代理<br><span class="hljs-string">[路由器/中继代理]</span><br>     ↓ 转发给客户端<br><span class="hljs-string">[子网1客户端]</span> ✅ 获得IP<br></code></pre></td></tr></table></figure><h3 id="5-2-中继工作流程">5.2 中继工作流程</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">1. 客户端广播 Discover</span><span class="hljs-punctuation">:</span><br>   <span class="hljs-attribute">源IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.0.0.0</span><br>   <span class="hljs-attribute">目标IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">255.255.255.255 (广播)</span><br><br><span class="hljs-attribute">2. 中继代理收到，修改报文</span><span class="hljs-punctuation">:</span><br>   <span class="hljs-attribute">源IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.1.1 (中继代理地址)</span><br>   <span class="hljs-attribute">目标IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.2.100 (DHCP服务器，单播)</span><br>   <span class="hljs-attribute">Gateway IP</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.1.1 (填入中继地址)</span><br>   <span class="hljs-attribute">Hops</span><span class="hljs-punctuation">:</span> <span class="hljs-string">增加1</span><br><br><span class="hljs-attribute">3. DHCP服务器处理</span><span class="hljs-punctuation">:</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">看到Gateway IP，知道客户端在子网1</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">从子网1的地址池分配IP</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">单播响应给中继代理</span><br><br><span class="hljs-attribute">4. 中继代理转发</span><span class="hljs-punctuation">:</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">将响应转发给客户端（广播或单播）</span><br></code></pre></td></tr></table></figure><hr><h2 id="6-实战项目：DHCP分析工具">6. 实战项目：DHCP分析工具</h2><h3 id="6-1-项目功能">6.1 项目功能</h3><p>我们将实现：</p><ol><li>DHCP报文构建器</li><li>DHCP报文解析器</li><li>模拟DHCP客户端</li><li>地址租约信息查看</li></ol><h3 id="6-2-工具演示">6.2 工具演示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看本机DHCP租约信息</span><br>python day13_dhcp_tool.py --show-lease<br><br><span class="hljs-comment"># 解析DHCP报文（从pcap文件）</span><br>python day13_dhcp_tool.py --parse capture.pcap<br><br><span class="hljs-comment"># 模拟DHCP Discover</span><br>python day13_dhcp_tool.py --discover<br><br><span class="hljs-comment"># 释放当前IP</span><br>python day13_dhcp_tool.py --release<br></code></pre></td></tr></table></figure><hr><h2 id="7-知识拓展">7. 知识拓展</h2><h3 id="7-1-查看DHCP信息的命令">7.1 查看DHCP信息的命令</h3><p><strong>Windows</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看DHCP租约信息</span><br>ipconfig /all<br><br>输出示例：<br>以太网适配器 以太网:<br>   DHCP 已启用: 是<br>   IPv4 地址: 192.168.1.100<br>   子网掩码: 255.255.255.0<br>   默认网关: 192.168.1.1<br>   DHCP 服务器: 192.168.1.1<br>   获得租约的时间: 2024年1月15日 10:00:00<br>   租约过期的时间: 2024年1月16日 10:00:00<br>   DNS 服务器: 8.8.8.8<br><br><span class="hljs-comment"># 释放IP地址</span><br>ipconfig /release<br><br><span class="hljs-comment"># 重新获取IP</span><br>ipconfig /renew<br></code></pre></td></tr></table></figure><p><strong>Linux</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看网卡配置</span><br>ip addr show<br>ifconfig<br><br><span class="hljs-comment"># 查看DHCP租约（不同发行版路径不同）</span><br><span class="hljs-built_in">cat</span> /var/lib/dhcp/dhclient.leases       <span class="hljs-comment"># Debian/Ubuntu</span><br><span class="hljs-built_in">cat</span> /var/lib/dhclient/dhclient.leases   <span class="hljs-comment"># CentOS/RHEL</span><br><br><span class="hljs-comment"># 释放和重新获取（使用dhclient）</span><br><span class="hljs-built_in">sudo</span> dhclient -r eth0  <span class="hljs-comment"># 释放</span><br><span class="hljs-built_in">sudo</span> dhclient eth0     <span class="hljs-comment"># 重新获取</span><br><br><span class="hljs-comment"># 查看DHCP客户端日志</span><br>journalctl -u NetworkManager | grep -i dhcp<br></code></pre></td></tr></table></figure><p><strong>Mac</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看网络配置</span><br>ifconfig<br><br><span class="hljs-comment"># 释放DHCP租约</span><br><span class="hljs-built_in">sudo</span> ipconfig <span class="hljs-built_in">set</span> en0 DHCP<br><br><span class="hljs-comment"># 查看DHCP详细信息</span><br>ipconfig getpacket en0<br></code></pre></td></tr></table></figure><h3 id="7-2-DHCP安全问题">7.2 DHCP安全问题</h3><p><strong>1. DHCP欺骗攻击</strong>：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">攻击场景：<br>┌──────────────────────────────────────┐<br>│ 1. 攻击者部署假DHCP服务器             │<br>│ 2. 客户端发送 Discover                │<br>│ 3. 假服务器快速响应 Offer              │<br>│    - 分配正常IP                       │<br>│    - 但网关指向攻击者                  │<br>│    - DNS指向攻击者                     │<br>│ 4. 客户端流量被劫持                   │<br>└──────────────────────────────────────┘<br><br>防护措施：<br><span class="hljs-bullet">- </span>DHCP Snooping（交换机特性）<br><span class="hljs-bullet">- </span>端口安全（只允许特定端口接收DHCP响应）<br><span class="hljs-bullet">- </span>802.1X认证<br></code></pre></td></tr></table></figure><p><strong>2. DHCP饿死攻击</strong>：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs markdown">攻击原理：<br><span class="hljs-bullet">1.</span> 攻击者伪造大量不同MAC地址<br><span class="hljs-bullet">2.</span> 快速请求IP地址<br><span class="hljs-bullet">3.</span> 耗尽DHCP地址池<br><span class="hljs-bullet">4.</span> 正常用户无法获得IP<br><br>防护：<br><span class="hljs-bullet">-</span> 限制端口的MAC地址数量<br><span class="hljs-bullet">-</span> DHCP地址池足够大<br><span class="hljs-bullet">-</span> 启用端口安全<br></code></pre></td></tr></table></figure><p><strong>3. 非法DHCP服务器</strong>：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">场景：<br><span class="hljs-bullet">- </span>员工私自接入路由器（启用DHCP）<br><span class="hljs-bullet">- </span>导致网络混乱<br><br>检测方法：<br><span class="hljs-bullet">- </span>监控网络中的DHCP响应<br><span class="hljs-bullet">- </span>使用DHCP Snooping<br><span class="hljs-bullet">- </span>定期扫描DHCP服务器<br></code></pre></td></tr></table></figure><h3 id="7-3-DHCP-vs-静态IP">7.3 DHCP vs 静态IP</h3><p><strong>对比表</strong>：</p><table><thead><tr><th>特性</th><th>DHCP（动态）</th><th>静态IP</th></tr></thead><tbody><tr><td><strong>配置方式</strong></td><td>自动获取</td><td>手动配置</td></tr><tr><td><strong>易用性</strong></td><td>✅ 简单，即插即用</td><td>❌ 需要手动配置</td></tr><tr><td><strong>管理成本</strong></td><td>✅ 低，集中管理</td><td>❌ 高，逐台配置</td></tr><tr><td><strong>IP冲突</strong></td><td>✅ 自动避免</td><td>❌ 可能冲突</td></tr><tr><td><strong>稳定性</strong></td><td>⚠️ 依赖DHCP服务器</td><td>✅ 不依赖服务器</td></tr><tr><td><strong>IP固定</strong></td><td>❌ 可能变化</td><td>✅ 永久不变</td></tr><tr><td><strong>适用场景</strong></td><td>普通客户端、移动设备</td><td>服务器、网络设备</td></tr></tbody></table><p><strong>推荐策略</strong>：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">使用静态IP：<br><span class="hljs-bullet">- </span>服务器（Web、DNS、DHCP等）<br><span class="hljs-bullet">- </span>网络设备（路由器、交换机）<br><span class="hljs-bullet">- </span>打印机、网络摄像头<br><span class="hljs-bullet">- </span>需要端口映射的设备<br><br>使用DHCP：<br><span class="hljs-bullet">- </span>普通办公电脑<br><span class="hljs-bullet">- </span>笔记本电脑<br><span class="hljs-bullet">- </span>移动设备（手机、平板）<br><span class="hljs-bullet">- </span>访客设备<br><br>混合方案：<br><span class="hljs-bullet">- </span>DHCP + 保留地址（根据MAC分配固定IP）<br><span class="hljs-code">  优点：既自动配置，又IP固定</span><br></code></pre></td></tr></table></figure><hr><h2 id="8-今日练习">8. 今日练习</h2><h3 id="练习1：查看本机DHCP信息">练习1：查看本机DHCP信息</h3><p>在你的电脑上查看：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 当前IP地址<br><span class="hljs-bullet">2.</span> DHCP服务器地址<br><span class="hljs-bullet">3.</span> 租约开始时间<br><span class="hljs-bullet">4.</span> 租约结束时间<br><span class="hljs-bullet">5.</span> DNS服务器地址<br><span class="hljs-bullet">6.</span> 默认网关地址<br></code></pre></td></tr></table></figure><h3 id="练习2：释放和重新获取IP">练习2：释放和重新获取IP</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">步骤：<br><span class="hljs-bullet">1.</span> 记录当前IP地址<br><span class="hljs-bullet">2.</span> 释放IP地址（ipconfig /release）<br><span class="hljs-bullet">3.</span> 观察网络状态（无法上网）<br><span class="hljs-bullet">4.</span> 重新获取IP（ipconfig /renew）<br><span class="hljs-bullet">5.</span> 对比前后IP是否相同<br><span class="hljs-bullet">6.</span> 分析为什么相同/不同<br></code></pre></td></tr></table></figure><h3 id="练习3：计算租约时间">练习3：计算租约时间</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown">已知：<br><span class="hljs-bullet">-</span> 租约开始：2024-01-15 14:00:00<br><span class="hljs-bullet">-</span> 租约时长：48小时<br><br>计算：<br><span class="hljs-bullet">1.</span> T1（续约时间）<br><span class="hljs-bullet">2.</span> T2（重绑时间）<br><span class="hljs-bullet">3.</span> 租约到期时间<br><span class="hljs-bullet">4.</span> 从开始到T1的间隔（秒）<br></code></pre></td></tr></table></figure><h3 id="练习4：DHCP抓包分析">练习4：DHCP抓包分析</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown">使用Wireshark抓包：<br><span class="hljs-bullet">1.</span> 释放当前IP<br><span class="hljs-bullet">2.</span> 启动Wireshark，过滤 &quot;dhcp&quot;<br><span class="hljs-bullet">3.</span> 重新获取IP<br><span class="hljs-bullet">4.</span> 观察DORA四个报文<br><span class="hljs-bullet">5.</span> 分析每个报文的内容<br></code></pre></td></tr></table></figure><hr><h2 id="9-常见问题">9. 常见问题</h2><p><strong>Q1：为什么DHCP Request要广播而不是单播？</strong></p><p>A：两个原因：</p><ol><li>告诉所有DHCP服务器&quot;我选择了哪个offer&quot;，其他服务器可以回收IP</li><li>此时客户端还没有正式的IP，使用单播可能有问题</li></ol><p><strong>Q2：如果有多个DHCP服务器，会发生什么？</strong></p><p>A：</p><ul><li>客户端会收到多个Offer</li><li>客户端通常选择第一个收到的Offer</li><li>其他服务器看到Request后，会回收它们提供的IP</li></ul><p><strong>Q3：DHCP能跨网段工作吗？</strong></p><p>A：</p><ul><li>直接不能（广播无法跨越路由器）</li><li>需要配置DHCP Relay（中继代理）</li><li>路由器将广播转换为单播转发</li></ul><p><strong>Q4：租约到期后没有续约会怎样？</strong></p><p>A：</p><ul><li>IP地址被释放</li><li>客户端失去网络连接</li><li>需要重新发起DORA获取新IP</li><li>通常客户端会在到期前自动续约</li></ul><p><strong>Q5：为什么有时候IP地址会变化？</strong></p><p>A：可能原因：</p><ul><li>租约到期后获得不同的IP</li><li>DHCP服务器重启，地址池重置</li><li>长时间离线，原IP被分配给其他设备</li><li>更换了网络（连接不同的WiFi）</li></ul><hr><h2 id="10-总结">10. 总结</h2><p>今天我们学习了：</p><h3 id="核心知识点">核心知识点</h3><ol><li><p><strong>DHCP基础</strong>：</p><ul><li>动态主机配置协议</li><li>自动分配IP和网络参数</li><li>简化网络管理</li></ul></li><li><p><strong>DORA过程</strong>：</p><ul><li>Discover：寻找DHCP服务器</li><li>Offer：服务器提供IP</li><li>Request：客户端请求IP</li><li>Ack：服务器确认分配</li></ul></li><li><p><strong>租约管理</strong>：</p><ul><li>租约生命周期</li><li>T1续约（50%）、T2重绑（87.5%）</li><li>租约到期处理</li></ul></li><li><p><strong>DHCP报文</strong>：</p><ul><li>基于BOOTP协议</li><li>UDP端口67/68</li><li>丰富的Options字段</li></ul></li><li><p><strong>高级特性</strong>：</p><ul><li>DHCP中继（跨网段）</li><li>安全问题（欺骗、饿死攻击）</li><li>地址保留</li></ul></li></ol><h3 id="重点回顾">重点回顾</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">DHCP</span> <span class="hljs-operator">=</span> 自动网络配置<br>过程 <span class="hljs-operator">=</span> DORA（<span class="hljs-number">4</span>次握手）<br>管理 <span class="hljs-operator">=</span> 租约机制<br>安全 <span class="hljs-operator">=</span> DHCP Snooping<br><br>好处：<br>✅ 自动化配置<br>✅ 避免IP冲突<br>✅ 集中管理<br>✅ 提高效率<br></code></pre></td></tr></table></figure><h3 id="明天预告">明天预告</h3><p><strong>第14天：第二周总结与实战</strong></p><p>内容预览：</p><ul><li>本周知识串讲（Day 8-13）</li><li>IP、子网、MAC、端口、DNS、DHCP综合应用</li><li>综合项目：网络配置助手</li><li>知识测验</li></ul><hr><p><strong>继续加油！🚀</strong></p><p>今天我们深入学习了DHCP协议，理解了网络设备如何自动获取IP地址和配置。DHCP极大地简化了网络管理，是现代网络不可或缺的基础服务。掌握DHCP不仅能帮你理解网络自动化配置，还能在排查网络问题时快速定位。</p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>12天：DNS协议详解</title>
    <link href="/2025/11/10/12%E5%A4%A9%EF%BC%9ADNS%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/"/>
    <url>/2025/11/10/12%E5%A4%A9%EF%BC%9ADNS%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1>第12天：DNS协议详解</h1><h2 id="今日目标">今日目标</h2><ul><li>理解DNS的工作原理和架构</li><li>掌握DNS查询过程</li><li>了解常见的DNS记录类型</li><li>学会使用Python实现DNS查询工具</li></ul><hr><h2 id="1-什么是DNS？">1. 什么是DNS？</h2><h3 id="1-1-DNS的定义">1.1 DNS的定义</h3><p><strong>DNS（Domain Name System，域名系统）</strong> 是互联网的&quot;电话簿&quot;。</p><p><strong>生活类比</strong>：</p><ul><li>你记得朋友的名字，但不记得他的电话号码</li><li>你查通讯录，通过名字找到电话号码</li><li>DNS就是这样一个通讯录，把域名翻译成IP地址</li></ul><p><strong>为什么需要DNS？</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">人类喜欢记忆：www<span class="hljs-selector-class">.baidu</span><span class="hljs-selector-class">.com</span><br>计算机需要使用：<span class="hljs-number">110.242</span>.<span class="hljs-number">68.66</span><br><br>DNS的作用：把域名转换为IP地址<br></code></pre></td></tr></table></figure><h3 id="1-2-DNS的重要性">1.2 DNS的重要性</h3><p><strong>如果没有DNS会怎样？</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">访问百度：http:<span class="hljs-comment">//110.242.68.66  ❌ 很难记</span><br>访问淘宝：http:<span class="hljs-comment">//106.11.248.146 ❌ 更难记</span><br>访问微信：http:<span class="hljs-comment">//101.32.118.25  ❌ 记不住</span><br><br>有了DNS：<br>访问百度：www<span class="hljs-selector-class">.baidu</span><span class="hljs-selector-class">.com</span>  ✅ 容易记<br>访问淘宝：www<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.com</span> ✅ 好记<br>访问微信：www<span class="hljs-selector-class">.weixin</span><span class="hljs-selector-class">.com</span> ✅ 简单<br></code></pre></td></tr></table></figure><hr><h2 id="2-DNS架构体系">2. DNS架构体系</h2><h3 id="2-1-DNS层级结构">2.1 DNS层级结构</h3><p>DNS采用<strong>分布式、层级化</strong>的设计，就像一个倒置的树形结构：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">                       .（根域）<br>                        |<span class="hljs-string"></span><br><span class="hljs-string">       +----------------+----------------+</span><br><span class="hljs-string">       </span>|<span class="hljs-string">                </span>|<span class="hljs-string">                </span>|<br>     com              cn               org<br>       |<span class="hljs-string">                </span>|<span class="hljs-string">                </span>|<br>  +----+----+      +----+----+      +----+----+<br>  |<span class="hljs-string">         </span>|<span class="hljs-string">      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">      </span>|<span class="hljs-string">         </span>|<br>baidu    google  sina     163    wikipedia  linux<br>  |<span class="hljs-string">         </span>|<span class="hljs-string">      </span>|<span class="hljs-string">         </span>|<span class="hljs-string">        </span>|<span class="hljs-string">        </span>|<br> www       www    www       www      www      www<br></code></pre></td></tr></table></figure><p><strong>域名层级（从右到左）</strong>：</p><ol><li><p><strong>根域（Root Domain）</strong>：<code>.</code></p><ul><li>最顶层，通常被省略</li><li>全球只有13组根域名服务器</li></ul></li><li><p><strong>顶级域（TLD - Top Level Domain）</strong>：</p><ul><li>通用顶级域：<code>.com</code> <code>.net</code> <code>.org</code> <code>.edu</code> <code>.gov</code></li><li>国家顶级域：<code>.cn</code> <code>.us</code> <code>.uk</code> <code>.jp</code></li><li>新顶级域：<code>.tech</code> <code>.xyz</code> <code>.top</code></li></ul></li><li><p><strong>二级域（SLD - Second Level Domain）</strong>：</p><ul><li><code>baidu.com</code> 中的 <code>baidu</code></li><li><code>google.com</code> 中的 <code>google</code></li></ul></li><li><p><strong>三级域（子域）</strong>：</p><ul><li><code>www.baidu.com</code> 中的 <code>www</code></li><li><code>mail.google.com</code> 中的 <code>mail</code></li></ul></li></ol><p><strong>完整域名示例</strong>：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">www.baidu.com.<br> |<span class="hljs-string">   </span>|<span class="hljs-string">     </span>|<span class="hljs-string">  </span>|<br> |<span class="hljs-string">   </span>|<span class="hljs-string">     </span>|<span class="hljs-string">  +-- 根域（通常省略）</span><br><span class="hljs-string"> </span>|<span class="hljs-string">   </span>|<span class="hljs-string">     +----- 顶级域</span><br><span class="hljs-string"> </span>|<span class="hljs-string">   +----------- 二级域</span><br><span class="hljs-string"> +--------------- 三级域（子域）</span><br></code></pre></td></tr></table></figure><h3 id="2-2-DNS服务器类型">2.2 DNS服务器类型</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌─────────────────────────────────────────┐<br>│         DNS服务器类型                     │<br>├─────────────────────────────────────────┤<br>│ <span class="hljs-number">1.</span> 根DNS服务器（Root DNS <span class="hljs-keyword">Server</span>）        │<br>│    - 全球<span class="hljs-number">13</span>组                            │<br>│    - 知道所有顶级域服务器的地址          │<br>│                                          │<br>│ <span class="hljs-number">2.</span> 顶级域DNS服务器（TLD DNS <span class="hljs-keyword">Server</span>）     │<br>│    - 管理 .com、.cn 等顶级域             │<br>│    - 知道所有注册域的权威服务器          │<br>│                                          │<br>│ <span class="hljs-number">3.</span> 权威DNS服务器（Authoritative DNS）    │<br>│    - 存储域名的真实IP地址                │<br>│    - 由域名所有者管理                    │<br>│                                          │<br>│ <span class="hljs-number">4.</span> 本地DNS服务器（<span class="hljs-keyword">Local</span> DNS <span class="hljs-keyword">Server</span>）     │<br>│    - 通常由ISP提供                       │<br>│    - 缓存查询结果                        │<br>│    - 代替客户端执行递归查询              │<br>└─────────────────────────────────────────┘<br></code></pre></td></tr></table></figure><hr><h2 id="3-DNS查询过程">3. DNS查询过程</h2><h3 id="3-1-递归查询-vs-迭代查询">3.1 递归查询 vs 迭代查询</h3><p><strong>递归查询（Recursive Query）</strong>：</p><ul><li>客户端发出请求后，DNS服务器负责完成所有查询</li><li>“帮我查到结果再告诉我”</li></ul><p><strong>迭代查询（Iterative Query）</strong>：</p><ul><li>DNS服务器只返回下一步应该查询的服务器地址</li><li>“我不知道，但你可以去问XX服务器”</li></ul><h3 id="3-2-完整的DNS查询流程">3.2 完整的DNS查询流程</h3><p><strong>场景</strong>：你在浏览器输入 <code>www.example.com</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs stylus">步骤<span class="hljs-number">1</span>：检查本地缓存<br>─────────────────────────<br><span class="hljs-selector-attr">[你的电脑]</span><br>  ↓<br>先查看本地DNS缓存<br>  ↓<br>如果有缓存 → 直接返回IP ✅<br>如果没有 → 继续查询<br><br>步骤<span class="hljs-number">2</span>：查询本地DNS服务器<br>─────────────────────────<br><span class="hljs-selector-attr">[你的电脑]</span> → <span class="hljs-selector-attr">[本地DNS服务器]</span><br>               （通常是运营商的DNS）<br>  ↓<br>检查缓存<br>  ↓<br>如果有 → 返回IP ✅<br>如果没有 → 开始递归查询<br><br>步骤<span class="hljs-number">3</span>：查询根DNS服务器<br>─────────────────────────<br><span class="hljs-selector-attr">[本地DNS]</span> → <span class="hljs-selector-attr">[根DNS服务器]</span><br>问：www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> 的IP是多少？<br>答：我不知道，但 <span class="hljs-selector-class">.com</span> 的地址我知道，去问它<br><br>步骤<span class="hljs-number">4</span>：查询顶级域DNS服务器<br>─────────────────────────<br><span class="hljs-selector-attr">[本地DNS]</span> → <span class="hljs-selector-attr">[.com DNS服务器]</span><br>问：www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> 的IP是多少？<br>答：我不知道，但 example<span class="hljs-selector-class">.com</span> 的权威DNS我知道，去问它<br><br>步骤<span class="hljs-number">5</span>：查询权威DNS服务器<br>─────────────────────────<br><span class="hljs-selector-attr">[本地DNS]</span> → <span class="hljs-selector-attr">[example.com 权威DNS]</span><br>问：www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> 的IP是多少？<br>答：<span class="hljs-number">93.184</span>.<span class="hljs-number">216.34</span> ✅<br><br>步骤<span class="hljs-number">6</span>：返回结果并缓存<br>─────────────────────────<br><span class="hljs-selector-attr">[本地DNS]</span> → <span class="hljs-selector-attr">[你的电脑]</span><br>返回：<span class="hljs-number">93.184</span>.<span class="hljs-number">216.34</span><br>并且缓存结果（TTL时间内有效）<br></code></pre></td></tr></table></figure><p><strong>时间流程图</strong>：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">时间轴：<br>─────────────────────────────────────────────────<br><span class="hljs-symbol">t0:</span> 用户输入 www.example.com<br>    ↓<br><span class="hljs-symbol">t1:</span> 查询本地缓存（<span class="hljs-number">1</span>ms）<br>    ↓<br><span class="hljs-symbol">t2:</span> 查询本地DNS服务器（<span class="hljs-number">5</span>ms）<br>    ↓<br><span class="hljs-symbol">t3:</span> 本地DNS查询根服务器（<span class="hljs-number">50</span>ms）<br>    ↓<br><span class="hljs-symbol">t4:</span> 本地DNS查询.com服务器（<span class="hljs-number">30</span>ms）<br>    ↓<br><span class="hljs-symbol">t5:</span> 本地DNS查询权威服务器（<span class="hljs-number">20</span>ms）<br>    ↓<br><span class="hljs-symbol">t6:</span> 返回结果给用户（<span class="hljs-number">5</span>ms）<br>    ↓<br>总耗时：约 <span class="hljs-number">111</span>ms<br></code></pre></td></tr></table></figure><h3 id="3-3-DNS缓存机制">3.3 DNS缓存机制</h3><p><strong>多级缓存</strong>：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-number">1</span>. 浏览器缓存<br>   ├── <span class="hljs-params">Chrome:</span> chrome:<span class="hljs-operator">//</span>net-internals<span class="hljs-operator">/</span><span class="hljs-comment">#dns</span><br>   ├── <span class="hljs-params">Firefox:</span> about:networking<span class="hljs-comment">#dns</span><br>   └── 缓存时间：通常几分钟<br><br><span class="hljs-number">2</span>. 操作系统缓存<br>   ├── <span class="hljs-params">Windows:</span> ipconfig <span class="hljs-symbol">/displaydns</span><br>   ├── <span class="hljs-params">Linux:</span> nscd<br>   └── 缓存时间：根据TTL<br><br><span class="hljs-number">3</span>. 路由器缓存<br>   └── 家庭网关会缓存DNS结果<br><br><span class="hljs-number">4</span>. 本地DNS服务器缓存<br>   └── ISP的DNS服务器<br>   └── 缓存时间：根据TTL<br><br><span class="hljs-number">5</span>. 权威DNS服务器<br>   └── 最终的真实数据源<br></code></pre></td></tr></table></figure><p><strong>TTL（Time To Live）</strong>：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs markdown">DNS记录都有TTL值，表示缓存有效期<br><br>示例：<br>www.example.com.  300  IN  A  93.184.216.34<br><span class="hljs-code">                   ↑</span><br><span class="hljs-code">                  TTL = 300秒（5分钟）</span><br><span class="hljs-code"></span><br>含义：<br><span class="hljs-bullet">-</span> 这条记录可以被缓存5分钟<br><span class="hljs-bullet">-</span> 5分钟后需要重新查询<br><span class="hljs-bullet">-</span> TTL短：更新快，但查询频繁<br><span class="hljs-bullet">-</span> TTL长：查询少，但更新慢<br></code></pre></td></tr></table></figure><hr><h2 id="4-DNS记录类型">4. DNS记录类型</h2><h3 id="4-1-常见DNS记录类型">4.1 常见DNS记录类型</h3><table><thead><tr><th>记录类型</th><th>全称</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td><strong>A</strong></td><td>Address</td><td>IPv4地址</td><td><code>www.example.com → 93.184.216.34</code></td></tr><tr><td><strong>AAAA</strong></td><td>IPv6 Address</td><td>IPv6地址</td><td><code>www.example.com → 2606:2800:220:1:...</code></td></tr><tr><td><strong>CNAME</strong></td><td>Canonical Name</td><td>别名</td><td><code>blog.example.com → www.example.com</code></td></tr><tr><td><strong>MX</strong></td><td>Mail Exchange</td><td>邮件服务器</td><td><code>example.com → mail.example.com</code></td></tr><tr><td><strong>NS</strong></td><td>Name Server</td><td>域名服务器</td><td><code>example.com → ns1.example.com</code></td></tr><tr><td><strong>TXT</strong></td><td>Text</td><td>文本信息</td><td><code>SPF、DKIM等验证信息</code></td></tr><tr><td><strong>PTR</strong></td><td>Pointer</td><td>反向解析</td><td><code>34.216.184.93.in-addr.arpa → www.example.com</code></td></tr><tr><td><strong>SOA</strong></td><td>Start of Authority</td><td>授权起始</td><td>域的管理信息</td></tr><tr><td><strong>SRV</strong></td><td>Service</td><td>服务位置</td><td>特定服务的主机和端口</td></tr></tbody></table><h3 id="4-2-记录类型详解">4.2 记录类型详解</h3><p><strong>A记录（最常用）</strong>：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dns">用途：将域名解析为IPv4地址<br><br>配置示例：<br>www.example.com.    <span class="hljs-keyword">IN</span>  <span class="hljs-keyword">A</span>  <span class="hljs-number">93.184.216.34</span><br>api.example.com.    <span class="hljs-keyword">IN</span>  <span class="hljs-keyword">A</span>  <span class="hljs-number">93.184.216.35</span><br>cdn.example.com.    <span class="hljs-keyword">IN</span>  <span class="hljs-keyword">A</span>  <span class="hljs-number">104.16.132.229</span><br><br>一个域名可以有多个<span class="hljs-keyword">A</span>记录（负载均衡）：<br>www.example.com.    <span class="hljs-keyword">IN</span>  <span class="hljs-keyword">A</span>  <span class="hljs-number">93.184.216.34</span><br>www.example.com.    <span class="hljs-keyword">IN</span>  <span class="hljs-keyword">A</span>  <span class="hljs-number">93.184.216.35</span><br>www.example.com.    <span class="hljs-keyword">IN</span>  <span class="hljs-keyword">A</span>  <span class="hljs-number">93.184.216.36</span><br></code></pre></td></tr></table></figure><p><strong>AAAA记录</strong>：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">用途：将域名解析为IPv6地址<br><br>配置示例：<br>www.example.com.    <span class="hljs-keyword">IN</span>  <span class="hljs-keyword">AAAA</span>  <span class="hljs-number">2606:2800:220:1:248:1893:25c8:1946</span><br></code></pre></td></tr></table></figure><p><strong>CNAME记录</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">用途：创建域名别名<br><br>配置示例：<br>www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.     IN  A      <span class="hljs-number">93.184</span>.<span class="hljs-number">216.34</span><br>blog<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.    IN  CNAME  www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.<br>forum<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.   IN  CNAME  www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.<br><br>解析过程：<br>用户访问 blog<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span><br>  ↓ CNAME<br>指向 www<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span><br>  ↓ A记录<br>解析为 <span class="hljs-number">93.184</span>.<span class="hljs-number">216.34</span><br><br>注意：CNAME不能与其他记录共存<br></code></pre></td></tr></table></figure><p><strong>MX记录</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs stylus">用途：指定邮件服务器<br><br>配置示例：<br>example<span class="hljs-selector-class">.com</span>.    IN  MX  <span class="hljs-number">10</span>  mail1<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.<br>example<span class="hljs-selector-class">.com</span>.    IN  MX  <span class="hljs-number">20</span>  mail2<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.<br>                      ↑<br>                   优先级（越小越优先）<br><br>邮件发送过程：<br>发送到 user@example<span class="hljs-selector-class">.com</span><br>  ↓<br>查询 example<span class="hljs-selector-class">.com</span> 的 MX记录<br>  ↓<br>找到 mail1<span class="hljs-selector-class">.example</span>.com（优先级<span class="hljs-number">10</span>）<br>  ↓<br>查询 mail1<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> 的 A记录<br>  ↓<br>获得邮件服务器IP，发送邮件<br></code></pre></td></tr></table></figure><p><strong>NS记录</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">用途：指定域名服务器<br><br>配置示例：<br>example<span class="hljs-selector-class">.com</span>.    IN  NS  ns1<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.<br>example<span class="hljs-selector-class">.com</span>.    IN  NS  ns2<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.<br><br>通常配置多个NS记录（冗余备份）<br></code></pre></td></tr></table></figure><p><strong>TXT记录</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stylus">用途：存储文本信息（常用于验证）<br><br>配置示例：<br><br><span class="hljs-number">1</span>. SPF记录（防止邮件伪造）：<br>   example<span class="hljs-selector-class">.com</span>.  IN  TXT  <span class="hljs-string">&quot;v=spf1 mx include:_spf.google.com ~all&quot;</span><br><br><span class="hljs-number">2</span>. DKIM（邮件签名）：<br>   selector._domainkey<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>.  IN  TXT  <span class="hljs-string">&quot;v=DKIM1; k=rsa; p=MIGfMA...&quot;</span><br><br><span class="hljs-number">3</span>. 域名验证：<br>   example<span class="hljs-selector-class">.com</span>.  IN  TXT  <span class="hljs-string">&quot;google-site-verification=rXOxyZounnZasA8Z7oaD3c14JdjS9aKSWvsR1EbUSIQ&quot;</span><br></code></pre></td></tr></table></figure><p><strong>PTR记录（反向解析）</strong>：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">用途：从IP地址查询域名<br><br>配置示例：<br><span class="hljs-number">34.216.184.93</span>.in-addr.arpa.  IN  PTR  www.example.com.<br><br>应用场景：<br>- 邮件服务器验证<br>- 安全审计<br>- 日志分析<br></code></pre></td></tr></table></figure><hr><h2 id="5-实战项目：DNS查询工具">5. 实战项目：DNS查询工具</h2><h3 id="5-1-项目功能">5.1 项目功能</h3><p>我们将实现一个DNS查询工具，支持：</p><ol><li>查询各种DNS记录类型</li><li>指定DNS服务器</li><li>显示详细的查询结果</li><li>性能分析（查询时间）</li></ol><h3 id="5-2-工具演示">5.2 工具演示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查询A记录</span><br>python day12_dns_tool.py www.baidu.com<br><br><span class="hljs-comment"># 查询指定类型</span><br>python day12_dns_tool.py www.baidu.com MX<br><br><span class="hljs-comment"># 指定DNS服务器</span><br>python day12_dns_tool.py www.baidu.com A 8.8.8.8<br><br><span class="hljs-comment"># 查询所有记录</span><br>python day12_dns_tool.py example.com ALL<br></code></pre></td></tr></table></figure><hr><h2 id="6-知识拓展">6. 知识拓展</h2><h3 id="6-1-公共DNS服务器">6.1 公共DNS服务器</h3><p><strong>国内公共DNS</strong>：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">阿里DNS：<br><span class="hljs-bullet">- </span>223.5.5.5<br><span class="hljs-bullet">- </span>223.6.6.6<br><br>腾讯DNS：<br><span class="hljs-bullet">- </span>119.29.29.29<br><br>百度DNS：<br><span class="hljs-bullet">- </span>180.76.76.76<br><br>114DNS：<br><span class="hljs-bullet">- </span>114.114.114.114<br></code></pre></td></tr></table></figure><p><strong>国际公共DNS</strong>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Google</span> DNS：<br>- <span class="hljs-number">8.8.8.8</span><br>- <span class="hljs-number">8.8.4.4</span><br><br>Cloudflare DNS：<br>- <span class="hljs-number">1.1.1.1</span><br>- <span class="hljs-number">1.0.0.1</span><br><br>OpenDNS：<br>- <span class="hljs-number">208.67.222.222</span><br>- <span class="hljs-number">208.67.220.220</span><br></code></pre></td></tr></table></figure><h3 id="6-2-DNS安全问题">6.2 DNS安全问题</h3><p><strong>1. DNS劫持</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus">正常流程：<br>用户 → www<span class="hljs-selector-class">.bank</span><span class="hljs-selector-class">.com</span> → 真实银行IP<br><br>被劫持：<br>用户 → www<span class="hljs-selector-class">.bank</span><span class="hljs-selector-class">.com</span> → 假冒钓鱼网站IP<br><br>防护措施：<br>- 使用可信DNS服务器<br>- 启用DNSSEC<br>- 使用HTTPS<br></code></pre></td></tr></table></figure><p><strong>2. DNS污染</strong>：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">什么是DNS污染？<br><span class="hljs-bullet">- </span>DNS服务器返回错误的IP地址<br><span class="hljs-bullet">- </span>通常是某些地区的网络审查手段<br><br>现象：<br><span class="hljs-bullet">- </span>某些网站无法访问<br><span class="hljs-bullet">- </span>访问被重定向到其他页面<br><br>解决方法：<br><span class="hljs-bullet">- </span>更换DNS服务器<br><span class="hljs-bullet">- </span>使用VPN<br><span class="hljs-bullet">- </span>使用加密DNS（DoH/DoT）<br></code></pre></td></tr></table></figure><p><strong>3. DNS放大攻击</strong>：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown">攻击原理：<br><span class="hljs-bullet">1.</span> 攻击者伪造受害者IP<br><span class="hljs-bullet">2.</span> 向DNS服务器发送查询请求<br><span class="hljs-bullet">3.</span> DNS服务器将大量响应发送给受害者<br><span class="hljs-bullet">4.</span> 造成受害者网络瘫痪<br><br>特点：<br><span class="hljs-bullet">-</span> 小请求 → 大响应（放大效应）<br><span class="hljs-bullet">-</span> 典型放大倍数：28-54倍<br></code></pre></td></tr></table></figure><h3 id="6-3-新一代DNS技术">6.3 新一代DNS技术</h3><p><strong>DoH（DNS over HTTPS）</strong>：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">传统DNS：<br>明文传输，端口53，易被监听和劫持<br><br>DoH：<br>通过HTTPS加密传输，端口443<br><span class="hljs-bullet">- </span>隐私保护<br><span class="hljs-bullet">- </span>防止劫持<br><span class="hljs-bullet">- </span>绕过某些限制<br><br>支持DoH的浏览器：<br><span class="hljs-bullet">- </span>Firefox<br><span class="hljs-bullet">- </span>Chrome<br><span class="hljs-bullet">- </span>Edge<br></code></pre></td></tr></table></figure><p><strong>DoT（DNS over TLS）</strong>：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gauss">类似DoH，但使用TLS协议<br>端口：<span class="hljs-number">853</span><br><br>区别：<br>DoH：使用HTTPS，融入正常网页流量<br><span class="hljs-built_in">DoT</span>：专用端口，易被识别和过滤<br></code></pre></td></tr></table></figure><p><strong>DNSSEC（DNS Security Extensions）</strong>：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown">功能：<br><span class="hljs-bullet">-</span> 防止DNS欺骗<br><span class="hljs-bullet">-</span> 验证DNS响应的真实性<br><span class="hljs-bullet">-</span> 使用数字签名<br><br>工作原理：<br><span class="hljs-bullet">1.</span> 权威DNS用私钥签名记录<br><span class="hljs-bullet">2.</span> 查询时验证签名<br><span class="hljs-bullet">3.</span> 确保数据未被篡改<br></code></pre></td></tr></table></figure><hr><h2 id="7-实用命令">7. 实用命令</h2><h3 id="7-1-Windows-DNS命令">7.1 Windows DNS命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看DNS缓存</span><br>ipconfig /displaydns<br><br><span class="hljs-comment"># 清除DNS缓存</span><br>ipconfig /flushdns<br><br><span class="hljs-comment"># 查看DNS配置</span><br>ipconfig /all<br><br><span class="hljs-comment"># 使用nslookup查询</span><br>nslookup www.baidu.com<br>nslookup www.baidu.com 8.8.8.8<br></code></pre></td></tr></table></figure><h3 id="7-2-Linux-Mac-DNS命令">7.2 Linux/Mac DNS命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用dig查询（推荐）</span><br>dig www.baidu.com<br>dig www.baidu.com @8.8.8.8<br>dig www.baidu.com MX<br>dig www.baidu.com +trace  <span class="hljs-comment"># 追踪完整查询过程</span><br><br><span class="hljs-comment"># 使用host命令</span><br>host www.baidu.com<br>host -t MX baidu.com<br><br><span class="hljs-comment"># 使用nslookup</span><br>nslookup www.baidu.com<br><br><span class="hljs-comment"># 清除DNS缓存（Mac）</span><br><span class="hljs-built_in">sudo</span> dscacheutil -flushcache<br><span class="hljs-built_in">sudo</span> killall -HUP mDNSResponder<br><br><span class="hljs-comment"># 查看DNS配置</span><br><span class="hljs-built_in">cat</span> /etc/resolv.conf<br></code></pre></td></tr></table></figure><hr><h2 id="8-今日练习">8. 今日练习</h2><h3 id="练习1：DNS查询分析">练习1：DNS查询分析</h3><p>使用我们的工具查询以下域名，分析结果：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-number">1</span>. www.baidu.<span class="hljs-keyword">com</span>（A记录）<br><span class="hljs-number">2</span>. baidu.<span class="hljs-keyword">com</span>（MX记录）<br><span class="hljs-number">3</span>. www.taobao.<span class="hljs-keyword">com</span>（CNAME记录）<br><span class="hljs-number">4</span>. qq.<span class="hljs-keyword">com</span>（NS记录）<br></code></pre></td></tr></table></figure><h3 id="练习2：DNS性能对比">练习2：DNS性能对比</h3><p>对比不同DNS服务器的查询速度：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">测试域名：www.google.com<br>测试DNS：<br><span class="hljs-bullet">- </span>本地DNS<br><span class="hljs-bullet">- </span>8.8.8.8（Google）<br><span class="hljs-bullet">- </span>223.5.5.5（阿里）<br><span class="hljs-bullet">- </span>1.1.1.1（Cloudflare）<br><br>记录每个DNS的响应时间<br></code></pre></td></tr></table></figure><h3 id="练习3：DNS追踪">练习3：DNS追踪</h3><p>手动追踪一个域名的完整解析过程：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">域名：www.example.com<br><br>步骤：<br><span class="hljs-bullet">1.</span> 查询根DNS服务器<br><span class="hljs-bullet">2.</span> 查询.com顶级域服务器<br><span class="hljs-bullet">3.</span> 查询example.com权威服务器<br><span class="hljs-bullet">4.</span> 记录每一步的结果<br></code></pre></td></tr></table></figure><h3 id="练习4：DNS记录配置">练习4：DNS记录配置</h3><p>如果你有自己的域名，尝试配置：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> A记录：指向你的服务器<br><span class="hljs-bullet">2.</span> CNAME记录：创建子域名别名<br><span class="hljs-bullet">3.</span> MX记录：配置邮件服务器<br><span class="hljs-bullet">4.</span> TXT记录：添加网站验证信息<br></code></pre></td></tr></table></figure><hr><h2 id="9-常见问题">9. 常见问题</h2><p><strong>Q1：为什么有时候改了DNS记录，但访问还是旧的IP？</strong></p><p>A：这是因为DNS缓存。解决方法：</p><ul><li>清除本地DNS缓存</li><li>等待TTL过期</li><li>设置较短的TTL值（修改前）</li></ul><p><strong>Q2：什么时候用A记录，什么时候用CNAME？</strong></p><p>A：</p><ul><li>A记录：直接指向IP，速度快</li><li>CNAME：指向另一个域名，灵活但多一次查询</li><li>根域名（<a href="http://example.com">example.com</a>）只能用A记录</li><li>子域名（<a href="http://www.example.com">www.example.com</a>）两者都可以</li></ul><p><strong>Q3：如何选择DNS服务器？</strong></p><p>A：考虑因素：</p><ul><li>速度：选择离你近的服务器</li><li>稳定性：选择大厂的公共DNS</li><li>隐私：避免记录查询日志的DNS</li><li>功能：是否支持DoH、广告过滤等</li></ul><p><strong>Q4：DNS查询走TCP还是UDP？</strong></p><p>A：</p><ul><li>通常走UDP（端口53）</li><li>响应超过512字节时走TCP</li><li>DNSSEC、区域传输走TCP</li><li>DoH走TCP（HTTPS）</li></ul><hr><h2 id="10-总结">10. 总结</h2><p>今天我们学习了：</p><h3 id="核心知识点">核心知识点</h3><ol><li><p><strong>DNS基础</strong>：</p><ul><li>DNS是域名与IP地址的映射系统</li><li>分布式、层级化架构</li></ul></li><li><p><strong>DNS架构</strong>：</p><ul><li>根域、顶级域、二级域、子域</li><li>根服务器、TLD服务器、权威服务器、本地服务器</li></ul></li><li><p><strong>查询过程</strong>：</p><ul><li>递归查询 vs 迭代查询</li><li>多级缓存机制</li><li>TTL机制</li></ul></li><li><p><strong>记录类型</strong>：</p><ul><li>A/AAAA：地址记录</li><li>CNAME：别名记录</li><li>MX：邮件服务器</li><li>NS：域名服务器</li><li>TXT：文本信息</li></ul></li><li><p><strong>DNS安全</strong>：</p><ul><li>DNS劫持、DNS污染</li><li>DoH、DoT、DNSSEC</li></ul></li></ol><h3 id="重点回顾">重点回顾</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">DNS</span> = 互联网的<span class="hljs-string">&quot;通讯录&quot;</span><br>作用 = 域名 → <span class="hljs-built_in">IP</span>地址<br><br>架构：分布式 + 层级化<br>查询：缓存优先 + 递归查询<br>安全：加密 + 验证<br></code></pre></td></tr></table></figure><h3 id="明天预告">明天预告</h3><p><strong>第13天：DHCP协议与网络配置</strong></p><p>内容预览：</p><ul><li>DHCP工作原理</li><li>IP地址自动分配</li><li>DHCP四次握手过程</li><li>实战：DHCP服务器搭建</li></ul><hr><p><strong>继续加油！🚀</strong></p><p>今天我们深入学习了DNS协议，理解了互联网域名解析的完整流程。DNS是互联网的基础设施，几乎所有的网络访问都离不开它。掌握DNS不仅能帮你理解网络工作原理，还能在遇到网络问题时快速定位和解决。</p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>11天：端口和Socket深入</title>
    <link href="/2025/11/10/11%E5%A4%A9%EF%BC%9A%E7%AB%AF%E5%8F%A3%E5%92%8CSocket%E6%B7%B1%E5%85%A5/"/>
    <url>/2025/11/10/11%E5%A4%A9%EF%BC%9A%E7%AB%AF%E5%8F%A3%E5%92%8CSocket%E6%B7%B1%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1>第11天：端口和Socket深入</h1><blockquote><p>“端口是应用程序的门牌号，Socket是网络编程的大门。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解端口的概念和作用</li><li>掌握端口的分类和常用端口号</li><li>深入理解Socket编程</li><li>区分TCP Socket和UDP Socket</li><li>编写端口扫描器工具</li></ul><h2 id="🎯-什么是端口？">🎯 什么是端口？</h2><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dns">端口 = 公司大楼的房间号<br><br>大楼地址（IP地址）：<br>北京市朝阳区某某路<span class="hljs-number">100</span>号<br><br>房间号（端口）：<br><span class="hljs-number">101</span>室 - 前台<br><span class="hljs-number">201</span>室 - 财务部<br><span class="hljs-number">301</span>室 - 技术部<br><br>访问方式：<br>找技术部 = 北京市朝阳区某某路<span class="hljs-number">100号301</span>室<br>访问网站 = <span class="hljs-number">220.181.38.148</span>:<span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><p><strong>端口</strong>（Port）是传输层的概念，用于标识主机上的不同应用程序或服务。</p><h3 id="端口的作用">端口的作用</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">问题：一台电脑同时运行多个网络程序<br><span class="hljs-bullet">- </span>浏览器访问网页<br><span class="hljs-bullet">- </span>QQ聊天<br><span class="hljs-bullet">- </span>下载文件<br><span class="hljs-bullet">- </span>播放在线视频<br><br>如何区分这些数据是给哪个程序的？<br>答案：通过端口号！<br><br>数据包到达：<br>IP地址 → 找到正确的电脑<br>端口号 → 找到正确的程序<br></code></pre></td></tr></table></figure><h2 id="📊-端口的基本特征">📊 端口的基本特征</h2><h3 id="1-端口号范围">1. 端口号范围</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">端口号：<span class="hljs-number">16</span>位无符号整数<br>范围：<span class="hljs-number">0</span> - <span class="hljs-number">65535（2^16</span> - <span class="hljs-number">1</span>）<br><br>分为三类：<br></code></pre></td></tr></table></figure><h3 id="2-端口分类">2. 端口分类</h3><table><thead><tr><th>类别</th><th>范围</th><th>说明</th><th>例子</th></tr></thead><tbody><tr><td>知名端口</td><td>0-1023</td><td>系统保留，需要管理员权限</td><td>80(HTTP), 443(HTTPS), 22(SSH)</td></tr><tr><td>注册端口</td><td>1024-49151</td><td>软件厂商注册使用</td><td>3306(MySQL), 8080(HTTP代理)</td></tr><tr><td>动态/私有端口</td><td>49152-65535</td><td>客户端临时使用</td><td>随机分配</td></tr></tbody></table><h3 id="3-端口的状态">3. 端口的状态</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs markdown">端口的三种状态：<br><br><span class="hljs-bullet">1.</span> LISTENING（监听）<br>   服务器程序正在监听，等待连接<br>   例如：Web服务器监听80端口<br><br><span class="hljs-bullet">2.</span> ESTABLISHED（已建立）<br>   连接已建立，正在通信<br>   例如：浏览器和服务器之间的连接<br><br><span class="hljs-bullet">3.</span> CLOSED（关闭）<br>   端口未被使用<br></code></pre></td></tr></table></figure><h2 id="🔢-常用端口号">🔢 常用端口号</h2><h3 id="Web服务">Web服务</h3><table><thead><tr><th>端口</th><th>协议</th><th>说明</th></tr></thead><tbody><tr><td>80</td><td>HTTP</td><td>网页浏览（明文）</td></tr><tr><td>443</td><td>HTTPS</td><td>安全网页浏览（加密）</td></tr><tr><td>8080</td><td>HTTP</td><td>HTTP代理、测试服务器</td></tr><tr><td>8443</td><td>HTTPS</td><td>HTTPS备用端口</td></tr></tbody></table><h3 id="文件传输">文件传输</h3><table><thead><tr><th>端口</th><th>协议</th><th>说明</th></tr></thead><tbody><tr><td>20</td><td>FTP-DATA</td><td>FTP数据传输</td></tr><tr><td>21</td><td>FTP</td><td>FTP控制连接</td></tr><tr><td>22</td><td>SFTP/SSH</td><td>安全文件传输</td></tr><tr><td>69</td><td>TFTP</td><td>简单文件传输</td></tr></tbody></table><h3 id="邮件服务">邮件服务</h3><table><thead><tr><th>端口</th><th>协议</th><th>说明</th></tr></thead><tbody><tr><td>25</td><td>SMTP</td><td>发送邮件</td></tr><tr><td>110</td><td>POP3</td><td>接收邮件</td></tr><tr><td>143</td><td>IMAP</td><td>邮件访问</td></tr><tr><td>465</td><td>SMTPS</td><td>SMTP加密版</td></tr><tr><td>993</td><td>IMAPS</td><td>IMAP加密版</td></tr><tr><td>995</td><td>POP3S</td><td>POP3加密版</td></tr></tbody></table><h3 id="数据库">数据库</h3><table><thead><tr><th>端口</th><th>数据库</th><th>说明</th></tr></thead><tbody><tr><td>3306</td><td>MySQL</td><td>MySQL数据库</td></tr><tr><td>5432</td><td>PostgreSQL</td><td>PostgreSQL数据库</td></tr><tr><td>1521</td><td>Oracle</td><td>Oracle数据库</td></tr><tr><td>27017</td><td>MongoDB</td><td>MongoDB数据库</td></tr><tr><td>6379</td><td>Redis</td><td>Redis缓存数据库</td></tr></tbody></table><h3 id="远程访问">远程访问</h3><table><thead><tr><th>端口</th><th>协议</th><th>说明</th></tr></thead><tbody><tr><td>22</td><td>SSH</td><td>安全外壳协议</td></tr><tr><td>23</td><td>Telnet</td><td>远程终端（不安全）</td></tr><tr><td>3389</td><td>RDP</td><td>Windows远程桌面</td></tr><tr><td>5900</td><td>VNC</td><td>虚拟网络计算</td></tr></tbody></table><h3 id="其他常用端口">其他常用端口</h3><table><thead><tr><th>端口</th><th>协议</th><th>说明</th></tr></thead><tbody><tr><td>53</td><td>DNS</td><td>域名解析</td></tr><tr><td>67/68</td><td>DHCP</td><td>动态主机配置</td></tr><tr><td>161</td><td>SNMP</td><td>简单网络管理</td></tr><tr><td>445</td><td>SMB</td><td>Windows文件共享</td></tr><tr><td>3000</td><td>Node.js</td><td>常用开发端口</td></tr><tr><td>5000</td><td>Flask</td><td>Python Flask默认</td></tr><tr><td>8000</td><td>Django</td><td>Python Django常用</td></tr></tbody></table><h2 id="🔧-Socket编程">🔧 Socket编程</h2><h3 id="什么是Socket？">什么是Socket？</h3><p><strong>Socket</strong>（套接字）是网络编程的基础接口，用于实现网络通信。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown">Socket = 电话机<br><br>打电话的过程：<br><span class="hljs-bullet">1.</span> 拿起电话（创建Socket）<br><span class="hljs-bullet">2.</span> 拨号（连接）<br><span class="hljs-bullet">3.</span> 说话（发送数据）<br><span class="hljs-bullet">4.</span> 听对方说（接收数据）<br><span class="hljs-bullet">5.</span> 挂断（关闭Socket）<br><br>网络通信的过程：<br><span class="hljs-bullet">1.</span> 创建Socket对象<br><span class="hljs-bullet">2.</span> 连接到服务器（TCP）或准备好（UDP）<br><span class="hljs-bullet">3.</span> 发送数据<br><span class="hljs-bullet">4.</span> 接收数据<br><span class="hljs-bullet">5.</span> 关闭Socket<br></code></pre></td></tr></table></figure><h3 id="Socket类型">Socket类型</h3><h4 id="1-TCP-Socket（流式套接字）">1. TCP Socket（流式套接字）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 特点：</span><br>- 面向连接<br>- 可靠传输<br>- 数据按序到达<br>- 适用于需要可靠传输的场景<br><br><span class="hljs-comment"># 使用场景：</span><br>- 网页浏览（HTTP/HTTPS）<br>- 文件传输（FTP）<br>- 邮件发送（SMTP）<br>- 远程登录（SSH）<br><br><span class="hljs-comment"># Python创建：</span><br><span class="hljs-keyword">import</span> socket<br>sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br></code></pre></td></tr></table></figure><h4 id="2-UDP-Socket（数据报套接字）">2. UDP Socket（数据报套接字）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 特点：</span><br>- 无连接<br>- 不可靠（可能丢包）<br>- 速度快<br>- 适用于实时性要求高的场景<br><br><span class="hljs-comment"># 使用场景：</span><br>- 视频直播<br>- 语音通话<br>- 在线游戏<br>- DNS查询<br><br><span class="hljs-comment"># Python创建：</span><br><span class="hljs-keyword">import</span> socket<br>sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)<br></code></pre></td></tr></table></figure><h3 id="TCP-Socket编程流程">TCP Socket编程流程</h3><h4 id="服务器端">服务器端</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-number">1</span>. 创建Socket<br><span class="hljs-number">2</span>. 绑定地址和端口（<span class="hljs-keyword">bind</span>）<br><span class="hljs-number">3</span>. 监听连接（<span class="hljs-keyword">listen</span>）<br><span class="hljs-number">4</span>. 接受连接（<span class="hljs-keyword">accept</span>）<br><span class="hljs-number">5</span>. 收发数据（<span class="hljs-keyword">recv</span>/<span class="hljs-keyword">send</span>）<br><span class="hljs-number">6</span>. 关闭连接（<span class="hljs-keyword">close</span>）<br><br>┌─────────────┐<br>│ 创建Socket  │<br>└──────┬──────┘<br>       ↓<br>┌─────────────┐<br>│ 绑定端口    │ <span class="hljs-keyword">bind</span>((<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">8888</span>))<br>└──────┬──────┘<br>       ↓<br>┌─────────────┐<br>│ 开始监听    │ <span class="hljs-keyword">listen</span>(<span class="hljs-number">5</span>)<br>└──────┬──────┘<br>       ↓<br>┌─────────────┐<br>│ 等待连接    │ <span class="hljs-keyword">accept</span>() ← 阻塞等待<br>└──────┬──────┘<br>       ↓<br>┌─────────────┐<br>│ 收发数据    │ <span class="hljs-keyword">recv</span>() / <span class="hljs-keyword">send</span>()<br>└──────┬──────┘<br>       ↓<br>┌─────────────┐<br>│ 关闭连接    │ <span class="hljs-keyword">close</span>()<br>└─────────────┘<br></code></pre></td></tr></table></figure><h4 id="客户端">客户端</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-number">1</span>. 创建Socket<br><span class="hljs-number">2</span>. 连接服务器（<span class="hljs-keyword">connect</span>）<br><span class="hljs-number">3</span>. 收发数据（<span class="hljs-keyword">recv</span>/<span class="hljs-keyword">send</span>）<br><span class="hljs-number">4</span>. 关闭连接（<span class="hljs-keyword">close</span>）<br><br>┌─────────────┐<br>│ 创建Socket  │<br>└──────┬──────┘<br>       ↓<br>┌─────────────┐<br>│ 连接服务器  │ <span class="hljs-keyword">connect</span>((<span class="hljs-string">&#x27;server_ip&#x27;</span>, <span class="hljs-number">8888</span>))<br>└──────┬──────┘<br>       ↓<br>┌─────────────┐<br>│ 收发数据    │ <span class="hljs-keyword">recv</span>() / <span class="hljs-keyword">send</span>()<br>└──────┬──────┘<br>       ↓<br>┌─────────────┐<br>│ 关闭连接    │ <span class="hljs-keyword">close</span>()<br>└─────────────┘<br></code></pre></td></tr></table></figure><h2 id="🔧-实战项目：端口扫描器">🔧 实战项目：端口扫描器</h2><p>让我们编写一个功能强大的端口扫描器！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day11_port_scanner.py</span><br><span class="hljs-comment"># 功能：端口扫描器</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor, as_completed<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PortScanner</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;端口扫描器&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 常用端口和服务的映射</span><br>        <span class="hljs-variable language_">self</span>.common_ports = &#123;<br>            <span class="hljs-number">20</span>: <span class="hljs-string">&#x27;FTP-DATA&#x27;</span>,<br>            <span class="hljs-number">21</span>: <span class="hljs-string">&#x27;FTP&#x27;</span>,<br>            <span class="hljs-number">22</span>: <span class="hljs-string">&#x27;SSH&#x27;</span>,<br>            <span class="hljs-number">23</span>: <span class="hljs-string">&#x27;Telnet&#x27;</span>,<br>            <span class="hljs-number">25</span>: <span class="hljs-string">&#x27;SMTP&#x27;</span>,<br>            <span class="hljs-number">53</span>: <span class="hljs-string">&#x27;DNS&#x27;</span>,<br>            <span class="hljs-number">80</span>: <span class="hljs-string">&#x27;HTTP&#x27;</span>,<br>            <span class="hljs-number">110</span>: <span class="hljs-string">&#x27;POP3&#x27;</span>,<br>            <span class="hljs-number">143</span>: <span class="hljs-string">&#x27;IMAP&#x27;</span>,<br>            <span class="hljs-number">443</span>: <span class="hljs-string">&#x27;HTTPS&#x27;</span>,<br>            <span class="hljs-number">445</span>: <span class="hljs-string">&#x27;SMB&#x27;</span>,<br>            <span class="hljs-number">3306</span>: <span class="hljs-string">&#x27;MySQL&#x27;</span>,<br>            <span class="hljs-number">3389</span>: <span class="hljs-string">&#x27;RDP&#x27;</span>,<br>            <span class="hljs-number">5432</span>: <span class="hljs-string">&#x27;PostgreSQL&#x27;</span>,<br>            <span class="hljs-number">6379</span>: <span class="hljs-string">&#x27;Redis&#x27;</span>,<br>            <span class="hljs-number">8080</span>: <span class="hljs-string">&#x27;HTTP-Proxy&#x27;</span>,<br>            <span class="hljs-number">27017</span>: <span class="hljs-string">&#x27;MongoDB&#x27;</span>,<br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_port</span>(<span class="hljs-params">self, host, port, timeout=<span class="hljs-number">1</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        扫描单个端口</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            host: 目标主机</span><br><span class="hljs-string">            port: 端口号</span><br><span class="hljs-string">            timeout: 超时时间（秒）</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            (port, is_open, service_name) 元组</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 创建TCP Socket</span><br>            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>            sock.settimeout(timeout)<br><br>            <span class="hljs-comment"># 尝试连接</span><br>            result = sock.connect_ex((host, port))<br><br>            <span class="hljs-comment"># 关闭连接</span><br>            sock.close()<br><br>            <span class="hljs-comment"># result = 0 表示连接成功（端口开放）</span><br>            <span class="hljs-keyword">if</span> result == <span class="hljs-number">0</span>:<br>                service = <span class="hljs-variable language_">self</span>.common_ports.get(port, <span class="hljs-string">&#x27;Unknown&#x27;</span>)<br>                <span class="hljs-keyword">return</span> (port, <span class="hljs-literal">True</span>, service)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> (port, <span class="hljs-literal">False</span>, <span class="hljs-literal">None</span>)<br><br>        <span class="hljs-keyword">except</span> socket.timeout:<br>            <span class="hljs-keyword">return</span> (port, <span class="hljs-literal">False</span>, <span class="hljs-literal">None</span>)<br>        <span class="hljs-keyword">except</span> socket.error:<br>            <span class="hljs-keyword">return</span> (port, <span class="hljs-literal">False</span>, <span class="hljs-literal">None</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> (port, <span class="hljs-literal">False</span>, <span class="hljs-literal">None</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_port_with_banner</span>(<span class="hljs-params">self, host, port, timeout=<span class="hljs-number">1</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        扫描端口并尝试获取服务banner</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            host: 目标主机</span><br><span class="hljs-string">            port: 端口号</span><br><span class="hljs-string">            timeout: 超时时间</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            (port, is_open, service_name, banner)</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        port_result = <span class="hljs-variable language_">self</span>.scan_port(host, port, timeout)<br>        port_num, is_open, service = port_result<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_open:<br>            <span class="hljs-keyword">return</span> (port_num, <span class="hljs-literal">False</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>)<br><br>        <span class="hljs-comment"># 尝试获取banner</span><br>        banner = <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">try</span>:<br>            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>            sock.settimeout(<span class="hljs-number">2</span>)<br>            sock.connect((host, port))<br><br>            <span class="hljs-comment"># 发送简单的请求</span><br>            <span class="hljs-keyword">if</span> port == <span class="hljs-number">80</span> <span class="hljs-keyword">or</span> port == <span class="hljs-number">8080</span>:<br>                sock.send(<span class="hljs-string">b&#x27;GET / HTTP/1.0\r\n\r\n&#x27;</span>)<br><br>            <span class="hljs-comment"># 尝试接收响应</span><br>            banner = sock.recv(<span class="hljs-number">1024</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>).strip()<br>            sock.close()<br><br>            <span class="hljs-comment"># 只保留第一行</span><br>            <span class="hljs-keyword">if</span> banner:<br>                banner = banner.split(<span class="hljs-string">&#x27;\n&#x27;</span>)[<span class="hljs-number">0</span>][:<span class="hljs-number">50</span>]<br><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br><br>        <span class="hljs-keyword">return</span> (port_num, is_open, service, banner)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_range</span>(<span class="hljs-params">self, host, start_port, end_port, timeout=<span class="hljs-number">1</span>, show_closed=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        扫描端口范围</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            host: 目标主机</span><br><span class="hljs-string">            start_port: 起始端口</span><br><span class="hljs-string">            end_port: 结束端口</span><br><span class="hljs-string">            timeout: 超时时间</span><br><span class="hljs-string">            show_closed: 是否显示关闭的端口</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            开放端口列表</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔍 正在扫描 <span class="hljs-subst">&#123;host&#125;</span>:<span class="hljs-subst">&#123;start_port&#125;</span>-<span class="hljs-subst">&#123;end_port&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⏳ 请稍候...\n&quot;</span>)<br><br>        open_ports = []<br>        total_ports = end_port - start_port + <span class="hljs-number">1</span><br>        scanned = <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># 使用线程池并发扫描</span><br>        <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">100</span>) <span class="hljs-keyword">as</span> executor:<br>            <span class="hljs-comment"># 提交所有扫描任务</span><br>            futures = &#123;<br>                executor.submit(<span class="hljs-variable language_">self</span>.scan_port, host, port, timeout): port<br>                <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(start_port, end_port + <span class="hljs-number">1</span>)<br>            &#125;<br><br>            <span class="hljs-comment"># 处理完成的任务</span><br>            <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(futures):<br>                scanned += <span class="hljs-number">1</span><br>                port_num, is_open, service = future.result()<br><br>                <span class="hljs-keyword">if</span> is_open:<br>                    open_ports.append((port_num, service))<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 端口 <span class="hljs-subst">&#123;port_num:&lt;<span class="hljs-number">6</span>&#125;</span> 开放 - <span class="hljs-subst">&#123;service&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">elif</span> show_closed:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 端口 <span class="hljs-subst">&#123;port_num:&lt;<span class="hljs-number">6</span>&#125;</span> 关闭&quot;</span>)<br><br>                <span class="hljs-comment"># 显示进度</span><br>                <span class="hljs-keyword">if</span> scanned % <span class="hljs-number">50</span> == <span class="hljs-number">0</span>:<br>                    progress = (scanned / total_ports) * <span class="hljs-number">100</span><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   进度: <span class="hljs-subst">&#123;progress:<span class="hljs-number">.1</span>f&#125;</span>% (<span class="hljs-subst">&#123;scanned&#125;</span>/<span class="hljs-subst">&#123;total_ports&#125;</span>)&quot;</span>, end=<span class="hljs-string">&#x27;\r&#x27;</span>)<br><br>        <span class="hljs-keyword">return</span> open_ports<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_common_ports</span>(<span class="hljs-params">self, host, timeout=<span class="hljs-number">1</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        扫描常用端口</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            host: 目标主机</span><br><span class="hljs-string">            timeout: 超时时间</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            开放端口列表</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔍 正在扫描 <span class="hljs-subst">&#123;host&#125;</span> 的常用端口&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📋 共 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(self.common_ports)&#125;</span> 个常用端口\n&quot;</span>)<br><br>        open_ports = []<br><br>        <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">50</span>) <span class="hljs-keyword">as</span> executor:<br>            futures = &#123;<br>                executor.submit(<span class="hljs-variable language_">self</span>.scan_port_with_banner, host, port, timeout): port<br>                <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.common_ports.keys()<br>            &#125;<br><br>            <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(futures):<br>                port_num, is_open, service, banner = future.result()<br><br>                <span class="hljs-keyword">if</span> is_open:<br>                    open_ports.append((port_num, service, banner))<br>                    <span class="hljs-keyword">if</span> banner:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 端口 <span class="hljs-subst">&#123;port_num:&lt;<span class="hljs-number">6</span>&#125;</span> 开放 - <span class="hljs-subst">&#123;service:&lt;<span class="hljs-number">15</span>&#125;</span> | <span class="hljs-subst">&#123;banner&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 端口 <span class="hljs-subst">&#123;port_num:&lt;<span class="hljs-number">6</span>&#125;</span> 开放 - <span class="hljs-subst">&#123;service&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">return</span> open_ports<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">display_results</span>(<span class="hljs-params">self, host, open_ports</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        显示扫描结果</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            host: 主机地址</span><br><span class="hljs-string">            open_ports: 开放端口列表</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;扫描结果 - <span class="hljs-subst">&#123;host&#125;</span>&quot;</span>.center(<span class="hljs-number">70</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>        <span class="hljs-keyword">if</span> open_ports:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n发现 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(open_ports)&#125;</span> 个开放端口:\n&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;端口&#x27;</span>:&lt;<span class="hljs-number">10</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;服务&#x27;</span>:&lt;<span class="hljs-number">20</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;备注&#x27;</span>&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">70</span>)<br><br>            <span class="hljs-keyword">for</span> port_info <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(open_ports):<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(port_info) == <span class="hljs-number">2</span>:<br>                    port, service = port_info<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;port:&lt;<span class="hljs-number">10</span>&#125;</span> <span class="hljs-subst">&#123;service:&lt;<span class="hljs-number">20</span>&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(port_info) == <span class="hljs-number">3</span>:<br>                    port, service, banner = port_info<br>                    banner_str = banner[:<span class="hljs-number">40</span>] <span class="hljs-keyword">if</span> banner <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;port:&lt;<span class="hljs-number">10</span>&#125;</span> <span class="hljs-subst">&#123;service:&lt;<span class="hljs-number">20</span>&#125;</span> <span class="hljs-subst">&#123;banner_str&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n❌ 未发现开放端口&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    scanner = PortScanner()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;端口扫描器&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;请选择扫描模式:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. 扫描常用端口（推荐）&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. 扫描端口范围&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 扫描单个端口&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;0. 退出&quot;</span>)<br><br>    choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入选项: &quot;</span>).strip()<br><br>    <span class="hljs-keyword">if</span> choice == <span class="hljs-string">&#x27;0&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n再见！&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 获取目标主机</span><br>    host = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入目标主机（IP或域名）: &quot;</span>).strip()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> host:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 主机不能为空&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 验证主机是否可达</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🔍 正在检查主机 <span class="hljs-subst">&#123;host&#125;</span> 是否可达...&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        socket.gethostbyname(host)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;✅ 主机可达&quot;</span>)<br>    <span class="hljs-keyword">except</span> socket.gaierror:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 无法解析主机名&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-built_in">print</span>()<br>    start_time = time.time()<br><br>    <span class="hljs-keyword">if</span> choice == <span class="hljs-string">&#x27;1&#x27;</span>:<br>        <span class="hljs-comment"># 扫描常用端口</span><br>        open_ports = scanner.scan_common_ports(host)<br>        scanner.display_results(host, open_ports)<br><br>    <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;2&#x27;</span>:<br>        <span class="hljs-comment"># 扫描端口范围</span><br>        start_port = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入起始端口: &quot;</span>).strip())<br>        end_port = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入结束端口: &quot;</span>).strip())<br><br>        <span class="hljs-keyword">if</span> start_port &lt; <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> end_port &gt; <span class="hljs-number">65535</span> <span class="hljs-keyword">or</span> start_port &gt; end_port:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 端口范围无效&quot;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        open_ports = scanner.scan_range(host, start_port, end_port)<br>        scanner.display_results(host, open_ports)<br><br>    <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;3&#x27;</span>:<br>        <span class="hljs-comment"># 扫描单个端口</span><br>        port = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入端口号: &quot;</span>).strip())<br><br>        <span class="hljs-keyword">if</span> port &lt; <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> port &gt; <span class="hljs-number">65535</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 端口号无效&quot;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        port_num, is_open, service, banner = scanner.scan_port_with_banner(host, port)<br><br>        <span class="hljs-keyword">if</span> is_open:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n✅ 端口 <span class="hljs-subst">&#123;port&#125;</span> 开放&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   服务: <span class="hljs-subst">&#123;service&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">if</span> banner:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   Banner: <span class="hljs-subst">&#123;banner&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n❌ 端口 <span class="hljs-subst">&#123;port&#125;</span> 关闭&quot;</span>)<br><br>    <span class="hljs-comment"># 显示耗时</span><br>    elapsed_time = time.time() - start_time<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n⏱️  扫描耗时: <span class="hljs-subst">&#123;elapsed_time:<span class="hljs-number">.2</span>f&#125;</span> 秒&quot;</span>)<br><br>    <span class="hljs-comment"># 安全提示</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚠️  安全提示:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 仅扫描您有权限扫描的主机&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 未经授权的端口扫描可能违法&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 请遵守网络安全法律法规&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python code/day11/day11_port_scanner.py<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="1-Socket连接测试">1. Socket连接测试</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># connect_ex() 方法</span><br>result = sock.connect_ex((host, port))<br><br><span class="hljs-comment"># 返回值：</span><br><span class="hljs-comment"># 0 = 连接成功（端口开放）</span><br><span class="hljs-comment"># 其他 = 连接失败（端口关闭或被过滤）</span><br></code></pre></td></tr></table></figure><h3 id="2-并发扫描提速">2. 并发扫描提速</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 使用线程池同时扫描多个端口</span><br><span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">100</span>) <span class="hljs-keyword">as</span> executor:<br>    <span class="hljs-comment"># 100个线程并发工作</span><br>    futures = &#123;executor.submit(scan_port, host, port): port<br>               <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(start, end)&#125;<br></code></pre></td></tr></table></figure><h3 id="3-Banner抓取">3. Banner抓取</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 连接成功后，尝试接收服务器的响应</span><br>sock.connect((host, port))<br>sock.send(<span class="hljs-string">b&#x27;GET / HTTP/1.0\r\n\r\n&#x27;</span>)  <span class="hljs-comment"># 发送HTTP请求</span><br>banner = sock.recv(<span class="hljs-number">1024</span>)  <span class="hljs-comment"># 接收响应</span><br><br><span class="hljs-comment"># Banner可以帮助识别服务类型和版本</span><br></code></pre></td></tr></table></figure><h2 id="🎓-知识小结">🎓 知识小结</h2><p>今天学习了：</p><ol><li>✅ 端口是传输层的概念，用于标识应用程序</li><li>✅ 端口号范围：0-65535</li><li>✅ Socket是网络编程的基础接口</li><li>✅ TCP Socket面向连接，UDP Socket无连接</li><li>✅ 端口扫描是网络安全审计的重要手段</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>说明</th></tr></thead><tbody><tr><td>端口</td><td>16位数字，标识应用程序</td></tr><tr><td>Socket</td><td>网络编程接口</td></tr><tr><td>TCP Socket</td><td>面向连接，可靠传输</td></tr><tr><td>UDP Socket</td><td>无连接，快速但不可靠</td></tr><tr><td>端口扫描</td><td>检测端口开放状态</td></tr></tbody></table><h3 id="常用命令">常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看本机监听的端口</span><br>netstat -an | grep LISTEN    <span class="hljs-comment"># Linux/Mac</span><br>netstat -an | findstr LISTEN <span class="hljs-comment"># Windows</span><br><br><span class="hljs-comment"># 查看特定端口</span><br>lsof -i :8080               <span class="hljs-comment"># Mac/Linux</span><br>netstat -ano | findstr :8080 <span class="hljs-comment"># Windows</span><br><br><span class="hljs-comment"># 测试端口连通性</span><br>telnet host port<br>nc -zv host port            <span class="hljs-comment"># Linux/Mac</span><br></code></pre></td></tr></table></figure><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：查看本机端口">练习1：查看本机端口</h3><ol><li>查看本机正在监听的所有端口</li><li>找出80和443端口的状态</li><li>查看哪些程序占用了端口</li></ol><h3 id="练习2：理解Socket">练习2：理解Socket</h3><ol><li>画出TCP Socket通信的完整流程</li><li>解释TCP三次握手在Socket中的体现</li><li>说明服务器端和客户端的区别</li></ol><h3 id="练习3：端口扫描">练习3：端口扫描</h3><ol><li>扫描本机的常用端口</li><li>扫描局域网网关的端口</li><li>分析扫描结果，识别运行的服务</li></ol><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>扩展端口扫描器：</p><ol><li>添加扫描结果保存功能</li><li>实现服务版本检测</li><li>添加操作系统指纹识别</li><li>支持多主机批量扫描</li></ol><h3 id="练习5：安全思考">练习5：安全思考</h3><ol><li>什么是端口扫描？合法吗？</li><li>如何防御端口扫描？</li><li>防火墙如何过滤端口？</li></ol><hr><p>💡 <strong>今日金句</strong>：端口是网络世界的大门，Socket是打开这扇门的钥匙！</p><p>👉 <a href="day10.md">上一天：MAC地址和ARP</a> | <a href="../../README.md">返回目录</a> | <a href="day12.md">下一天：DNS协议详解</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>10天：MAC地址和ARP协议</title>
    <link href="/2025/11/10/10%E5%A4%A9%EF%BC%9AMAC%E5%9C%B0%E5%9D%80%E5%92%8CARP%E5%8D%8F%E8%AE%AE/"/>
    <url>/2025/11/10/10%E5%A4%A9%EF%BC%9AMAC%E5%9C%B0%E5%9D%80%E5%92%8CARP%E5%8D%8F%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<h1>第10天：MAC地址和ARP协议</h1><blockquote><p>“IP地址是逻辑地址，MAC地址是物理地址。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解MAC地址的概念和格式</li><li>掌握MAC地址和IP地址的区别</li><li>理解ARP协议的工作原理</li><li>学会查看和管理ARP缓存</li><li>编写ARP扫描工具</li></ul><h2 id="🎯-什么是MAC地址？">🎯 什么是MAC地址？</h2><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs abnf">MAC地址 <span class="hljs-operator">=</span> 身份证号<br><br>身份证号：终身不变，唯一标识一个人<br>MAC地址：出厂固化，唯一标识一块网卡<br><br>IP地址 <span class="hljs-operator">=</span> 家庭住址<br><br>家庭住址：可以搬家更换<br>IP地址：可以更换网络而改变<br></code></pre></td></tr></table></figure><p><strong>MAC地址</strong>（Media Access Control Address，媒体访问控制地址）是网卡（网络接口卡）的物理地址，用于在数据链路层标识网络设备。</p><h3 id="MAC地址的特点">MAC地址的特点</h3><ol><li><strong>全球唯一</strong>：理论上世界上没有两块网卡有相同的MAC地址</li><li><strong>固化在硬件</strong>：出厂时写入ROM，一般不可更改</li><li><strong>48位（6字节）</strong>：通常用12位十六进制数表示</li><li><strong>数据链路层</strong>：工作在OSI模型的第2层</li></ol><h2 id="📊-MAC地址格式">📊 MAC地址格式</h2><h3 id="标准格式">标准格式</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ruby">常见表示方法：<br><br><span class="hljs-number">1</span>. 冒号分隔（<span class="hljs-title class_">Linux</span>/<span class="hljs-title class_">Unix</span>）<br>   <span class="hljs-variable constant_">AA</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:CC</span><span class="hljs-symbol">:DD</span><span class="hljs-symbol">:EE</span><span class="hljs-symbol">:FF</span><br><br><span class="hljs-number">2</span>. 横线分隔（<span class="hljs-title class_">Windows</span>）<br>   <span class="hljs-variable constant_">AA</span>-<span class="hljs-variable constant_">BB</span>-<span class="hljs-variable constant_">CC</span>-<span class="hljs-variable constant_">DD</span>-<span class="hljs-variable constant_">EE</span>-<span class="hljs-variable constant_">FF</span><br><br><span class="hljs-number">3</span>. 点分隔（<span class="hljs-title class_">Cisco</span>）<br>   <span class="hljs-variable constant_">AABB</span>.<span class="hljs-variable constant_">CCDD</span>.<span class="hljs-variable constant_">EEFF</span><br><br><span class="hljs-number">4</span>. 连续（无分隔符）<br>   <span class="hljs-variable constant_">AABBCCDDEEFF</span><br><br>都是同一个<span class="hljs-variable constant_">MAC</span>地址！<br></code></pre></td></tr></table></figure><h3 id="MAC地址结构">MAC地址结构</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs markdown">MAC地址分为两部分：<br><br>┌─────────────────┬─────────────────┐<br>│  OUI (24位)     │  设备标识(24位) │<br>│  厂商标识       │  序列号         │<br>└─────────────────┴─────────────────┘<br>  AA:BB:CC         DD:EE:FF<br><br>OUI（Organizationally Unique Identifier）：<br><span class="hljs-bullet">-</span> 前3个字节（24位）<br><span class="hljs-bullet">-</span> IEEE分配给厂商的唯一标识<br><span class="hljs-bullet">-</span> 例如：<br><span class="hljs-bullet">  -</span> 00:50:56 → VMware虚拟网卡<br><span class="hljs-bullet">  -</span> 00:1C:42 → Parallels虚拟网卡<br><span class="hljs-bullet">  -</span> DC:A6:32 → Raspberry Pi<br><span class="hljs-bullet">  -</span> 3C:A9:F4 → 小米设备<br><br>设备标识：<br><span class="hljs-bullet">-</span> 后3个字节（24位）<br><span class="hljs-bullet">-</span> 厂商自行分配的序列号<br><span class="hljs-bullet">-</span> 理论上可产生 2^24 = 16,777,216 个地址<br></code></pre></td></tr></table></figure><h3 id="特殊MAC地址">特殊MAC地址</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-number">1</span>. 广播<span class="hljs-variable constant_">MAC</span>地址<br>   <span class="hljs-variable constant_">FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><br>   用于向局域网内所有设备发送数据<br><br><span class="hljs-number">2</span>. 组播<span class="hljs-variable constant_">MAC</span>地址<br>   第一个字节的最低位为<span class="hljs-number">1</span><br>   例如：<span class="hljs-number">01</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">E:</span><span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:XX</span><span class="hljs-symbol">:XX</span>（<span class="hljs-title class_">IPv4</span>组播）<br><br><span class="hljs-number">3</span>. 单播<span class="hljs-variable constant_">MAC</span>地址<br>   第一个字节的最低位为<span class="hljs-number">0</span><br>   普通的设备地址<br></code></pre></td></tr></table></figure><h2 id="🔍-MAC地址-vs-IP地址">🔍 MAC地址 vs IP地址</h2><h3 id="对比表">对比表</h3><table><thead><tr><th>特性</th><th>MAC地址</th><th>IP地址</th></tr></thead><tbody><tr><td>层次</td><td>数据链路层（第2层）</td><td>网络层（第3层）</td></tr><tr><td>长度</td><td>48位（6字节）</td><td>32位（IPv4）或128位（IPv6）</td></tr><tr><td>表示</td><td>十六进制</td><td>十进制（点分）</td></tr><tr><td>分配</td><td>厂商分配，固化在硬件</td><td>网络管理员或DHCP分配</td></tr><tr><td>唯一性</td><td>全球唯一</td><td>网络内唯一</td></tr><tr><td>可变性</td><td>理论上不可变</td><td>可以更换</td></tr><tr><td>作用范围</td><td>局域网内</td><td>可跨越多个网络</td></tr><tr><td>路由</td><td>不能路由</td><td>可以路由</td></tr></tbody></table><h3 id="为什么需要两个地址？">为什么需要两个地址？</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown">类比：快递系统<br><br>MAC地址 = 楼层和房间号<br><span class="hljs-bullet">-</span> 在一栋楼内找到具体房间<br><span class="hljs-bullet">-</span> 只在本楼有效<br><span class="hljs-bullet">-</span> 固定不变<br><br>IP地址 = 城市和街道地址<br><span class="hljs-bullet">-</span> 跨城市寻找目标<br><span class="hljs-bullet">-</span> 可以搬家（更换网络）<br><span class="hljs-bullet">-</span> 可变<br><br>过程：<br><span class="hljs-bullet">1.</span> 快递先通过城市地址找到目标城市（IP路由）<br><span class="hljs-bullet">2.</span> 到达后通过楼层房间号找到具体位置（MAC寻址）<br></code></pre></td></tr></table></figure><h3 id="数据传输过程">数据传输过程</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs armasm">北京的电脑A → 上海的电脑<span class="hljs-keyword">B</span><br><br><span class="hljs-number">1</span>. 应用层：生成数据<br><span class="hljs-number">2</span>. 传输层：添加端口号<br><span class="hljs-number">3</span>. 网络层：添加<span class="hljs-built_in">IP</span>地址<br>   源<span class="hljs-built_in">IP</span>：北京A的<span class="hljs-built_in">IP</span><br>   目标<span class="hljs-built_in">IP</span>：上海B的<span class="hljs-built_in">IP</span><br><span class="hljs-number">4</span>. 数据链路层：添加MAC地址<br>   源MAC：当前路由器的MAC<br>   目标MAC：下一跳路由器的MAC<br><br>重点：<br>- <span class="hljs-built_in">IP</span>地址从头到尾不变（北京A → 上海B）<br>- MAC地址每一跳都会变化（每段链路使用不同的MAC）<br></code></pre></td></tr></table></figure><h2 id="📡-ARP协议">📡 ARP协议</h2><h3 id="什么是ARP？">什么是ARP？</h3><p><strong>ARP</strong>（Address Resolution Protocol，地址解析协议）用于将IP地址转换为MAC地址。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby">问题：我知道目标的<span class="hljs-variable constant_">IP</span>地址，但要发送数据需要<span class="hljs-variable constant_">MAC</span>地址<br><br><span class="hljs-variable constant_">ARP</span>的作用：<br><span class="hljs-variable constant_">IP</span>地址（<span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span>） → <span class="hljs-variable constant_">ARP</span>查询 → <span class="hljs-variable constant_">MAC</span>地址（<span class="hljs-variable constant_">AA</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:CC</span><span class="hljs-symbol">:DD</span><span class="hljs-symbol">:EE</span><span class="hljs-symbol">:FF</span>）<br></code></pre></td></tr></table></figure><h3 id="ARP工作原理">ARP工作原理</h3><h4 id="场景：主机A（192-168-1-10）要发送数据给主机B（192-168-1-20）">场景：主机A（192.168.1.10）要发送数据给主机B（192.168.1.20）</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs ruby">步骤<span class="hljs-number">1</span>：检查<span class="hljs-variable constant_">ARP</span>缓存<br>主机A首先查看本地<span class="hljs-variable constant_">ARP</span>缓存表<br>- 如果有<span class="hljs-number">192.168</span>.<span class="hljs-number">1.20</span>的<span class="hljs-variable constant_">MAC</span>地址 → 直接使用<br>- 如果没有 → 发送<span class="hljs-variable constant_">ARP</span>请求<br><br>步骤<span class="hljs-number">2</span>：发送<span class="hljs-variable constant_">ARP</span>请求（广播）<br>主机A发送广播包：<br>┌─────────────────────────────────────┐<br>│ 谁是<span class="hljs-number">192.168</span>.<span class="hljs-number">1.20</span>？                  │<br>│ 请告诉<span class="hljs-number">192.168</span>.<span class="hljs-number">1.10</span>                  │<br>│ 我的<span class="hljs-variable constant_">MAC</span>是<span class="hljs-variable constant_">AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span>          │<br>└─────────────────────────────────────┘<br>目标<span class="hljs-variable constant_">MAC</span>：<span class="hljs-variable constant_">FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span><span class="hljs-symbol">:FF</span>（广播）<br><br>步骤<span class="hljs-number">3</span>：所有主机接收<br>局域网内所有主机都收到这个广播包<br>- 主机B：这是问我的！<br>- 其他主机：不是问我的，丢弃<br><br>步骤<span class="hljs-number">4</span>：主机B发送<span class="hljs-variable constant_">ARP</span>响应（单播）<br>主机B回复：<br>┌─────────────────────────────────────┐<br>│ 我是<span class="hljs-number">192.168</span>.<span class="hljs-number">1.20</span>                    │<br>│ 我的<span class="hljs-variable constant_">MAC</span>是<span class="hljs-variable constant_">BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span>          │<br>└─────────────────────────────────────┘<br>目标<span class="hljs-variable constant_">MAC</span>：<span class="hljs-variable constant_">AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span><span class="hljs-symbol">:AA</span>（单播给A）<br><br>步骤<span class="hljs-number">5</span>：主机A更新<span class="hljs-variable constant_">ARP</span>缓存<br>主机A记录：<br><span class="hljs-number">192.168</span>.<span class="hljs-number">1.20</span> → <span class="hljs-variable constant_">BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:BB</span><br><br>步骤<span class="hljs-number">6</span>：开始通信<br>现在主机A知道了主机B的<span class="hljs-variable constant_">MAC</span>地址，可以发送数据了<br></code></pre></td></tr></table></figure><h3 id="ARP报文格式">ARP报文格式</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ARP请求/响应报文：<br><br>┌────────────────────────────────────┐<br>│ 硬件类型（<span class="hljs-number">2</span>字节）                  │ <span class="hljs-number">1</span> <span class="hljs-operator">=</span> 以太网<br>├────────────────────────────────────┤<br>│ 协议类型（<span class="hljs-number">2</span>字节）                  │ <span class="hljs-number">0</span>x0800 <span class="hljs-operator">=</span> IP<br>├────────────────────────────────────┤<br>│ 硬件地址长度（<span class="hljs-number">1</span>字节）              │ <span class="hljs-number">6</span> <span class="hljs-operator">=</span> MAC地址<span class="hljs-number">6</span>字节<br>├────────────────────────────────────┤<br>│ 协议地址长度（<span class="hljs-number">1</span>字节）              │ <span class="hljs-number">4</span> <span class="hljs-operator">=</span> IP地址<span class="hljs-number">4</span>字节<br>├────────────────────────────────────┤<br>│ 操作码（<span class="hljs-number">2</span>字节）                    │ <span class="hljs-number">1</span><span class="hljs-operator">=</span>请求，<span class="hljs-number">2</span><span class="hljs-operator">=</span>响应<br>├────────────────────────────────────┤<br>│ 发送方MAC地址（<span class="hljs-number">6</span>字节）             │<br>├────────────────────────────────────┤<br>│ 发送方IP地址（<span class="hljs-number">4</span>字节）              │<br>├────────────────────────────────────┤<br>│ 目标MAC地址（<span class="hljs-number">6</span>字节）               │ 请求时为全<span class="hljs-number">0</span><br>├────────────────────────────────────┤<br>│ 目标IP地址（<span class="hljs-number">4</span>字节）                │<br>└────────────────────────────────────┘<br></code></pre></td></tr></table></figure><h3 id="ARP缓存">ARP缓存</h3><p>为了提高效率，系统会缓存ARP解析的结果。</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">ARP缓存表示例：<br><br>IP地址           MAC地址              类型     过期时间<br><span class="hljs-number">192.168.1.1</span>     AA:BB:CC:DD:EE:FF    动态     <span class="hljs-number">120</span>秒<br><span class="hljs-number">192.168.1.20</span>    <span class="hljs-number">11</span>:<span class="hljs-number">22</span>:<span class="hljs-number">33</span>:<span class="hljs-number">44</span>:<span class="hljs-number">55</span>:<span class="hljs-number">66</span>    动态     <span class="hljs-number">120</span>秒<br><span class="hljs-number">192.168.1.100</span>   FF:EE:DD:CC:BB:AA    静态     永久<br><br>类型：<br>- 动态：通过ARP协议自动学习，有过期时间<br>- 静态：手动配置，永久有效<br></code></pre></td></tr></table></figure><h3 id="查看ARP缓存">查看ARP缓存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Windows</span><br>arp -a<br><br><span class="hljs-comment"># Linux/Mac</span><br>arp -n<br><br><span class="hljs-comment"># 查看特定IP的MAC</span><br>arp -n 192.168.1.1<br><br><span class="hljs-comment"># 清空ARP缓存（需要管理员权限）</span><br><span class="hljs-comment"># Windows</span><br>arp -d<br><br><span class="hljs-comment"># Linux</span><br><span class="hljs-built_in">sudo</span> ip -s -s neigh flush all<br><br><span class="hljs-comment"># Mac</span><br><span class="hljs-built_in">sudo</span> arp -d -a<br></code></pre></td></tr></table></figure><h2 id="🔧-实战项目：ARP扫描工具">🔧 实战项目：ARP扫描工具</h2><p>让我们编写一个ARP扫描工具，用于发现局域网内的所有设备！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day10_arp_scanner.py</span><br><span class="hljs-comment"># 功能：ARP扫描工具</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ARPScanner</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;ARP扫描器&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># OUI数据库（部分常见厂商）</span><br>        <span class="hljs-variable language_">self</span>.oui_database = &#123;<br>            <span class="hljs-string">&#x27;00:50:56&#x27;</span>: <span class="hljs-string">&#x27;VMware&#x27;</span>,<br>            <span class="hljs-string">&#x27;00:0C:29&#x27;</span>: <span class="hljs-string">&#x27;VMware&#x27;</span>,<br>            <span class="hljs-string">&#x27;00:1C:42&#x27;</span>: <span class="hljs-string">&#x27;Parallels&#x27;</span>,<br>            <span class="hljs-string">&#x27;08:00:27&#x27;</span>: <span class="hljs-string">&#x27;VirtualBox&#x27;</span>,<br>            <span class="hljs-string">&#x27;DC:A6:32&#x27;</span>: <span class="hljs-string">&#x27;Raspberry Pi&#x27;</span>,<br>            <span class="hljs-string">&#x27;3C:A9:F4&#x27;</span>: <span class="hljs-string">&#x27;小米&#x27;</span>,<br>            <span class="hljs-string">&#x27;28:6C:07&#x27;</span>: <span class="hljs-string">&#x27;小米&#x27;</span>,<br>            <span class="hljs-string">&#x27;F8:A4:5F&#x27;</span>: <span class="hljs-string">&#x27;华为&#x27;</span>,<br>            <span class="hljs-string">&#x27;00:E0:4C&#x27;</span>: <span class="hljs-string">&#x27;华为&#x27;</span>,<br>            <span class="hljs-string">&#x27;AC:DE:48&#x27;</span>: <span class="hljs-string">&#x27;Apple&#x27;</span>,<br>            <span class="hljs-string">&#x27;00:03:93&#x27;</span>: <span class="hljs-string">&#x27;Apple&#x27;</span>,<br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_mac_vendor</span>(<span class="hljs-params">self, mac</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        根据MAC地址获取厂商信息</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            mac: MAC地址字符串</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            厂商名称</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 提取OUI（前3个字节）</span><br>        oui = <span class="hljs-string">&#x27;:&#x27;</span>.join(mac.split(<span class="hljs-string">&#x27;:&#x27;</span>)[:<span class="hljs-number">3</span>]).upper()<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.oui_database.get(oui, <span class="hljs-string">&#x27;未知厂商&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ip</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        获取本机IP地址</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)<br>            sock.connect((<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-number">80</span>))<br>            local_ip = sock.getsockname()[<span class="hljs-number">0</span>]<br>            sock.close()<br>            <span class="hljs-keyword">return</span> local_ip<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_mac_address</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        通过ARP获取指定IP的MAC地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: 目标IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            MAC地址字符串，如果失败返回None</span><br><span class="hljs-string"></span><br><span class="hljs-string">        工作原理：</span><br><span class="hljs-string">            发送ARP请求，等待响应</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 在Windows上使用arp命令</span><br>            <span class="hljs-keyword">import</span> subprocess<br>            <span class="hljs-keyword">import</span> platform<br><br>            system = platform.system()<br><br>            <span class="hljs-keyword">if</span> system == <span class="hljs-string">&#x27;Windows&#x27;</span>:<br>                <span class="hljs-comment"># Windows: arp -a IP</span><br>                result = subprocess.check_output(<br>                    <span class="hljs-string">f&#x27;arp -a <span class="hljs-subst">&#123;ip&#125;</span>&#x27;</span>,<br>                    shell=<span class="hljs-literal">True</span>,<br>                    stderr=subprocess.DEVNULL<br>                ).decode(<span class="hljs-string">&#x27;gbk&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br><br>                <span class="hljs-comment"># 解析输出</span><br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> result.split(<span class="hljs-string">&#x27;\n&#x27;</span>):<br>                    <span class="hljs-keyword">if</span> ip <span class="hljs-keyword">in</span> line:<br>                        parts = line.split()<br>                        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt;= <span class="hljs-number">2</span>:<br>                            mac = parts[<span class="hljs-number">1</span>].replace(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;:&#x27;</span>)<br>                            <span class="hljs-keyword">return</span> mac<br><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># Linux/Mac: arp -n IP</span><br>                result = subprocess.check_output(<br>                    <span class="hljs-string">f&#x27;arp -n <span class="hljs-subst">&#123;ip&#125;</span>&#x27;</span>,<br>                    shell=<span class="hljs-literal">True</span>,<br>                    stderr=subprocess.DEVNULL<br>                ).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br><br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> result.split(<span class="hljs-string">&#x27;\n&#x27;</span>):<br>                    <span class="hljs-keyword">if</span> ip <span class="hljs-keyword">in</span> line:<br>                        parts = line.split()<br>                        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt;= <span class="hljs-number">3</span>:<br>                            <span class="hljs-keyword">return</span> parts[<span class="hljs-number">2</span>]<br><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ping_and_get_mac</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        先ping一下IP（触发ARP），然后获取MAC地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: 目标IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            (ip, mac, vendor) 元组，失败返回None</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">import</span> subprocess<br>            <span class="hljs-keyword">import</span> platform<br><br>            system = platform.system()<br><br>            <span class="hljs-comment"># 先ping一下，触发ARP</span><br>            <span class="hljs-keyword">if</span> system == <span class="hljs-string">&#x27;Windows&#x27;</span>:<br>                ping_cmd = <span class="hljs-string">f&#x27;ping -n 1 -w 500 <span class="hljs-subst">&#123;ip&#125;</span>&#x27;</span><br>            <span class="hljs-keyword">else</span>:<br>                ping_cmd = <span class="hljs-string">f&#x27;ping -c 1 -W 1 <span class="hljs-subst">&#123;ip&#125;</span>&#x27;</span><br><br>            subprocess.run(<br>                ping_cmd,<br>                shell=<span class="hljs-literal">True</span>,<br>                stdout=subprocess.DEVNULL,<br>                stderr=subprocess.DEVNULL,<br>                timeout=<span class="hljs-number">2</span><br>            )<br><br>            <span class="hljs-comment"># 获取MAC地址</span><br>            mac = <span class="hljs-variable language_">self</span>.get_mac_address(ip)<br><br>            <span class="hljs-keyword">if</span> mac <span class="hljs-keyword">and</span> mac != <span class="hljs-string">&#x27;(incomplete)&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;ff:ff:ff:ff:ff:ff&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> mac.lower():<br>                vendor = <span class="hljs-variable language_">self</span>.get_mac_vendor(mac)<br>                <span class="hljs-keyword">return</span> (ip, mac, vendor)<br><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_network</span>(<span class="hljs-params">self, network, max_workers=<span class="hljs-number">50</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        扫描整个网络</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            network: 网络地址（如 &quot;192.168.1.0/24&quot;）</span><br><span class="hljs-string">            max_workers: 最大线程数</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            发现的设备列表</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">import</span> ipaddress<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔍 开始扫描网络: <span class="hljs-subst">&#123;network&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⏳ 请稍候...\n&quot;</span>)<br><br>        <span class="hljs-comment"># 解析网络</span><br>        net = ipaddress.ip_network(network, strict=<span class="hljs-literal">False</span>)<br>        total = net.num_addresses - <span class="hljs-number">2</span><br><br>        devices = []<br>        scanned = <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># 使用线程池并发扫描</span><br>        <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=max_workers) <span class="hljs-keyword">as</span> executor:<br>            futures = &#123;<br>                executor.submit(<span class="hljs-variable language_">self</span>.ping_and_get_mac, <span class="hljs-built_in">str</span>(ip)): ip<br>                <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> net.hosts()<br>            &#125;<br><br>            <span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> as_completed<br><br>            <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(futures):<br>                scanned += <span class="hljs-number">1</span><br>                result = future.result()<br><br>                <span class="hljs-keyword">if</span> result:<br>                    devices.append(result)<br>                    ip, mac, vendor = result<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ <span class="hljs-subst">&#123;ip:&lt;<span class="hljs-number">15</span>&#125;</span> <span class="hljs-subst">&#123;mac:&lt;<span class="hljs-number">17</span>&#125;</span> <span class="hljs-subst">&#123;vendor&#125;</span>&quot;</span>)<br><br>                <span class="hljs-comment"># 显示进度</span><br>                <span class="hljs-keyword">if</span> scanned % <span class="hljs-number">20</span> == <span class="hljs-number">0</span>:<br>                    progress = (scanned / total) * <span class="hljs-number">100</span><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   进度: <span class="hljs-subst">&#123;progress:<span class="hljs-number">.1</span>f&#125;</span>% (<span class="hljs-subst">&#123;scanned&#125;</span>/<span class="hljs-subst">&#123;total&#125;</span>)&quot;</span>, end=<span class="hljs-string">&#x27;\r&#x27;</span>)<br><br>        <span class="hljs-keyword">return</span> devices<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">display_results</span>(<span class="hljs-params">self, devices</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        显示扫描结果</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            devices: 设备列表</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;扫描完成！共发现 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(devices)&#125;</span> 台设备&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>        <span class="hljs-keyword">if</span> devices:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;IP地址&#x27;</span>:&lt;<span class="hljs-number">15</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;MAC地址&#x27;</span>:&lt;<span class="hljs-number">17</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;厂商&#x27;</span>&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">70</span>)<br><br>            <span class="hljs-keyword">for</span> ip, mac, vendor <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(devices):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ip:&lt;<span class="hljs-number">15</span>&#125;</span> <span class="hljs-subst">&#123;mac:&lt;<span class="hljs-number">17</span>&#125;</span> <span class="hljs-subst">&#123;vendor&#125;</span>&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">view_arp_cache</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    查看系统ARP缓存</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">import</span> subprocess<br>    <span class="hljs-keyword">import</span> platform<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;系统ARP缓存表&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-keyword">try</span>:<br>        system = platform.system()<br><br>        <span class="hljs-keyword">if</span> system == <span class="hljs-string">&#x27;Windows&#x27;</span>:<br>            result = subprocess.check_output(<span class="hljs-string">&#x27;arp -a&#x27;</span>, shell=<span class="hljs-literal">True</span>).decode(<span class="hljs-string">&#x27;gbk&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            result = subprocess.check_output(<span class="hljs-string">&#x27;arp -n&#x27;</span>, shell=<span class="hljs-literal">True</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br><br>        <span class="hljs-built_in">print</span>(result)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 无法获取ARP缓存: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    scanner = ARPScanner()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ARP扫描工具&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取本机IP</span><br>    local_ip = scanner.get_local_ip()<br>    <span class="hljs-keyword">if</span> local_ip:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;💻 本机IP: <span class="hljs-subst">&#123;local_ip&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># 推断网络</span><br>        ip_parts = local_ip.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br>        network = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">0</span>]&#125;</span>.<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">1</span>]&#125;</span>.<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">2</span>]&#125;</span>.0/24&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🌐 推断网络: <span class="hljs-subst">&#123;network&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        network = <span class="hljs-string">&quot;192.168.1.0/24&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🌐 使用默认网络: <span class="hljs-subst">&#123;network&#125;</span>&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;请选择功能:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. 扫描局域网设备（推荐）&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. 扫描自定义网络&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 查看ARP缓存表&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;0. 退出&quot;</span>)<br><br>    choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入选项: &quot;</span>).strip()<br><br>    <span class="hljs-keyword">if</span> choice == <span class="hljs-string">&#x27;1&#x27;</span>:<br>        devices = scanner.scan_network(network)<br>        scanner.display_results(devices)<br><br>    <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;2&#x27;</span>:<br>        custom_network = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入网络地址（如192.168.1.0/24）: &quot;</span>).strip()<br>        <span class="hljs-keyword">if</span> custom_network:<br>            devices = scanner.scan_network(custom_network)<br>            scanner.display_results(devices)<br><br>    <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;3&#x27;</span>:<br>        view_arp_cache()<br><br>    <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;0&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n再见！&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python code/day10/day10_arp_scanner.py<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="1-ARP工作流程">1. ARP工作流程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. Ping触发ARP</span><br>subprocess.run(<span class="hljs-string">f&#x27;ping -c 1 <span class="hljs-subst">&#123;ip&#125;</span>&#x27;</span>, ...)<br><br><span class="hljs-comment"># 2. 系统自动发送ARP请求</span><br><span class="hljs-comment"># 3. 目标主机响应</span><br><span class="hljs-comment"># 4. 系统缓存ARP表项</span><br><br><span class="hljs-comment"># 5. 读取ARP缓存</span><br>subprocess.check_output(<span class="hljs-string">&#x27;arp -n&#x27;</span>, ...)<br></code></pre></td></tr></table></figure><h3 id="2-并发扫描提速">2. 并发扫描提速</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 使用线程池并发扫描多个IP</span><br><span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">50</span>) <span class="hljs-keyword">as</span> executor:<br>    <span class="hljs-comment"># 50个线程同时工作</span><br>    futures = &#123;executor.submit(ping_and_get_mac, ip): ip<br>               <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> net.hosts()&#125;<br></code></pre></td></tr></table></figure><h3 id="3-MAC地址厂商识别">3. MAC地址厂商识别</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 通过MAC地址前3个字节（OUI）识别厂商</span><br>oui = mac[:<span class="hljs-number">8</span>]  <span class="hljs-comment"># 如 &quot;00:50:56&quot;</span><br>vendor = oui_database.get(oui, <span class="hljs-string">&#x27;未知厂商&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="🎓-知识小结">🎓 知识小结</h2><p>今天学习了：</p><ol><li>✅ MAC地址是网卡的物理地址，全球唯一</li><li>✅ MAC地址工作在数据链路层</li><li>✅ ARP协议用于IP地址到MAC地址的转换</li><li>✅ ARP使用广播请求，单播响应</li><li>✅ 系统会缓存ARP解析结果</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>说明</th></tr></thead><tbody><tr><td>MAC地址</td><td>48位物理地址，固化在网卡</td></tr><tr><td>OUI</td><td>MAC地址前24位，厂商标识</td></tr><tr><td>ARP</td><td>地址解析协议，IP→MAC</td></tr><tr><td>ARP缓存</td><td>系统缓存的IP-MAC映射表</td></tr><tr><td>广播MAC</td><td>FF:FF:FF:FF:FF:FF</td></tr></tbody></table><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：查看本机信息">练习1：查看本机信息</h3><ol><li>查看本机的MAC地址</li><li>查看本机的ARP缓存</li><li>找出路由器的MAC地址</li></ol><h3 id="练习2：理解ARP">练习2：理解ARP</h3><ol><li>画出ARP请求和响应的完整过程</li><li>解释为什么ARP请求使用广播</li><li>ARP缓存的作用是什么？</li></ol><h3 id="练习3：实践操作">练习3：实践操作</h3><ol><li>清空ARP缓存</li><li>Ping一个局域网内的设备</li><li>再次查看ARP缓存，观察变化</li></ol><h3 id="练习4：安全思考">练习4：安全思考</h3><ol><li>什么是ARP欺骗（ARP Spoofing）？</li><li>如何防范ARP攻击？</li><li>为什么ARP协议不安全？</li></ol><hr><p>💡 <strong>今日金句</strong>：MAC地址是网络世界的身份证！</p><p>👉 <a href="day09.md">上一天：子网划分实战</a> | <a href="../../README.md">返回目录</a> | <a href="day11.md">下一天：端口和Socket深入</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>9天：子网划分实战</title>
    <link href="/2025/11/10/9%E5%A4%A9%EF%BC%9A%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E5%AE%9E%E6%88%98/"/>
    <url>/2025/11/10/9%E5%A4%A9%EF%BC%9A%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h1>第9天：子网划分实战</h1><blockquote><p>“子网划分就像把一栋大楼分成不同的房间。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解子网掩码的概念和作用</li><li>掌握CIDR表示法</li><li>学会计算网络地址、广播地址</li><li>能够进行子网划分</li><li>编写子网计算器工具</li></ul><h2 id="🎯-为什么需要子网划分？">🎯 为什么需要子网划分？</h2><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">没有子网划分：<br>一栋100层的大楼，所有人共用一个门牌号<br>→ 混乱、难以管理<br><br>有子网划分：<br>把大楼分成不同楼层，每层有自己的编号<br>→ 清晰、便于管理<br><br>网络也是一样：<br><span class="hljs-bullet">- </span>节省IP地址<br><span class="hljs-bullet">- </span>提高网络性能<br><span class="hljs-bullet">- </span>增强安全性<br><span class="hljs-bullet">- </span>便于管理<br></code></pre></td></tr></table></figure><h3 id="实际问题">实际问题</h3><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">问题：一个公司有<span class="hljs-number">500</span>台电脑，给了一个<span class="hljs-built_in">C</span>类地址<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span><br><br><span class="hljs-built_in">C</span>类地址只能容纳<span class="hljs-number">254</span>台主机（<span class="hljs-number">2</span><span class="hljs-operator">^</span><span class="hljs-number">8</span> <span class="hljs-operator">-</span> <span class="hljs-number">2</span>）<br><br>解决方案：<br><span class="hljs-number">1.</span> 申请多个<span class="hljs-built_in">C</span>类地址（浪费、管理复杂）<br><span class="hljs-number">2.</span> 使用<span class="hljs-variable">B</span>类地址，然后划分子网（推荐）<br></code></pre></td></tr></table></figure><h2 id="📊-子网掩码">📊 子网掩码</h2><h3 id="什么是子网掩码？">什么是子网掩码？</h3><p><strong>子网掩码</strong>（Subnet Mask）用于区分IP地址中的网络部分和主机部分。</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">IP地址：    <span class="hljs-number">192.168.1.100</span><br>子网掩码：  <span class="hljs-number">255.255.255.0</span><br><br>作用：确定哪些位是网络号，哪些位是主机号<br></code></pre></td></tr></table></figure><h3 id="子网掩码的格式">子网掩码的格式</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns">二进制表示：<br>网络部分：全是<span class="hljs-number">1</span><br>主机部分：全是<span class="hljs-number">0</span><br><br>例如：<span class="hljs-number">255.255.255.0</span><br><span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">00000000</span><br>[    网络部分（<span class="hljs-number">24</span>位）    ][主机部分(<span class="hljs-number">8</span>位)]<br></code></pre></td></tr></table></figure><h3 id="常见的子网掩码">常见的子网掩码</h3><table><thead><tr><th>类别</th><th>默认子网掩码</th><th>二进制</th><th>CIDR</th></tr></thead><tbody><tr><td>A类</td><td>255.0.0.0</td><td>11111111.00000000.00000000.00000000</td><td>/8</td></tr><tr><td>B类</td><td>255.255.0.0</td><td>11111111.11111111.00000000.00000000</td><td>/16</td></tr><tr><td>C类</td><td>255.255.255.0</td><td>11111111.11111111.11111111.00000000</td><td>/24</td></tr></tbody></table><h2 id="🔢-CIDR表示法">🔢 CIDR表示法</h2><h3 id="什么是CIDR？">什么是CIDR？</h3><p><strong>CIDR</strong>（Classless Inter-Domain Routing，无类域间路由）</p><p>用 <code>/数字</code> 表示子网掩码，数字表示网络位数。</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">传统表示：<span class="hljs-number">192.168.1.0</span>  子网掩码：<span class="hljs-number">255.255.255.0</span><br>CIDR表示：<span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><br><br>/<span class="hljs-number">24</span> 表示前<span class="hljs-number">24</span>位是网络位，后<span class="hljs-number">8</span>位是主机位<br></code></pre></td></tr></table></figure><h3 id="CIDR对照表">CIDR对照表</h3><table><thead><tr><th>CIDR</th><th>子网掩码</th><th>可用主机数</th><th>说明</th></tr></thead><tbody><tr><td>/8</td><td>255.0.0.0</td><td>16,777,214</td><td>A类默认</td></tr><tr><td>/16</td><td>255.255.0.0</td><td>65,534</td><td>B类默认</td></tr><tr><td>/24</td><td>255.255.255.0</td><td>254</td><td>C类默认</td></tr><tr><td>/25</td><td>255.255.255.128</td><td>126</td><td>C类分2个子网</td></tr><tr><td>/26</td><td>255.255.255.192</td><td>62</td><td>C类分4个子网</td></tr><tr><td>/27</td><td>255.255.255.224</td><td>30</td><td>C类分8个子网</td></tr><tr><td>/28</td><td>255.255.255.240</td><td>14</td><td>C类分16个子网</td></tr><tr><td>/29</td><td>255.255.255.248</td><td>6</td><td>C类分32个子网</td></tr><tr><td>/30</td><td>255.255.255.252</td><td>2</td><td>点对点链路</td></tr></tbody></table><h3 id="计算公式">计算公式</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs tap">网络位数：n<br>主机位数：32 - n<br><br>可用主机数 = 2^(主机位数) - 2<br><br>减2的原因：<br>- 网络地址（主机位全0）<br>- 广播地址（主机位全1）<br><br>例如：/24<br>主机位数 =<span class="hljs-number"> 32 </span>-<span class="hljs-number"> 24 </span>= 8<br>可用主机数 = 2^8 -<span class="hljs-number"> 2 </span>= 254<br></code></pre></td></tr></table></figure><h2 id="🧮-子网划分计算">🧮 子网划分计算</h2><h3 id="基本概念">基本概念</h3><p><strong>网络地址</strong>：主机位全为0<br><strong>广播地址</strong>：主机位全为1<br><strong>第一个可用IP</strong>：网络地址 + 1<br><strong>最后一个可用IP</strong>：广播地址 - 1</p><h3 id="计算步骤">计算步骤</h3><h4 id="例1：192-168-1-0-24">例1：192.168.1.0/24</h4><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">1</span>. IP地址：<span class="hljs-number">192.168.1.0</span><br><span class="hljs-number">2</span>. 子网掩码：<span class="hljs-number">255.255.255.0</span> (/<span class="hljs-number">24</span>)<br><br>计算：<br>网络地址：<span class="hljs-number">192.168.1.0</span><br>广播地址：<span class="hljs-number">192.168.1.255</span><br>第一个可用IP：<span class="hljs-number">192.168.1.1</span><br>最后一个可用IP：<span class="hljs-number">192.168.1.254</span><br>可用主机数：<span class="hljs-number">254</span><br></code></pre></td></tr></table></figure><h4 id="例2：192-168-1-0-25">例2：192.168.1.0/25</h4><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">1</span>. IP地址：<span class="hljs-number">192.168.1.0</span><br><span class="hljs-number">2</span>. 子网掩码：<span class="hljs-number">255.255.255.128</span> (/<span class="hljs-number">25</span>)<br><br>分析：<br>/<span class="hljs-number">25</span> 表示前<span class="hljs-number">25</span>位是网络位，后<span class="hljs-number">7</span>位是主机位<br><span class="hljs-number">255.255.255.128</span> = <span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">10000000</span><br><br>子网<span class="hljs-number">1</span>：<br>网络地址：<span class="hljs-number">192.168.1.0</span><br>广播地址：<span class="hljs-number">192.168.1.127</span><br>可用IP：<span class="hljs-number">192.168.1.1</span> - <span class="hljs-number">192.168.1.126</span><br>可用主机数：<span class="hljs-number">126</span><br><br>子网<span class="hljs-number">2</span>：<br>网络地址：<span class="hljs-number">192.168.1.128</span><br>广播地址：<span class="hljs-number">192.168.1.255</span><br>可用IP：<span class="hljs-number">192.168.1.129</span> - <span class="hljs-number">192.168.1.254</span><br>可用主机数：<span class="hljs-number">126</span><br></code></pre></td></tr></table></figure><h3 id="快速计算技巧">快速计算技巧</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">1</span>. 找到<span class="hljs-string">&quot;变化的八位&quot;</span><br>   <span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">128</span> → 最后一个八位是<span class="hljs-number">128</span><br><br><span class="hljs-number">2</span>. 计算块大小<br>   块大小 = <span class="hljs-number">256</span> - 子网掩码最后非<span class="hljs-number">0</span>的八位<br>   块大小 = <span class="hljs-number">256</span> - <span class="hljs-number">128</span> = <span class="hljs-number">128</span><br><br><span class="hljs-number">3</span>. 列出子网<br>   第一个子网：<span class="hljs-number">0</span><br>   第二个子网：<span class="hljs-number">0</span> + <span class="hljs-number">128</span> = <span class="hljs-number">128</span><br>   第三个子网：<span class="hljs-number">128</span> + <span class="hljs-number">128</span> = <span class="hljs-number">256</span>（超出范围，没有第三个）<br><br>所以子网是：<br><span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">25</span><br><span class="hljs-number">192.168.1.128</span>/<span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><h2 id="🔧-实战项目：子网计算器">🔧 实战项目：子网计算器</h2><p>让我们编写一个强大的子网计算器！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day09_subnet_calculator.py</span><br><span class="hljs-comment"># 功能：子网计算器</span><br><br><span class="hljs-keyword">import</span> math<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubnetCalculator</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;子网计算器&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cidr_to_mask</span>(<span class="hljs-params">self, cidr</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        将CIDR转换为子网掩码</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            cidr: CIDR值（如24）</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            子网掩码字符串（如 &quot;255.255.255.0&quot;）</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 生成32位二进制，前cidr位是1，其余是0</span><br>        binary = <span class="hljs-string">&#x27;1&#x27;</span> * cidr + <span class="hljs-string">&#x27;0&#x27;</span> * (<span class="hljs-number">32</span> - cidr)<br><br>        <span class="hljs-comment"># 分成4组，每组8位</span><br>        octets = [binary[i:i+<span class="hljs-number">8</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>, <span class="hljs-number">8</span>)]<br><br>        <span class="hljs-comment"># 转换为十进制</span><br>        mask = <span class="hljs-string">&#x27;.&#x27;</span>.join([<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(octet, <span class="hljs-number">2</span>)) <span class="hljs-keyword">for</span> octet <span class="hljs-keyword">in</span> octets])<br><br>        <span class="hljs-keyword">return</span> mask<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mask_to_cidr</span>(<span class="hljs-params">self, mask</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        将子网掩码转换为CIDR</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            mask: 子网掩码字符串（如 &quot;255.255.255.0&quot;）</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            CIDR值</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 转换为二进制</span><br>        binary = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">format</span>(<span class="hljs-built_in">int</span>(x), <span class="hljs-string">&#x27;08b&#x27;</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> mask.split(<span class="hljs-string">&#x27;.&#x27;</span>)])<br><br>        <span class="hljs-comment"># 计算1的个数</span><br>        <span class="hljs-keyword">return</span> binary.count(<span class="hljs-string">&#x27;1&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ip_to_int</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;将IP地址转换为整数&quot;&quot;&quot;</span><br>        parts = ip.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">int</span>(parts[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">24</span>) + (<span class="hljs-built_in">int</span>(parts[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">16</span>) + \<br>               (<span class="hljs-built_in">int</span>(parts[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">8</span>) + <span class="hljs-built_in">int</span>(parts[<span class="hljs-number">3</span>])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">int_to_ip</span>(<span class="hljs-params">self, num</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;将整数转换为IP地址&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;(num &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">255</span>&#125;</span>.<span class="hljs-subst">&#123;(num &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">255</span>&#125;</span>.&quot;</span> \<br>               <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;(num &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">255</span>&#125;</span>.<span class="hljs-subst">&#123;num &amp; <span class="hljs-number">255</span>&#125;</span>&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_subnet</span>(<span class="hljs-params">self, ip, cidr</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        计算子网信息</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串</span><br><span class="hljs-string">            cidr: CIDR值</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            包含所有子网信息的字典</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 转换为整数</span><br>        ip_int = <span class="hljs-variable language_">self</span>.ip_to_int(ip)<br><br>        <span class="hljs-comment"># 计算子网掩码</span><br>        mask = <span class="hljs-variable language_">self</span>.cidr_to_mask(cidr)<br>        mask_int = <span class="hljs-variable language_">self</span>.ip_to_int(mask)<br><br>        <span class="hljs-comment"># 计算网络地址（IP AND 掩码）</span><br>        network_int = ip_int &amp; mask_int<br>        network = <span class="hljs-variable language_">self</span>.int_to_ip(network_int)<br><br>        <span class="hljs-comment"># 计算广播地址（网络地址 OR 反码掩码）</span><br>        wildcard_int = ~mask_int &amp; <span class="hljs-number">0xFFFFFFFF</span>  <span class="hljs-comment"># 通配符掩码（反码）</span><br>        broadcast_int = network_int | wildcard_int<br>        broadcast = <span class="hljs-variable language_">self</span>.int_to_ip(broadcast_int)<br><br>        <span class="hljs-comment"># 计算第一个和最后一个可用IP</span><br>        first_usable_int = network_int + <span class="hljs-number">1</span><br>        last_usable_int = broadcast_int - <span class="hljs-number">1</span><br><br>        first_usable = <span class="hljs-variable language_">self</span>.int_to_ip(first_usable_int)<br>        last_usable = <span class="hljs-variable language_">self</span>.int_to_ip(last_usable_int)<br><br>        <span class="hljs-comment"># 计算主机数</span><br>        host_bits = <span class="hljs-number">32</span> - cidr<br>        total_hosts = <span class="hljs-number">2</span> ** host_bits<br>        usable_hosts = total_hosts - <span class="hljs-number">2</span> <span class="hljs-keyword">if</span> total_hosts &gt; <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># 计算通配符掩码</span><br>        wildcard = <span class="hljs-variable language_">self</span>.int_to_ip(wildcard_int)<br><br>        result = &#123;<br>            <span class="hljs-string">&#x27;ip&#x27;</span>: ip,<br>            <span class="hljs-string">&#x27;cidr&#x27;</span>: cidr,<br>            <span class="hljs-string">&#x27;mask&#x27;</span>: mask,<br>            <span class="hljs-string">&#x27;wildcard&#x27;</span>: wildcard,<br>            <span class="hljs-string">&#x27;network&#x27;</span>: network,<br>            <span class="hljs-string">&#x27;broadcast&#x27;</span>: broadcast,<br>            <span class="hljs-string">&#x27;first_usable&#x27;</span>: first_usable,<br>            <span class="hljs-string">&#x27;last_usable&#x27;</span>: last_usable,<br>            <span class="hljs-string">&#x27;total_hosts&#x27;</span>: total_hosts,<br>            <span class="hljs-string">&#x27;usable_hosts&#x27;</span>: usable_hosts<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">split_subnet</span>(<span class="hljs-params">self, ip, old_cidr, new_cidr</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        将一个子网划分为多个更小的子网</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: 原始网络地址</span><br><span class="hljs-string">            old_cidr: 原始CIDR</span><br><span class="hljs-string">            new_cidr: 新的CIDR（必须大于old_cidr）</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            子网列表</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> new_cidr &lt;= old_cidr:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>        <span class="hljs-comment"># 计算可以划分多少个子网</span><br>        num_subnets = <span class="hljs-number">2</span> ** (new_cidr - old_cidr)<br><br>        <span class="hljs-comment"># 计算每个子网的大小</span><br>        subnet_size = <span class="hljs-number">2</span> ** (<span class="hljs-number">32</span> - new_cidr)<br><br>        <span class="hljs-comment"># 获取起始网络地址</span><br>        start_int = <span class="hljs-variable language_">self</span>.ip_to_int(ip) &amp; <span class="hljs-variable language_">self</span>.ip_to_int(<span class="hljs-variable language_">self</span>.cidr_to_mask(old_cidr))<br><br>        subnets = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_subnets):<br>            subnet_ip_int = start_int + (i * subnet_size)<br>            subnet_ip = <span class="hljs-variable language_">self</span>.int_to_ip(subnet_ip_int)<br>            subnets.append(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;subnet_ip&#125;</span>/<span class="hljs-subst">&#123;new_cidr&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">return</span> subnets<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">print_subnet_info</span>(<span class="hljs-params">self, info</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        打印子网信息</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            info: calculate_subnet()返回的字典</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;子网信息&quot;</span>.center(<span class="hljs-number">70</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📍 IP地址:          <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;ip&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔢 CIDR:            /<span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;cidr&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🎭 子网掩码:        <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;mask&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🃏 通配符掩码:      <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;wildcard&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🌐 网络地址:        <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;network&#x27;</span>]&#125;</span>/<span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;cidr&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📡 广播地址:        <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;broadcast&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🏁 第一个可用IP:    <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;first_usable&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🏁 最后一个可用IP:  <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;last_usable&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📊 总主机数:        <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;total_hosts&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 可用主机数:      <span class="hljs-subst">&#123;info[<span class="hljs-string">&#x27;usable_hosts&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    calc = SubnetCalculator()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;子网计算器&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n请选择功能:&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. 计算子网信息&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. CIDR ↔ 子网掩码转换&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 子网划分&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4. 快速查询常用CIDR&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;0. 退出&quot;</span>)<br><br>        choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入选项: &quot;</span>).strip()<br><br>        <span class="hljs-keyword">if</span> choice == <span class="hljs-string">&#x27;0&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n再见！&quot;</span>)<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;1&#x27;</span>:<br>            ip = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入IP地址: &quot;</span>).strip()<br>            cidr = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入CIDR（如24）: &quot;</span>).strip()<br><br>            <span class="hljs-keyword">try</span>:<br>                cidr = <span class="hljs-built_in">int</span>(cidr)<br>                <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= cidr &lt;= <span class="hljs-number">32</span>:<br>                    info = calc.calculate_subnet(ip, cidr)<br>                    calc.print_subnet_info(info)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ CIDR必须在0-32之间&quot;</span>)<br>            <span class="hljs-keyword">except</span> ValueError:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 请输入有效的数字&quot;</span>)<br><br>        <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;2&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n请选择转换方向:&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. CIDR → 子网掩码&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. 子网掩码 → CIDR&quot;</span>)<br><br>            sub_choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入选项: &quot;</span>).strip()<br><br>            <span class="hljs-keyword">if</span> sub_choice == <span class="hljs-string">&#x27;1&#x27;</span>:<br>                cidr = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入CIDR: &quot;</span>).strip()<br>                <span class="hljs-keyword">try</span>:<br>                    cidr = <span class="hljs-built_in">int</span>(cidr)<br>                    mask = calc.cidr_to_mask(cidr)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n/<span class="hljs-subst">&#123;cidr&#125;</span> = <span class="hljs-subst">&#123;mask&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">except</span> ValueError:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 请输入有效的数字&quot;</span>)<br><br>            <span class="hljs-keyword">elif</span> sub_choice == <span class="hljs-string">&#x27;2&#x27;</span>:<br>                mask = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入子网掩码: &quot;</span>).strip()<br>                <span class="hljs-keyword">try</span>:<br>                    cidr = calc.mask_to_cidr(mask)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;mask&#125;</span> = /<span class="hljs-subst">&#123;cidr&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">except</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 请输入有效的子网掩码&quot;</span>)<br><br>        <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;3&#x27;</span>:<br>            ip = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入网络地址: &quot;</span>).strip()<br>            old_cidr = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入原始CIDR: &quot;</span>).strip()<br>            new_cidr = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入新的CIDR: &quot;</span>).strip()<br><br>            <span class="hljs-keyword">try</span>:<br>                old_cidr = <span class="hljs-built_in">int</span>(old_cidr)<br>                new_cidr = <span class="hljs-built_in">int</span>(new_cidr)<br><br>                subnets = calc.split_subnet(ip, old_cidr, new_cidr)<br><br>                <span class="hljs-keyword">if</span> subnets:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📊 将 <span class="hljs-subst">&#123;ip&#125;</span>/<span class="hljs-subst">&#123;old_cidr&#125;</span> 划分为 /<span class="hljs-subst">&#123;new_cidr&#125;</span> 子网:&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   共 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(subnets)&#125;</span> 个子网\n&quot;</span>)<br>                    <span class="hljs-keyword">for</span> i, subnet <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(subnets, <span class="hljs-number">1</span>):<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   <span class="hljs-subst">&#123;i&#125;</span>. <span class="hljs-subst">&#123;subnet&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 新CIDR必须大于原CIDR&quot;</span>)<br>            <span class="hljs-keyword">except</span> ValueError:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 请输入有效的数字&quot;</span>)<br><br>        <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;4&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n常用CIDR速查表：&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;CIDR&#x27;</span>:&lt;<span class="hljs-number">8</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;子网掩码&#x27;</span>:&lt;<span class="hljs-number">18</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;可用主机数&#x27;</span>:&lt;<span class="hljs-number">12</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;说明&#x27;</span>&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">60</span>)<br><br>            common_cidrs = [<br>                (<span class="hljs-number">8</span>, <span class="hljs-string">&quot;A类默认&quot;</span>),<br>                (<span class="hljs-number">16</span>, <span class="hljs-string">&quot;B类默认&quot;</span>),<br>                (<span class="hljs-number">24</span>, <span class="hljs-string">&quot;C类默认&quot;</span>),<br>                (<span class="hljs-number">25</span>, <span class="hljs-string">&quot;C类分2个子网&quot;</span>),<br>                (<span class="hljs-number">26</span>, <span class="hljs-string">&quot;C类分4个子网&quot;</span>),<br>                (<span class="hljs-number">27</span>, <span class="hljs-string">&quot;C类分8个子网&quot;</span>),<br>                (<span class="hljs-number">28</span>, <span class="hljs-string">&quot;C类分16个子网&quot;</span>),<br>                (<span class="hljs-number">29</span>, <span class="hljs-string">&quot;小型子网&quot;</span>),<br>                (<span class="hljs-number">30</span>, <span class="hljs-string">&quot;点对点链路&quot;</span>),<br>            ]<br><br>            <span class="hljs-keyword">for</span> cidr, desc <span class="hljs-keyword">in</span> common_cidrs:<br>                mask = calc.cidr_to_mask(cidr)<br>                hosts = <span class="hljs-number">2</span> ** (<span class="hljs-number">32</span> - cidr) - <span class="hljs-number">2</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;/<span class="hljs-subst">&#123;cidr:&lt;<span class="hljs-number">7</span>&#125;</span> <span class="hljs-subst">&#123;mask:&lt;<span class="hljs-number">18</span>&#125;</span> <span class="hljs-subst">&#123;hosts:&lt;<span class="hljs-number">12</span>&#125;</span> <span class="hljs-subst">&#123;desc&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python code/day09/day09_subnet_calculator.py<br></code></pre></td></tr></table></figure><h2 id="💡-实战案例">💡 实战案例</h2><h3 id="案例1：公司网络规划">案例1：公司网络规划</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs markdown">需求：<br>公司有200台电脑，分布在4个部门<br><span class="hljs-bullet">-</span> 销售部：60台<br><span class="hljs-bullet">-</span> 技术部：80台<br><span class="hljs-bullet">-</span> 行政部：40台<br><span class="hljs-bullet">-</span> 财务部：20台<br><br>给定网络：192.168.0.0/24<br><br>方案：<br><span class="hljs-bullet">1.</span> 技术部：192.168.0.0/25（126台主机）<br><span class="hljs-bullet">2.</span> 销售部：192.168.0.128/26（62台主机）<br><span class="hljs-bullet">3.</span> 行政部：192.168.0.192/27（30台主机）<br><span class="hljs-bullet">4.</span> 财务部：192.168.0.224/27（30台主机）<br></code></pre></td></tr></table></figure><h3 id="案例2：家庭网络">案例2：家庭网络</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dns">需求：<br>家里有<span class="hljs-number">10</span>台设备，使用C类私网<br><br>方案：<br>网络：<span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><br>- 可用IP：<span class="hljs-number">192.168.1.1</span> - <span class="hljs-number">192.168.1.254</span><br>- 路由器：<span class="hljs-number">192.168.1.1</span><br>- 设备：<span class="hljs-number">192.168.1.100</span>-<span class="hljs-number">109</span><br></code></pre></td></tr></table></figure><h2 id="🎓-知识小结">🎓 知识小结</h2><p>今天学习了：</p><ol><li>✅ 子网掩码用于区分网络部分和主机部分</li><li>✅ CIDR是子网掩码的简写形式</li><li>✅ 可用主机数 = 2^主机位数 - 2</li><li>✅ 网络地址、广播地址的计算方法</li><li>✅ 子网划分的实际应用</li></ol><h3 id="重要公式">重要公式</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">可用主机数 = <span class="hljs-number">2</span>^(<span class="hljs-number">32</span>-<span class="hljs-built_in">CIDR</span>) - <span class="hljs-number">2</span><br>子网数量 = <span class="hljs-number">2</span>^(新<span class="hljs-built_in">CIDR</span> - 旧<span class="hljs-built_in">CIDR</span>)<br>块大小 = <span class="hljs-number">256</span> - 子网掩码的变化八位<br></code></pre></td></tr></table></figure><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：基础计算">练习1：基础计算</h3><p>计算以下子网的信息：</p><ol><li>192.168.10.0/24</li><li>172.16.0.0/16</li><li>10.0.0.0/8</li></ol><h3 id="练习2：子网划分">练习2：子网划分</h3><p>将192.168.1.0/24划分为：</p><ol><li>2个相等的子网</li><li>4个相等的子网</li><li>8个相等的子网</li></ol><h3 id="练习3：实际应用">练习3：实际应用</h3><p>一个公司有以下需求：</p><ul><li>部门A：需要50台主机</li><li>部门B：需要30台主机</li><li>部门C：需要20台主机</li></ul><p>给定192.168.0.0/24，如何划分？</p><h3 id="练习4：进阶题目">练习4：进阶题目</h3><p>如何判断两个IP是否在同一子网？</p><ul><li>IP1: 192.168.1.100/25</li><li>IP2: 192.168.1.150/25</li></ul><hr><p>💡 <strong>今日金句</strong>：子网划分是网络规划的基本功！</p><p>👉 <a href="day08.md">上一天：IP地址详解</a> | <a href="../../README.md">返回目录</a> | <a href="day10.md">下一天：MAC地址和ARP</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>8天：IP地址详解</title>
    <link href="/2025/11/10/8%E5%A4%A9%EF%BC%9AIP%E5%9C%B0%E5%9D%80%E8%AF%A6%E8%A7%A3/"/>
    <url>/2025/11/10/8%E5%A4%A9%EF%BC%9AIP%E5%9C%B0%E5%9D%80%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1>第8天：IP地址详解</h1><blockquote><p>“IP地址就像互联网上的门牌号。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>深入理解IP地址的概念和作用</li><li>掌握IPv4地址的格式和表示</li><li>理解IP地址的分类（A/B/C/D/E类）</li><li>区分公网IP和私网IP</li><li>编写IP地址分析工具</li></ul><h2 id="🎯-什么是IP地址？">🎯 什么是IP地址？</h2><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">IP地址 = 家庭住址<br><br>北京市朝阳区xx街道xx号  →  详细地址<br><span class="hljs-number">192.168.1.100</span>            →  IP地址<br><br>作用：<br>- 唯一标识网络中的设备<br>- 让数据包找到目的地<br>- 实现跨网络通信<br></code></pre></td></tr></table></figure><p><strong>IP地址</strong>（Internet Protocol Address）是分配给网络设备的数字标识，用于在网络中定位和识别设备。</p><h3 id="IP地址的两个版本">IP地址的两个版本</h3><table><thead><tr><th>版本</th><th>全称</th><th>地址长度</th><th>地址数量</th><th>例子</th></tr></thead><tbody><tr><td>IPv4</td><td>Internet Protocol version 4</td><td>32位</td><td>约43亿个</td><td>192.168.1.1</td></tr><tr><td>IPv6</td><td>Internet Protocol version 6</td><td>128位</td><td>约340万亿亿亿个</td><td>2001:0db8::1</td></tr></tbody></table><p><strong>本节重点</strong>：IPv4（最常用）</p><h2 id="📊-IPv4地址格式">📊 IPv4地址格式</h2><h3 id="二进制和十进制表示">二进制和十进制表示</h3><p>IPv4地址是32位二进制数，分成4组，每组8位（1字节）：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns">二进制表示（<span class="hljs-number">32</span>位）：<br><span class="hljs-number">11000000</span>.<span class="hljs-number">10101000</span>.<span class="hljs-number">00000001</span>.<span class="hljs-number">00000001</span><br><br>转换为十进制（点分十进制）：<br><span class="hljs-number">192.168.1.1</span><br><br>每组范围：<span class="hljs-number">0-255（2^8</span> = <span class="hljs-number">256</span>）<br></code></pre></td></tr></table></figure><h3 id="转换示例">转换示例</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">192.168.1.1</span> 的转换过程：<br><br><span class="hljs-number">192</span>  = <span class="hljs-number">11000000</span>  (<span class="hljs-number">128</span>+<span class="hljs-number">64</span> = <span class="hljs-number">192</span>)<br><span class="hljs-number">168</span>  = <span class="hljs-number">10101000</span>  (<span class="hljs-number">128+32+8</span> = <span class="hljs-number">168</span>)<br><span class="hljs-number">1</span>    = <span class="hljs-number">00000001</span>  (<span class="hljs-number">1</span>)<br><span class="hljs-number">1</span>    = <span class="hljs-number">00000001</span>  (<span class="hljs-number">1</span>)<br><br>完整二进制：<br><span class="hljs-number">11000000</span> <span class="hljs-number">10101000</span> <span class="hljs-number">00000001</span> <span class="hljs-number">00000001</span><br></code></pre></td></tr></table></figure><h3 id="地址范围">地址范围</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">最小IP地址：<span class="hljs-number">0.0.0.0</span><br>最大IP地址：<span class="hljs-number">255.255.255.255</span><br><br>总数：<span class="hljs-number">2</span>^<span class="hljs-number">32</span> = <span class="hljs-number">4</span>,<span class="hljs-number">294,967</span>,<span class="hljs-number">296</span> 个（约<span class="hljs-number">43</span>亿）<br></code></pre></td></tr></table></figure><h2 id="🏷️-IP地址分类">🏷️ IP地址分类</h2><p>IPv4地址分为5类：A、B、C、D、E类</p><h3 id="A类地址">A类地址</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">格式：<span class="hljs-number">0</span>xxxxxxx<span class="hljs-selector-class">.xxxxxxxx</span><span class="hljs-selector-class">.xxxxxxxx</span><span class="hljs-selector-class">.xxxxxxxx</span><br>     <span class="hljs-selector-attr">[网络号]</span>.<span class="hljs-selector-attr">[  主机号（24位）  ]</span><br><br>范围：<span class="hljs-number">1.0</span>.<span class="hljs-number">0.0</span> - <span class="hljs-number">126.255</span>.<span class="hljs-number">255.255</span><br>网络数：<span class="hljs-number">126</span>个（<span class="hljs-number">2</span>^<span class="hljs-number">7</span> - <span class="hljs-number">2</span>，去掉<span class="hljs-number">0</span>和<span class="hljs-number">127</span>）<br>每个网络的主机数：<span class="hljs-number">16</span>,<span class="hljs-number">777</span>,<span class="hljs-number">214</span>个（<span class="hljs-number">2</span>^<span class="hljs-number">24</span> - <span class="hljs-number">2</span>）<br><br>用途：大型网络（如大型企业、ISP）<br>例子：<span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>（私网）<br></code></pre></td></tr></table></figure><h3 id="B类地址">B类地址</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">格式：<span class="hljs-number">10</span>xxxxxx<span class="hljs-selector-class">.xxxxxxxx</span><span class="hljs-selector-class">.xxxxxxxx</span><span class="hljs-selector-class">.xxxxxxxx</span><br>     <span class="hljs-selector-attr">[  网络号（16位） ]</span>.<span class="hljs-selector-attr">[主机号（16位）]</span><br><br>范围：<span class="hljs-number">128.0</span>.<span class="hljs-number">0.0</span> - <span class="hljs-number">191.255</span>.<span class="hljs-number">255.255</span><br>网络数：<span class="hljs-number">16</span>,<span class="hljs-number">384</span>个（<span class="hljs-number">2</span>^<span class="hljs-number">14</span>）<br>每个网络的主机数：<span class="hljs-number">65</span>,<span class="hljs-number">534</span>个（<span class="hljs-number">2</span>^<span class="hljs-number">16</span> - <span class="hljs-number">2</span>）<br><br>用途：中型网络（如大学、中型企业）<br>例子：<span class="hljs-number">172.16</span>.<span class="hljs-number">0.0</span>（私网）<br></code></pre></td></tr></table></figure><h3 id="C类地址">C类地址</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">格式：<span class="hljs-number">110</span>xxxxx<span class="hljs-selector-class">.xxxxxxxx</span><span class="hljs-selector-class">.xxxxxxxx</span><span class="hljs-selector-class">.xxxxxxxx</span><br>     <span class="hljs-selector-attr">[     网络号（24位）    ]</span>.<span class="hljs-selector-attr">[主机号]</span><br><br>范围：<span class="hljs-number">192.0</span>.<span class="hljs-number">0.0</span> - <span class="hljs-number">223.255</span>.<span class="hljs-number">255.255</span><br>网络数：<span class="hljs-number">2</span>,<span class="hljs-number">097</span>,<span class="hljs-number">152</span>个（<span class="hljs-number">2</span>^<span class="hljs-number">21</span>）<br>每个网络的主机数：<span class="hljs-number">254</span>个（<span class="hljs-number">2</span>^<span class="hljs-number">8</span> - <span class="hljs-number">2</span>）<br><br>用途：小型网络（如家庭、小型办公室）<br>例子：<span class="hljs-number">192.168</span>.<span class="hljs-number">1.0</span>（私网）<br></code></pre></td></tr></table></figure><h3 id="D类地址（组播）">D类地址（组播）</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns">格式：<span class="hljs-number">1110</span>xxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx<br><br>范围：<span class="hljs-number">224.0.0.0</span> - <span class="hljs-number">239.255.255.255</span><br><br>用途：组播（多播）地址<br>      一对多的通信<br>例子：<span class="hljs-number">224.0.0.1</span>（所有主机组）<br></code></pre></td></tr></table></figure><h3 id="E类地址（保留）">E类地址（保留）</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">格式：<span class="hljs-number">1111</span>xxxx<span class="hljs-selector-class">.xxxxxxxx</span><span class="hljs-selector-class">.xxxxxxxx</span><span class="hljs-selector-class">.xxxxxxxx</span><br><br>范围：<span class="hljs-number">240.0</span>.<span class="hljs-number">0.0</span> - <span class="hljs-number">255.255</span>.<span class="hljs-number">255.255</span><br><br>用途：保留用于将来或实验<br></code></pre></td></tr></table></figure><h3 id="分类总结">分类总结</h3><table><thead><tr><th>类别</th><th>首字节范围</th><th>网络数</th><th>主机数/网络</th><th>用途</th></tr></thead><tbody><tr><td>A</td><td>1-126</td><td>126</td><td>16,777,214</td><td>大型网络</td></tr><tr><td>B</td><td>128-191</td><td>16,384</td><td>65,534</td><td>中型网络</td></tr><tr><td>C</td><td>192-223</td><td>2,097,152</td><td>254</td><td>小型网络</td></tr><tr><td>D</td><td>224-239</td><td>-</td><td>-</td><td>组播</td></tr><tr><td>E</td><td>240-255</td><td>-</td><td>-</td><td>保留</td></tr></tbody></table><h2 id="🌐-公网IP-vs-私网IP">🌐 公网IP vs 私网IP</h2><h3 id="公网IP（Public-IP）">公网IP（Public IP）</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">定义：可以在互联网上直接访问的IP地址<br>特点：<br><span class="hljs-bullet">- </span>全球唯一<br><span class="hljs-bullet">- </span>可以从互联网任何地方访问<br><span class="hljs-bullet">- </span>需要向ISP申请<br><span class="hljs-bullet">- </span>数量有限，需要付费<br><br>例子：<br><span class="hljs-bullet">- </span>8.8.8.8（Google DNS）<br><span class="hljs-bullet">- </span>114.114.114.114（国内DNS）<br><span class="hljs-bullet">- </span>220.181.38.148（百度）<br></code></pre></td></tr></table></figure><h3 id="私网IP（Private-IP）">私网IP（Private IP）</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dns">定义：只能在局域网内使用的IP地址<br>特点：<br>- 不能在互联网上直接访问<br>- 可以重复使用（不同局域网可以用相同的私网IP）<br>- 免费使用<br>- 需要通过NAT访问互联网<br><br>私网IP地址范围（RFC <span class="hljs-number">1918</span>）：<br><span class="hljs-keyword">A</span>类：<span class="hljs-number">10.0.0.0</span>      - <span class="hljs-number">10.255.255.255</span>    (<span class="hljs-number">10.0.0.0</span>/<span class="hljs-number">8</span>)<br>B类：<span class="hljs-number">172.16.0.0</span>    - <span class="hljs-number">172.31.255.255</span>    (<span class="hljs-number">172.16.0.0</span>/<span class="hljs-number">12</span>)<br>C类：<span class="hljs-number">192.168.0.0</span>   - <span class="hljs-number">192.168.255.255</span>   (<span class="hljs-number">192.168.0.0</span>/<span class="hljs-number">16</span>)<br></code></pre></td></tr></table></figure><h3 id="对比">对比</h3><table><thead><tr><th>特性</th><th>公网IP</th><th>私网IP</th></tr></thead><tbody><tr><td>可访问性</td><td>互联网可访问</td><td>仅局域网可访问</td></tr><tr><td>唯一性</td><td>全球唯一</td><td>可重复使用</td></tr><tr><td>获取方式</td><td>ISP分配</td><td>自行分配</td></tr><tr><td>费用</td><td>通常收费</td><td>免费</td></tr><tr><td>数量</td><td>有限</td><td>充足</td></tr></tbody></table><h3 id="NAT（网络地址转换）">NAT（网络地址转换）</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs 1c">家庭网络示例：<br><br>互联网（公网IP：<span class="hljs-number">123.45</span>.<span class="hljs-number">67.89</span>）<br>    <span class="hljs-string">|</span><br>   路由器（NAT设备）<br>    <span class="hljs-string">|</span><br>局域网（私网IP）<br>    <span class="hljs-string">|-- 电脑1: 192.168.1.100</span><br>    <span class="hljs-string">|-- 电脑2: 192.168.1.101</span><br>    <span class="hljs-string">|-- 手机: 192.168.1.102</span><br><br>NAT的作用：<br>将局域网的私网IP转换为公网IP，<br>使私网设备可以访问互联网。<br></code></pre></td></tr></table></figure><h2 id="🔍-特殊IP地址">🔍 特殊IP地址</h2><h3 id="1-环回地址（Loopback）">1. 环回地址（Loopback）</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">地址：127.0.0.0 - 127.255.255.255<br>常用：127.0.0.1<br><br>作用：本机测试，数据不会发送到网络<br>别名：localhost<br><br>用途：<br><span class="hljs-bullet">- </span>测试网络程序<br><span class="hljs-bullet">- </span>本地开发<br><span class="hljs-bullet">- </span>诊断TCP/IP协议栈<br></code></pre></td></tr></table></figure><h3 id="2-网络地址">2. 网络地址</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">定义：主机号全为<span class="hljs-number">0</span>的地址<br>例子：<span class="hljs-number">192.168.1.0</span><br><br>作用：表示整个网络，不能分配给主机<br></code></pre></td></tr></table></figure><h3 id="3-广播地址">3. 广播地址</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">定义：主机号全为<span class="hljs-number">1</span>的地址<br>例子：<span class="hljs-number">192.168.1.255</span><br><br>作用：向网络中所有主机发送数据<br></code></pre></td></tr></table></figure><h3 id="4-默认路由">4. 默认路由</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">地址：0.0.0.0<br><br>作用：<br><span class="hljs-bullet">- </span>表示&quot;任意地址&quot;<br><span class="hljs-bullet">- </span>路由表中的默认路由<br><span class="hljs-bullet">- </span>服务器监听所有网络接口<br></code></pre></td></tr></table></figure><h3 id="5-受限广播地址">5. 受限广播地址</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">地址：<span class="hljs-number">255.255.255.255</span><br><br>作用：向本地网络广播，不会被路由器转发<br></code></pre></td></tr></table></figure><h2 id="🔧-实战项目：IP地址分析工具">🔧 实战项目：IP地址分析工具</h2><p>让我们编写一个IP地址分析工具，实现各种IP地址相关功能！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day08_ip_analyzer.py</span><br><span class="hljs-comment"># 功能：IP地址分析工具</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IPAnalyzer</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;IP地址分析器&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 私网IP地址范围</span><br>        <span class="hljs-variable language_">self</span>.private_ranges = [<br>            (<span class="hljs-string">&#x27;10.0.0.0&#x27;</span>, <span class="hljs-string">&#x27;10.255.255.255&#x27;</span>),<br>            (<span class="hljs-string">&#x27;172.16.0.0&#x27;</span>, <span class="hljs-string">&#x27;172.31.255.255&#x27;</span>),<br>            (<span class="hljs-string">&#x27;192.168.0.0&#x27;</span>, <span class="hljs-string">&#x27;192.168.255.255&#x27;</span>)<br>        ]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ip_to_int</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        将IP地址转换为整数</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串（如 &quot;192.168.1.1&quot;）</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            整数形式的IP</span><br><span class="hljs-string"></span><br><span class="hljs-string">        工作原理：</span><br><span class="hljs-string">            192.168.1.1 = 192*256^3 + 168*256^2 + 1*256 + 1</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        parts = ip.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">int</span>(parts[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">24</span>) + (<span class="hljs-built_in">int</span>(parts[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">16</span>) + \<br>               (<span class="hljs-built_in">int</span>(parts[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">8</span>) + <span class="hljs-built_in">int</span>(parts[<span class="hljs-number">3</span>])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">int_to_ip</span>(<span class="hljs-params">self, num</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        将整数转换为IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            num: 整数形式的IP</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            IP地址字符串</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;(num &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">255</span>&#125;</span>.<span class="hljs-subst">&#123;(num &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">255</span>&#125;</span>.&quot;</span> \<br>               <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;(num &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">255</span>&#125;</span>.<span class="hljs-subst">&#123;num &amp; <span class="hljs-number">255</span>&#125;</span>&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ip_to_binary</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        将IP地址转换为二进制表示</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            二进制字符串（用点分隔）</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        parts = ip.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br>        binary_parts = [<span class="hljs-built_in">format</span>(<span class="hljs-built_in">int</span>(part), <span class="hljs-string">&#x27;08b&#x27;</span>) <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> parts]<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;.&#x27;</span>.join(binary_parts)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_ip</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        验证IP地址格式是否正确</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            True/False</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        pattern = <span class="hljs-string">r&#x27;^(\d&#123;1,3&#125;)\.(\d&#123;1,3&#125;)\.(\d&#123;1,3&#125;)\.(\d&#123;1,3&#125;)$&#x27;</span><br>        <span class="hljs-keyword">match</span> = re.<span class="hljs-keyword">match</span>(pattern, ip)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">match</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>        <span class="hljs-comment"># 检查每个数字是否在0-255范围内</span><br>        <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> <span class="hljs-keyword">match</span>.groups():<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(num) &gt; <span class="hljs-number">255</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_ip_class</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        判断IP地址的类别（A/B/C/D/E类）</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            类别字符串和详细信息</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        first_octet = <span class="hljs-built_in">int</span>(ip.split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">0</span>])<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-number">1</span> &lt;= first_octet &lt;= <span class="hljs-number">126</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;大型网络&#x27;</span>, <span class="hljs-string">&#x27;1-126&#x27;</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-number">128</span> &lt;= first_octet &lt;= <span class="hljs-number">191</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;中型网络&#x27;</span>, <span class="hljs-string">&#x27;128-191&#x27;</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-number">192</span> &lt;= first_octet &lt;= <span class="hljs-number">223</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;小型网络&#x27;</span>, <span class="hljs-string">&#x27;192-223&#x27;</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-number">224</span> &lt;= first_octet &lt;= <span class="hljs-number">239</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;组播地址&#x27;</span>, <span class="hljs-string">&#x27;224-239&#x27;</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-number">240</span> &lt;= first_octet &lt;= <span class="hljs-number">255</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;保留地址&#x27;</span>, <span class="hljs-string">&#x27;240-255&#x27;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;未知&#x27;</span>, <span class="hljs-string">&#x27;特殊地址&#x27;</span>, <span class="hljs-string">&#x27;0或127&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_private_ip</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        判断是否为私网IP</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            True/False</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        ip_int = <span class="hljs-variable language_">self</span>.ip_to_int(ip)<br><br>        <span class="hljs-keyword">for</span> start, end <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.private_ranges:<br>            start_int = <span class="hljs-variable language_">self</span>.ip_to_int(start)<br>            end_int = <span class="hljs-variable language_">self</span>.ip_to_int(end)<br><br>            <span class="hljs-keyword">if</span> start_int &lt;= ip_int &lt;= end_int:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_special_ip</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        判断是否为特殊IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            (是否特殊, 类型说明)</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 环回地址</span><br>        <span class="hljs-keyword">if</span> ip.startswith(<span class="hljs-string">&#x27;127.&#x27;</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;环回地址（Loopback）&#x27;</span><br><br>        <span class="hljs-comment"># 默认路由</span><br>        <span class="hljs-keyword">if</span> ip == <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;默认路由/任意地址&#x27;</span><br><br>        <span class="hljs-comment"># 受限广播</span><br>        <span class="hljs-keyword">if</span> ip == <span class="hljs-string">&#x27;255.255.255.255&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;受限广播地址&#x27;</span><br><br>        <span class="hljs-comment"># 网络地址（主机号全0）</span><br>        <span class="hljs-keyword">if</span> ip.endswith(<span class="hljs-string">&#x27;.0&#x27;</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;网络地址&#x27;</span><br><br>        <span class="hljs-comment"># 广播地址（主机号全255）</span><br>        <span class="hljs-keyword">if</span> ip.endswith(<span class="hljs-string">&#x27;.255&#x27;</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;广播地址&#x27;</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        全面分析IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串</span><br><span class="hljs-string"></span><br><span class="hljs-string">        返回：</span><br><span class="hljs-string">            分析结果字典</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.validate_ip(ip):<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;valid&#x27;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;IP地址格式不正确&#x27;</span>&#125;<br><br>        result = &#123;<br>            <span class="hljs-string">&#x27;valid&#x27;</span>: <span class="hljs-literal">True</span>,<br>            <span class="hljs-string">&#x27;ip&#x27;</span>: ip,<br>            <span class="hljs-string">&#x27;binary&#x27;</span>: <span class="hljs-variable language_">self</span>.ip_to_binary(ip),<br>            <span class="hljs-string">&#x27;integer&#x27;</span>: <span class="hljs-variable language_">self</span>.ip_to_int(ip),<br>            <span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-variable language_">self</span>.get_ip_class(ip),<br>            <span class="hljs-string">&#x27;is_private&#x27;</span>: <span class="hljs-variable language_">self</span>.is_private_ip(ip),<br>            <span class="hljs-string">&#x27;is_public&#x27;</span>: <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.is_private_ip(ip) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.is_special_ip(ip)[<span class="hljs-number">0</span>],<br>            <span class="hljs-string">&#x27;special&#x27;</span>: <span class="hljs-variable language_">self</span>.is_special_ip(ip)<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">print_analysis</span>(<span class="hljs-params">self, ip</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        打印IP地址分析结果</span><br><span class="hljs-string"></span><br><span class="hljs-string">        参数：</span><br><span class="hljs-string">            ip: IP地址字符串</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IP地址分析结果&quot;</span>.center(<span class="hljs-number">70</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>        result = <span class="hljs-variable language_">self</span>.analyze(ip)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result[<span class="hljs-string">&#x27;valid&#x27;</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n❌ <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;error&#x27;</span>]&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📍 IP地址: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;ip&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔢 十进制: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;integer&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;💾 二进制: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;binary&#x27;</span>]&#125;</span>&quot;</span>)<br><br>        ip_class, usage, range_str = result[<span class="hljs-string">&#x27;class&#x27;</span>]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📊 地址类别: <span class="hljs-subst">&#123;ip_class&#125;</span>类&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   用途: <span class="hljs-subst">&#123;usage&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   范围: <span class="hljs-subst">&#123;range_str&#125;</span>&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🌐 地址类型:&quot;</span>)<br>        <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;special&#x27;</span>][<span class="hljs-number">0</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   ⭐ <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;special&#x27;</span>][<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">elif</span> result[<span class="hljs-string">&#x27;is_private&#x27;</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   🏠 私网IP（不能在互联网上直接访问）&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   🌍 公网IP（可以在互联网上直接访问）&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ips</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    获取本机所有IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        IP地址列表</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 获取主机名</span><br>        hostname = socket.gethostname()<br><br>        <span class="hljs-comment"># 获取所有IP</span><br>        ips = socket.gethostbyname_ex(hostname)[<span class="hljs-number">2</span>]<br><br>        <span class="hljs-keyword">return</span> ips<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> []<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    analyzer = IPAnalyzer()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IP地址分析工具&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>    <span class="hljs-comment"># 显示本机IP</span><br>    local_ips = get_local_ips()<br>    <span class="hljs-keyword">if</span> local_ips:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n💻 本机IP地址:&quot;</span>)<br>        <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> local_ips:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   <span class="hljs-subst">&#123;ip&#125;</span>&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">70</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n请选择操作:&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. 分析IP地址&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. IP地址转换（十进制 ↔ 二进制）&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 批量分析&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;0. 退出&quot;</span>)<br><br>        choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入选项: &quot;</span>).strip()<br><br>        <span class="hljs-keyword">if</span> choice == <span class="hljs-string">&#x27;0&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n再见！&quot;</span>)<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;1&#x27;</span>:<br>            ip = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入IP地址: &quot;</span>).strip()<br>            <span class="hljs-keyword">if</span> ip:<br>                analyzer.print_analysis(ip)<br><br>        <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;2&#x27;</span>:<br>            ip = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请输入IP地址: &quot;</span>).strip()<br>            <span class="hljs-keyword">if</span> ip <span class="hljs-keyword">and</span> analyzer.validate_ip(ip):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n十进制: <span class="hljs-subst">&#123;ip&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;二进制: <span class="hljs-subst">&#123;analyzer.ip_to_binary(ip)&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;整数: <span class="hljs-subst">&#123;analyzer.ip_to_int(ip)&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">&#x27;3&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n请输入多个IP地址（每行一个，输入空行结束）:&quot;</span>)<br>            ips = []<br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                ip = <span class="hljs-built_in">input</span>().strip()<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ip:<br>                    <span class="hljs-keyword">break</span><br>                ips.append(ip)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;IP地址&#x27;</span>:&lt;<span class="hljs-number">18</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;类别&#x27;</span>:&lt;<span class="hljs-number">8</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;类型&#x27;</span>:&lt;<span class="hljs-number">15</span>&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">45</span>)<br><br>            <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> ips:<br>                result = analyzer.analyze(ip)<br>                <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;valid&#x27;</span>]:<br>                    ip_class = result[<span class="hljs-string">&#x27;class&#x27;</span>][<span class="hljs-number">0</span>]<br>                    <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;special&#x27;</span>][<span class="hljs-number">0</span>]:<br>                        ip_type = result[<span class="hljs-string">&#x27;special&#x27;</span>][<span class="hljs-number">1</span>][:<span class="hljs-number">12</span>]<br>                    <span class="hljs-keyword">elif</span> result[<span class="hljs-string">&#x27;is_private&#x27;</span>]:<br>                        ip_type = <span class="hljs-string">&#x27;私网&#x27;</span><br>                    <span class="hljs-keyword">else</span>:<br>                        ip_type = <span class="hljs-string">&#x27;公网&#x27;</span><br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ip:&lt;<span class="hljs-number">18</span>&#125;</span> <span class="hljs-subst">&#123;ip_class:&lt;<span class="hljs-number">8</span>&#125;</span> <span class="hljs-subst">&#123;ip_type:&lt;<span class="hljs-number">15</span>&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python code/day08/day08_ip_analyzer.py<br></code></pre></td></tr></table></figure><h2 id="🎓-知识小结">🎓 知识小结</h2><p>今天我们学习了：</p><ol><li>✅ IP地址是32位二进制数（IPv4）</li><li>✅ IP地址分为5类：A/B/C/D/E</li><li>✅ 私网IP不能在互联网上直接使用</li><li>✅ 特殊IP地址有特定用途</li><li>✅ 能够分析和转换IP地址</li></ol><h2 id="💪-练习题">💪 练习题</h2><ol><li><p>判断以下IP地址的类别和类型：</p><ul><li>10.0.0.1</li><li>172.20.1.1</li><li>202.96.209.133</li><li>127.0.0.1</li></ul></li><li><p>将以下IP转换为二进制：</p><ul><li>192.168.1.1</li><li>255.255.255.0</li></ul></li><li><p>计算：A类地址的网络数和每个网络的主机数</p></li></ol><hr><p>💡 <strong>今日金句</strong>：IP地址是互联网的基石！</p><p>👉 <a href="../week01/day07.md">上一天：Wireshark抓包</a> | <a href="../../README.md">返回目录</a> | <a href="day09.md">下一天：子网划分实战</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>7天：Wireshark抓包入门</title>
    <link href="/2025/11/10/7%E5%A4%A9%EF%BC%9AWireshark%E6%8A%93%E5%8C%85%E5%85%A5%E9%97%A8/"/>
    <url>/2025/11/10/7%E5%A4%A9%EF%BC%9AWireshark%E6%8A%93%E5%8C%85%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1>第7天：Wireshark抓包入门</h1><blockquote><p>“看见网络数据包的流动，就像看见了互联网的血液循环。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>学会安装和使用Wireshark</li><li>掌握基本的抓包和过滤技巧</li><li>能够分析HTTP请求过程</li><li>理解各层协议在实际数据包中的呈现</li></ul><h2 id="🎯-什么是Wireshark？">🎯 什么是Wireshark？</h2><p><strong>Wireshark</strong>是世界上最流行的网络协议分析工具（也叫抓包工具）。</p><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">Wireshark = 网络显微镜<br><br>就像医生用显微镜观察血液：<br><span class="hljs-bullet">- </span>看到红细胞、白细胞<br><span class="hljs-bullet">- </span>分析血液成分<br><span class="hljs-bullet">- </span>诊断健康问题<br><br>Wireshark让你看到网络数据包：<br><span class="hljs-bullet">- </span>看到TCP、HTTP、DNS包<br><span class="hljs-bullet">- </span>分析数据内容<br><span class="hljs-bullet">- </span>诊断网络问题<br></code></pre></td></tr></table></figure><h3 id="Wire">Wire</h3><p>shark的特点</p><ul><li>🔍 <strong>可视化</strong>：图形界面，易于使用</li><li>🎨 <strong>彩色显示</strong>：不同协议不同颜色</li><li>🔎 <strong>强大过滤</strong>：快速找到需要的包</li><li>📊 <strong>统计分析</strong>：流量统计、协议分布</li><li>💾 <strong>保存分析</strong>：可以保存抓包文件</li><li>🌐 <strong>跨平台</strong>：支持Windows、Mac、Linux</li></ul><h2 id="🔧-安装Wireshark">🔧 安装Wireshark</h2><h3 id="下载">下载</h3><p>访问官网：<a href="https://www.wireshark.org/">https://www.wireshark.org/</a></p><h3 id="各平台安装">各平台安装</h3><p><strong>Windows</strong>：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 下载.exe安装包<br><span class="hljs-bullet">2.</span> 双击安装<br><span class="hljs-bullet">3.</span> 安装过程中选择安装WinPcap或Npcap（必需）<br><span class="hljs-bullet">4.</span> 完成后重启计算机<br></code></pre></td></tr></table></figure><p><strong>Mac</strong>：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 下载.dmg文件<br><span class="hljs-bullet">2.</span> 拖动到Applications文件夹<br><span class="hljs-bullet">3.</span> 首次运行可能需要在系统偏好设置中允许<br></code></pre></td></tr></table></figure><p><strong>Linux（Ubuntu/Debian）</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt install wireshark<br><br><span class="hljs-comment"># 添加当前用户到wireshark组</span><br><span class="hljs-built_in">sudo</span> usermod -aG wireshark <span class="hljs-variable">$USER</span><br><br><span class="hljs-comment"># 重新登录生效</span><br></code></pre></td></tr></table></figure><h2 id="📖-Wireshark界面介绍">📖 Wireshark界面介绍</h2><h3 id="主界面布局">主界面布局</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs tap">┌─────────────────────────────────────────────────────────┐<br>│  菜单栏: 文件 编辑 查看 捕获 分析 统计 帮助         │<br>├─────────────────────────────────────────────────────────┤<br>│  工具栏: [开始] [停止] [重启] [保存] ...                │<br>├─────────────────────────────────────────────────────────┤<br>│  过滤器: [___________________________] [应用]           │<br>├─────────────────────────────────────────────────────────┤<br>│  ① 数据包列表区（Packet List）                          │<br>│  No.  Time     Source      Destination  Protocol Info   │<br>│ <span class="hljs-number"> 1 </span>   0.000    192.168.1.1 192.168.1.2  TCP      SYN    │<br>│ <span class="hljs-number"> 2 </span>   0.001    192.168.1.2 192.168.1.1  TCP      ACK    │<br>├─────────────────────────────────────────────────────────┤<br>│  ② 数据包详情区（Packet Details）                       │<br>│  ▶ Frame 1:<span class="hljs-number"> 74 </span>bytes on wire                            │<br>│  ▶ Ethernet II, Src: aa:bb:cc:dd:ee:ff                  │<br>│  ▶ Internet Protocol Version<span class="hljs-number"> 4 </span>                         │<br>│  ▶ Transmission Control Protocol                        │<br>├─────────────────────────────────────────────────────────┤<br>│  ③ 十六进制数据区（Packet Bytes）                       │<br>│ <span class="hljs-number"> 0000 </span><span class="hljs-number"> 00 </span>0c<span class="hljs-number"> 29 </span>6f 6c<span class="hljs-number"> 92 </span>00 0c<span class="hljs-number"> 29 </span>5b 3f e8<span class="hljs-number"> 08 </span>00<span class="hljs-number"> 45 </span>00 │<br>│ <span class="hljs-number"> 0010 </span><span class="hljs-number"> 00 </span>3c f9<span class="hljs-number"> 68 </span>40<span class="hljs-number"> 00 </span>40<span class="hljs-number"> 06 </span>38<span class="hljs-number"> 57 </span>c0 a8<span class="hljs-number"> 01 </span>64 c0 a8 │<br>└─────────────────────────────────────────────────────────┘<br></code></pre></td></tr></table></figure><h3 id="三大区域">三大区域</h3><ol><li><strong>数据包列表区</strong>：显示捕获的所有包</li><li><strong>数据包详情区</strong>：显示选中包的协议层次结构</li><li><strong>十六进制数据区</strong>：显示原始字节数据</li></ol><h2 id="🔍-开始第一次抓包">🔍 开始第一次抓包</h2><h3 id="步骤1：选择网络接口">步骤1：选择网络接口</h3><ol><li>启动Wireshark</li><li>在主界面看到网络接口列表</li><li>选择正在使用的接口（有流量波形的）<ul><li>WiFi：通常是 <code>en0</code>（Mac）或 <code>wlan0</code>（Linux）</li><li>有线：通常是 <code>eth0</code> 或 <code>en0</code></li></ul></li></ol><h3 id="步骤2：开始捕获">步骤2：开始捕获</h3><p>点击接口名称或点击工具栏的&quot;开始捕获&quot;按钮（鲨鱼鳍图标）</p><h3 id="步骤3：生成流量">步骤3：生成流量</h3><p>在浏览器中访问：<a href="http://www.example.com">http://www.example.com</a></p><h3 id="步骤4：停止捕获">步骤4：停止捕获</h3><p>点击工具栏的&quot;停止捕获&quot;按钮（红色方块）</p><h2 id="🎨-认识颜色代码">🎨 认识颜色代码</h2><p>Wireshark用颜色区分不同类型的包：</p><table><thead><tr><th>颜色</th><th>协议/类型</th><th>含义</th></tr></thead><tbody><tr><td>浅紫色</td><td>TCP</td><td>TCP协议</td></tr><tr><td>浅蓝色</td><td>UDP</td><td>UDP协议</td></tr><tr><td>黑色</td><td>有问题的包</td><td>校验和错误、重传等</td></tr><tr><td>浅绿色</td><td>HTTP</td><td>HTTP协议</td></tr><tr><td>浅黄色</td><td>Windows特定</td><td>NetBIOS、SMB等</td></tr><tr><td>深灰色</td><td>TCP重传</td><td>数据包重传</td></tr></tbody></table><h2 id="🔎-过滤器使用">🔎 过滤器使用</h2><h3 id="显示过滤器（Display-Filter）">显示过滤器（Display Filter）</h3><p><strong>在工具栏的过滤器框中输入</strong>，用于过滤已捕获的包。</p><h4 id="常用过滤器">常用过滤器</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># 只显示HTTP</span><br><span class="hljs-attribute">http</span><br><br><span class="hljs-comment"># 只显示TCP</span><br>tcp<br><br><span class="hljs-comment"># 只显示特定IP</span><br>ip.addr == <span class="hljs-number">192.168.1.100</span><br><br><span class="hljs-comment"># 只显示源IP</span><br>ip.src == <span class="hljs-number">192.168.1.100</span><br><br><span class="hljs-comment"># 只显示目标IP</span><br>ip.dst == <span class="hljs-number">8.8.8.8</span><br><br><span class="hljs-comment"># 只显示特定端口</span><br>tcp.port == <span class="hljs-number">80</span><br><br><span class="hljs-comment"># 组合条件（AND）</span><br>ip.addr == <span class="hljs-number">192.168.1.100</span> &amp;&amp; tcp.port == <span class="hljs-number">80</span><br><br><span class="hljs-comment"># 组合条件（OR）</span><br>http || dns<br><br><span class="hljs-comment"># 排除（NOT）</span><br>!arp<br><br><span class="hljs-comment"># HTTP GET请求</span><br>http.request.method == <span class="hljs-string">&quot;GET&quot;</span><br><br><span class="hljs-comment"># DNS查询</span><br>dns.flags.response == <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="捕获过滤器（Capture-Filter）">捕获过滤器（Capture Filter）</h3><p><strong>在开始捕获前设置</strong>，只捕获符合条件的包。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 只捕获80端口</span><br><span class="hljs-attribute">port</span> <span class="hljs-number">80</span><br><br><span class="hljs-comment"># 只捕获特定主机</span><br><span class="hljs-attribute">host</span> <span class="hljs-number">192.168.1.100</span><br><br><span class="hljs-comment"># 只捕获TCP</span><br><span class="hljs-attribute">tcp</span><br><br><span class="hljs-comment"># 组合条件</span><br><span class="hljs-attribute">host</span> <span class="hljs-number">192.168.1.100</span> and port <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><h2 id="🔬-实战：分析HTTP请求">🔬 实战：分析HTTP请求</h2><p>让我们实际抓取并分析一个HTTP请求！</p><h3 id="步骤1：设置过滤器">步骤1：设置过滤器</h3><p>在开始前，设置显示过滤器：<code>http</code></p><h3 id="步骤2：开始捕获-2">步骤2：开始捕获</h3><p>点击开始按钮</p><h3 id="步骤3：访问网站">步骤3：访问网站</h3><p>在浏览器访问：<a href="http://www.example.com">http://www.example.com</a><br>（注意：必须是http，不是https）</p><h3 id="步骤4：停止并分析">步骤4：停止并分析</h3><p>停止捕获，你会看到HTTP请求和响应。</p><h3 id="分析HTTP-GET请求">分析HTTP GET请求</h3><p>找到一个HTTP GET请求包，点击它：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">在数据包详情区，你会看到：</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">▶ Frame 123</span><span class="hljs-punctuation">:</span> <span class="hljs-string">502 bytes on wire</span><br>  <span class="hljs-attribute">├─ 物理层信息</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">▶ Ethernet II</span><br><span class="hljs-attribute">  ├─ Destination</span><span class="hljs-punctuation">:</span> <span class="hljs-string">xx:xx:xx:xx:xx:xx</span><br>  <span class="hljs-attribute">├─ Source</span><span class="hljs-punctuation">:</span> <span class="hljs-string">yy:yy:yy:yy:yy:yy</span><br>  <span class="hljs-attribute">└─ Type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">IPv4 (0x0800)</span><br>    <span class="hljs-comment"># 数据链路层：MAC地址</span><br><br><span class="hljs-attribute">▶ Internet Protocol Version 4</span><br><span class="hljs-attribute">  ├─ Source</span><span class="hljs-punctuation">:</span> <span class="hljs-string">192.168.1.100</span><br>  <span class="hljs-attribute">├─ Destination</span><span class="hljs-punctuation">:</span> <span class="hljs-string">93.184.216.34</span><br>  <span class="hljs-attribute">├─ Protocol</span><span class="hljs-punctuation">:</span> <span class="hljs-string">TCP (6)</span><br>  <span class="hljs-attribute">└─ TTL</span><span class="hljs-punctuation">:</span> <span class="hljs-string">64</span><br>    <span class="hljs-comment"># 网际层：IP地址</span><br><br><span class="hljs-attribute">▶ Transmission Control Protocol</span><br><span class="hljs-attribute">  ├─ Source Port</span><span class="hljs-punctuation">:</span> <span class="hljs-string">54321</span><br>  <span class="hljs-attribute">├─ Destination Port</span><span class="hljs-punctuation">:</span> <span class="hljs-string">80</span><br>  <span class="hljs-attribute">├─ Sequence number</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1</span><br>  <span class="hljs-attribute">└─ Flags</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0x018 (PSH, ACK)</span><br>    <span class="hljs-comment"># 传输层：端口号</span><br><br><span class="hljs-attribute">▶ Hypertext Transfer Protocol</span><br><span class="hljs-attribute">  ├─ GET / HTTP/1.1\r\n</span><br><span class="hljs-attribute">  ├─ Host</span><span class="hljs-punctuation">:</span> <span class="hljs-string">www.example.com\r\n</span><br>  <span class="hljs-attribute">├─ User-Agent</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Mozilla/5.0...\r\n</span><br>  <span class="hljs-attribute">├─ Accept</span><span class="hljs-punctuation">:</span> <span class="hljs-string">text/html...\r\n</span><br>  └─ \r\n<br>    <span class="hljs-comment"># 应用层：HTTP协议</span><br></code></pre></td></tr></table></figure><p><strong>看到了什么？</strong></p><ul><li>✅ 完整的TCP/IP四层结构！</li><li>✅ 每一层的头部信息</li><li>✅ HTTP请求的完整内容</li></ul><h3 id="分析HTTP响应">分析HTTP响应</h3><p>找到对应的HTTP响应包：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">▶ Hypertext Transfer Protocol<br>  ├─ HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK\<span class="hljs-attribute">r</span>\n<br>  ├─ Content-Type: text/html\<span class="hljs-attribute">r</span>\n<br>  ├─ Content-Length: <span class="hljs-number">1256</span>\<span class="hljs-attribute">r</span>\n<br>  ├─ Server: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">41</span>\<span class="hljs-attribute">r</span>\n<br>  └─ \<span class="hljs-attribute">r</span>\n<br>  └─ <span class="hljs-selector-attr">[HTML content]</span><br></code></pre></td></tr></table></figure><h2 id="💡-实用技巧">💡 实用技巧</h2><h3 id="1-跟踪TCP流">1. 跟踪TCP流</h3><p>右键点击一个TCP包 → Follow → TCP Stream</p><p><strong>作用</strong>：查看完整的TCP会话内容（所有来回的数据）</p><h3 id="2-统计信息">2. 统计信息</h3><p>菜单：Statistics → Protocol Hierarchy</p><p><strong>作用</strong>：查看各种协议的流量占比</p><h3 id="3-导出对象">3. 导出对象</h3><p>菜单：File → Export Objects → HTTP</p><p><strong>作用</strong>：提取HTTP传输的文件（图片、HTML等）</p><h3 id="4-时间列显示">4. 时间列显示</h3><p>右键点击Time列 → Display Format → 选择格式</p><p><strong>推荐</strong>：选择&quot;Seconds Since Previous Displayed Packet&quot;查看包间隔</p><h3 id="5-查找包">5. 查找包</h3><p>Ctrl+F（Windows/Linux）或 Cmd+F（Mac）</p><p>可以搜索：</p><ul><li>显示过滤器</li><li>十六进制值</li><li>字符串</li></ul><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ Wireshark是最强大的网络协议分析工具</li><li>✅ 可以看到每个数据包的完整结构</li><li>✅ 过滤器可以快速定位需要的包</li><li>✅ 可以分析HTTP、TCP、IP等各层协议</li><li>✅ 实际验证了前几天学习的协议知识</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>含义</th><th>用途</th></tr></thead><tbody><tr><td>抓包</td><td>捕获网络数据包</td><td>分析网络行为</td></tr><tr><td>显示过滤器</td><td>过滤已捕获的包</td><td>查看特定包</td></tr><tr><td>捕获过滤器</td><td>只捕获特定的包</td><td>减少文件大小</td></tr><tr><td>跟踪流</td><td>查看完整会话</td><td>理解通信过程</td></tr></tbody></table><h3 id="常用过滤器速查">常用过滤器速查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 协议过滤</span><br>http, tcp, udp, dns, icmp<br><br><span class="hljs-comment"># IP过滤</span><br>ip.addr == 192.168.1.1<br>ip.src == 192.168.1.1<br>ip.dst == 8.8.8.8<br><br><span class="hljs-comment"># 端口过滤</span><br>tcp.port == 80<br>tcp.srcport == 80<br>tcp.dstport == 443<br><br><span class="hljs-comment"># HTTP过滤</span><br>http.request<br>http.response<br>http.request.method == <span class="hljs-string">&quot;POST&quot;</span><br><br><span class="hljs-comment"># 逻辑运算</span><br>&amp;&amp; (AND)<br>|| (OR)<br>! (NOT)<br></code></pre></td></tr></table></figure><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：基础抓包">练习1：基础抓包</h3><ol><li>抓取访问baidu.com的数据包</li><li>找到DNS查询包</li><li>找到TCP三次握手的三个包</li><li>找到HTTP请求和响应</li></ol><h3 id="练习2：过滤器练习">练习2：过滤器练习</h3><p>使用过滤器完成以下任务：</p><ol><li>只显示你的电脑发送的包</li><li>只显示HTTP POST请求</li><li>显示所有到8.8.8.8的包</li><li>显示DNS查询但不显示响应</li></ol><h3 id="练习3：协议分析">练习3：协议分析</h3><p>抓取一个完整的HTTP请求，分析：</p><ol><li>TCP三次握手过程</li><li>HTTP请求头部内容</li><li>HTTP响应状态码</li><li>TCP四次挥手过程</li></ol><h3 id="练习4：进阶任务">练习4：进阶任务</h3><ol><li>导出一个网页传输的图片</li><li>统计5分钟内各协议的流量占比</li><li>找出延迟最大的数据包</li><li>分析一个TCP重传的包</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="为什么HTTPS不能抓包？">为什么HTTPS不能抓包？</h3><p>HTTPS是加密的：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">HTTP:  明文传输，Wireshark可以看到内容<br>HTTPS: 加密传输，Wireshark只能看到加密数据<br><br>要抓取HTTPS内容需要：<br><span class="hljs-bullet">1.</span> 安装证书<br><span class="hljs-bullet">2.</span> 配置浏览器导出密钥<br><span class="hljs-bullet">3.</span> 在Wireshark中配置SSL密钥日志<br></code></pre></td></tr></table></figure><h3 id="Wireshark的替代工具">Wireshark的替代工具</h3><ul><li><strong>tcpdump</strong>：命令行抓包工具</li><li><strong>Charles</strong>：专注HTTP/HTTPS的工具</li><li><strong>Fiddler</strong>：Windows上的HTTP调试工具</li><li><strong>mitmproxy</strong>：命令行的中间人代理</li></ul><h3 id="实际应用场景">实际应用场景</h3><ol><li><strong>Web开发调试</strong>：查看HTTP请求和响应</li><li><strong>网络故障排查</strong>：分析丢包、延迟</li><li><strong>安全分析</strong>：检测异常流量</li><li><strong>学习协议</strong>：深入理解网络协议</li><li><strong>性能优化</strong>：分析网络瓶颈</li></ol><h2 id="🎯-下一步：第一周总结">🎯 下一步：第一周总结</h2><p><strong>明天我们将总结第一周的所有内容！</strong></p><p>回顾：</p><ul><li>网络基础概念</li><li>OSI和TCP/IP模型</li><li>ping和traceroute命令</li><li>Wireshark抓包分析</li></ul><p>准备好进行第一周的综合测验了吗？</p><hr><p>💡 <strong>今日金句</strong>：Wireshark让不可见的网络数据包变得可见！</p><p>👉 <a href="day06.md">上一天：traceroute详解</a> | <a href="../../README.md">返回目录</a> | <a href="week_summary.md">下一天：第一周总结</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一周总结：网络基础入门</title>
    <link href="/2025/11/10/%E4%B8%80%E5%91%A8%E6%80%BB%E7%BB%93%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"/>
    <url>/2025/11/10/%E4%B8%80%E5%91%A8%E6%80%BB%E7%BB%93%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1>第一周总结：网络基础入门</h1><blockquote><p>“万丈高楼平地起，扎实基础是关键。”</p></blockquote><h2 id="🎯-本周回顾">🎯 本周回顾</h2><p>恭喜你完成了第一周的学习！让我们回顾一下这一周的精彩内容。</p><h3 id="📚-本周学习内容">📚 本周学习内容</h3><table><thead><tr><th>天数</th><th>主题</th><th>核心内容</th><th>实战项目</th></tr></thead><tbody><tr><td>第1天</td><td>认识计算机网络</td><td>网络基本概念、作用</td><td>网络连接检测工具</td></tr><tr><td>第2天</td><td>网络分类和拓扑</td><td>LAN/WAN/MAN、拓扑结构</td><td>局域网设备扫描器</td></tr><tr><td>第3天</td><td>OSI七层模型</td><td>七层结构、数据封装</td><td>协议分层演示</td></tr><tr><td>第4天</td><td>TCP/IP四层模型</td><td>实际应用模型、协议</td><td>数据包分析器</td></tr><tr><td>第5天</td><td>ping命令</td><td>ICMP协议、RTT</td><td>简易ping工具</td></tr><tr><td>第6天</td><td>traceroute命令</td><td>路由追踪、TTL</td><td>简易traceroute工具</td></tr><tr><td>第7天</td><td>Wireshark抓包</td><td>抓包分析、过滤器</td><td>实际抓包分析</td></tr></tbody></table><h2 id="📖-知识点总结">📖 知识点总结</h2><h3 id="1-网络基础概念">1. 网络基础概念</h3><p><strong>什么是计算机网络？</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">计算机网络 = 多台计算机通过通信线路连接<br><span class="hljs-bullet">             +</span> 共享资源<br><span class="hljs-bullet">             +</span> 交换信息<br></code></pre></td></tr></table></figure><p><strong>网络的分类</strong>：</p><ul><li>LAN（局域网）：家庭、办公室（几米到几公里）</li><li>MAN（城域网）：城市范围（几十公里）</li><li>WAN（广域网）：跨国、跨洲（几百到几万公里）</li></ul><p><strong>网络拓扑结构</strong>：</p><ul><li>总线型：所有设备连在一条线上</li><li>星型：所有设备连到中心节点（最常用）</li><li>环型：设备首尾相连成环</li><li>网状型：设备互相连接</li><li>树型：分层结构</li></ul><h3 id="2-OSI七层模型">2. OSI七层模型</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino">第<span class="hljs-number">7</span>层 - 应用层（Application）      → HTTP, FTP, DNS<br>第<span class="hljs-number">6</span>层 - 表示层（Presentation）     → 加密, 压缩<br>第<span class="hljs-number">5</span>层 - 会话层（Session）          → 会话管理<br>第<span class="hljs-number">4</span>层 - 传输层（Transport）        → TCP, UDP<br>第<span class="hljs-number">3</span>层 - 网络层（Network）          → IP, ICMP<br>第<span class="hljs-number">2</span>层 - 数据链路层（Data Link）    → <span class="hljs-built_in">Ethernet</span>, <span class="hljs-built_in">WiFi</span><br>第<span class="hljs-number">1</span>层 - 物理层（Physical）         → 网线, 光纤<br></code></pre></td></tr></table></figure><p><strong>记忆口诀</strong>：应表会传网数物</p><p><strong>数据封装过程</strong>：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">应用数据 → [传输层头|<span class="hljs-string">数据] → [网络层头</span>|<span class="hljs-string">传输层头</span>|<span class="hljs-string">数据]</span><br><span class="hljs-string">→ [链路层头</span>|<span class="hljs-string">网络层头</span>|<span class="hljs-string">传输层头</span>|<span class="hljs-string">数据</span>|<span class="hljs-string">链路层尾]</span><br></code></pre></td></tr></table></figure><h3 id="3-TCP-IP四层模型">3. TCP/IP四层模型</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs arduino">┌────────────────┐<br>│  应用层        │  HTTP, DNS, FTP, SSH<br>├────────────────┤<br>│  传输层        │  TCP, UDP<br>├────────────────┤<br>│  网际层        │  IP, ICMP, ARP<br>├────────────────┤<br>│  网络接口层    │  <span class="hljs-built_in">Ethernet</span>, <span class="hljs-built_in">WiFi</span><br>└────────────────┘<br></code></pre></td></tr></table></figure><p><strong>TCP/IP vs OSI</strong>：</p><ul><li>OSI：理论模型（7层）</li><li>TCP/IP：实际使用（4层）</li></ul><h3 id="4-关键协议">4. 关键协议</h3><h4 id="IP协议（Internet-Protocol）">IP协议（Internet Protocol）</h4><ul><li>作用：寻址和路由</li><li>IP地址：192.168.1.100</li><li>版本：IPv4（32位）、IPv6（128位）</li></ul><h4 id="TCP协议（Transmission-Control-Protocol）">TCP协议（Transmission Control Protocol）</h4><ul><li>作用：可靠传输</li><li>特点：面向连接、可靠、有序</li><li>端口：标识应用程序</li></ul><h4 id="UDP协议（User-Datagram-Protocol）">UDP协议（User Datagram Protocol）</h4><ul><li>作用：快速传输</li><li>特点：无连接、不可靠、简单快速</li></ul><h4 id="ICMP协议（Internet-Control-Message-Protocol）">ICMP协议（Internet Control Message Protocol）</h4><ul><li>作用：错误报告、网络诊断</li><li>应用：ping、traceroute</li></ul><h4 id="HTTP协议（Hypertext-Transfer-Protocol）">HTTP协议（Hypertext Transfer Protocol）</h4><ul><li>作用：网页传输</li><li>端口：80（HTTP）、443（HTTPS）</li><li>方法：GET、POST、PUT、DELETE等</li></ul><h3 id="5-重要概念">5. 重要概念</h3><p><strong>MAC地址</strong>：</p><ul><li>网卡的物理地址</li><li>格式：AA:BB:CC:DD:EE:FF</li><li>作用：局域网内通信</li></ul><p><strong>IP地址</strong>：</p><ul><li>网络中设备的逻辑地址</li><li>格式：192.168.1.1</li><li>作用：跨网络通信</li></ul><p><strong>端口号</strong>：</p><ul><li>标识主机上的应用程序</li><li>范围：0-65535</li><li>常用：80(HTTP)、443(HTTPS)、22(SSH)</li></ul><p><strong>TTL（Time To Live）</strong>：</p><ul><li>数据包的生存时间</li><li>每经过一个路由器减1</li><li>为0时被丢弃</li></ul><p><strong>RTT（Round-Trip Time）</strong>：</p><ul><li>往返时间</li><li>从发送到收到回复的时间</li><li>单位：毫秒(ms)</li></ul><h3 id="6-网络工具">6. 网络工具</h3><p><strong>ping</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 测试连通性</span><br>ping baidu.com<br><br><span class="hljs-comment"># 发送4个包</span><br>ping -c 4 baidu.com  <span class="hljs-comment"># Linux/Mac</span><br>ping -n 4 baidu.com  <span class="hljs-comment"># Windows</span><br></code></pre></td></tr></table></figure><p><strong>traceroute</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 追踪路由路径</span><br>traceroute baidu.com  <span class="hljs-comment"># Linux/Mac</span><br>tracert baidu.com     <span class="hljs-comment"># Windows</span><br></code></pre></td></tr></table></figure><p><strong>Wireshark</strong>：</p><ul><li>图形化抓包工具</li><li>支持多种协议分析</li><li>强大的过滤功能</li></ul><h2 id="🧪-综合练习题">🧪 综合练习题</h2><h3 id="一、选择题">一、选择题</h3><ol><li><p>以下哪个不是网络拓扑结构？<br>A. 星型  B. 环型  C. 圆型  D. 总线型</p></li><li><p>TCP/IP模型有几层？<br>A. 4层  B. 5层  C. 7层  D. 9层</p></li><li><p>ping命令使用的是哪个协议？<br>A. TCP  B. UDP  C. ICMP  D. HTTP</p></li><li><p>以下哪个IP地址是私网地址？<br>A. 8.8.8.8  B. 192.168.1.1  C. 114.114.114.114  D. 220.181.38.148</p></li><li><p>HTTP协议默认使用哪个端口？<br>A. 22  B. 80  C. 443  D. 3306</p></li></ol><h3 id="二、简答题">二、简答题</h3><ol><li><p>解释OSI模型中每一层的主要作用。</p></li><li><p>TCP和UDP有什么区别？各自适用于什么场景？</p></li><li><p>说明ping命令的工作原理。</p></li><li><p>什么是子网掩码？192.168.1.0/24是什么意思？</p></li><li><p>数据包从应用层到物理层的封装过程是怎样的？</p></li></ol><h3 id="三、实践题">三、实践题</h3><ol><li><p><strong>网络诊断</strong></p><ul><li>使用ping测试到baidu.com的连通性</li><li>记录RTT和TTL值</li><li>分析结果说明什么</li></ul></li><li><p><strong>路径追踪</strong></p><ul><li>使用traceroute追踪到google.com的路径</li><li>记录经过的跳数</li><li>哪一跳延迟最大？为什么？</li></ul></li><li><p><strong>抓包分析</strong></p><ul><li>使用Wireshark抓取访问<a href="http://www.example.xn--com-n82e636edycn86b">http://www.example.com的数据包</a></li><li>找出DNS查询包</li><li>找出TCP三次握手的包</li><li>找出HTTP GET请求包</li><li>分析每个包的各层结构</li></ul></li><li><p><strong>局域网扫描</strong></p><ul><li>扫描你所在的局域网</li><li>列出所有在线设备的IP和MAC地址</li><li>绘制简单的网络拓扑图</li></ul></li></ol><h2 id="🚀-综合实战项目">🚀 综合实战项目</h2><h3 id="项目：网络诊断工具箱">项目：网络诊断工具箱</h3><p><strong>需求</strong>：<br>开发一个综合的网络诊断工具，整合本周学到的所有知识。</p><p><strong>功能</strong>：</p><ol><li><strong>连通性测试</strong>：ping功能</li><li><strong>路由追踪</strong>：traceroute功能</li><li><strong>端口扫描</strong>：扫描指定主机的开放端口</li><li><strong>局域网扫描</strong>：发现局域网内的所有设备</li><li><strong>DNS查询</strong>：查询域名的IP地址</li><li><strong>网络信息</strong>：显示本机网络配置</li></ol><p><strong>实现提示</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day08_network_toolbox.py</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkToolbox</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">self, host</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;测试连通性&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">traceroute</span>(<span class="hljs-params">self, host</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;追踪路由&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_ports</span>(<span class="hljs-params">self, host, ports</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;扫描端口&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_lan</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;扫描局域网&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dns_lookup</span>(<span class="hljs-params">self, domain</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;DNS查询&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_network_info</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;获取本机网络信息&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    toolbox = NetworkToolbox()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== 网络诊断工具箱 ===&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1. Ping测试&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2. 路由追踪&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3. 端口扫描&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4. 局域网扫描&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;5. DNS查询&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;6. 网络信息&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;0. 退出&quot;</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n请选择功能: &quot;</span>)<br>        <span class="hljs-comment"># 根据choice调用相应功能</span><br>        ...<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p><strong>评分标准</strong>：</p><ul><li>功能完整性：40分</li><li>代码质量：30分</li><li>用户体验：20分</li><li>创新性：10分</li></ul><h2 id="📊-自我评估">📊 自我评估</h2><h3 id="检查清单">检查清单</h3><p>完成本周学习后，你应该能够：</p><ul><li>[ ] 解释什么是计算机网络</li><li>[ ] 说出网络的三种分类</li><li>[ ] 画出五种网络拓扑结构</li><li>[ ] 列出OSI七层模型的每一层</li><li>[ ] 说明TCP/IP四层模型</li><li>[ ] 理解数据包的封装过程</li><li>[ ] 使用ping命令测试网络</li><li>[ ] 使用traceroute追踪路由</li><li>[ ] 使用Wireshark抓包</li><li>[ ] 编写简单的网络诊断程序</li></ul><h3 id="掌握程度评估">掌握程度评估</h3><p>为每个知识点打分（1-5分）：</p><table><thead><tr><th>知识点</th><th>掌握程度</th></tr></thead><tbody><tr><td>网络基础概念</td><td>□□□□□</td></tr><tr><td>网络分类和拓扑</td><td>□□□□□</td></tr><tr><td>OSI七层模型</td><td>□□□□□</td></tr><tr><td>TCP/IP四层模型</td><td>□□□□□</td></tr><tr><td>常用协议理解</td><td>□□□□□</td></tr><tr><td>ping命令使用</td><td>□□□□□</td></tr><tr><td>traceroute使用</td><td>□□□□□</td></tr><tr><td>Wireshark使用</td><td>□□□□□</td></tr><tr><td>网络编程基础</td><td>□□□□□</td></tr></tbody></table><p>如果某项低于3分，建议复习对应章节。</p><h2 id="💡-学习心得">💡 学习心得</h2><p><strong>思考题</strong>：</p><ol><li>本周学习中，哪个知识点你觉得最难理解？</li><li>哪个实战项目你觉得最有趣？</li><li>你遇到了什么困难？如何解决的？</li><li>对下周的学习有什么期待？</li></ol><p><strong>建议</strong>：</p><ul><li>写下你的学习心得</li><li>记录遇到的问题和解决方法</li><li>整理笔记，建立知识体系</li><li>多动手实践，光看不练假把式</li></ul><h2 id="🎯-下周预告">🎯 下周预告</h2><p><strong>第二周：深入理解网络模型</strong></p><p>我们将学习：</p><ul><li>第8天：IP地址详解</li><li>第9天：子网划分实战</li><li>第10天：MAC地址和ARP协议</li><li>第11天：端口和Socket深入</li><li>第12天：DNS协议详解</li><li>第13天：DHCP协议</li><li>第14天：第二周总结和项目</li></ul><p><strong>预习建议</strong>：</p><ul><li>复习本周的IP地址概念</li><li>了解二进制和十进制转换</li><li>思考：为什么需要子网划分？</li></ul><h2 id="🏆-成就解锁">🏆 成就解锁</h2><p>恭喜你完成第一周的学习！你已经解锁：</p><p>✅ <strong>网络入门者</strong>：完成第一周所有内容<br>✅ <strong>抓包新手</strong>：学会使用Wireshark<br>✅ <strong>诊断助手</strong>：会使用ping和traceroute<br>✅ <strong>代码实践者</strong>：编写了5个网络工具</p><p><strong>继续加油，向着网络大师的目标前进！</strong> 💪</p><hr><h2 id="📚-参考资料">📚 参考资料</h2><h3 id="推荐书籍">推荐书籍</h3><ul><li>《计算机网络：自顶向下方法》</li><li>《图解TCP/IP》</li><li>《网络是怎样连接的》</li></ul><h3 id="在线资源">在线资源</h3><ul><li>Wireshark官方文档：<a href="https://www.wireshark.org/docs/">https://www.wireshark.org/docs/</a></li><li>RFC文档库：<a href="https://www.rfc-editor.org/">https://www.rfc-editor.org/</a></li><li>TCP/IP指南：各大技术博客</li></ul><h3 id="练习网站">练习网站</h3><ul><li>HackerRank网络题目</li><li>LeetCode网络相关题</li><li>实验楼网络课程</li></ul><hr><p>💡 <strong>本周金句</strong>：千里之行始于足下，网络学习贵在坚持！</p><p>👉 <a href="day01.md">返回第1天</a> | <a href="../../README.md">返回目录</a> | <a href="../week02/day08.md">进入第2周</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>6天：网络命令进阶 - traceroute</title>
    <link href="/2025/11/10/6%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%BF%9B%E9%98%B6%20-%20traceroute/"/>
    <url>/2025/11/10/6%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%BF%9B%E9%98%B6%20-%20traceroute/</url>
    
    <content type="html"><![CDATA[<h1>第6天：网络命令进阶 - traceroute</h1><blockquote><p>“看看数据包是怎样环游世界的。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解traceroute的工作原理</li><li>掌握如何追踪网络路径</li><li>深入理解TTL的作用机制</li><li>编写自己的traceroute工具</li></ul><h2 id="🎯-什么是traceroute？">🎯 什么是traceroute？</h2><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">traceroute</span> <span class="hljs-operator">=</span> 追踪快递路线<br><br>你的包裹从北京到上海：<br>北京 → 石家庄中转站 → 济南中转站 → 南京中转站 → 上海<br><br>traceroute就是显示数据包经过的所有<span class="hljs-string">&quot;中转站&quot;</span>（路由器）<br></code></pre></td></tr></table></figure><p><strong>traceroute</strong>（Windows上叫tracert）是用来显示数据包从源到目的地所经过的路由路径的工具。</p><h3 id="traceroute的作用">traceroute的作用</h3><ol><li><strong>诊断网络故障</strong>：找出哪个路由器出问题了</li><li><strong>分析网络路径</strong>：了解数据包的传输路线</li><li><strong>测量延迟</strong>：看每一跳的延迟</li><li><strong>发现网络瓶颈</strong>：找出哪里最慢</li></ol><h2 id="🔍-traceroute的工作原理">🔍 traceroute的工作原理</h2><h3 id="核心思想：利用TTL">核心思想：利用TTL</h3><p>还记得昨天学的TTL吗？</p><ul><li>每个数据包都有TTL（Time To Live）</li><li>每经过一个路由器，TTL减1</li><li>当TTL=0时，路由器丢弃数据包，并返回&quot;超时&quot;错误（ICMP Time Exceeded）</li></ul><p><strong>traceroute的巧妙之处</strong>：故意设置小的TTL值！</p><h3 id="完整流程">完整流程</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs routeros">第1步：发送<span class="hljs-attribute">TTL</span>=1的包<br>┌──────┐  <span class="hljs-attribute">TTL</span>=1   ┌────────┐<br>│ 你的 │ ───────&gt; │ 路由器1 │<br>│ 电脑 │          └────────┘<br>└──────┘          TTL变成0！<br>                  返回<span class="hljs-string">&quot;超时&quot;</span>消息<br>                  (ICMP Time Exceeded)<br><br>→ 得知第1跳是路由器1<br><br>第2步：发送<span class="hljs-attribute">TTL</span>=2的包<br>┌──────┐  <span class="hljs-attribute">TTL</span>=2   ┌────────┐  <span class="hljs-attribute">TTL</span>=1   ┌────────┐<br>│ 你的 │ ───────&gt; │ 路由器1 │ ───────&gt; │ 路由器2 │<br>│ 电脑 │          └────────┘          └────────┘<br>└──────┘                              TTL变成0！<br>                                      返回<span class="hljs-string">&quot;超时&quot;</span>消息<br><br>→ 得知第2跳是路由器2<br><br>第3步：发送<span class="hljs-attribute">TTL</span>=3的包<br>（依此类推，直到到达目的地）<br></code></pre></td></tr></table></figure><h3 id="图解示意">图解示意</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs 1c">你的电脑 <span class="hljs-punctuation">(</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span><span class="hljs-punctuation">)</span><br>    <span class="hljs-string">|</span><br>    <span class="hljs-string">| TTL=1</span><br>    v<br>路由器<span class="hljs-number">1</span> <span class="hljs-punctuation">(</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span><span class="hljs-punctuation">)</span>     → 返回<span class="hljs-punctuation">:</span> Time Exceeded<br>    <span class="hljs-string">|</span><br>    <span class="hljs-string">| TTL=2</span><br>    v<br>路由器<span class="hljs-number">2</span> <span class="hljs-punctuation">(</span><span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span><span class="hljs-punctuation">)</span>        → 返回<span class="hljs-punctuation">:</span> Time Exceeded<br>    <span class="hljs-string">|</span><br>    <span class="hljs-string">| TTL=3</span><br>    v<br>路由器<span class="hljs-number">3</span> <span class="hljs-punctuation">(</span><span class="hljs-number">61.135</span>.<span class="hljs-number">169.1</span><span class="hljs-punctuation">)</span>    → 返回<span class="hljs-punctuation">:</span> Time Exceeded<br>    <span class="hljs-string">|</span><br>    <span class="hljs-string">| TTL=4</span><br>    v<br>目标服务器 <span class="hljs-punctuation">(</span><span class="hljs-number">220.181</span>.<span class="hljs-number">38.148</span><span class="hljs-punctuation">)</span> → 返回<span class="hljs-punctuation">:</span> Echo Reply<br></code></pre></td></tr></table></figure><h2 id="🔧-使用traceroute命令">🔧 使用traceroute命令</h2><h3 id="基本用法">基本用法</h3><p><strong>Linux/Mac</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本traceroute</span><br>traceroute baidu.com<br><br><span class="hljs-comment"># 限制最大跳数</span><br>traceroute -m 20 baidu.com<br><br><span class="hljs-comment"># 不解析域名（更快）</span><br>traceroute -n baidu.com<br><br><span class="hljs-comment"># 使用ICMP而不是UDP</span><br>traceroute -I baidu.com<br></code></pre></td></tr></table></figure><p><strong>Windows</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本tracert</span><br>tracert baidu.com<br><br><span class="hljs-comment"># 限制最大跳数</span><br>tracert -h 20 baidu.com<br><br><span class="hljs-comment"># 不解析域名</span><br>tracert -d baidu.com<br></code></pre></td></tr></table></figure><h3 id="输出解析">输出解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ traceroute baidu.com<br><br>traceroute to baidu.com (220.181.38.148), 30 hops max, 60 byte packets<br> 1  192.168.1.1 (192.168.1.1)          1.234 ms  1.123 ms  1.089 ms<br> 2  10.0.0.1 (10.0.0.1)                5.678 ms  5.432 ms  5.345 ms<br> 3  61.135.169.1 (61.135.169.1)        12.345 ms 12.234 ms 12.123 ms<br> 4  61.135.169.125 (61.135.169.125)    15.678 ms 15.567 ms 15.456 ms<br> 5  * * *<br> 6  220.181.38.148 (220.181.38.148)    28.901 ms 28.789 ms 28.678 ms<br></code></pre></td></tr></table></figure><p><strong>字段含义</strong>：</p><ul><li>第1列：跳数（hop number）</li><li>第2列：路由器的IP地址和主机名</li><li>后3列：三次测试的RTT（往返时间）</li><li><code>* * *</code>：该路由器没有回应（可能禁用了ICMP）</li></ul><h2 id="🔧-实战项目：实现简易traceroute工具">🔧 实战项目：实现简易traceroute工具</h2><p>让我们用Python实现traceroute！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day06_simple_traceroute.py</span><br><span class="hljs-comment"># 功能：实现简单的traceroute工具</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_checksum</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    计算ICMP校验和（与ping工具中的相同）</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>:<br>        data += <span class="hljs-string">b&#x27;\x00&#x27;</span><br><br>    checksum = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">2</span>):<br>        word = (data[i] &lt;&lt; <span class="hljs-number">8</span>) + data[i + <span class="hljs-number">1</span>]<br>        checksum += word<br><br>    <span class="hljs-keyword">while</span> checksum &gt;&gt; <span class="hljs-number">16</span>:<br>        checksum = (checksum &amp; <span class="hljs-number">0xFFFF</span>) + (checksum &gt;&gt; <span class="hljs-number">16</span>)<br><br>    checksum = ~checksum &amp; <span class="hljs-number">0xFFFF</span><br>    <span class="hljs-keyword">return</span> checksum<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_icmp_packet</span>(<span class="hljs-params">packet_id, sequence</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    创建ICMP Echo Request数据包</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    icmp_type = <span class="hljs-number">8</span>  <span class="hljs-comment"># Echo Request</span><br>    icmp_code = <span class="hljs-number">0</span><br>    icmp_checksum = <span class="hljs-number">0</span><br><br>    header = struct.pack(<span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_type, icmp_code, icmp_checksum,<br>                         packet_id, sequence)<br>    data = struct.pack(<span class="hljs-string">&#x27;!d&#x27;</span>, time.time())<br><br>    icmp_checksum = calculate_checksum(header + data)<br>    header = struct.pack(<span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_type, icmp_code, icmp_checksum,<br>                         packet_id, sequence)<br><br>    <span class="hljs-keyword">return</span> header + data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_icmp_reply</span>(<span class="hljs-params">packet</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析ICMP回复</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        (icmp_type, source_ip)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 解析IP头部，获取源IP</span><br>    ip_header = packet[:<span class="hljs-number">20</span>]<br>    iph = struct.unpack(<span class="hljs-string">&#x27;!BBHHHBBH4s4s&#x27;</span>, ip_header)<br>    source_ip = socket.inet_ntoa(iph[<span class="hljs-number">8</span>])<br><br>    <span class="hljs-comment"># 解析ICMP头部</span><br>    icmp_header = packet[<span class="hljs-number">20</span>:<span class="hljs-number">28</span>]<br>    icmp_type, icmp_code = struct.unpack(<span class="hljs-string">&#x27;!BB&#x27;</span>, icmp_header[:<span class="hljs-number">2</span>])<br><br>    <span class="hljs-keyword">return</span> icmp_type, source_ip<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">traceroute</span>(<span class="hljs-params">host, max_hops=<span class="hljs-number">30</span>, timeout=<span class="hljs-number">2</span>, tries=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    追踪到目标主机的路由路径</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        host: 目标主机名或IP</span><br><span class="hljs-string">        max_hops: 最大跳数</span><br><span class="hljs-string">        timeout: 超时时间（秒）</span><br><span class="hljs-string">        tries: 每一跳尝试次数</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        1. 从TTL=1开始，逐步增加TTL</span><br><span class="hljs-string">        2. 发送ICMP Echo Request</span><br><span class="hljs-string">        3. 收到Time Exceeded回复时，记录该路由器</span><br><span class="hljs-string">        4. 收到Echo Reply时，说明到达目的地</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;traceroute to <span class="hljs-subst">&#123;host&#125;</span>, <span class="hljs-subst">&#123;max_hops&#125;</span> hops max&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 解析目标主机</span><br>    <span class="hljs-keyword">try</span>:<br>        dest_ip = socket.gethostbyname(host)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;目标IP: <span class="hljs-subst">&#123;dest_ip&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-keyword">except</span> socket.gaierror:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 无法解析主机名: <span class="hljs-subst">&#123;host&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 创建原始socket（需要root权限）</span><br>    <span class="hljs-keyword">try</span>:<br>        send_sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)<br>        recv_sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)<br>        recv_sock.settimeout(timeout)<br>    <span class="hljs-keyword">except</span> PermissionError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 需要管理员权限运行此程序&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Linux/Mac: sudo python day06_simple_traceroute.py&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Windows: 以管理员身份运行&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    packet_id = <span class="hljs-number">12345</span><br>    reached = <span class="hljs-literal">False</span><br><br>    <span class="hljs-comment"># 从TTL=1开始，逐步增加</span><br>    <span class="hljs-keyword">for</span> ttl <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, max_hops + <span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 设置TTL</span><br>        send_sock.setsockopt(socket.IPPROTO_IP, socket.IP_TTL, ttl)<br><br>        <span class="hljs-comment"># 尝试3次</span><br>        hop_info = &#123;<br>            <span class="hljs-string">&#x27;ttl&#x27;</span>: ttl,<br>            <span class="hljs-string">&#x27;ip&#x27;</span>: <span class="hljs-literal">None</span>,<br>            <span class="hljs-string">&#x27;hostname&#x27;</span>: <span class="hljs-literal">None</span>,<br>            <span class="hljs-string">&#x27;rtts&#x27;</span>: []<br>        &#125;<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot; <span class="hljs-subst">&#123;ttl:2d&#125;</span>  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>, flush=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(tries):<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-comment"># 创建并发送ICMP包</span><br>                packet = create_icmp_packet(packet_id, ttl)<br>                send_time = time.time()<br>                send_sock.sendto(packet, (dest_ip, <span class="hljs-number">0</span>))<br><br>                <span class="hljs-comment"># 接收回复</span><br>                <span class="hljs-keyword">try</span>:<br>                    reply_packet, addr = recv_sock.recvfrom(<span class="hljs-number">1024</span>)<br>                    recv_time = time.time()<br>                    rtt = (recv_time - send_time) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># 转换为毫秒</span><br><br>                    <span class="hljs-comment"># 解析回复</span><br>                    icmp_type, source_ip = parse_icmp_reply(reply_packet)<br><br>                    <span class="hljs-comment"># 记录信息</span><br>                    <span class="hljs-keyword">if</span> hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                        hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>] = source_ip<br><br>                        <span class="hljs-comment"># 尝试获取主机名</span><br>                        <span class="hljs-keyword">try</span>:<br>                            hostname = socket.gethostbyaddr(source_ip)[<span class="hljs-number">0</span>]<br>                            hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>] = hostname<br>                        <span class="hljs-keyword">except</span>:<br>                            hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>] = source_ip<br><br>                    hop_info[<span class="hljs-string">&#x27;rtts&#x27;</span>].append(rtt)<br><br>                    <span class="hljs-comment"># ICMP类型11 = Time Exceeded（中间路由器）</span><br>                    <span class="hljs-comment"># ICMP类型0 = Echo Reply（到达目的地）</span><br>                    <span class="hljs-keyword">if</span> icmp_type == <span class="hljs-number">0</span>:<br>                        reached = <span class="hljs-literal">True</span><br><br>                <span class="hljs-keyword">except</span> socket.timeout:<br>                    hop_info[<span class="hljs-string">&#x27;rtts&#x27;</span>].append(<span class="hljs-literal">None</span>)<br><br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                hop_info[<span class="hljs-string">&#x27;rtts&#x27;</span>].append(<span class="hljs-literal">None</span>)<br><br>        <span class="hljs-comment"># 打印这一跳的信息</span><br>        <span class="hljs-keyword">if</span> hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>]:<br>            <span class="hljs-keyword">if</span> hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>] <span class="hljs-keyword">and</span> hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>] != hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>]:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;hop_info[<span class="hljs-string">&#x27;hostname&#x27;</span>]&#125;</span> (<span class="hljs-subst">&#123;hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>]&#125;</span>)  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;hop_info[<span class="hljs-string">&#x27;ip&#x27;</span>]&#125;</span>  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br><br>            <span class="hljs-comment"># 打印RTT</span><br>            <span class="hljs-keyword">for</span> rtt <span class="hljs-keyword">in</span> hop_info[<span class="hljs-string">&#x27;rtts&#x27;</span>]:<br>                <span class="hljs-keyword">if</span> rtt <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;rtt:<span class="hljs-number">.2</span>f&#125;</span> ms  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;*  &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;* * *&quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>()  <span class="hljs-comment"># 换行</span><br><br>        <span class="hljs-comment"># 如果到达目的地，停止</span><br>        <span class="hljs-keyword">if</span> reached:<br>            <span class="hljs-built_in">print</span>()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 已到达目的地 <span class="hljs-subst">&#123;dest_ip&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> reached:<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⚠️  未能在<span class="hljs-subst">&#123;max_hops&#125;</span>跳内到达目的地&quot;</span>)<br><br>    send_sock.close()<br>    recv_sock.close()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;简易Traceroute工具&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取目标主机</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span>:<br>        host = sys.argv[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        host = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入要追踪的主机名或IP: &quot;</span>).strip()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> host:<br>            host = <span class="hljs-string">&quot;baidu.com&quot;</span>  <span class="hljs-comment"># 默认</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🔍 开始追踪路由路径...\n&quot;</span>)<br><br>    <span class="hljs-comment"># 执行traceroute</span><br>    traceroute(host, max_hops=<span class="hljs-number">30</span>, timeout=<span class="hljs-number">2</span>, tries=<span class="hljs-number">3</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n💡 说明:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 每一行代表一跳（一个路由器）&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 显示3次测试的RTT时间&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - * 表示该路由器没有响应&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - 某些路由器可能禁用了ICMP响应&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Linux/Mac（需要root权限）</span><br><span class="hljs-built_in">sudo</span> python code/day06/day06_simple_traceroute.py baidu.com<br><br><span class="hljs-comment"># Windows（以管理员身份运行）</span><br>python code\day06\day06_simple_traceroute.py baidu.com<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">======================================================================<br>                      简易Traceroute工具<br>======================================================================<br><br>🔍 开始追踪路由路径...<br><br>traceroute to baidu.com, <span class="hljs-number">30</span> hops max<br><br>目标IP: <span class="hljs-number">220.181</span>.<span class="hljs-number">38.148</span><br>----------------------------------------------------------------------<br>  <span class="hljs-number">1</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>  <span class="hljs-number">1.23</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">1</span>.<span class="hljs-number">12</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">1</span>.<span class="hljs-number">09</span> <span class="hljs-keyword">ms</span><br>  <span class="hljs-title">2</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span>  <span class="hljs-number">5.67</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">5</span>.<span class="hljs-number">43</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">5</span>.<span class="hljs-number">34</span> <span class="hljs-keyword">ms</span><br>  <span class="hljs-title">3</span>  <span class="hljs-number">61.135</span>.<span class="hljs-number">169.1</span>  <span class="hljs-number">12.34</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">12</span>.<span class="hljs-number">23</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">12</span>.<span class="hljs-number">12</span> <span class="hljs-keyword">ms</span><br>  <span class="hljs-title">4</span>  <span class="hljs-number">61.135</span>.<span class="hljs-number">169.125</span>  <span class="hljs-number">15.67</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">15</span>.<span class="hljs-number">56</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">15</span>.<span class="hljs-number">45</span> <span class="hljs-keyword">ms</span><br>  <span class="hljs-title">5</span>  * * *<br>  <span class="hljs-number">6</span>  <span class="hljs-number">220.181</span>.<span class="hljs-number">38.148</span>  <span class="hljs-number">28.90</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">28</span>.<span class="hljs-number">78</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">28</span>.<span class="hljs-number">67</span> <span class="hljs-keyword">ms</span><br><br><span class="hljs-title">✅ 已到达目的地 220</span>.<span class="hljs-number">181.38</span>.<span class="hljs-number">148</span><br><br>======================================================================<br><br>💡 说明:<br>   - 每一行代表一跳（一个路由器）<br>   - 显示<span class="hljs-number">3</span>次测试的RTT时间<br>   - * 表示该路由器没有响应<br>   - 某些路由器可能禁用了ICMP响应<br>======================================================================<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="1-设置TTL">1. 设置TTL</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">send_sock.setsockopt(socket.IPPROTO_IP, socket.IP_TTL, ttl)<br></code></pre></td></tr></table></figure><p>这是关键！通过设置socket的TTL选项，我们可以控制数据包能经过多少个路由器。</p><h3 id="2-ICMP消息类型">2. ICMP消息类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 收到的ICMP类型：</span><br>- 类型<span class="hljs-number">11</span>（Time Exceeded）：中间路由器返回，说明TTL耗尽<br>- 类型<span class="hljs-number">0</span>（Echo Reply）：目标主机返回，说明到达目的地<br></code></pre></td></tr></table></figure><h3 id="3-为什么要尝试3次？">3. 为什么要尝试3次？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(tries):  <span class="hljs-comment"># 尝试3次</span><br></code></pre></td></tr></table></figure><p><strong>原因</strong>：</p><ol><li>网络可能不稳定，单次测试不准确</li><li>可以计算平均延迟</li><li>可以检测丢包情况</li><li>与标准traceroute行为一致</li></ol><h3 id="4-为什么有些路由器显示-？">4. 为什么有些路由器显示 * * * ？</h3><p>可能的原因：</p><ol><li><strong>防火墙阻止</strong>：该路由器配置了防火墙，不响应ICMP</li><li><strong>安全策略</strong>：运营商出于安全考虑，禁用了ICMP响应</li><li><strong>负载均衡</strong>：每次请求可能走不同路径</li><li><strong>超时</strong>：路由器太忙，来不及响应</li></ol><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ traceroute通过逐步增加TTL来追踪路径</li><li>✅ TTL=0时路由器返回&quot;Time Exceeded&quot;消息</li><li>✅ 每一跳通常测试3次以获得稳定数据</li><li>✅ 某些路由器可能不响应ICMP</li></ol><h3 id="traceroute-vs-ping">traceroute vs ping</h3><table><thead><tr><th>特性</th><th>ping</th><th>traceroute</th></tr></thead><tbody><tr><td>目的</td><td>测试连通性</td><td>追踪路径</td></tr><tr><td>显示内容</td><td>目标主机信息</td><td>所有中间路由器</td></tr><tr><td>TTL设置</td><td>固定（通常64）</td><td>递增（1, 2, 3…）</td></tr><tr><td>数据包数量</td><td>少</td><td>多</td></tr><tr><td>执行速度</td><td>快</td><td>慢</td></tr></tbody></table><h3 id="Windows-vs-Linux-Mac">Windows vs Linux/Mac</h3><table><thead><tr><th>特性</th><th>Windows (tracert)</th><th>Linux/Mac (traceroute)</th></tr></thead><tbody><tr><td>协议</td><td>ICMP</td><td>UDP（默认）或ICMP</td></tr><tr><td>命令</td><td>tracert</td><td>traceroute</td></tr><tr><td>ICMP选项</td><td>默认</td><td>-I 参数</td></tr></tbody></table><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：实际操作">练习1：实际操作</h3><p>使用traceroute追踪以下网站，记录经过的跳数：</p><ol><li><a href="http://baidu.com">baidu.com</a></li><li><a href="http://google.com">google.com</a>（如果能访问）</li><li>你的学校或公司网站</li><li>国外的网站（观察延迟变化）</li></ol><h3 id="练习2：路径分析">练习2：路径分析</h3><p>观察traceroute的输出，回答：</p><ol><li>第一跳通常是什么设备？</li><li>为什么有些跳的延迟突然增大？</li><li>国内访问国外网站，通常在第几跳出国？</li></ol><h3 id="练习3：故障诊断">练习3：故障诊断</h3><p>如果traceroute显示以下情况，说明什么问题？</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-number">1</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>  <span class="hljs-number">1</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">2</span>  * * *<br><span class="hljs-number">3</span>  * * *<br><span class="hljs-number">4</span>  * * *<br>...<br></code></pre></td></tr></table></figure><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>扩展traceroute工具：</p><ol><li>添加路径可视化（绘制路由图）</li><li>支持同时追踪多个目标</li><li>记录历史路径，对比路径变化</li><li>添加AS号查询（自治系统号）</li></ol><h3 id="练习5：思考题">练习5：思考题</h3><ol><li>为什么去程和回程路径可能不同？</li><li>traceroute能用来攻击吗？</li><li>如何阻止别人traceroute你的服务器？</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="traceroute的不同实现方式">traceroute的不同实现方式</h3><h4 id="1-UDP方式（Linux默认）">1. UDP方式（Linux默认）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用UDP包，目标端口从33434开始递增</span><br>traceroute baidu.com<br><br>工作原理：<br>- 发送UDP包到不常用的端口<br>- 中间路由器：返回ICMP Time Exceeded<br>- 目标主机：返回ICMP Port Unreachable<br></code></pre></td></tr></table></figure><h4 id="2-ICMP方式（Windows默认）">2. ICMP方式（Windows默认）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用ICMP Echo Request</span><br>traceroute -I baidu.com  <span class="hljs-comment"># Linux</span><br>tracert baidu.com        <span class="hljs-comment"># Windows</span><br><br>工作原理：<br>- 发送ICMP Echo Request<br>- 中间路由器：返回ICMP Time Exceeded<br>- 目标主机：返回ICMP Echo Reply<br></code></pre></td></tr></table></figure><h4 id="3-TCP方式">3. TCP方式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用TCP SYN包（需要指定端口）</span><br>traceroute -T -p 80 baidu.com<br><br>工作原理：<br>- 发送TCP SYN包到指定端口<br>- 中间路由器：返回ICMP Time Exceeded<br>- 目标主机：返回TCP SYN+ACK<br></code></pre></td></tr></table></figure><h3 id="MTR：增强版traceroute">MTR：增强版traceroute</h3><p>MTR（My Traceroute）结合了ping和traceroute的功能：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装</span><br><span class="hljs-built_in">sudo</span> apt install mtr      <span class="hljs-comment"># Ubuntu/Debian</span><br>brew install mtr          <span class="hljs-comment"># Mac</span><br><br><span class="hljs-comment"># 使用</span><br><span class="hljs-built_in">sudo</span> mtr baidu.com<br></code></pre></td></tr></table></figure><p><strong>MTR的优势</strong>：</p><ul><li>实时更新</li><li>显示丢包率</li><li>显示每一跳的统计信息</li><li>更直观的界面</li></ul><h3 id="路由的变化">路由的变化</h3><p>互联网的路由不是固定的，会因为以下原因变化：</p><ol><li><strong>负载均衡</strong>：分散流量到不同路径</li><li><strong>路由策略</strong>：运营商动态调整路由</li><li><strong>故障切换</strong>：某条线路故障时自动切换</li><li><strong>时间因素</strong>：不同时段可能走不同路由</li></ol><h3 id="实际应用场景">实际应用场景</h3><ol><li><p><strong>网络故障诊断</strong>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">情况：网站访问很慢<br>步骤：traceroute 查看哪一跳延迟高<br>结果：定位瓶颈所在<br></code></pre></td></tr></table></figure></li><li><p><strong>CDN检测</strong>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">情况：想知道访问的是哪个CDN节点<br>步骤：traceroute 查看最后几跳<br>结果：发现CDN在本地，延迟低<br></code></pre></td></tr></table></figure></li><li><p><strong>网络拓扑发现</strong>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">情况：想了解公司网络结构<br>步骤：traceroute 到不同内网地址<br>结果：绘制网络拓扑图<br></code></pre></td></tr></table></figure></li></ol><h3 id="有趣的发现">有趣的发现</h3><p><strong>地理位置与延迟</strong>：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">本地路由器：    <span class="hljs-number">1</span>-<span class="hljs-number">2</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">同城服务器：    10-30</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">相邻省份：      30-60</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">跨国连接：      100-300</span> <span class="hljs-keyword">ms</span><br><span class="hljs-title">全球另一端：    300-500</span> ms<br></code></pre></td></tr></table></figure><p><strong>光速的限制</strong>：</p><ul><li>光在光纤中的速度约为 200,000 km/s</li><li>地球周长约 40,000 km</li><li>理论上环绕地球一圈至少需要 200ms</li><li>实际延迟会更高（路由器处理时间）</li></ul><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第7天：Wireshark抓包入门</strong></p><p>我们将学习：</p><ul><li>Wireshark的基本使用</li><li>如何捕获和分析数据包</li><li>过滤器的使用技巧</li><li>实战：分析HTTP请求过程</li></ul><hr><p>💡 <strong>今日金句</strong>：追踪路由，就像在互联网上寻找宝藏的地图！</p><p>👉 <a href="day05.md">上一天：ping命令详解</a> | <a href="../../README.md">返回目录</a> | <a href="day07.md">下一天：Wireshark抓包入门</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>5天：网络命令入门 - ping</title>
    <link href="/2025/11/10/5%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E5%85%A5%E9%97%A8%20-%20ping/"/>
    <url>/2025/11/10/5%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E5%85%A5%E9%97%A8%20-%20ping/</url>
    
    <content type="html"><![CDATA[<h1>第5天：网络命令入门 - ping</h1><blockquote><p>“ping一下，网络通不通立刻知道。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解ping命令的工作原理</li><li>掌握ICMP协议基础知识</li><li>学会使用ping命令进行网络诊断</li><li>编写自己的ping工具</li></ul><h2 id="🎯-什么是ping？">🎯 什么是ping？</h2><h3 id="生活中的例子">生活中的例子</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">ping</span> <span class="hljs-operator">=</span> 喊话游戏<br><br>你：喂！能听到吗？ （发送）<br>朋友：能听到！         （回应）<br>你：太好了，通信正常！ （确认）<br></code></pre></td></tr></table></figure><p><strong>ping命令</strong>就是用来测试网络连通性的工具，它会发送一个数据包到目标主机，然后等待回应。</p><h3 id="ping的作用">ping的作用</h3><ol><li><strong>测试连通性</strong>：目标主机是否可达</li><li><strong>测量延迟</strong>：数据往返需要多少时间</li><li><strong>检测丢包</strong>：有多少数据包丢失了</li><li><strong>诊断网络问题</strong>：定位网络故障</li></ol><h2 id="📡-ICMP协议">📡 ICMP协议</h2><h3 id="什么是ICMP？">什么是ICMP？</h3><p><strong>ICMP</strong>（Internet Control Message Protocol，互联网控制消息协议）是TCP/IP协议族的一部分，工作在网际层（IP层）。</p><h3 id="ICMP的作用">ICMP的作用</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">ICMP</span> <span class="hljs-operator">=</span> 网络的<span class="hljs-string">&quot;通讯员&quot;</span><br><br>主要任务：<br><span class="hljs-number">1</span>. 报告错误（<span class="hljs-string">&quot;对方不在家&quot;</span>）<br><span class="hljs-number">2</span>. 诊断问题（<span class="hljs-string">&quot;ping测试&quot;</span>）<br><span class="hljs-number">3</span>. 提供反馈（<span class="hljs-string">&quot;超时了&quot;</span>）<br></code></pre></td></tr></table></figure><h3 id="常见的ICMP消息类型">常见的ICMP消息类型</h3><table><thead><tr><th>类型</th><th>名称</th><th>用途</th></tr></thead><tbody><tr><td>0</td><td>Echo Reply</td><td>ping的回应</td></tr><tr><td>3</td><td>Destination Unreachable</td><td>目标不可达</td></tr><tr><td>5</td><td>Redirect</td><td>重定向</td></tr><tr><td>8</td><td>Echo Request</td><td>ping的请求</td></tr><tr><td>11</td><td>Time Exceeded</td><td>超时（TTL=0）</td></tr></tbody></table><h2 id="🔍-ping的工作原理">🔍 ping的工作原理</h2><h3 id="完整流程">完整流程</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">1</span>. 发送 ICMP Echo Request（类型<span class="hljs-number">8</span>）<br>   你的电脑 → 目标主机<br>   &quot;你好，我是<span class="hljs-number">192.168.1.100</span>，请回应！&quot;<br><br><span class="hljs-number">2</span>. 接收 ICMP Echo Reply（类型<span class="hljs-number">0</span>）<br>   目标主机 → 你的电脑<br>   &quot;收到！我是<span class="hljs-number">8.8.8.8</span>，一切正常！&quot;<br><br><span class="hljs-number">3</span>. 计算RTT（往返时间）<br>   发送时间：<span class="hljs-number">10</span>:<span class="hljs-number">00:00.000</span><br>   接收时间：<span class="hljs-number">10</span>:<span class="hljs-number">00:00.050</span><br>   RTT = <span class="hljs-number">50</span>毫秒<br></code></pre></td></tr></table></figure><h3 id="RTT（Round-Trip-Time）">RTT（Round-Trip Time）</h3><p><strong>RTT</strong>：数据包从发送到收到回复的总时间</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">RTT = 去程时间 + 回程时间<br><br>影响RTT的因素：<br><span class="hljs-bullet">- </span>物理距离（光速是有限的）<br><span class="hljs-bullet">- </span>网络拥塞<br><span class="hljs-bullet">- </span>路由器处理时间<br><span class="hljs-bullet">- </span>对方服务器处理时间<br></code></pre></td></tr></table></figure><h3 id="ICMP报文结构">ICMP报文结构</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">ICMP Echo Request/Reply 格式：<br><br><span class="hljs-section">0               8              16              24              31</span><br><span class="hljs-section">+---------------+---------------+---------------+---------------+</span><br>|     类型      |     代码      |           校验和              |<br><span class="hljs-section">|   (Type)      |   (Code)      |         (Checksum)            |</span><br><span class="hljs-section">+---------------+---------------+---------------+---------------+</span><br><span class="hljs-section">|          标识符 (Identifier)   |      序列号 (Sequence)        |</span><br><span class="hljs-section">+---------------+---------------+---------------+---------------+</span><br>|                         数据 (Data)                            |<br><span class="hljs-section">|                         可选，用于填充                         |</span><br><span class="hljs-section">+---------------+---------------+---------------+---------------+</span><br><br>字段说明：<br><span class="hljs-bullet">- </span>类型：8=请求，0=回应<br><span class="hljs-bullet">- </span>代码：通常为0<br><span class="hljs-bullet">- </span>校验和：用于检测数据完整性<br><span class="hljs-bullet">- </span>标识符：标识这个ping进程<br><span class="hljs-bullet">- </span>序列号：标识这是第几个包<br><span class="hljs-bullet">- </span>数据：可选的负载数据<br></code></pre></td></tr></table></figure><h2 id="🔧-使用ping命令">🔧 使用ping命令</h2><h3 id="基本用法">基本用法</h3><p><strong>Windows</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本ping</span><br>ping baidu.com<br><br><span class="hljs-comment"># ping 4次后停止</span><br>ping -n 4 baidu.com<br><br><span class="hljs-comment"># 指定包大小（字节）</span><br>ping -l 1000 baidu.com<br><br><span class="hljs-comment"># 持续ping</span><br>ping -t baidu.com<br></code></pre></td></tr></table></figure><p><strong>Linux/Mac</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本ping</span><br>ping baidu.com<br><br><span class="hljs-comment"># ping 4次后停止</span><br>ping -c 4 baidu.com<br><br><span class="hljs-comment"># 指定包大小（字节）</span><br>ping -s 1000 baidu.com<br><br><span class="hljs-comment"># 快速ping（间隔0.2秒）</span><br>ping -i 0.2 baidu.com<br></code></pre></td></tr></table></figure><h3 id="输出解析">输出解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ping baidu.com<br><br>PING baidu.com (220.181.38.148): 56 data bytes<br>64 bytes from 220.181.38.148: icmp_seq=0 ttl=52 <span class="hljs-keyword">time</span>=28.5 ms<br>64 bytes from 220.181.38.148: icmp_seq=1 ttl=52 <span class="hljs-keyword">time</span>=27.8 ms<br>64 bytes from 220.181.38.148: icmp_seq=2 ttl=52 <span class="hljs-keyword">time</span>=28.1 ms<br>64 bytes from 220.181.38.148: icmp_seq=3 ttl=52 <span class="hljs-keyword">time</span>=29.2 ms<br><br>--- baidu.com ping statistics ---<br>4 packets transmitted, 4 packets received, 0.0% packet loss<br>round-trip min/avg/max/stddev = 27.8/28.4/29.2/0.5 ms<br></code></pre></td></tr></table></figure><p><strong>字段含义</strong>：</p><ul><li><code>64 bytes</code>：数据包大小</li><li><code>icmp_seq</code>：序列号（第几个包）</li><li><code>ttl=52</code>：生存时间（经过了64-52=12个路由器）</li><li><code>time=28.5 ms</code>：RTT往返时间</li><li><code>0.0% packet loss</code>：丢包率</li><li><code>min/avg/max</code>：最小/平均/最大RTT</li></ul><h2 id="🔧-实战项目：实现简易ping工具">🔧 实战项目：实现简易ping工具</h2><p>让我们用Python实现一个简单的ping工具！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day05_simple_ping.py</span><br><span class="hljs-comment"># 功能：实现简单的ping工具</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_checksum</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    计算ICMP校验和</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        data: 要计算校验和的数据（bytes）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        校验和（int）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        1. 将数据按16位分组求和</span><br><span class="hljs-string">        2. 如果有进位，将进位加到结果上</span><br><span class="hljs-string">        3. 取反码得到校验和</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 如果数据长度是奇数，补一个字节0</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>:<br>        data += <span class="hljs-string">b&#x27;\x00&#x27;</span><br><br>    <span class="hljs-comment"># 按16位（2字节）分组求和</span><br>    checksum = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">2</span>):<br>        <span class="hljs-comment"># 将两个字节组合成一个16位整数</span><br>        word = (data[i] &lt;&lt; <span class="hljs-number">8</span>) + data[i + <span class="hljs-number">1</span>]<br>        checksum += word<br><br>    <span class="hljs-comment"># 处理进位：将高16位加到低16位</span><br>    <span class="hljs-keyword">while</span> checksum &gt;&gt; <span class="hljs-number">16</span>:<br>        checksum = (checksum &amp; <span class="hljs-number">0xFFFF</span>) + (checksum &gt;&gt; <span class="hljs-number">16</span>)<br><br>    <span class="hljs-comment"># 取反码</span><br>    checksum = ~checksum &amp; <span class="hljs-number">0xFFFF</span><br><br>    <span class="hljs-keyword">return</span> checksum<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_icmp_packet</span>(<span class="hljs-params">packet_id, sequence</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    创建ICMP Echo Request数据包</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        packet_id: 标识符（用于区分不同的ping进程）</span><br><span class="hljs-string">        sequence: 序列号（标识第几个包）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        完整的ICMP数据包（bytes）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    ICMP包结构：</span><br><span class="hljs-string">        [类型(1字节) | 代码(1字节) | 校验和(2字节) |</span><br><span class="hljs-string">         标识符(2字节) | 序列号(2字节) | 数据]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># ICMP类型：8=Echo Request</span><br>    icmp_type = <span class="hljs-number">8</span><br>    <span class="hljs-comment"># ICMP代码：0</span><br>    icmp_code = <span class="hljs-number">0</span><br>    <span class="hljs-comment"># 校验和：先设为0，稍后计算</span><br>    icmp_checksum = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># 打包ICMP头部（不包括校验和）</span><br>    <span class="hljs-comment"># ! = 网络字节序（大端）</span><br>    <span class="hljs-comment"># B = unsigned char (1字节)</span><br>    <span class="hljs-comment"># H = unsigned short (2字节)</span><br>    header = struct.pack(<span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_type, icmp_code, icmp_checksum,<br>                         packet_id, sequence)<br><br>    <span class="hljs-comment"># 数据部分：发送时间戳（用于计算RTT）</span><br>    data = struct.pack(<span class="hljs-string">&#x27;!d&#x27;</span>, time.time())<br><br>    <span class="hljs-comment"># 计算校验和</span><br>    icmp_checksum = calculate_checksum(header + data)<br><br>    <span class="hljs-comment"># 重新打包，加入正确的校验和</span><br>    header = struct.pack(<span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_type, icmp_code, icmp_checksum,<br>                         packet_id, sequence)<br><br>    <span class="hljs-keyword">return</span> header + data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_icmp_reply</span>(<span class="hljs-params">packet</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析ICMP Echo Reply数据包</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        packet: 接收到的数据包</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        (icmp_type, icmp_code, icmp_id, icmp_seq, send_time)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># IP头部通常是20字节，ICMP从第21字节开始</span><br>    icmp_header = packet[<span class="hljs-number">20</span>:<span class="hljs-number">28</span>]<br><br>    <span class="hljs-comment"># 解析ICMP头部</span><br>    icmp_type, icmp_code, checksum, packet_id, sequence = struct.unpack(<br>        <span class="hljs-string">&#x27;!BBHHH&#x27;</span>, icmp_header<br>    )<br><br>    <span class="hljs-comment"># 解析数据部分的时间戳</span><br>    send_time = struct.unpack(<span class="hljs-string">&#x27;!d&#x27;</span>, packet[<span class="hljs-number">28</span>:<span class="hljs-number">36</span>])[<span class="hljs-number">0</span>]<br><br>    <span class="hljs-keyword">return</span> icmp_type, icmp_code, packet_id, sequence, send_time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">host, count=<span class="hljs-number">4</span>, timeout=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ping指定主机</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        host: 目标主机名或IP地址</span><br><span class="hljs-string">        count: ping的次数</span><br><span class="hljs-string">        timeout: 超时时间（秒）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        统计信息字典</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PING <span class="hljs-subst">&#123;host&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 解析主机名为IP地址</span><br>    <span class="hljs-keyword">try</span>:<br>        dest_ip = socket.gethostbyname(host)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;目标IP: <span class="hljs-subst">&#123;dest_ip&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-keyword">except</span> socket.gaierror:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 无法解析主机名: <span class="hljs-subst">&#123;host&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># 创建原始socket（需要root权限）</span><br>    <span class="hljs-keyword">try</span>:<br>        sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)<br>        sock.settimeout(timeout)<br>    <span class="hljs-keyword">except</span> PermissionError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 需要管理员权限运行此程序&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Linux/Mac: sudo python day05_simple_ping.py&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Windows: 以管理员身份运行&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># 统计信息</span><br>    packet_id = <span class="hljs-number">12345</span>  <span class="hljs-comment"># 可以用进程ID</span><br>    sent = <span class="hljs-number">0</span><br>    received = <span class="hljs-number">0</span><br>    rtt_list = []<br><br>    <span class="hljs-comment"># 发送ping包</span><br>    <span class="hljs-keyword">for</span> seq <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(count):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 创建ICMP包</span><br>            packet = create_icmp_packet(packet_id, seq)<br><br>            <span class="hljs-comment"># 发送</span><br>            send_time = time.time()<br>            sock.sendto(packet, (dest_ip, <span class="hljs-number">0</span>))<br>            sent += <span class="hljs-number">1</span><br><br>            <span class="hljs-comment"># 接收回复</span><br>            <span class="hljs-keyword">try</span>:<br>                reply_packet, addr = sock.recvfrom(<span class="hljs-number">1024</span>)<br>                recv_time = time.time()<br><br>                <span class="hljs-comment"># 解析回复</span><br>                icmp_type, icmp_code, reply_id, reply_seq, packet_send_time = \<br>                    parse_icmp_reply(reply_packet)<br><br>                <span class="hljs-comment"># 检查是否是我们的包的回复</span><br>                <span class="hljs-keyword">if</span> icmp_type == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> reply_id == packet_id <span class="hljs-keyword">and</span> reply_seq == seq:<br>                    <span class="hljs-comment"># 计算RTT</span><br>                    rtt = (recv_time - packet_send_time) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># 转换为毫秒</span><br>                    rtt_list.append(rtt)<br>                    received += <span class="hljs-number">1</span><br><br>                    <span class="hljs-comment"># 获取TTL</span><br>                    ttl = struct.unpack(<span class="hljs-string">&#x27;!B&#x27;</span>, reply_packet[<span class="hljs-number">8</span>:<span class="hljs-number">9</span>])[<span class="hljs-number">0</span>]<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 来自 <span class="hljs-subst">&#123;dest_ip&#125;</span>: icmp_seq=<span class="hljs-subst">&#123;seq&#125;</span> ttl=<span class="hljs-subst">&#123;ttl&#125;</span> &quot;</span><br>                          <span class="hljs-string">f&quot;time=<span class="hljs-subst">&#123;rtt:<span class="hljs-number">.2</span>f&#125;</span> ms&quot;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⚠️  收到意外的ICMP包 type=<span class="hljs-subst">&#123;icmp_type&#125;</span>&quot;</span>)<br><br>            <span class="hljs-keyword">except</span> socket.timeout:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⏱️  icmp_seq=<span class="hljs-subst">&#123;seq&#125;</span> 请求超时&quot;</span>)<br><br>            <span class="hljs-comment"># 等待1秒再发送下一个包</span><br>            <span class="hljs-keyword">if</span> seq &lt; count - <span class="hljs-number">1</span>:<br>                time.sleep(<span class="hljs-number">1</span>)<br><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 发送失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    sock.close()<br><br>    <span class="hljs-comment"># 打印统计信息</span><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📊 <span class="hljs-subst">&#123;host&#125;</span> ping统计信息:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   发送: <span class="hljs-subst">&#123;sent&#125;</span> 个包&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   接收: <span class="hljs-subst">&#123;received&#125;</span> 个包&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   丢失: <span class="hljs-subst">&#123;sent - received&#125;</span> 个包 (<span class="hljs-subst">&#123;((sent-received)/sent*<span class="hljs-number">100</span>):<span class="hljs-number">.1</span>f&#125;</span>% loss)&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> rtt_list:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   RTT: 最小=<span class="hljs-subst">&#123;<span class="hljs-built_in">min</span>(rtt_list):<span class="hljs-number">.2</span>f&#125;</span>ms, &quot;</span><br>              <span class="hljs-string">f&quot;平均=<span class="hljs-subst">&#123;<span class="hljs-built_in">sum</span>(rtt_list)/<span class="hljs-built_in">len</span>(rtt_list):<span class="hljs-number">.2</span>f&#125;</span>ms, &quot;</span><br>              <span class="hljs-string">f&quot;最大=<span class="hljs-subst">&#123;<span class="hljs-built_in">max</span>(rtt_list):<span class="hljs-number">.2</span>f&#125;</span>ms&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">60</span>)<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&#x27;sent&#x27;</span>: sent,<br>        <span class="hljs-string">&#x27;received&#x27;</span>: received,<br>        <span class="hljs-string">&#x27;rtt_list&#x27;</span>: rtt_list<br>    &#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;简易Ping工具&quot;</span>.center(<span class="hljs-number">60</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取目标主机</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span>:<br>        host = sys.argv[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        host = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入要ping的主机名或IP: &quot;</span>).strip()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> host:<br>            host = <span class="hljs-string">&quot;baidu.com&quot;</span>  <span class="hljs-comment"># 默认</span><br><br>    <span class="hljs-comment"># 执行ping</span><br>    result = ping(host, count=<span class="hljs-number">4</span>, timeout=<span class="hljs-number">3</span>)<br><br>    <span class="hljs-keyword">if</span> result <span class="hljs-keyword">and</span> result[<span class="hljs-string">&#x27;received&#x27;</span>] &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;🎉 Ping完成！&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ Ping失败或网络不可达&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Linux/Mac（需要root权限）</span><br><span class="hljs-built_in">sudo</span> python code/day05/day05_simple_ping.py baidu.com<br><br><span class="hljs-comment"># Windows（以管理员身份运行）</span><br>python code\day05\day05_simple_ping.py baidu.com<br><br><span class="hljs-comment"># 不带参数运行，会提示输入主机名</span><br><span class="hljs-built_in">sudo</span> python code/day05/day05_simple_ping.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">============================================================<br>                       简易Ping工具<br>============================================================<br><br>PING baidu.com<br><br><span class="hljs-section">目标IP: 220.181.38.148</span><br><span class="hljs-section">------------------------------------------------------------</span><br>✅ 来自 220.181.38.148: icmp<span class="hljs-emphasis">_seq=0 ttl=52 time=28.50 ms</span><br><span class="hljs-emphasis">✅ 来自 220.181.38.148: icmp_seq=1 ttl=52 time=27.82 ms</span><br><span class="hljs-emphasis">✅ 来自 220.181.38.148: icmp_seq=2 ttl=52 time=28.15 ms</span><br><span class="hljs-emphasis">✅ 来自 220.181.38.148: icmp_</span>seq=3 ttl=52 time=29.20 ms<br><br><span class="hljs-code">------------------------------------------------------------</span><br><span class="hljs-code">📊 baidu.com ping统计信息:</span><br><span class="hljs-code">   发送: 4 个包</span><br><span class="hljs-code">   接收: 4 个包</span><br><span class="hljs-code">   丢失: 0 个包 (0.0% loss)</span><br><span class="hljs-code">   RTT: 最小=27.82ms, 平均=28.42ms, 最大=29.20ms</span><br><span class="hljs-code">------------------------------------------------------------</span><br><br>🎉 Ping完成！<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="1-为什么需要root权限？">1. 为什么需要root权限？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)<br></code></pre></td></tr></table></figure><p><strong>原始套接字</strong>（SOCK_RAW）可以构造任意的IP包，这是一个强大的功能，所以操作系统要求必须有管理员权限才能使用。</p><h3 id="2-校验和的计算">2. 校验和的计算</h3><p>校验和用于检测数据在传输过程中是否损坏：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 原理：</span><br><span class="hljs-number">1.</span> 将数据按<span class="hljs-number">16</span>位分组<br><span class="hljs-number">2.</span> 所有分组相加<br><span class="hljs-number">3.</span> 如果有进位，加到低<span class="hljs-number">16</span>位<br><span class="hljs-number">4.</span> 对结果取反码<br><br><span class="hljs-comment"># 接收方验证：</span><br><span class="hljs-number">1.</span> 对收到的数据（包括校验和）做同样的计算<br><span class="hljs-number">2.</span> 如果结果是<span class="hljs-number">0xFFFF</span>，说明数据完整<br><span class="hljs-number">3.</span> 否则说明数据损坏<br></code></pre></td></tr></table></figure><h3 id="3-TTL的含义">3. TTL的含义</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">TTL (Time To Live) <span class="hljs-operator">=</span> 生存时间<br><br>初始值：通常是<span class="hljs-number">64</span>或<span class="hljs-number">128</span><br>每经过一个路由器：TTL -<span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>当TTL <span class="hljs-operator">=</span> <span class="hljs-number">0</span>：路由器丢弃该包，返回超时错误<br><br>作用：防止数据包在网络中无限循环<br></code></pre></td></tr></table></figure><h3 id="4-时间戳的作用">4. 时间戳的作用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 发送时在数据部分嵌入时间戳</span><br>data = struct.pack(<span class="hljs-string">&#x27;!d&#x27;</span>, time.time())<br><br><span class="hljs-comment"># 收到回复时，解析时间戳</span><br>send_time = struct.unpack(<span class="hljs-string">&#x27;!d&#x27;</span>, packet[<span class="hljs-number">28</span>:<span class="hljs-number">36</span>])[<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># 计算RTT</span><br>rtt = (recv_time - send_time) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># 毫秒</span><br></code></pre></td></tr></table></figure><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ ping用于测试网络连通性和延迟</li><li>✅ ping基于ICMP协议（类型8请求，类型0回复）</li><li>✅ RTT是数据包往返的总时间</li><li>✅ TTL表示数据包还能经过多少个路由器</li><li>✅ 实现ping需要使用原始套接字</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>含义</th><th>单位</th></tr></thead><tbody><tr><td>RTT</td><td>往返时间</td><td>毫秒(ms)</td></tr><tr><td>TTL</td><td>生存时间</td><td>跳数(hops)</td></tr><tr><td>丢包率</td><td>丢失的包占总数的比例</td><td>百分比(%)</td></tr><tr><td>ICMP</td><td>网络控制消息协议</td><td>-</td></tr></tbody></table><h3 id="ping命令速查">ping命令速查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本用法</span><br>ping 目标主机<br><br><span class="hljs-comment"># 常用选项</span><br>-c 次数      <span class="hljs-comment"># Linux/Mac: 指定ping次数</span><br>-n 次数      <span class="hljs-comment"># Windows: 指定ping次数</span><br>-i 间隔      <span class="hljs-comment"># 指定发送间隔（秒）</span><br>-s 大小      <span class="hljs-comment"># 指定数据包大小</span><br>-t           <span class="hljs-comment"># Windows: 持续ping</span><br></code></pre></td></tr></table></figure><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：实际操作">练习1：实际操作</h3><p>使用ping命令测试以下主机，记录RTT和TTL：</p><ol><li><a href="http://baidu.com">baidu.com</a></li><li><a href="http://google.com">google.com</a></li><li>你的路由器（通常是192.168.1.1）</li><li>本机（127.0.0.1）</li></ol><h3 id="练习2：理解TTL">练习2：理解TTL</h3><p>如果ping baidu.com的TTL是52，初始TTL是64，问：</p><ol><li>数据包经过了多少个路由器？</li><li>为什么不同的主机TTL不一样？</li></ol><h3 id="练习3：分析丢包">练习3：分析丢包</h3><p>如果ping一个网站，出现以下情况，可能的原因是什么？</p><ol><li>100%丢包</li><li>偶尔丢包（10-20%）</li><li>RTT很高（&gt;500ms）</li></ol><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>扩展ping工具：</p><ol><li>添加图形化的RTT变化显示</li><li>支持ping多个主机</li><li>将结果保存到文件</li><li>添加声音提示（连通时播放提示音）</li></ol><h3 id="练习5：思考题">练习5：思考题</h3><ol><li>为什么ping使用ICMP而不是TCP或UDP？</li><li>能否通过ping判断对方的操作系统？（提示：看TTL初始值）</li><li>防火墙可以阻止ping吗？</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="ping的高级用法">ping的高级用法</h3><p><strong>测试MTU（最大传输单元）</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Linux/Mac</span><br>ping -M <span class="hljs-keyword">do</span> -s 1472 baidu.com<br><br><span class="hljs-comment"># Windows</span><br>ping -f -l 1472 baidu.com<br><br><span class="hljs-comment"># 如果成功，说明MTU &gt;= 1500</span><br><span class="hljs-comment"># 如果失败，逐渐减小数值直到成功</span><br></code></pre></td></tr></table></figure><p><strong>洪水ping（压力测试）</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Linux（需要root权限）</span><br><span class="hljs-built_in">sudo</span> ping -f baidu.com<br><br><span class="hljs-comment"># 说明：尽可能快地发送包，用于压力测试</span><br><span class="hljs-comment"># ⚠️ 注意：不要对公共服务器使用，可能被视为攻击</span><br></code></pre></td></tr></table></figure><h3 id="不同操作系统的TTL初始值">不同操作系统的TTL初始值</h3><table><thead><tr><th>操作系统</th><th>TTL初始值</th></tr></thead><tbody><tr><td>Linux</td><td>64</td></tr><tr><td>Windows</td><td>128</td></tr><tr><td>Cisco路由器</td><td>255</td></tr><tr><td>Unix/BSD</td><td>255</td></tr></tbody></table><p>通过ping返回的TTL，可以大致判断对方的操作系统类型！</p><h3 id="ICMP的其他用途">ICMP的其他用途</h3><ol><li><strong>Traceroute</strong>：通过逐步增加TTL来追踪路由</li><li><strong>MTU发现</strong>：确定最佳数据包大小</li><li><strong>网络诊断</strong>：检测网络配置问题</li><li><strong>错误报告</strong>：通知源主机网络错误</li></ol><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第6天：网络命令进阶 - traceroute</strong></p><p>我们将学习：</p><ul><li>traceroute的工作原理</li><li>如何追踪数据包的完整路径</li><li>理解TTL在路由追踪中的作用</li><li>编写自己的traceroute工具</li></ul><hr><p>💡 <strong>今日金句</strong>：ping通网络，就像听到远方朋友的回音！</p><p>👉 <a href="day04.md">上一天：TCP/IP四层模型</a> | <a href="../../README.md">返回目录</a> | <a href="day06.md">下一天：traceroute详解</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>4天：TCP/IP四层模型</title>
    <link href="/2025/11/10/4%E5%A4%A9%EF%BC%9ATCP_IP%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B/"/>
    <url>/2025/11/10/4%E5%A4%A9%EF%BC%9ATCP_IP%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1>第4天：TCP/IP四层模型</h1><blockquote><p>“理论是OSI，实战是TCP/IP。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解TCP/IP四层模型</li><li>掌握TCP/IP与OSI的区别和联系</li><li>学会分析真实的网络数据包</li><li>编写程序捕获和解析数据包</li></ul><h2 id="🎯-为什么需要TCP-IP模型？">🎯 为什么需要TCP/IP模型？</h2><h3 id="OSI-vs-TCP-IP">OSI vs TCP/IP</h3><p><strong>OSI七层模型</strong>：</p><ul><li>📖 理论模型，由ISO制定</li><li>🎓 教学用途，帮助理解网络概念</li><li>📚 过于复杂，实际应用较少</li></ul><p><strong>TCP/IP四层模型</strong>：</p><ul><li>💻 实际使用的模型</li><li>🌐 互联网的基础</li><li>🚀 简单实用，广泛应用</li></ul><h3 id="类比理解">类比理解</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">OSI模型 <span class="hljs-operator">=</span> 理想的建筑设计图纸（<span class="hljs-number">7</span>层楼）<br>TCP/IP模型 <span class="hljs-operator">=</span> 实际建造的房子（<span class="hljs-number">4</span>层楼，但功能齐全）<br></code></pre></td></tr></table></figure><h2 id="📊-TCP-IP四层模型">📊 TCP/IP四层模型</h2><h3 id="层次对应关系">层次对应关系</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs livescript">┌──────────────────┐<br>│   OSI七层模型    │            TCP/IP四层模型<br>├──────────────────┤<br>│  <span class="hljs-number">7.</span> 应用层       │ <span class="hljs-string">\</span><br>│  <span class="hljs-number">6.</span> 表示层       │  <span class="hljs-string">\</span>       ┌──────────────────┐<br>│  <span class="hljs-number">5.</span> 会话层       │   &#125; ───&gt; │  <span class="hljs-number">4.</span> 应用层       │<br>└──────────────────┘  /       │  (Application)   │<br>┌──────────────────┐ /        └──────────────────┘<br>│  <span class="hljs-number">4.</span> 传输层       │ ───────&gt; ┌──────────────────┐<br>└──────────────────┘          │  <span class="hljs-number">3.</span> 传输层       │<br>┌──────────────────┐          │  (Transport)     │<br>│  <span class="hljs-number">3.</span> 网络层       │ ───────&gt; └──────────────────┘<br>└──────────────────┘          ┌──────────────────┐<br>┌──────────────────┐          │  <span class="hljs-number">2.</span> 网际层       │<br>│  <span class="hljs-number">2.</span> 数据链路层   │ <span class="hljs-string">\</span>        │  (Internet)      │<br>│  <span class="hljs-number">1.</span> 物理层       │  &#125; ───&gt;  └──────────────────┘<br>└──────────────────┘ /        ┌──────────────────┐<br>                               │  <span class="hljs-number">1.</span> 网络接口层   │<br>                               │  (Network Access)│<br>                               └──────────────────┘<br></code></pre></td></tr></table></figure><h3 id="TCP-IP各层详解">TCP/IP各层详解</h3><h4 id="第4层：应用层（Application-Layer）">第4层：应用层（Application Layer）</h4><p><strong>对应OSI</strong>：应用层 + 表示层 + 会话层</p><p><strong>主要协议</strong>：</p><ul><li>🌐 HTTP/HTTPS：网页浏览</li><li>📧 SMTP/POP3/IMAP：邮件</li><li>📁 FTP：文件传输</li><li>🔍 DNS：域名解析</li><li>🔐 SSH：远程登录</li><li>💬 MQTT：物联网通信</li></ul><p><strong>作用</strong>：为用户提供各种网络服务</p><p><strong>例子</strong>：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nix">浏览器访问 www.baidu.com<br>↓<br>应用层：生成HTTP请求<br>GET <span class="hljs-symbol">/</span> HTTP<span class="hljs-symbol">/1.1</span><br><span class="hljs-params">Host:</span> www.baidu.com<br></code></pre></td></tr></table></figure><hr><h4 id="第3层：传输层（Transport-Layer）">第3层：传输层（Transport Layer）</h4><p><strong>对应OSI</strong>：传输层</p><p><strong>主要协议</strong>：</p><ul><li>🚚 TCP：可靠传输，面向连接</li><li>📦 UDP：快速传输，无连接</li></ul><p><strong>作用</strong>：提供端到端的数据传输</p><p><strong>关键概念</strong>：</p><ul><li><strong>端口号</strong>：标识应用程序<ul><li>HTTP: 80</li><li>HTTPS: 443</li><li>SSH: 22</li><li>MySQL: 3306</li></ul></li></ul><p><strong>TCP vs UDP</strong>：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">TCP</span> <span class="hljs-operator">=</span> 打电话（需要接通，可靠）<br><span class="hljs-attribute">UDP</span> <span class="hljs-operator">=</span> 发短信（直接发，不保证送达）<br></code></pre></td></tr></table></figure><hr><h4 id="第2层：网际层（Internet-Layer）">第2层：网际层（Internet Layer）</h4><p><strong>对应OSI</strong>：网络层</p><p><strong>主要协议</strong>：</p><ul><li>🌐 IP：网际协议（IPv4/IPv6）</li><li>📡 ICMP：控制消息协议</li><li>🗺️ ARP：地址解析协议</li><li>🔀 IGMP：组管理协议</li></ul><p><strong>作用</strong>：路由和寻址，在网络间传输数据</p><p><strong>关键概念</strong>：</p><ul><li><strong>IP地址</strong>：设备的网络地址<ul><li>192.168.1.100（私网）</li><li>8.8.8.8（公网）</li></ul></li></ul><p><strong>例子</strong>：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">从北京的电脑访问上海的服务器<br>↓<br>网际层：选择最佳路径<br>北京 → 路由器1 → 路由器2 → <span class="hljs-string">...</span> → 上海<br></code></pre></td></tr></table></figure><hr><h4 id="第1层：网络接口层（Network-Access-Layer）">第1层：网络接口层（Network Access Layer）</h4><p><strong>对应OSI</strong>：数据链路层 + 物理层</p><p><strong>主要协议</strong>：</p><ul><li>🔗 Ethernet：以太网</li><li>📶 WiFi：无线局域网</li><li>🔌 PPP：点对点协议</li></ul><p><strong>作用</strong>：在物理网络上传输数据帧</p><p><strong>关键概念</strong>：</p><ul><li><strong>MAC地址</strong>：网卡的物理地址<ul><li>AA:BB:CC:DD:EE:FF</li></ul></li></ul><p><strong>例子</strong>：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">同一个局域网内的两台电脑通信<br>↓<br>网络接口层：通过MAC地址直接传输<br>电脑<span class="hljs-selector-tag">A</span>的网卡 → 交换机 → 电脑<span class="hljs-selector-tag">B</span>的网卡<br></code></pre></td></tr></table></figure><h2 id="📦-TCP-IP数据封装">📦 TCP/IP数据封装</h2><h3 id="发送数据的封装过程">发送数据的封装过程</h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs coq">应用层：<br>[HTTP请求数据]<br>    ↓<br>传输层：<br>[TCP头部 | <span class="hljs-type">HTTP</span>请求数据]  ← Segment（段）<br>    ↓<br>网际层：<br>[IP头部 | <span class="hljs-type">TCP</span>头部 | <span class="hljs-type">HTTP</span>请求数据]  ← Packet（包）<br>    ↓<br>网络接口层：<br>[以太网帧头 | <span class="hljs-type">IP</span>头部 | <span class="hljs-type">TCP</span>头部 | <span class="hljs-type">HTTP</span>请求数据 | <span class="hljs-type">帧尾]  ← Frame</span>（帧）<br>    ↓<br>物理层：<br><span class="hljs-number">01010101.</span>..  ← Bits（比特流）<br></code></pre></td></tr></table></figure><h3 id="各层添加的信息">各层添加的信息</h3><table><thead><tr><th>层次</th><th>添加的信息</th><th>目的</th></tr></thead><tbody><tr><td>应用层</td><td>应用数据</td><td>用户数据</td></tr><tr><td>传输层</td><td>源端口、目标端口</td><td>标识应用程序</td></tr><tr><td>网际层</td><td>源IP、目标IP</td><td>标识主机位置</td></tr><tr><td>网络接口层</td><td>源MAC、目标MAC</td><td>标识网卡</td></tr></tbody></table><h2 id="🔧-实战项目：数据包分析器">🔧 实战项目：数据包分析器</h2><p>让我们编写一个程序，捕获和分析真实的网络数据包！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day04_packet_analyzer.py</span><br><span class="hljs-comment"># 功能：捕获并分析网络数据包（TCP/IP各层信息）</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> textwrap<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ethernet_frame</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析以太网帧（网络接口层）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    以太网帧格式：</span><br><span class="hljs-string">    [目标MAC(6字节) | 源MAC(6字节) | 类型(2字节) | 数据 | CRC(4字节)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 提取MAC地址和类型</span><br>    dest_mac, src_mac, eth_type = struct.unpack(<span class="hljs-string">&#x27;! 6s 6s H&#x27;</span>, data[:<span class="hljs-number">14</span>])<br><br>    <span class="hljs-comment"># 格式化MAC地址</span><br>    dest_mac = <span class="hljs-string">&#x27;:&#x27;</span>.join(<span class="hljs-string">&#x27;&#123;:02x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> dest_mac)<br>    src_mac = <span class="hljs-string">&#x27;:&#x27;</span>.join(<span class="hljs-string">&#x27;&#123;:02x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> src_mac)<br><br>    <span class="hljs-comment"># 以太网类型</span><br>    <span class="hljs-comment"># 0x0800 = IPv4, 0x86DD = IPv6, 0x0806 = ARP</span><br>    eth_type = socket.htons(eth_type)<br><br>    <span class="hljs-comment"># 返回MAC地址、类型和剩余数据</span><br>    <span class="hljs-keyword">return</span> dest_mac, src_mac, eth_type, data[<span class="hljs-number">14</span>:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ipv4_packet</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析IPv4数据包（网际层）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    IPv4头部格式（20字节）：</span><br><span class="hljs-string">    [版本+头长(1) | 服务类型(1) | 总长度(2) | 标识(2) | 标志+偏移(2) |</span><br><span class="hljs-string">     TTL(1) | 协议(1) | 校验和(2) | 源IP(4) | 目标IP(4)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 解析IPv4头部的前20字节</span><br>    version_header_length = data[<span class="hljs-number">0</span>]<br>    version = version_header_length &gt;&gt; <span class="hljs-number">4</span>  <span class="hljs-comment"># 高4位是版本</span><br>    header_length = (version_header_length &amp; <span class="hljs-number">15</span>) * <span class="hljs-number">4</span>  <span class="hljs-comment"># 低4位是头长（单位：4字节）</span><br><br>    <span class="hljs-comment"># 提取TTL、协议、源IP、目标IP</span><br>    ttl, proto, src, target = struct.unpack(<span class="hljs-string">&#x27;! 8x B B 2x 4s 4s&#x27;</span>, data[:<span class="hljs-number">20</span>])<br><br>    <span class="hljs-comment"># 格式化IP地址</span><br>    src_ip = <span class="hljs-string">&#x27;.&#x27;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, src))<br>    target_ip = <span class="hljs-string">&#x27;.&#x27;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, target))<br><br>    <span class="hljs-comment"># 协议号对应的协议名</span><br>    protocols = &#123;<span class="hljs-number">1</span>: <span class="hljs-string">&#x27;ICMP&#x27;</span>, <span class="hljs-number">6</span>: <span class="hljs-string">&#x27;TCP&#x27;</span>, <span class="hljs-number">17</span>: <span class="hljs-string">&#x27;UDP&#x27;</span>&#125;<br>    proto_name = protocols.get(proto, <span class="hljs-string">f&#x27;Other(<span class="hljs-subst">&#123;proto&#125;</span>)&#x27;</span>)<br><br>    <span class="hljs-keyword">return</span> version, header_length, ttl, proto_name, src_ip, target_ip, data[header_length:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tcp_segment</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析TCP段（传输层）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    TCP头部格式（至少20字节）：</span><br><span class="hljs-string">    [源端口(2) | 目标端口(2) | 序号(4) | 确认号(4) |</span><br><span class="hljs-string">     头长+标志(2) | 窗口(2) | 校验和(2) | 紧急指针(2)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    src_port, dest_port, sequence, acknowledgment, offset_reserved_flags = struct.unpack(<br>        <span class="hljs-string">&#x27;! H H L L H&#x27;</span>, data[:<span class="hljs-number">14</span>]<br>    )<br><br>    <span class="hljs-comment"># 提取头部长度（高4位）</span><br>    offset = (offset_reserved_flags &gt;&gt; <span class="hljs-number">12</span>) * <span class="hljs-number">4</span><br><br>    <span class="hljs-comment"># 提取TCP标志位</span><br>    flag_urg = (offset_reserved_flags &amp; <span class="hljs-number">32</span>) &gt;&gt; <span class="hljs-number">5</span><br>    flag_ack = (offset_reserved_flags &amp; <span class="hljs-number">16</span>) &gt;&gt; <span class="hljs-number">4</span><br>    flag_psh = (offset_reserved_flags &amp; <span class="hljs-number">8</span>) &gt;&gt; <span class="hljs-number">3</span><br>    flag_rst = (offset_reserved_flags &amp; <span class="hljs-number">4</span>) &gt;&gt; <span class="hljs-number">2</span><br>    flag_syn = (offset_reserved_flags &amp; <span class="hljs-number">2</span>) &gt;&gt; <span class="hljs-number">1</span><br>    flag_fin = offset_reserved_flags &amp; <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> src_port, dest_port, sequence, acknowledgment, flag_urg, flag_ack, \<br>           flag_psh, flag_rst, flag_syn, flag_fin, data[offset:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">udp_segment</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析UDP段（传输层）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    UDP头部格式（8字节）：</span><br><span class="hljs-string">    [源端口(2) | 目标端口(2) | 长度(2) | 校验和(2)]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    src_port, dest_port, length = struct.unpack(<span class="hljs-string">&#x27;! H H 2x H&#x27;</span>, data[:<span class="hljs-number">8</span>])<br>    <span class="hljs-keyword">return</span> src_port, dest_port, length, data[<span class="hljs-number">8</span>:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">format_multi_line</span>(<span class="hljs-params">prefix, string, size=<span class="hljs-number">80</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;格式化多行输出&quot;&quot;&quot;</span><br>    size -= <span class="hljs-built_in">len</span>(prefix)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(string, <span class="hljs-built_in">bytes</span>):<br>        string = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-string">r&#x27;\x&#123;:02x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(byte) <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> string)<br>        <span class="hljs-keyword">if</span> size % <span class="hljs-number">2</span>:<br>            size -= <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;\n&#x27;</span>.join([prefix + line <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> textwrap.wrap(string, size)])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数：捕获并分析数据包</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;TCP/IP数据包分析器&quot;</span>.center(<span class="hljs-number">80</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n📡 正在监听网络接口...&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 提示：访问一个网站或ping一个地址来生成流量&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚠️  按Ctrl+C停止捕获\n&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><br>    <span class="hljs-comment"># 创建原始套接字</span><br>    <span class="hljs-comment"># 注意：在某些系统上可能需要root权限</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># Windows</span><br>        conn = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_IP)<br>        conn.bind((<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-number">0</span>))<br>        conn.setsockopt(socket.IPPROTO_IP, socket.IP_HDRINCL, <span class="hljs-number">1</span>)<br>        conn.ioctl(socket.SIO_RCVALL, socket.RCVALL_ON)<br>    <span class="hljs-keyword">except</span> AttributeError:<br>        <span class="hljs-comment"># Linux/Mac</span><br>        conn = socket.socket(socket.AF_PACKET, socket.SOCK_RAW, socket.ntohs(<span class="hljs-number">3</span>))<br><br>    packet_count = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-comment"># 接收数据</span><br>            raw_data, addr = conn.recvfrom(<span class="hljs-number">65535</span>)<br>            packet_count += <span class="hljs-number">1</span><br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;▼&#x27;</span> * <span class="hljs-number">40</span>&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📦 数据包 #<span class="hljs-subst">&#123;packet_count&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;▼&#x27;</span> * <span class="hljs-number">40</span>&#125;</span>\n&quot;</span>)<br><br>            <span class="hljs-comment"># 1. 解析以太网帧（网络接口层）</span><br>            <span class="hljs-keyword">try</span>:<br>                dest_mac, src_mac, eth_type, data = ethernet_frame(raw_data)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔗 网络接口层（以太网帧）&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源MAC地址: <span class="hljs-subst">&#123;src_mac&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标MAC地址: <span class="hljs-subst">&#123;dest_mac&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   协议类型: 0x<span class="hljs-subst">&#123;eth_type:04x&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-comment"># 某些系统可能不包含以太网头</span><br>                eth_type = <span class="hljs-number">0x0800</span><br>                data = raw_data<br><br>            <span class="hljs-comment"># 2. 解析IP数据包（网际层）</span><br>            <span class="hljs-keyword">if</span> eth_type == <span class="hljs-number">0x0800</span>:  <span class="hljs-comment"># IPv4</span><br>                version, header_length, ttl, proto, src_ip, target_ip, data = ipv4_packet(data)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🌐 网际层（IP数据包）&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   IP版本: IPv<span class="hljs-subst">&#123;version&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   头部长度: <span class="hljs-subst">&#123;header_length&#125;</span>字节&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   TTL: <span class="hljs-subst">&#123;ttl&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   协议: <span class="hljs-subst">&#123;proto&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源IP地址: <span class="hljs-subst">&#123;src_ip&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标IP地址: <span class="hljs-subst">&#123;target_ip&#125;</span>&quot;</span>)<br><br>                <span class="hljs-comment"># 3. 解析传输层</span><br>                <span class="hljs-keyword">if</span> proto == <span class="hljs-string">&#x27;TCP&#x27;</span>:<br>                    src_port, dest_port, sequence, acknowledgment, flag_urg, flag_ack, \<br>                    flag_psh, flag_rst, flag_syn, flag_fin, data = tcp_segment(data)<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n🚚 传输层（TCP段）&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源端口: <span class="hljs-subst">&#123;src_port&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标端口: <span class="hljs-subst">&#123;dest_port&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   序列号: <span class="hljs-subst">&#123;sequence&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   确认号: <span class="hljs-subst">&#123;acknowledgment&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   标志位: &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br><br>                    flags = []<br>                    <span class="hljs-keyword">if</span> flag_syn: flags.append(<span class="hljs-string">&quot;SYN&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_ack: flags.append(<span class="hljs-string">&quot;ACK&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_fin: flags.append(<span class="hljs-string">&quot;FIN&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_rst: flags.append(<span class="hljs-string">&quot;RST&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_psh: flags.append(<span class="hljs-string">&quot;PSH&quot;</span>)<br>                    <span class="hljs-keyword">if</span> flag_urg: flags.append(<span class="hljs-string">&quot;URG&quot;</span>)<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;, &quot;</span>.join(flags) <span class="hljs-keyword">if</span> flags <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;无&quot;</span>)<br><br>                    <span class="hljs-comment"># 4. 应用层数据</span><br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &gt; <span class="hljs-number">0</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📱 应用层数据&quot;</span>)<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   数据长度: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(data)&#125;</span>字节&quot;</span>)<br><br>                        <span class="hljs-comment"># 尝试解析HTTP</span><br>                        <span class="hljs-keyword">try</span>:<br>                            data_str = data.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>                            <span class="hljs-keyword">if</span> data_str.startswith(<span class="hljs-string">&#x27;HTTP&#x27;</span>) <span class="hljs-keyword">or</span> data_str.startswith(<span class="hljs-string">&#x27;GET&#x27;</span>) <span class="hljs-keyword">or</span> \<br>                               data_str.startswith(<span class="hljs-string">&#x27;POST&#x27;</span>):<br>                                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   协议: HTTP&quot;</span>)<br>                                lines = data_str.split(<span class="hljs-string">&#x27;\\r\\n&#x27;</span>)[:<span class="hljs-number">5</span>]  <span class="hljs-comment"># 只显示前5行</span><br>                                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>                                    <span class="hljs-keyword">if</span> line:<br>                                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   <span class="hljs-subst">&#123;line&#125;</span>&quot;</span>)<br>                        <span class="hljs-keyword">except</span>:<br>                            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   数据预览: <span class="hljs-subst">&#123;data[:<span class="hljs-number">50</span>]&#125;</span>&quot;</span>)<br><br>                <span class="hljs-keyword">elif</span> proto == <span class="hljs-string">&#x27;UDP&#x27;</span>:<br>                    src_port, dest_port, length, data = udp_segment(data)<br><br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📦 传输层（UDP段）&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源端口: <span class="hljs-subst">&#123;src_port&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标端口: <span class="hljs-subst">&#123;dest_port&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   长度: <span class="hljs-subst">&#123;length&#125;</span>字节&quot;</span>)<br><br>                    <span class="hljs-comment"># DNS查询/响应</span><br>                    <span class="hljs-keyword">if</span> src_port == <span class="hljs-number">53</span> <span class="hljs-keyword">or</span> dest_port == <span class="hljs-number">53</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   应用协议: DNS&quot;</span>)<br><br>                <span class="hljs-keyword">elif</span> proto == <span class="hljs-string">&#x27;ICMP&#x27;</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n📡 传输层（ICMP）&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   这是一个ping或traceroute数据包&quot;</span>)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><br>            <span class="hljs-comment"># 只捕获前10个包作为演示</span><br>            <span class="hljs-keyword">if</span> packet_count &gt;= <span class="hljs-number">10</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n✅ 已捕获<span class="hljs-subst">&#123;packet_count&#125;</span>个数据包，停止监听&quot;</span>)<br>                <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n\n✋ 用户停止捕获&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📊 总共捕获了 <span class="hljs-subst">&#123;packet_count&#125;</span> 个数据包&quot;</span>)<br><br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-comment"># Windows需要关闭混杂模式</span><br>        <span class="hljs-keyword">try</span>:<br>            conn.ioctl(socket.SIO_RCVALL, socket.RCVALL_OFF)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>        conn.close()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">import</span> sys<br>    <span class="hljs-keyword">if</span> sys.platform == <span class="hljs-string">&#x27;win32&#x27;</span> <span class="hljs-keyword">or</span> sys.platform == <span class="hljs-string">&#x27;linux&#x27;</span> <span class="hljs-keyword">or</span> sys.platform == <span class="hljs-string">&#x27;darwin&#x27;</span>:<br>        main()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚠️  此程序可能需要管理员/root权限&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Linux/Mac: sudo python day04_packet_analyzer.py&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 Windows: 以管理员身份运行&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="运行说明">运行说明</h3><p><strong>Linux/Mac</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> python code/day04/day04_packet_analyzer.py<br></code></pre></td></tr></table></figure><p><strong>Windows</strong>：<br>以管理员身份运行命令提示符，然后：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python code\day04\day04_packet_analyzer.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><p>程序会实时显示捕获到的数据包的各层信息。</p><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ TCP/IP四层模型是实际使用的网络模型</li><li>✅ TCP/IP比OSI更简洁实用</li><li>✅ 每一层都有特定的协议和作用</li><li>✅ 数据包包含多层的头部信息</li></ol><h3 id="TCP-IP四层对应表">TCP/IP四层对应表</h3><table><thead><tr><th>TCP/IP层</th><th>主要协议</th><th>关键信息</th><th>设备</th></tr></thead><tbody><tr><td>应用层</td><td>HTTP、DNS、FTP</td><td>应用数据</td><td>-</td></tr><tr><td>传输层</td><td>TCP、UDP</td><td>端口号</td><td>-</td></tr><tr><td>网际层</td><td>IP、ICMP</td><td>IP地址</td><td>路由器</td></tr><tr><td>网络接口层</td><td>Ethernet、WiFi</td><td>MAC地址</td><td>交换机、网卡</td></tr></tbody></table><h3 id="重要协议">重要协议</h3><p><strong>应用层</strong>：</p><ul><li>HTTP（80）：网页</li><li>HTTPS（443）：加密网页</li><li>DNS（53）：域名解析</li><li>FTP（21）：文件传输</li><li>SSH（22）：远程登录</li><li>SMTP（25）：发送邮件</li></ul><p><strong>传输层</strong>：</p><ul><li>TCP：可靠传输</li><li>UDP：快速传输</li></ul><p><strong>网际层</strong>：</p><ul><li>IP：寻址和路由</li><li>ICMP：错误报告和诊断</li></ul><p><strong>网络接口层</strong>：</p><ul><li>Ethernet：有线网络</li><li>WiFi：无线网络</li></ul><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：协议识别">练习1：协议识别</h3><p>以下端口号对应什么协议？</p><ol><li>80</li><li>443</li><li>22</li><li>3306</li><li>27017</li></ol><h3 id="练习2：层次判断">练习2：层次判断</h3><p>以下信息分别属于哪一层？</p><ol><li>192.168.1.1</li><li>AA:BB:CC:DD:EE:FF</li><li>端口8080</li><li>HTTP/1.1</li><li>TCP序列号12345</li></ol><h3 id="练习3：绘制数据包结构">练习3：绘制数据包结构</h3><p>画出一个完整的HTTP请求数据包的结构，标注每一层的头部。</p><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>扩展数据包分析器：</p><ol><li>添加数据包过滤功能（只显示特定协议）</li><li>统计各协议的数据包数量</li><li>将捕获的数据包保存到文件</li></ol><h3 id="练习5：思考题">练习5：思考题</h3><ol><li>为什么TCP/IP模型只有4层而OSI有7层？</li><li>路由器工作在哪一层？交换机呢？</li><li>防火墙可能工作在哪几层？</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="TCP-IP协议族">TCP/IP协议族</h3><p>TCP/IP不仅仅是TCP和IP两个协议，而是一整个协议族：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs routeros">应用层：<br>┌────────────────────────────────────┐<br>│ HTTP  FTP  <span class="hljs-built_in"> DNS </span>  SMTP  SSH  等<span class="hljs-built_in">..</span>. │<br>└────────────────────────────────────┘<br><br>传输层：<br>┌──────────┬──────────┐<br>│   TCP    │   UDP    │<br>└──────────┴──────────┘<br><br>网际层：<br>┌────────────────────────────┐<br>│  <span class="hljs-built_in"> IP </span>  ICMP   ARP   IGMP   │<br>└────────────────────────────┘<br><br>网络接口层：<br>┌────────────────────────────┐<br>│ <span class="hljs-built_in"> Ethernet </span> WiFi <span class="hljs-built_in"> PPP </span> 等<span class="hljs-built_in">..</span>. │<br>└────────────────────────────┘<br></code></pre></td></tr></table></figure><h3 id="常见端口号记忆">常见端口号记忆</h3><p><strong>HTTP家族</strong>：</p><ul><li>80：HTTP</li><li>443：HTTPS</li><li>8080：HTTP代理</li></ul><p><strong>文件传输</strong>：</p><ul><li>20/21：FTP</li><li>22：SFTP（SSH）</li><li>69：TFTP</li></ul><p><strong>邮件</strong>：</p><ul><li>25：SMTP（发送）</li><li>110：POP3（接收）</li><li>143：IMAP（接收）</li></ul><p><strong>数据库</strong>：</p><ul><li>3306：MySQL</li><li>5432：PostgreSQL</li><li>27017：MongoDB</li><li>6379：Redis</li></ul><p><strong>远程</strong>：</p><ul><li>22：SSH</li><li>23：Telnet</li><li>3389：RDP（Windows远程桌面）</li></ul><h3 id="实际应用场景">实际应用场景</h3><ol><li><p><strong>浏览网页</strong>：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">应用层：HTTP请求 www<span class="hljs-selector-class">.baidu</span><span class="hljs-selector-class">.com</span><br>传输层：TCP 端口<span class="hljs-number">80</span><br>网际层：IP地址 <span class="hljs-number">220.181</span>.<span class="hljs-number">38.148</span><br>网络接口层：通过以太网发送<br></code></pre></td></tr></table></figure></li><li><p><strong>发送邮件</strong>：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino">应用层：SMTP协议<br>传输层：TCP 端口<span class="hljs-number">25</span><br>网际层：IP地址（邮件服务器）<br>网络接口层：<span class="hljs-built_in">WiFi</span><br></code></pre></td></tr></table></figure></li><li><p><strong>ping命令</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">应用层：无（ICMP是网际层协议）<br>传输层：无<br>网际层：ICMP <span class="hljs-built_in">echo</span> request<br>网络接口层：以太网<br></code></pre></td></tr></table></figure></li></ol><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第5天：网络命令入门 - ping</strong></p><p>我们将学习：</p><ul><li>ping命令的工作原理</li><li>ICMP协议详解</li><li>RTT（往返时间）的计算</li><li>编写自己的ping工具</li></ul><hr><p>💡 <strong>今日金句</strong>：掌握TCP/IP，就掌握了互联网的语言！</p><p>👉 <a href="day03.md">上一天：OSI七层模型</a> | <a href="../../README.md">返回目录</a> | <a href="day05.md">下一天：ping命令详解</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>3天：OSI七层模型</title>
    <link href="/2025/11/10/3%E5%A4%A9%EF%BC%9AOSI%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/"/>
    <url>/2025/11/10/3%E5%A4%A9%EF%BC%9AOSI%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1>第3天：OSI七层模型</h1><blockquote><p>“网络协议就像流水线，每一层都有自己的分工。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解什么是OSI七层模型</li><li>掌握每一层的作用</li><li>理解数据封装和解封装过程</li><li>编写程序演示协议分层</li></ul><h2 id="🎯-为什么要分层？">🎯 为什么要分层？</h2><h3 id="生活中的例子：快递系统">生活中的例子：快递系统</h3><p>想象你要给上海的朋友寄一本书：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs">你写信 ────────────────────────────&gt; 朋友读信<br>  ↓                                      ↑<br>包装快递 ──────────────────────────&gt; 拆开快递<br>  ↓                                      ↑<br>分拣中心 ──────────────────────────&gt; 分拣中心<br>  ↓                                      ↑<br>运输车辆 ──────────────────────────&gt; 运输车辆<br></code></pre></td></tr></table></figure><p><strong>每一层只关心自己的工作</strong>：</p><ul><li>你只需要写信，不管怎么运输</li><li>快递员只负责包装，不管写的什么</li><li>司机只负责开车，不管包裹里是什么</li></ul><p>这就是<strong>分层的思想</strong>！</p><h3 id="分层的好处">分层的好处</h3><ol><li><strong>降低复杂度</strong>：每层只处理自己的任务</li><li><strong>标准化接口</strong>：层与层之间有明确的接口</li><li><strong>易于维护</strong>：修改某一层不影响其他层</li><li><strong>可替换</strong>：可以更换某一层的实现</li></ol><h2 id="📊-OSI七层模型">📊 OSI七层模型</h2><p><strong>OSI</strong>（Open Systems Interconnection）是国际标准化组织（ISO）制定的网络模型。</p><h3 id="七层概览">七层概览</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs arduino">┌─────────────┬────────────┬──────────────┬──────────────┐<br>│  层次       │  名称      │  作用        │  例子        │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">7</span>层      │  应用层    │  为用户提供  │  HTTP、FTP   │<br>│             │Application │  网络服务    │  SMTP、DNS   │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">6</span>层      │  表示层    │  数据格式转换│  加密、压缩  │<br>│             │Presentation│  编码、加密  │  JPEG、MPEG  │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">5</span>层      │  会话层    │  建立、管理  │  RPC、SQL    │<br>│             │Session     │  会话        │              │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">4</span>层      │  传输层    │  端到端通信  │  TCP、UDP    │<br>│             │Transport   │  可靠传输    │              │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">3</span>层      │  网络层    │  路由选择    │  IP、ICMP    │<br>│             │Network     │  寻址        │              │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">2</span>层      │  数据链路层│  帧传输      │  <span class="hljs-built_in">Ethernet</span>    │<br>│             │Data Link   │  错误检测    │  <span class="hljs-built_in">WiFi</span>、PPP   │<br>├─────────────┼────────────┼──────────────┼──────────────┤<br>│  第<span class="hljs-number">1</span>层      │  物理层    │  比特传输    │  网线、光纤  │<br>│             │Physical    │  电信号      │  无线电波    │<br>└─────────────┴────────────┴──────────────┴──────────────┘<br></code></pre></td></tr></table></figure><h3 id="记忆口诀">记忆口诀</h3><p><strong>从上到下</strong>：</p><ul><li>应（应用层）</li><li>表（表示层）</li><li>会（会话层）</li><li>传（传输层）</li><li>网（网络层）</li><li>数（数据链路层）</li><li>物（物理层）</li></ul><p><strong>英文口诀</strong>：All People Seem To Need Data Processing</p><h2 id="🔍-各层详解">🔍 各层详解</h2><h3 id="第7层：应用层（Application-Layer）">第7层：应用层（Application Layer）</h3><p><strong>作用</strong>：为应用程序提供网络服务</p><p><strong>通俗理解</strong>：你直接使用的软件层面</p><p><strong>例子</strong>：</p><ul><li>浏览器打开网页（HTTP/HTTPS）</li><li>收发邮件（SMTP/POP3）</li><li>下载文件（FTP）</li><li>域名解析（DNS）</li></ul><p><strong>类比</strong>：快递公司的客服窗口</p><hr><h3 id="第6层：表示层（Presentation-Layer）">第6层：表示层（Presentation Layer）</h3><p><strong>作用</strong>：数据格式转换、加密、压缩</p><p><strong>通俗理解</strong>：翻译官</p><p><strong>例子</strong>：</p><ul><li>JPEG图片格式</li><li>MP3音频格式</li><li>加密算法（SSL/TLS）</li><li>字符编码（UTF-8）</li></ul><p><strong>类比</strong>：快递包装、封装</p><hr><h3 id="第5层：会话层（Session-Layer）">第5层：会话层（Session Layer）</h3><p><strong>作用</strong>：建立、管理、终止会话</p><p><strong>通俗理解</strong>：负责通话的接线员</p><p><strong>例子</strong>：</p><ul><li>登录会话</li><li>数据库连接</li><li>RPC远程调用</li></ul><p><strong>类比</strong>：快递单号管理系统</p><hr><h3 id="第4层：传输层（Transport-Layer）">第4层：传输层（Transport Layer）</h3><p><strong>作用</strong>：端到端的可靠传输</p><p><strong>通俗理解</strong>：确保包裹完整送达</p><p><strong>例子</strong>：</p><ul><li>TCP：可靠传输，确保数据不丢失</li><li>UDP：快速传输，不保证可靠</li></ul><p><strong>关键概念</strong>：端口号（区分不同的应用）</p><p><strong>类比</strong>：快递公司的分发系统</p><hr><h3 id="第3层：网络层（Network-Layer）">第3层：网络层（Network Layer）</h3><p><strong>作用</strong>：路由选择和寻址</p><p><strong>通俗理解</strong>：找到最佳路径</p><p><strong>例子</strong>：</p><ul><li>IP协议（IP地址）</li><li>路由器工作在这一层</li></ul><p><strong>关键概念</strong>：IP地址（定位设备位置）</p><p><strong>类比</strong>：快递运输路线规划</p><hr><h3 id="第2层：数据链路层（Data-Link-Layer）">第2层：数据链路层（Data Link Layer）</h3><p><strong>作用</strong>：帧传输，相邻节点之间的数据传输</p><p><strong>通俗理解</strong>：同一条街道内的传送</p><p><strong>例子</strong>：</p><ul><li>以太网（Ethernet）</li><li>WiFi</li><li>MAC地址</li></ul><p><strong>关键概念</strong>：MAC地址（网卡的物理地址）</p><p><strong>类比</strong>：同城快递站点之间的传递</p><hr><h3 id="第1层：物理层（Physical-Layer）">第1层：物理层（Physical Layer）</h3><p><strong>作用</strong>：在物理媒介上传输比特流</p><p><strong>通俗理解</strong>：实际的传输介质</p><p><strong>例子</strong>：</p><ul><li>网线（双绞线）</li><li>光纤</li><li>无线电波</li></ul><p><strong>关键概念</strong>：电信号、光信号、无线信号</p><p><strong>类比</strong>：快递车、飞机、轮船</p><h2 id="📦-数据封装过程">📦 数据封装过程</h2><p>当你发送数据时，数据会经过<strong>封装</strong>过程：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">应用层：    [用户数据]<br>              ↓ 添加应用层头部<br>表示层：    [表示层头部|<span class="hljs-string">用户数据]</span><br><span class="hljs-string">              ↓ 添加会话层头部</span><br><span class="hljs-string">会话层：    [会话层头部</span>|<span class="hljs-string">表示层头部</span>|<span class="hljs-string">用户数据]</span><br><span class="hljs-string">              ↓ 添加传输层头部</span><br><span class="hljs-string">传输层：    [TCP头部</span>|<span class="hljs-string">数据] ← 称为&quot;段&quot;（Segment）</span><br><span class="hljs-string">              ↓ 添加网络层头部</span><br><span class="hljs-string">网络层：    [IP头部</span>|<span class="hljs-string">TCP头部</span>|<span class="hljs-string">数据] ← 称为&quot;包&quot;（Packet）</span><br><span class="hljs-string">              ↓ 添加数据链路层头部和尾部</span><br><span class="hljs-string">数据链路层：[帧头</span>|<span class="hljs-string">IP头部</span>|<span class="hljs-string">TCP头部</span>|<span class="hljs-string">数据</span>|<span class="hljs-string">帧尾] ← 称为&quot;帧&quot;（Frame）</span><br><span class="hljs-string">              ↓ 转换为比特流</span><br><span class="hljs-string">物理层：    01010101010101... ← 比特流（Bits）</span><br></code></pre></td></tr></table></figure><h3 id="类比理解">类比理解</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs armasm">你写的信     →  应用层数据<br>装进信封     →  传输层添加端口信息<br>写上地址     →  网络层添加<span class="hljs-built_in">IP</span>地址<br>放入包裹箱   →  数据链路层添加MAC地址<br>快递车运输   →  物理层传输<br></code></pre></td></tr></table></figure><h2 id="🔧-实战项目：协议分层演示">🔧 实战项目：协议分层演示</h2><p>让我们编写一个程序，模拟OSI七层模型的数据封装过程！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day03_osi_demo.py</span><br><span class="hljs-comment"># 功能：演示OSI七层模型的数据封装和解封装过程</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OSILayer</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;OSI模型的基础层类&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, layer_num</span>):<br>        <span class="hljs-variable language_">self</span>.name = name<br>        <span class="hljs-variable language_">self</span>.layer_num = layer_num<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;封装数据：添加本层头部&quot;&quot;&quot;</span><br>        header = <span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;self.name&#125;</span>头部]&quot;</span><br>        <span class="hljs-keyword">return</span> header + data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;解封装数据：移除本层头部&quot;&quot;&quot;</span><br>        header = <span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;self.name&#125;</span>头部]&quot;</span><br>        <span class="hljs-keyword">if</span> data.startswith(header):<br>            <span class="hljs-keyword">return</span> data[<span class="hljs-built_in">len</span>(header):]<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PhysicalLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;物理层：第1层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;物理层&quot;</span>, <span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;将数据转换为比特流&quot;&quot;&quot;</span><br>        bits = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">format</span>(<span class="hljs-built_in">ord</span>(c), <span class="hljs-string">&#x27;08b&#x27;</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📡 <span class="hljs-subst">&#123;self.name&#125;</span>: 将数据转换为比特流&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   比特流(前64位): <span class="hljs-subst">&#123;bits[:<span class="hljs-number">64</span>]&#125;</span>...&quot;</span>)<br>        <span class="hljs-keyword">return</span> bits<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, bits</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;将比特流转换为数据&quot;&quot;&quot;</span><br>        chars = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(bits), <span class="hljs-number">8</span>):<br>            byte = bits[i:i+<span class="hljs-number">8</span>]<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(byte) == <span class="hljs-number">8</span>:<br>                chars.append(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(byte, <span class="hljs-number">2</span>)))<br>        data = <span class="hljs-string">&#x27;&#x27;</span>.join(chars)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📡 <span class="hljs-subst">&#123;self.name&#125;</span>: 将比特流转换为数据&quot;</span>)<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLinkLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;数据链路层：第2层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;数据链路层&quot;</span>, <span class="hljs-number">2</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;添加MAC地址（帧头和帧尾）&quot;&quot;&quot;</span><br>        mac_src = <span class="hljs-string">&quot;AA:BB:CC:DD:EE:FF&quot;</span>  <span class="hljs-comment"># 源MAC地址</span><br>        mac_dst = <span class="hljs-string">&quot;11:22:33:44:55:66&quot;</span>  <span class="hljs-comment"># 目标MAC地址</span><br>        frame = <span class="hljs-string">f&quot;[帧头|源MAC:<span class="hljs-subst">&#123;mac_src&#125;</span>|目标MAC:<span class="hljs-subst">&#123;mac_dst&#125;</span>]<span class="hljs-subst">&#123;data&#125;</span>[帧尾|CRC校验]&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔗 <span class="hljs-subst">&#123;self.name&#125;</span>: 添加MAC地址&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源MAC: <span class="hljs-subst">&#123;mac_src&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标MAC: <span class="hljs-subst">&#123;mac_dst&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> frame<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, frame</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;移除MAC地址&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 简化处理：移除帧头和帧尾</span><br>        start = frame.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        end = frame.rfind(<span class="hljs-string">&quot;[&quot;</span>)<br>        data = frame[start:end]<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔗 <span class="hljs-subst">&#123;self.name&#125;</span>: 移除MAC地址&quot;</span>)<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;网络层：第3层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;网络层&quot;</span>, <span class="hljs-number">3</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;添加IP地址&quot;&quot;&quot;</span><br>        ip_src = <span class="hljs-string">&quot;192.168.1.100&quot;</span>  <span class="hljs-comment"># 源IP地址</span><br>        ip_dst = <span class="hljs-string">&quot;93.184.216.34&quot;</span>  <span class="hljs-comment"># 目标IP地址（example.com）</span><br>        packet = <span class="hljs-string">f&quot;[IP头|源IP:<span class="hljs-subst">&#123;ip_src&#125;</span>|目标IP:<span class="hljs-subst">&#123;ip_dst&#125;</span>|TTL:64]<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🌐 <span class="hljs-subst">&#123;self.name&#125;</span>: 添加IP地址&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源IP: <span class="hljs-subst">&#123;ip_src&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标IP: <span class="hljs-subst">&#123;ip_dst&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> packet<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, packet</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;移除IP头部&quot;&quot;&quot;</span><br>        start = packet.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🌐 <span class="hljs-subst">&#123;self.name&#125;</span>: 移除IP头部&quot;</span>)<br>        <span class="hljs-keyword">return</span> start <span class="hljs-keyword">and</span> packet[start:] <span class="hljs-keyword">or</span> packet<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TransportLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;传输层：第4层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;传输层&quot;</span>, <span class="hljs-number">4</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;添加端口号（TCP头部）&quot;&quot;&quot;</span><br>        port_src = <span class="hljs-number">54321</span>  <span class="hljs-comment"># 源端口</span><br>        port_dst = <span class="hljs-number">80</span>     <span class="hljs-comment"># 目标端口（HTTP）</span><br>        segment = <span class="hljs-string">f&quot;[TCP头|源端口:<span class="hljs-subst">&#123;port_src&#125;</span>|目标端口:<span class="hljs-subst">&#123;port_dst&#125;</span>|序号:12345]<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🚚 <span class="hljs-subst">&#123;self.name&#125;</span>: 添加端口号（TCP协议）&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   源端口: <span class="hljs-subst">&#123;port_src&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   目标端口: <span class="hljs-subst">&#123;port_dst&#125;</span> (HTTP)&quot;</span>)<br>        <span class="hljs-keyword">return</span> segment<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, segment</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;移除TCP头部&quot;&quot;&quot;</span><br>        start = segment.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🚚 <span class="hljs-subst">&#123;self.name&#125;</span>: 移除TCP头部&quot;</span>)<br>        <span class="hljs-keyword">return</span> segment[start:]<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SessionLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;会话层：第5层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;会话层&quot;</span>, <span class="hljs-number">5</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;建立会话&quot;&quot;&quot;</span><br>        session_id = <span class="hljs-string">&quot;SESSION-20250105-12345&quot;</span><br>        session_data = <span class="hljs-string">f&quot;[会话头|会话ID:<span class="hljs-subst">&#123;session_id&#125;</span>]<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;💬 <span class="hljs-subst">&#123;self.name&#125;</span>: 建立会话&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   会话ID: <span class="hljs-subst">&#123;session_id&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> session_data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;终止会话&quot;&quot;&quot;</span><br>        start = data.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;💬 <span class="hljs-subst">&#123;self.name&#125;</span>: 解析会话信息&quot;</span>)<br>        <span class="hljs-keyword">return</span> data[start:]<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PresentationLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;表示层：第6层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;表示层&quot;</span>, <span class="hljs-number">6</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;数据格式转换&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 这里简化为添加编码信息</span><br>        formatted_data = <span class="hljs-string">f&quot;[格式|编码:UTF-8|压缩:无|加密:无]<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🎨 <span class="hljs-subst">&#123;self.name&#125;</span>: 数据格式处理&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   编码: UTF-8&quot;</span>)<br>        <span class="hljs-keyword">return</span> formatted_data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;数据格式还原&quot;&quot;&quot;</span><br>        start = data.find(<span class="hljs-string">&quot;]&quot;</span>) + <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🎨 <span class="hljs-subst">&#123;self.name&#125;</span>: 数据格式还原&quot;</span>)<br>        <span class="hljs-keyword">return</span> data[start:]<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationLayer</span>(<span class="hljs-title class_ inherited__">OSILayer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;应用层：第7层&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__(<span class="hljs-string">&quot;应用层&quot;</span>, <span class="hljs-number">7</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;生成HTTP请求&quot;&quot;&quot;</span><br>        http_request = <span class="hljs-string">f&quot;GET / HTTP/1.1\\nHost: example.com\\n\\n<span class="hljs-subst">&#123;data&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📱 <span class="hljs-subst">&#123;self.name&#125;</span>: 生成HTTP请求&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   请求: GET / HTTP/1.1&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   主机: example.com&quot;</span>)<br>        <span class="hljs-keyword">return</span> http_request<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decapsulate</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;解析HTTP响应&quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📱 <span class="hljs-subst">&#123;self.name&#125;</span>: 解析HTTP响应&quot;</span>)<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OSIModel</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;OSI七层模型&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 创建各层对象</span><br>        <span class="hljs-variable language_">self</span>.layers = [<br>            ApplicationLayer(),    <span class="hljs-comment"># 第7层</span><br>            PresentationLayer(),   <span class="hljs-comment"># 第6层</span><br>            SessionLayer(),        <span class="hljs-comment"># 第5层</span><br>            TransportLayer(),      <span class="hljs-comment"># 第4层</span><br>            NetworkLayer(),        <span class="hljs-comment"># 第3层</span><br>            DataLinkLayer(),       <span class="hljs-comment"># 第2层</span><br>            PhysicalLayer(),       <span class="hljs-comment"># 第1层</span><br>        ]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_data</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;发送数据：从应用层到物理层&quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;📤 数据发送过程（封装）&quot;</span>.center(<span class="hljs-number">70</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n原始数据: <span class="hljs-subst">&#123;data&#125;</span>\n&quot;</span>)<br><br>        current_data = data<br><br>        <span class="hljs-comment"># 从应用层到物理层，逐层封装</span><br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.layers:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;▼&#x27;</span> * <span class="hljs-number">35</span>&#125;</span>&quot;</span>)<br>            current_data = layer.encapsulate(current_data)<br>            <span class="hljs-keyword">if</span> layer.layer_num &gt; <span class="hljs-number">1</span>:  <span class="hljs-comment"># 物理层的输出太长，不显示完整数据</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   数据长度: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(current_data)&#125;</span> 字符&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-keyword">return</span> current_data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">receive_data</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;接收数据：从物理层到应用层&quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;📥 数据接收过程（解封装）&quot;</span>.center(<span class="hljs-number">70</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>        current_data = data<br><br>        <span class="hljs-comment"># 从物理层到应用层，逐层解封装</span><br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(<span class="hljs-variable language_">self</span>.layers):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;▲&#x27;</span> * <span class="hljs-number">35</span>&#125;</span>&quot;</span>)<br>            current_data = layer.decapsulate(current_data)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n最终数据: <span class="hljs-subst">&#123;current_data&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>        <span class="hljs-keyword">return</span> current_data<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;OSI七层模型数据封装演示&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n📚 本程序演示OSI七层模型的数据封装和解封装过程&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 创建OSI模型</span><br>    osi = OSIModel()<br><br>    <span class="hljs-comment"># 要发送的数据</span><br>    original_data = <span class="hljs-string">&quot;Hello, Network World!&quot;</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🎯 准备发送数据: \&quot;<span class="hljs-subst">&#123;original_data&#125;</span>\&quot;&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 发送数据（封装过程）</span><br>    transmitted_data = osi.send_data(original_data)<br><br>    <span class="hljs-comment"># 模拟数据传输</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;⚡&quot;</span> * <span class="hljs-number">35</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   数据通过网络传输中...&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚡&quot;</span> * <span class="hljs-number">35</span>)<br><br>    <span class="hljs-comment"># 接收数据（解封装过程）</span><br>    received_data = osi.receive_data(transmitted_data)<br><br>    <span class="hljs-comment"># 验证</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;✅ 传输完成！&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n发送的数据: <span class="hljs-subst">&#123;original_data&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;接收的数据: <span class="hljs-subst">&#123;received_data&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello, Network World!&quot;</span> <span class="hljs-keyword">in</span> received_data:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n🎉 数据传输成功！&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n❌ 数据传输失败！&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> code/day03<br>python day03_osi_demo.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><p>程序会详细展示数据在OSI七层模型中的封装和解封装过程，帮助你直观理解每一层的作用。</p><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ OSI七层模型是网络通信的标准模型</li><li>✅ 每一层都有明确的职责</li><li>✅ 数据发送时逐层封装，接收时逐层解封装</li><li>✅ 分层的优点是降低复杂度、便于维护</li></ol><h3 id="OSI七层速记">OSI七层速记</h3><table><thead><tr><th>层次</th><th>名称</th><th>关键词</th><th>协议示例</th></tr></thead><tbody><tr><td>7</td><td>应用层</td><td>用户接口</td><td>HTTP、FTP、DNS</td></tr><tr><td>6</td><td>表示层</td><td>格式转换</td><td>SSL、JPEG</td></tr><tr><td>5</td><td>会话层</td><td>会话管理</td><td>RPC、SQL</td></tr><tr><td>4</td><td>传输层</td><td>端到端</td><td>TCP、UDP</td></tr><tr><td>3</td><td>网络层</td><td>路由寻址</td><td>IP、ICMP</td></tr><tr><td>2</td><td>数据链路层</td><td>帧传输</td><td>Ethernet、WiFi</td></tr><tr><td>1</td><td>物理层</td><td>比特流</td><td>网线、光纤</td></tr></tbody></table><h3 id="重要概念">重要概念</h3><ul><li><strong>封装</strong>（Encapsulation）：发送数据时，逐层添加头部信息</li><li><strong>解封装</strong>（Decapsulation）：接收数据时，逐层移除头部信息</li><li><strong>PDU</strong>（Protocol Data Unit）：协议数据单元<ul><li>应用层：消息（Message）</li><li>传输层：段（Segment）</li><li>网络层：包（Packet）</li><li>数据链路层：帧（Frame）</li><li>物理层：比特（Bit）</li></ul></li></ul><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：层次识别">练习1：层次识别</h3><p>以下操作分别在哪一层完成？</p><ol><li>输入网址 <a href="http://www.baidu.com">www.baidu.com</a></li><li>将域名解析为IP地址</li><li>添加源端口和目标端口</li><li>选择路由路径</li><li>将数据转换为电信号</li></ol><h3 id="练习2：绘制封装过程">练习2：绘制封装过程</h3><p>画出&quot;发送一封邮件&quot;的完整封装过程，标注每一层添加的信息。</p><h3 id="练习3：思考题">练习3：思考题</h3><ol><li>为什么要分成7层？能不能只分3层或分10层？</li><li>如果没有分层，会有什么问题？</li><li>哪些层是软件实现的？哪些是硬件实现的？</li></ol><h3 id="练习4：代码扩展">练习4：代码扩展</h3><p>修改演示程序，添加以下功能：</p><ol><li>显示每层数据的大小变化</li><li>模拟数据在传输过程中丢失的情况</li><li>添加错误检测和重传机制</li></ol><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="OSI-vs-TCP-IP模型">OSI vs TCP/IP模型</h3><p>OSI是理论模型，TCP/IP是实际使用的模型：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs livescript">OSI七层模型              TCP/IP四层模型<br>┌─────────────┐<br>│  应用层     │ <span class="hljs-string">\</span>        ┌─────────────┐<br>├─────────────┤  <span class="hljs-string">\</span>       │  应用层     │<br>│  表示层     │   &#125; ───&gt; │             │<br>├─────────────┤  /       │             │<br>│  会话层     │ /        └─────────────┘<br>├─────────────┤          ┌─────────────┐<br>│  传输层     │  ─────&gt;  │  传输层     │<br>├─────────────┤          └─────────────┘<br>│  网络层     │  ─────&gt;  ┌─────────────┐<br>├─────────────┤          │  网络层     │<br>│ 数据链路层  │ <span class="hljs-string">\</span>        └─────────────┘<br>├─────────────┤  &#125; ───&gt;  ┌─────────────┐<br>│  物理层     │ /        │ 网络接口层  │<br>└─────────────┘          └─────────────┘<br></code></pre></td></tr></table></figure><p><strong>明天我们将详细学习TCP/IP模型！</strong></p><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第4天：TCP/IP四层模型</strong></p><p>我们将学习：</p><ul><li>TCP/IP模型和OSI模型的区别</li><li>TCP/IP各层的详细功能</li><li>实际网络中如何使用TCP/IP</li><li>编写程序分析真实的网络数据包</li></ul><hr><p>💡 <strong>今日金句</strong>：分层不是为了复杂化，而是为了简单化！</p><p>👉 <a href="day02.md">上一天：网络的分类和拓扑结构</a> | <a href="../../README.md">返回目录</a> | <a href="day04.md">下一天：TCP/IP四层模型</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2天：网络的分类和拓扑结构</title>
    <link href="/2025/11/10/2%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E5%88%86%E7%B1%BB%E5%92%8C%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/"/>
    <url>/2025/11/10/2%E5%A4%A9%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E5%88%86%E7%B1%BB%E5%92%8C%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h1>第2天：网络的分类和拓扑结构</h1><blockquote><p>“网络就像城市的交通系统，有不同的规模和不同的连接方式。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解网络的分类（LAN、WAN、MAN）</li><li>掌握网络拓扑结构的类型</li><li>编写程序：扫描局域网设备</li></ul><h2 id="🌐-网络的分类">🌐 网络的分类</h2><h3 id="按地理范围分类">按地理范围分类</h3><h4 id="1-局域网（LAN-Local-Area-Network）">1. 局域网（LAN - Local Area Network）</h4><p><strong>定义</strong>：覆盖范围较小的网络，通常在一个建筑物或校园内。</p><p><strong>生活中的例子</strong>：</p><ul><li>你家里的WiFi网络</li><li>公司办公室的网络</li><li>网吧的网络</li><li>学校机房的网络</li></ul><p><strong>特点</strong>：</p><ul><li>📏 范围：几米到几公里</li><li>🚀 速度：很快（100Mbps - 10Gbps）</li><li>💰 成本：低</li><li>👥 归属：个人或单位所有</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">类比理解：<br>局域网 <span class="hljs-operator">=</span> 你家的内部电话系统<br>只能在家里几个房间之间通话<br></code></pre></td></tr></table></figure><h4 id="2-城域网（MAN-Metropolitan-Area-Network）">2. 城域网（MAN - Metropolitan Area Network）</h4><p><strong>定义</strong>：覆盖一个城市范围的网络。</p><p><strong>生活中的例子</strong>：</p><ul><li>城市的有线电视网络</li><li>城市公共WiFi网络</li><li>城市监控网络</li></ul><p><strong>特点</strong>：</p><ul><li>📏 范围：几十公里</li><li>🚀 速度：较快</li><li>💰 成本：中等</li><li>👥 归属：通常是运营商或政府</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">类比理解：<br>城域网 <span class="hljs-operator">=</span> 城市的公交系统<br>连接城市内的不同区域<br></code></pre></td></tr></table></figure><h4 id="3-广域网（WAN-Wide-Area-Network）">3. 广域网（WAN - Wide Area Network）</h4><p><strong>定义</strong>：覆盖很大地理范围的网络，可以跨越国家和大洲。</p><p><strong>生活中的例子</strong>：</p><ul><li>互联网（Internet）</li><li>跨国公司的专用网络</li><li>电信运营商的骨干网</li></ul><p><strong>特点</strong>：</p><ul><li>📏 范围：几百到几万公里</li><li>🚀 速度：相对较慢</li><li>💰 成本：高</li><li>👥 归属：运营商或大型组织</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">类比理解：<br>广域网 <span class="hljs-operator">=</span> 国际航空网络<br>连接世界各地的城市<br></code></pre></td></tr></table></figure><h3 id="对比总结">对比总结</h3><table><thead><tr><th>类型</th><th>覆盖范围</th><th>传输速度</th><th>延迟</th><th>例子</th></tr></thead><tbody><tr><td>LAN</td><td>10m - 1km</td><td>最快</td><td>最低</td><td>家庭WiFi</td></tr><tr><td>MAN</td><td>10km - 100km</td><td>较快</td><td>较低</td><td>城市网络</td></tr><tr><td>WAN</td><td>100km+</td><td>较慢</td><td>较高</td><td>互联网</td></tr></tbody></table><h2 id="🔷-网络拓扑结构">🔷 网络拓扑结构</h2><p><strong>拓扑结构</strong>就是网络中各个设备的连接方式和布局形状。</p><h3 id="1-总线型拓扑（Bus-Topology）">1. 总线型拓扑（Bus Topology）</h3><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">设备A</span> <span class="hljs-literal">---</span> <span class="hljs-comment">设备B</span> <span class="hljs-literal">---</span> <span class="hljs-comment">设备C</span> <span class="hljs-literal">---</span> <span class="hljs-comment">设备D</span><br>         <span class="hljs-comment">|                      |</span><br>       <span class="hljs-comment">(总线)                (总线)</span><br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：布线简单，成本低</li><li>❌ 缺点：总线断了，整个网络瘫痪</li><li>📝 应用：早期以太网</li></ul><p><strong>类比</strong>：公交线路，所有站点都在一条线上</p><h3 id="2-星型拓扑（Star-Topology）">2. 星型拓扑（Star Topology）</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c">        设备B<br>          <span class="hljs-string">|</span><br>设备A <span class="hljs-punctuation">-</span><span class="hljs-punctuation">-</span> 交换机 <span class="hljs-punctuation">-</span><span class="hljs-punctuation">-</span> 设备C<br>          <span class="hljs-string">|</span><br>        设备D<br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：一个设备故障不影响其他设备</li><li>✅ 管理方便，易于排错</li><li>❌ 缺点：中心设备（交换机）故障，整个网络瘫痪</li><li>📝 应用：<strong>现代最常用的拓扑结构</strong></li></ul><p><strong>类比</strong>：太阳系，所有行星围绕太阳转</p><h3 id="3-环型拓扑（Ring-Topology）">3. 环型拓扑（Ring Topology）</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">设备A <span class="hljs-comment">--- 设备B</span><br>  |          |<br>设备D <span class="hljs-comment">--- 设备C</span><br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：数据传输路径确定</li><li>❌ 缺点：一个设备故障影响整个网络</li><li>📝 应用：令牌环网络（已较少使用）</li></ul><p><strong>类比</strong>：接力赛跑，每个人传递给下一个人</p><h3 id="4-网状型拓扑（Mesh-Topology）">4. 网状型拓扑（Mesh Topology）</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">设备A --- 设备B<br> |<span class="hljs-string"> \    / </span>|<br> |<span class="hljs-string">  \ /   </span>|<br> |<span class="hljs-string">  / \   </span>|<br> |<span class="hljs-string"> /    \ </span>|<br>设备D --- 设备C<br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：可靠性极高，有多条路径</li><li>❌ 缺点：布线复杂，成本高</li><li>📝 应用：军事网络、互联网骨干</li></ul><p><strong>类比</strong>：地铁网络，有多条线路可选</p><h3 id="5-树型拓扑（Tree-Topology）">5. 树型拓扑（Tree Topology）</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript">     根交换机<br>     /      <span class="hljs-string">\</span><br>  交换机A   交换机B<br>  /   <span class="hljs-string">\</span>      /   <span class="hljs-string">\</span><br>设备<span class="hljs-number">1</span> 设备<span class="hljs-number">2</span> 设备<span class="hljs-number">3</span> 设备<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>✅ 优点：易于扩展，层次清晰</li><li>❌ 缺点：根节点故障影响所有下级</li><li>📝 应用：企业网络、校园网</li></ul><p><strong>类比</strong>：公司组织架构</p><h2 id="🔧-实战项目：局域网设备扫描器">🔧 实战项目：局域网设备扫描器</h2><p>让我们编写一个程序，扫描你所在局域网内的所有设备！</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day02_lan_scanner.py</span><br><span class="hljs-comment"># 功能：扫描局域网内的活跃设备</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> ipaddress<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor, as_completed<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ip_and_subnet</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    获取本机IP地址和所在的子网</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        local_ip: 本机IP地址字符串</span><br><span class="hljs-string">        subnet: 子网字符串（如 &quot;192.168.1.0/24&quot;）</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 创建socket连接到外部地址，获取本机IP</span><br>        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)<br>        sock.connect((<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-number">80</span>))<br>        local_ip = sock.getsockname()[<span class="hljs-number">0</span>]<br>        sock.close()<br><br>        <span class="hljs-comment"># 从IP地址推断子网（假设是/24子网）</span><br>        <span class="hljs-comment"># 例如：192.168.1.100 -&gt; 192.168.1.0/24</span><br>        ip_parts = local_ip.split(<span class="hljs-string">&#x27;.&#x27;</span>)<br>        subnet = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">0</span>]&#125;</span>.<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">1</span>]&#125;</span>.<span class="hljs-subst">&#123;ip_parts[<span class="hljs-number">2</span>]&#125;</span>.0/24&quot;</span><br><br>        <span class="hljs-keyword">return</span> local_ip, subnet<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;获取本机IP失败：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_host</span>(<span class="hljs-params">ip, timeout=<span class="hljs-number">0.5</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    检查指定IP的主机是否在线</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        ip: 要检查的IP地址</span><br><span class="hljs-string">        timeout: 超时时间（秒）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        如果主机在线，返回(ip, hostname)</span><br><span class="hljs-string">        如果主机不在线，返回None</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        尝试连接到目标IP的常用端口（80端口）</span><br><span class="hljs-string">        如果能连接，说明主机在线</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 尝试连接到80端口（HTTP端口）</span><br>        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>        sock.settimeout(timeout)<br><br>        <span class="hljs-comment"># 尝试连接</span><br>        result = sock.connect_ex((<span class="hljs-built_in">str</span>(ip), <span class="hljs-number">80</span>))<br><br>        <span class="hljs-keyword">if</span> result == <span class="hljs-number">0</span>:<br>            <span class="hljs-comment"># 连接成功，尝试获取主机名</span><br>            <span class="hljs-keyword">try</span>:<br>                hostname = socket.gethostbyaddr(<span class="hljs-built_in">str</span>(ip))[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">except</span>:<br>                hostname = <span class="hljs-string">&quot;未知主机名&quot;</span><br><br>            sock.close()<br>            <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(ip), hostname)<br>        <span class="hljs-keyword">else</span>:<br>            sock.close()<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ping_check</span>(<span class="hljs-params">ip, timeout=<span class="hljs-number">0.5</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    使用更简单的方法检测主机是否在线</span><br><span class="hljs-string">    尝试多个常用端口</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    common_ports = [<span class="hljs-number">80</span>, <span class="hljs-number">443</span>, <span class="hljs-number">22</span>, <span class="hljs-number">445</span>, <span class="hljs-number">139</span>]  <span class="hljs-comment"># HTTP, HTTPS, SSH, SMB</span><br><br>    <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> common_ports:<br>        <span class="hljs-keyword">try</span>:<br>            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>            sock.settimeout(timeout)<br>            result = sock.connect_ex((<span class="hljs-built_in">str</span>(ip), port))<br>            sock.close()<br><br>            <span class="hljs-keyword">if</span> result == <span class="hljs-number">0</span>:<br>                <span class="hljs-comment"># 尝试获取主机名</span><br>                <span class="hljs-keyword">try</span>:<br>                    hostname = socket.gethostbyaddr(<span class="hljs-built_in">str</span>(ip))[<span class="hljs-number">0</span>]<br>                <span class="hljs-keyword">except</span>:<br>                    hostname = <span class="hljs-string">&quot;未知主机名&quot;</span><br><br>                <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(ip), hostname, port)<br><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_network</span>(<span class="hljs-params">subnet, max_workers=<span class="hljs-number">50</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    扫描整个子网</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        subnet: 子网地址（如 &quot;192.168.1.0/24&quot;）</span><br><span class="hljs-string">        max_workers: 最大线程数</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        活跃主机列表</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 解析子网，获取所有IP地址</span><br>    network = ipaddress.ip_network(subnet, strict=<span class="hljs-literal">False</span>)<br>    total_hosts = network.num_addresses - <span class="hljs-number">2</span>  <span class="hljs-comment"># 减去网络地址和广播地址</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🔍 开始扫描子网: <span class="hljs-subst">&#123;subnet&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📊 总共需要扫描 <span class="hljs-subst">&#123;total_hosts&#125;</span> 个IP地址&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;⏳ 请稍候...\n&quot;</span>)<br><br>    active_hosts = []<br>    scanned = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># 使用线程池并发扫描</span><br>    <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=max_workers) <span class="hljs-keyword">as</span> executor:<br>        <span class="hljs-comment"># 提交所有扫描任务</span><br>        future_to_ip = &#123;<br>            executor.submit(ping_check, ip): ip<br>            <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> network.hosts()  <span class="hljs-comment"># 排除网络地址和广播地址</span><br>        &#125;<br><br>        <span class="hljs-comment"># 处理完成的任务</span><br>        <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(future_to_ip):<br>            scanned += <span class="hljs-number">1</span><br>            result = future.result()<br><br>            <span class="hljs-keyword">if</span> result:<br>                ip, hostname, port = result<br>                active_hosts.append((ip, hostname, port))<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 发现设备: <span class="hljs-subst">&#123;ip:<span class="hljs-number">15</span>&#125;</span> | <span class="hljs-subst">&#123;hostname:<span class="hljs-number">30</span>&#125;</span> | 端口: <span class="hljs-subst">&#123;port&#125;</span>&quot;</span>)<br><br>            <span class="hljs-comment"># 显示进度</span><br>            <span class="hljs-keyword">if</span> scanned % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:<br>                progress = (scanned / total_hosts) * <span class="hljs-number">100</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   进度: <span class="hljs-subst">&#123;progress:<span class="hljs-number">.1</span>f&#125;</span>% (<span class="hljs-subst">&#123;scanned&#125;</span>/<span class="hljs-subst">&#123;total_hosts&#125;</span>)&quot;</span>, end=<span class="hljs-string">&#x27;\r&#x27;</span>)<br><br>    <span class="hljs-keyword">return</span> active_hosts<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">display_topology</span>(<span class="hljs-params">active_hosts, local_ip</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    显示网络拓扑结构（简化版）</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;网络拓扑结构（星型拓扑）&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;                      [路由器/交换机]&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;                             |&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;          &quot;</span> + <span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">40</span>)<br><br>    <span class="hljs-keyword">for</span> ip, hostname, port <span class="hljs-keyword">in</span> active_hosts:<br>        marker = <span class="hljs-string">&quot; (本机)&quot;</span> <span class="hljs-keyword">if</span> ip == local_ip <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;          |-- [<span class="hljs-subst">&#123;ip&#125;</span>] <span class="hljs-subst">&#123;hostname&#125;</span><span class="hljs-subst">&#123;marker&#125;</span>&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;局域网设备扫描器&quot;</span>.center(<span class="hljs-number">70</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取本机IP和子网</span><br>    local_ip, subnet = get_local_ip_and_subnet()<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> local_ip:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 无法获取本机IP地址，请检查网络连接！&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📍 本机IP: <span class="hljs-subst">&#123;local_ip&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;🌐 所在子网: <span class="hljs-subst">&#123;subnet&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 扫描网络</span><br>    active_hosts = scan_network(subnet)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✨ 扫描完成！共发现 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(active_hosts)&#125;</span> 台活跃设备&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">70</span>)<br><br>    <span class="hljs-comment"># 显示详细信息</span><br>    <span class="hljs-keyword">if</span> active_hosts:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n📋 活跃设备列表：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;IP地址&#x27;</span>:&lt;<span class="hljs-number">15</span>&#125;</span> | <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;主机名&#x27;</span>:&lt;<span class="hljs-number">30</span>&#125;</span> | <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;开放端口&#x27;</span>&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">70</span>)<br><br>        <span class="hljs-keyword">for</span> ip, hostname, port <span class="hljs-keyword">in</span> active_hosts:<br>            marker = <span class="hljs-string">&quot; ⭐&quot;</span> <span class="hljs-keyword">if</span> ip == local_ip <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ip:&lt;<span class="hljs-number">15</span>&#125;</span> | <span class="hljs-subst">&#123;hostname:&lt;<span class="hljs-number">30</span>&#125;</span> | <span class="hljs-subst">&#123;port&#125;</span><span class="hljs-subst">&#123;marker&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># 显示拓扑结构</span><br>        display_topology(active_hosts, local_ip)<br><br>        <span class="hljs-comment"># 分析网络类型</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n💡 网络分析：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - 这是一个局域网（LAN）&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - 使用星型拓扑结构&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - 共有 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(active_hosts)&#125;</span> 台设备连接到同一个交换机/路由器&quot;</span>)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n⚠️  未发现其他活跃设备&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> code/day02<br>python day02_lan_scanner.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">======================================================================<br>                         局域网设备扫描器<br>======================================================================<br><br>📍 本机IP: 192.168.1.100<br>🌐 所在子网: 192.168.1.0/24<br><br>🔍 开始扫描子网: 192.168.1.0/24<br>📊 总共需要扫描 254 个IP地址<br>⏳ 请稍候...<br><br>✅ 发现设备: 192.168.1.1     | router.home                     | 端口: 80<br>✅ 发现设备: 192.168.1.100   | linzhibin-MacBook              | 端口: 80<br>✅ 发现设备: 192.168.1.105   | xiaomi-phone                   | 端口: 443<br><br>======================================================================<br>✨ 扫描完成！共发现 3 台活跃设备<br>======================================================================<br><br>📋 活跃设备列表：<br><span class="hljs-section">IP地址           | 主机名                          | 开放端口</span><br><span class="hljs-section">----------------------------------------------------------------------</span><br>192.168.1.1     | router.home                    | 80<br>192.168.1.100   | linzhibin-MacBook              | 80 ⭐<br>192.168.1.105   | xiaomi-phone                   | 443<br><br>======================================================================<br>                    网络拓扑结构（星型拓扑）<br>======================================================================<br><br><span class="hljs-code">                      [路由器/交换机]</span><br><span class="hljs-code">                             |</span><br><span class="hljs-code">          ----------------------------------------</span><br><span class="hljs-code">          |-- [192.168.1.1] router.home</span><br><span class="hljs-code">          |-- [192.168.1.100] linzhibin-MacBook (本机)</span><br><span class="hljs-code">          |-- [192.168.1.105] xiaomi-phone</span><br><br>======================================================================<br><br>💡 网络分析：<br>   - 这是一个局域网（LAN）<br>   - 使用星型拓扑结构<br>   - 共有 3 台设备连接到同一个交换机/路由器<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="1-ipaddress模块">1. ipaddress模块</h3><p>Python的<code>ipaddress</code>模块用于处理IP地址和网络：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> ipaddress<br><br><span class="hljs-comment"># 创建网络对象</span><br>network = ipaddress.ip_network(<span class="hljs-string">&quot;192.168.1.0/24&quot;</span>)<br><br><span class="hljs-comment"># 获取网络中的所有主机IP</span><br><span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> network.hosts():<br>    <span class="hljs-built_in">print</span>(ip)  <span class="hljs-comment"># 192.168.1.1, 192.168.1.2, ..., 192.168.1.254</span><br></code></pre></td></tr></table></figure><h3 id="2-子网掩码-24-是什么意思？">2. 子网掩码 /24 是什么意思？</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span> 的含义：<br><br>/<span class="hljs-number">24</span> 表示子网掩码有<span class="hljs-number">24</span>个<span class="hljs-number">1</span>：<br><span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">11111111</span>.<span class="hljs-number">00000000</span><br>即：<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">0</span><br><br>可用IP范围：<br><span class="hljs-number">192.168.1.1</span> 到 <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">254</span>（共<span class="hljs-number">254</span>个）<br><span class="hljs-number">192.168.1.0</span> 是网络地址<br><span class="hljs-number">192.168.1.255</span> 是广播地址<br></code></pre></td></tr></table></figure><h3 id="3-ThreadPoolExecutor-并发扫描">3. ThreadPoolExecutor 并发扫描</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><br><span class="hljs-comment"># 创建线程池，最多50个线程同时工作</span><br><span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">50</span>) <span class="hljs-keyword">as</span> executor:<br>    <span class="hljs-comment"># 提交任务</span><br>    futures = [executor.submit(scan_ip, ip) <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> ip_list]<br><br>    <span class="hljs-comment"># 等待完成</span><br>    <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(futures):<br>        result = future.result()<br></code></pre></td></tr></table></figure><p><strong>为什么要用多线程？</strong></p><ul><li>单线程扫描254个IP需要很长时间</li><li>多线程可以同时扫描多个IP，大大提高效率</li><li>50个线程可以让扫描速度提升几十倍</li></ul><h3 id="4-connect-ex方法">4. connect_ex方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">result = sock.connect_ex((ip, port))<br><br><span class="hljs-comment"># 返回值：</span><br><span class="hljs-comment"># 0 = 连接成功</span><br><span class="hljs-comment"># 其他 = 连接失败（错误码）</span><br></code></pre></td></tr></table></figure><p>这比普通的<code>connect()</code>方法更好，因为失败时不会抛出异常。</p><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ 网络按范围分为LAN、MAN、WAN</li><li>✅ 家庭和办公室网络是局域网（LAN）</li><li>✅ 网络拓扑结构有5种：总线、星型、环型、网状、树型</li><li>✅ 现代网络最常用星型拓扑结构</li><li>✅ 子网的概念和表示方法</li><li>✅ 如何扫描局域网内的设备</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>解释</th><th>例子</th></tr></thead><tbody><tr><td>局域网</td><td>小范围的网络</td><td>家庭WiFi</td></tr><tr><td>星型拓扑</td><td>所有设备连接到中心节点</td><td>所有电脑连接到路由器</td></tr><tr><td>子网</td><td>一个网络的子集</td><td>192.168.1.0/24</td></tr><tr><td>主机</td><td>网络中的设备</td><td>你的电脑、手机</td></tr></tbody></table><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：识别拓扑类型">练习1：识别拓扑类型</h3><p>说出以下场景使用的是什么拓扑结构：</p><ol><li>所有教室的电脑都连接到机房的交换机</li><li>地铁13号线各个站点的连接</li><li>互联网骨干网的连接方式</li></ol><h3 id="练习2：修改扫描器">练习2：修改扫描器</h3><p>修改程序，让它可以：</p><ol><li>扫描自定义的子网（不是默认的/24）</li><li>显示每个设备的响应时间</li><li>保存扫描结果到文件</li></ol><h3 id="练习3：计算题">练习3：计算题</h3><p>一个192.168.1.0/24的网络：</p><ol><li>子网掩码是多少？</li><li>第一个可用IP是多少？</li><li>最后一个可用IP是多少？</li><li>总共有多少个可用IP？</li></ol><h3 id="练习4：绘制拓扑图">练习4：绘制拓扑图</h3><p>绘制你家里或公司的网络拓扑结构图，标注：</p><ul><li>所有设备（电脑、手机、打印机等）</li><li>路由器/交换机</li><li>连接方式（有线/无线）</li></ul><h2 id="📚-扩展阅读">📚 扩展阅读</h2><h3 id="为什么星型拓扑最流行？">为什么星型拓扑最流行？</h3><p><strong>历史原因</strong>：</p><ul><li>早期使用总线型拓扑（10BASE-2同轴电缆）</li><li>问题：一根线断了，所有设备都不能用</li><li>星型拓扑解决了这个问题</li></ul><p><strong>现代优势</strong>：</p><ul><li>便于管理：可以在交换机上管理每个端口</li><li>易于排错：某个设备故障不影响其他设备</li><li>易于扩展：只需在交换机上增加端口</li><li>性能好：交换机可以智能转发数据</li></ul><h3 id="家庭网络的实际拓扑">家庭网络的实际拓扑</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs 1c">互联网<br>  <span class="hljs-string">|</span><br>光猫<br>  <span class="hljs-string">|</span><br>路由器（WiFi）<br>  <span class="hljs-string">|</span><br>  <span class="hljs-string">|---- 电脑（有线）</span><br>  <span class="hljs-string">|---- 手机（无线）</span><br>  <span class="hljs-string">|---- 平板（无线）</span><br>  <span class="hljs-string">|---- 智能电视（有线）</span><br>  <span class="hljs-string">|---- 智能音箱（无线）</span><br></code></pre></td></tr></table></figure><p>这是一个典型的<strong>星型拓扑</strong>！</p><h3 id="企业网络的拓扑">企业网络的拓扑</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript">     核心交换机（根）<br>       /      <span class="hljs-string">\</span><br>  交换机A    交换机B<br>  /   <span class="hljs-string">\</span>       /   <span class="hljs-string">\</span><br>电脑<span class="hljs-number">1</span> 电脑<span class="hljs-number">2</span> 电脑<span class="hljs-number">3</span> 电脑<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>这是一个<strong>树型拓扑</strong>（也叫分层星型拓扑）！</p><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第3天：OSI七层模型</strong></p><p>我们将学习：</p><ul><li>什么是OSI七层模型？</li><li>每一层做什么？</li><li>为什么要分层？</li><li>编写程序分析各层的作用</li></ul><hr><p>💡 <strong>今日金句</strong>：网络拓扑就像城市规划，不同的结构有不同的优缺点！</p><p>👉 <a href="day01.md">上一天：认识计算机网络</a> | <a href="../../README.md">返回目录</a> | <a href="day03.md">下一天：OSI七层模型</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>1天：认识计算机网络</title>
    <link href="/2025/11/10/1%E5%A4%A9%EF%BC%9A%E8%AE%A4%E8%AF%86%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    <url>/2025/11/10/1%E5%A4%A9%EF%BC%9A%E8%AE%A4%E8%AF%86%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
    
    <content type="html"><![CDATA[<h1>第1天：认识计算机网络</h1><blockquote><p>“互联网就像一张巨大的蜘蛛网，连接着全世界的计算机。”</p></blockquote><h2 id="📚-今日目标">📚 今日目标</h2><ul><li>理解什么是计算机网络</li><li>了解网络的作用和重要性</li><li>编写第一个网络程序：检测网络连接</li></ul><h2 id="🎯-什么是计算机网络？">🎯 什么是计算机网络？</h2><h3 id="生活化理解">生活化理解</h3><p>想象一下你在用微信聊天：</p><ol><li>你在北京发了一条消息</li><li>你的朋友在上海收到了这条消息</li><li>中间发生了什么？</li></ol><p>这就是计算机网络在工作！</p><p><strong>计算机网络</strong>就是把分散在不同地点的计算机通过通信线路连接起来，实现资源共享和信息传递的系统。</p><h3 id="网络的三个关键要素">网络的三个关键要素</h3><ol><li><strong>计算机</strong>（节点）：发送和接收信息的设备</li><li><strong>通信线路</strong>（链路）：传输信息的介质（网线、WiFi、光纤等）</li><li><strong>协议</strong>（规则）：计算机之间交流的&quot;语言&quot;</li></ol><h3 id="类比理解">类比理解</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">计算机网络 <span class="hljs-operator">=</span> 快递系统<br><br>你的电脑  →  寄件人<br>网络线路  →  快递车、飞机<br>路由器    →  中转站<br>协议      →  包裹规格、运输规则<br>目标电脑  →  收件人<br></code></pre></td></tr></table></figure><h2 id="💡-网络能做什么？">💡 网络能做什么？</h2><h3 id="1-资源共享">1. 资源共享</h3><ul><li>共享打印机</li><li>共享文件</li><li>共享数据库</li></ul><h3 id="2-信息传递">2. 信息传递</h3><ul><li>发送邮件</li><li>网页浏览</li><li>视频通话</li><li>在线游戏</li></ul><h3 id="3-分布式计算">3. 分布式计算</h3><ul><li>云计算</li><li>区块链</li><li>大数据处理</li></ul><h2 id="🔧-实战项目：检测网络连接">🔧 实战项目：检测网络连接</h2><p>让我们编写第一个网络程序！这个程序会检测你的电脑是否连接到互联网。</p><h3 id="代码实现">代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># day01_network_checker.py</span><br><span class="hljs-comment"># 功能：检测网络连接状态</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_internet_connection</span>(<span class="hljs-params">host=<span class="hljs-string">&quot;8.8.8.8&quot;</span>, port=<span class="hljs-number">53</span>, timeout=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    检测是否能连接到互联网</span><br><span class="hljs-string"></span><br><span class="hljs-string">    参数说明：</span><br><span class="hljs-string">        host: 目标主机IP地址（默认使用Google的DNS服务器 8.8.8.8）</span><br><span class="hljs-string">        port: 目标端口（53是DNS服务的标准端口）</span><br><span class="hljs-string">        timeout: 超时时间（秒）</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回值：</span><br><span class="hljs-string">        True: 网络连接正常</span><br><span class="hljs-string">        False: 网络连接失败</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        尝试创建一个socket连接到指定的服务器</span><br><span class="hljs-string">        如果能连接成功，说明网络是通的</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 创建一个socket对象</span><br>        <span class="hljs-comment"># AF_INET表示IPv4地址</span><br>        <span class="hljs-comment"># SOCK_STREAM表示TCP协议</span><br>        socket.setdefaulttimeout(timeout)<br>        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br><br>        <span class="hljs-comment"># 尝试连接到目标主机的指定端口</span><br>        sock.connect((host, port))<br><br>        <span class="hljs-comment"># 连接成功，关闭socket</span><br>        sock.close()<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># 连接失败，说明网络不通</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;连接失败：<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ip</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    获取本机的IP地址</span><br><span class="hljs-string"></span><br><span class="hljs-string">    工作原理：</span><br><span class="hljs-string">        创建一个UDP socket，连接到外部地址（不会真正发送数据）</span><br><span class="hljs-string">        通过这个socket获取本机的IP地址</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 创建UDP socket</span><br>        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)<br><br>        <span class="hljs-comment"># 连接到一个外部地址（这里不会真正发送数据）</span><br>        <span class="hljs-comment"># 使用Google的DNS服务器地址</span><br>        sock.connect((<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-number">80</span>))<br><br>        <span class="hljs-comment"># 获取本机的IP地址</span><br>        local_ip = sock.getsockname()[<span class="hljs-number">0</span>]<br><br>        sock.close()<br>        <span class="hljs-keyword">return</span> local_ip<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;无法获取IP地址&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_hostname</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    获取计算机的主机名</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> socket.gethostname()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;未知主机名&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数：执行网络检测并显示结果</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;网络连接检测工具&quot;</span>.center(<span class="hljs-number">50</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 获取主机名</span><br>    hostname = get_hostname()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📌 主机名: <span class="hljs-subst">&#123;hostname&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># 获取本机IP地址</span><br>    local_ip = get_local_ip()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📍 本机IP地址: <span class="hljs-subst">&#123;local_ip&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 检测网络连接</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;🔍 正在检测网络连接...&quot;</span>)<br><br>    <span class="hljs-comment"># 测试多个服务器</span><br>    test_servers = [<br>        (<span class="hljs-string">&quot;8.8.8.8&quot;</span>, <span class="hljs-string">&quot;Google DNS&quot;</span>),<br>        (<span class="hljs-string">&quot;114.114.114.114&quot;</span>, <span class="hljs-string">&quot;国内DNS&quot;</span>),<br>        (<span class="hljs-string">&quot;1.1.1.1&quot;</span>, <span class="hljs-string">&quot;Cloudflare DNS&quot;</span>)<br>    ]<br><br>    connected = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> ip, name <span class="hljs-keyword">in</span> test_servers:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   测试连接到 <span class="hljs-subst">&#123;name&#125;</span> (<span class="hljs-subst">&#123;ip&#125;</span>)...&quot;</span>, end=<span class="hljs-string">&quot; &quot;</span>)<br>        <span class="hljs-keyword">if</span> check_internet_connection(ip):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;✅ 成功&quot;</span>)<br>            connected = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ 失败&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-keyword">if</span> connected:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;🎉 网络连接正常！&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 这意味着你的电脑可以访问互联网上的其他计算机。&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚠️  网络连接异常！&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;💡 请检查：&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   1. 网线是否插好？&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   2. WiFi是否连接？&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   3. 路由器是否正常工作？&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">50</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="运行程序">运行程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> code/day01<br>python day01_network_checker.py<br></code></pre></td></tr></table></figure><h3 id="预期输出">预期输出</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">==================================================<br>                网络连接检测工具<br>==================================================<br><br>📌 主机名: linzhibin-MacBook<br>📍 本机IP地址: 192.168.1.100<br><br>🔍 正在检测网络连接...<br><span class="hljs-code">   测试连接到 Google DNS (8.8.8.8)... ✅ 成功</span><br><span class="hljs-code">   测试连接到 国内DNS (114.114.114.114)... ✅ 成功</span><br><span class="hljs-code">   测试连接到 Cloudflare DNS (1.1.1.1)... ✅ 成功</span><br><br>🎉 网络连接正常！<br>💡 这意味着你的电脑可以访问互联网上的其他计算机。<br><br>==================================================<br></code></pre></td></tr></table></figure><h2 id="🔍-代码详解">🔍 代码详解</h2><h3 id="Socket是什么？">Socket是什么？</h3><p><strong>Socket</strong>（套接字）是网络编程的基础，可以理解为：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">Socket</span> <span class="hljs-operator">=</span> 电话机<br><br>建立连接   →  拨号<br>发送数据   →  说话<br>接收数据   →  听对方说话<br>关闭连接   →  挂断电话<br></code></pre></td></tr></table></figure><h3 id="为什么用8-8-8-8？">为什么用8.8.8.8？</h3><ul><li><code>8.8.8.8</code> 是Google提供的公共DNS服务器</li><li>它几乎24小时在线，非常稳定</li><li>如果能连接到它，说明网络是通的</li></ul><h3 id="AF-INET-和-SOCK-STREAM-是什么？">AF_INET 和 SOCK_STREAM 是什么？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">socket.AF_INET       <span class="hljs-comment"># 使用IPv4地址</span><br>socket.AF_INET6      <span class="hljs-comment"># 使用IPv6地址</span><br><br>socket.SOCK_STREAM   <span class="hljs-comment"># TCP协议（可靠传输）</span><br>socket.SOCK_DGRAM    <span class="hljs-comment"># UDP协议（快速传输）</span><br></code></pre></td></tr></table></figure><h2 id="🎓-知识小结">🎓 知识小结</h2><h3 id="今天学到了什么？">今天学到了什么？</h3><ol><li>✅ 计算机网络是连接多台计算机的系统</li><li>✅ 网络由计算机、通信线路和协议组成</li><li>✅ Socket是网络编程的基础工具</li><li>✅ 可以通过连接DNS服务器来检测网络状态</li></ol><h3 id="重要概念">重要概念</h3><table><thead><tr><th>概念</th><th>解释</th><th>比喻</th></tr></thead><tbody><tr><td>计算机网络</td><td>多台计算机互联的系统</td><td>快递网络</td></tr><tr><td>Socket</td><td>网络编程接口</td><td>电话机</td></tr><tr><td>IP地址</td><td>计算机在网络中的地址</td><td>家庭住址</td></tr><tr><td>端口</td><td>应用程序的标识号</td><td>门牌号</td></tr></tbody></table><h2 id="💪-练习题">💪 练习题</h2><h3 id="练习1：修改代码">练习1：修改代码</h3><p>修改程序，让它可以检测连接到百度服务器（220.181.38.148）</p><h3 id="练习2：思考题">练习2：思考题</h3><ol><li>为什么我们使用DNS服务器（端口53）而不是HTTP服务器（端口80）来测试？</li><li>本机IP地址和互联网IP地址有什么区别？</li></ol><h3 id="练习3：扩展功能">练习3：扩展功能</h3><p>尝试添加功能：显示连接到目标服务器所需的时间（提示：使用time模块）</p><h2 id="📚-扩展阅读">📚 扩展阅读</h2><ul><li>IP地址是什么？（明天会详细讲解）</li><li>DNS是什么？（第15天会详细讲解）</li><li>TCP和UDP有什么区别？（第36天会详细讲解）</li></ul><h2 id="🎯-明天预告">🎯 明天预告</h2><p><strong>第2天：网络的分类和拓扑结构</strong></p><p>我们将学习：</p><ul><li>LAN、WAN、MAN是什么？</li><li>网络拓扑结构有哪些？</li><li>如何绘制网络拓扑图？</li></ul><hr><p>💡 <strong>今日金句</strong>：万丈高楼平地起，网络学习第一步！</p><p>👉 <a href="../../README.md">返回目录</a> | <a href="day02.md">下一天：网络的分类和拓扑结构</a></p>]]></content>
    
    
    <categories>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Network, Book, Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>about</title>
    <link href="/2025/10/29/about/"/>
    <url>/2025/10/29/about/</url>
    
    <content type="html"><![CDATA[<p>第一阶段（快速提升趣味性）：</p><ol><li>机缘系统 - 增加随机惊喜</li><li>连招系统 - 让战斗更有策略</li><li>灵兽系统 - 增加收集要素</li></ol><p>第二阶段（增加深度）：<br>4. 悟道系统 - 策略性成长<br>5. 道侣系统 - 情感投入<br>6. 秘境探索 - 内容扩充</p><p>第三阶段（长期目标）：<br>7. 成就系统 - 增加重玩价值<br>8. 轮回强化 - New Game+<br>9. 动态剧情 - 提升叙事品质</p><p>小应用思路：</p><p>聚焦“每日情绪打卡＋简易建议”应用</p><p>或“短时放松 + 呼吸／冥想”模块：适合美国用户快节奏生活</p><p>强化 iOS 本地处理＋隐私保障，会是加分项</p><p>本地化社群+手帐/规划应用</p><p>为什么有机会：欧洲多个国家语言多样、用户偏好本地化服务；且“轻量规划工具”在小应用里好切入。<br>小应用思路：</p><p>针对某国（如德国、法国、西班牙）市场的“月度预算规划＋支出可视化”工具</p><p>或“学习某语言／文化习惯”辅助工具：结合当地节日、任务打卡</p><p>强调“数据留设备端”“隐私保护”作为卖点</p>]]></content>
    
    
    
    <tags>
      
      <tag>“info&quot;,&quot;zen&quot;</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>myruls</title>
    <link href="/2025/10/29/myruls/"/>
    <url>/2025/10/29/myruls/</url>
    
    <content type="html"><![CDATA[<p>日常收集到的一些当时可能觉得有趣的东西</p><h1>AI</h1><p><a href="https://github.com/B3o/GPTS-Prompt-Collection">提示词搜集</a></p><h1>素材</h1><p><a href="https://github.com/renpy/renpy">回合制游戏引擎</a></p><p><a href="https://github.com/CorentinTh/it-tools">IT工具</a></p><p><a href="https://github.com/qdhenry/Claude-Command-Suite">Skills</a></p><p><a href="https://github.com/collections/game-engines">游戏引擎集合</a></p><h1>VPS</h1><p><a href="https://cloud.zheanyun.com">浙安云</a></p><p><a href="https://app.cloudcone.com">cloudcone</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>“url”,&quot;project&quot;</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
